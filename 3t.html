<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Time Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  
  <!-- New Modular CSS Architecture -->

  <script type="module" crossorigin>import{openDB as Rt}from"https://cdn.jsdelivr.net/npm/idb@7.1.1/build/index.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const Ot="TaskTimeTracker",Ft=10,S=Rt(Ot,Ft,{upgrade(e,t){if(console.log("Upgrading database from version",t),t<1){const s=e.createObjectStore("tasks",{keyPath:"id",autoIncrement:!0});s.createIndex("dueOn","dueOn"),s.createIndex("status","status"),s.createIndex("urgency","urgency");const o=e.createObjectStore("timeLogs",{keyPath:"id",autoIncrement:!0});o.createIndex("taskId","taskId"),o.createIndex("dateLogged","dateLogged")}if(t<5){if(!e.objectStoreNames.contains("todos")){const s=e.createObjectStore("todos",{keyPath:"id",autoIncrement:!0});s.createIndex("date","date"),s.createIndex("completed","completed")}e.objectStoreNames.contains("accomplishments")||e.createObjectStore("accomplishments",{keyPath:"id",autoIncrement:!0}).createIndex("date","date")}if(t<6&&!e.objectStoreNames.contains("workSessions")){const s=e.createObjectStore("workSessions",{keyPath:"id",autoIncrement:!0});s.createIndex("date","date"),s.createIndex("punchIn","punchIn"),s.createIndex("punchOut","punchOut")}if(t<7&&!e.objectStoreNames.contains("categoryLists")){const s=e.createObjectStore("categoryLists",{keyPath:"id",autoIncrement:!0});s.createIndex("slug","slug",{unique:!0}),s.createIndex("title","title")}if(t<8&&!e.objectStoreNames.contains("remainingHoursHistory")){const s=e.createObjectStore("remainingHoursHistory",{keyPath:"id",autoIncrement:!0});s.createIndex("taskId","taskId"),s.createIndex("timestamp","timestamp")}if(t<9){if(!e.objectStoreNames.contains("projects")){const s=e.createObjectStore("projects",{keyPath:"id",autoIncrement:!0});s.createIndex("name","name"),s.createIndex("status","status")}e.objectStoreNames.contains("phases")||e.createObjectStore("phases",{keyPath:"id",autoIncrement:!0}).createIndex("name","name")}if(t<10&&(e.objectStoreNames.contains("phases")&&e.deleteObjectStore("phases"),!e.objectStoreNames.contains("phaseLists"))){const s=e.createObjectStore("phaseLists",{keyPath:"id",autoIncrement:!0});s.createIndex("slug","slug",{unique:!0}),s.createIndex("title","title")}}});class Wt{constructor(){this.listeners={},this.debug=!1}on(t,s){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(s),this.debug&&console.log(`[EventBus] Subscribed to '${t}' (${this.listeners[t].length} listeners)`),()=>this.off(t,s)}once(t,s){const o=(...a)=>{s(...a),this.off(t,o)};return this.on(t,o)}off(t,s){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(o=>o!==s),this.debug&&console.log(`[EventBus] Unsubscribed from '${t}' (${this.listeners[t].length} listeners remaining)`),this.listeners[t].length===0&&delete this.listeners[t])}clear(t=null){t?(delete this.listeners[t],this.debug&&console.log(`[EventBus] Cleared all listeners for '${t}'`)):(this.listeners={},this.debug&&console.log("[EventBus] Cleared all listeners"))}emit(t,s){if(!this.listeners[t]||this.listeners[t].length===0){this.debug&&console.log(`[EventBus] No listeners for '${t}'`);return}this.debug&&console.log(`[EventBus] Emitting '${t}' to ${this.listeners[t].length} listener(s)`,s),this.listeners[t].forEach(o=>{try{o(s)}catch(a){console.error(`[EventBus] Error in listener for '${t}':`,a)}})}listenerCount(t){return this.listeners[t]?this.listeners[t].length:0}eventNames(){return Object.keys(this.listeners)}setDebug(t){this.debug=t,console.log(`[EventBus] Debug mode ${t?"enabled":"disabled"}`)}}const I=new Wt;let Me="board",lt=0,Ae=jt();function jt(){try{const e=localStorage.getItem("trackerSpaceportSession");if(e){const t=JSON.parse(e);return t.rockets&&Array.isArray(t.rockets)?t.rockets=new Map(t.rockets):t.rockets=new Map,console.log("Loaded spaceport session from storage:",t),t}}catch(e){console.warn("Could not load spaceport session from localStorage:",e)}return{isOperational:!1,startTime:null,activeRocket:null,rockets:new Map,sessionStartTime:null,launchPads:[]}}function qt(){try{const e={...Ae,rockets:Array.from(Ae.rockets.entries())};localStorage.setItem("trackerSpaceportSession",JSON.stringify(e))}catch(e){console.warn("Could not save spaceport session to localStorage:",e)}}let N=Nt();function Nt(){try{const e=localStorage.getItem("trackerGlobalFilters");if(e)return JSON.parse(e)}catch(e){console.warn("Could not load filters from localStorage:",e)}return{projectId:null,phaseId:null,categoryId:null,dateRange:null}}function rt(){try{localStorage.setItem("trackerGlobalFilters",JSON.stringify(N))}catch(e){console.warn("Could not save filters to localStorage:",e)}}function ne(){return Me}function zt(e){["board","month","calendar","today","spaceport","work","reports","all"].includes(e)||(console.warn(`Invalid view: ${e}. Defaulting to 'board'`),e="board"),Me=e,console.log("View changed to:",Me)}function G(){return lt}function Pe(e){lt=e}function C(){return Ae}function Y(){qt()}function z(){return{...N}}function te(e){const t={...N};N={...N,...e},rt(),I.emit("filters:changed",{filters:{...N},oldFilters:t})}function Ut(){const e={...N};N={projectId:null,phaseId:null,categoryId:null,dateRange:null},rt(),I.emit("filters:changed",{filters:{...N},oldFilters:e})}function O(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${s}-${o}`}function je(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),a=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0");return`${t}-${s}-${o}T${a}:${n}:${l}`}function Vt(e){if(!e||typeof e!="string")return new Date;const t=e.split("-");if(t.length!==3)return console.error("Invalid date string format:",e),new Date;const s=parseInt(t[0],10),o=parseInt(t[1],10)-1,a=parseInt(t[2],10);return new Date(s,o,a)}function ct(e,t="medium"){if(!e)return"";const s=Vt(e);switch(t){case"short":return s.toLocaleDateString("en-US",{year:"2-digit",month:"numeric",day:"numeric"});case"long":return s.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});case"medium":default:return s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}}function Yt(e){return e?e<O():!1}function Xe(e){return{Draft:"secondary",Ready:"info",Estimated:"success",OnDeck:"warning",InProgress:"primary",Blocked:"danger",Backburner:"warning",OnHold:"warning",Completed:"success",Abandoned:"dark",Archived:"light"}[e]||"secondary"}function k(e,t="info",s=5e3){const o=document.querySelector(".toast-container");if(!o){console.warn("Toast container not found in DOM");return}const a="toast-"+Date.now(),n=`
    <div class="toast toast-${t}" role="alert" aria-live="assertive" aria-atomic="true" id="${a}">
      <div class="toast-header">
        <i class="fas ${_t(t)} me-2"></i>
        <strong class="me-auto">${Gt(t)}</strong>
        <small class="text-muted">now</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        ${e}
      </div>
    </div>
  `;o.insertAdjacentHTML("beforeend",n);const l=document.getElementById(a);new bootstrap.Toast(l,{delay:s}).show(),l.addEventListener("hidden.bs.toast",()=>{l.remove()})}function _t(e){return{success:"fa-check-circle",warning:"fa-exclamation-triangle",error:"fa-times-circle",info:"fa-info-circle"}[e]||"fa-info-circle"}function Gt(e){return{success:"Success",warning:"Warning",error:"Error",info:"Info"}[e]||"Notification"}function ie(){return O()}function qe(e){return Math.round(e*4)/4}function oe(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}async function dt(e,t=null){try{const o=await(await S).getAllFromIndex("categoryLists","slug",e);return t?!o.some(a=>a.id!==t):o.length===0}catch(s){return console.error("Error checking slug uniqueness:",s),!1}}async function Se(){try{return await(await S).getAll("categoryLists")}catch(e){return console.error("Error loading category lists:",e),[]}}async function ut(e){try{const t=await S;if(!e.slug&&e.title&&(e.slug=oe(e.title)),e.categories&&(e.categories=e.categories.map(o=>({title:o.title,slug:o.slug||`${e.slug}.${oe(o.title)}`}))),!await dt(e.slug,e.id))throw new Error(`Slug "${e.slug}" already exists. Please choose a different title.`);const s=await t.put("categoryLists",e);return e.id||(e.id=s),k(`Category list "${e.title}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving category list:",t),k("Failed to save category list: "+t.message,"error"),t}}async function mt(e){try{return await(await S).delete("categoryLists",e),k("Category list deleted successfully!","success"),!0}catch(t){return console.error("Error deleting category list:",t),k("Failed to delete category list: "+t.message,"error"),!1}}function gt(e){if(!e||!e.includes("."))return{listSlug:null,itemSlug:null};const[t,...s]=e.split("."),o=s.join(".");return{listSlug:t,itemSlug:o}}function ft(e){const t={};for(const s of e){const o=s.category||"uncategorized";t[o]||(t[o]=0),t[o]+=s.hours||0}return t}const ht=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryTimeSummaries:ft,deleteCategoryList:mt,generateSlug:oe,getCategoryLists:Se,isSlugUnique:dt,parseCategoryKey:gt,saveCategoryList:ut},Symbol.toStringTag,{value:"Module"}));async function le(){try{return await(await S).getAll("projects")}catch(e){return console.error("Error loading projects:",e),[]}}async function Qt(e){try{const t=await S;if(!e.name||e.name.trim()==="")throw new Error("Project name is required");e.status||(e.status="Ready"),e.createdAt||(e.createdAt=new Date().toISOString());const s=await t.put("projects",e);return e.id||(e.id=s),k(`Project "${e.name}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving project:",t),k("Failed to save project: "+t.message,"error"),t}}async function Xt(e){try{const t=await S,o=(await t.getAll("tasks")).filter(a=>a.projectId===e);if(o.length>0)throw new Error(`Cannot delete project: ${o.length} task(s) are still linked to it`);return await t.delete("projects",e),k("Project deleted successfully!","success"),!0}catch(t){return console.error("Error deleting project:",t),k("Failed to delete project: "+t.message,"error"),!1}}async function Ne(e){if(!e)return{name:"",shortName:""};try{const s=await(await S).get("projects",parseInt(e));return s?{name:s.name,shortName:s.name.length>12?s.name.substring(0,12)+"...":s.name}:{name:`Project ${e}`,shortName:`P${e}`}}catch(t){return console.error("Error getting project display info:",t),{name:`Project ${e}`,shortName:`P${e}`}}}async function re(){try{return await(await S).getAll("phaseLists")}catch(e){return console.error("Error loading phase lists:",e),[]}}async function Kt(e){try{const s=await(await S).getAllFromIndex("phaseLists","slug",e);return s.length>0?s[0]:null}catch(t){return console.error("Error loading phase list by slug:",t),null}}async function Jt(e){try{const t=await S;!e.slug&&e.title&&(e.slug=oe(e.title)),e.phases&&(e.phases=e.phases.map(o=>({title:o.title,slug:o.slug||`${e.slug}.${oe(o.title)}`})));const s=await t.put("phaseLists",e);return e.id||(e.id=s),k(`Phase list "${e.title}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving phase list:",t),k("Failed to save phase list: "+t.message,"error"),t}}async function Zt(e){try{return await(await S).delete("phaseLists",e),k("Phase list deleted successfully!","success"),!0}catch(t){return console.error("Error deleting phase list:",t),k("Failed to delete phase list: "+t.message,"error"),!1}}async function ze(e){var o;if(!e)return{listTitle:"",itemTitle:"",shortTitle:""};const{listSlug:t,itemSlug:s}=gt(e);if(!t||!s)return{listTitle:"",itemTitle:e,shortTitle:e};try{const a=await Kt(t);if(!a)return{listTitle:t,itemTitle:s,shortTitle:s};const n=(o=a.phases)==null?void 0:o.find(r=>r.slug===s),l=n?n.title:s,i=l.length>10?l.substring(0,10)+"...":l;return{listTitle:a.title,itemTitle:l,shortTitle:i}}catch(a){return console.error("Error getting phase display info:",a),{listTitle:t,itemTitle:s,shortTitle:s}}}async function Ee(e){console.log("Attempting to save time log:",e);try{const t=await S,s=await t.get("tasks",e.taskId);if(!s||!["Estimated","InProgress"].includes(s.status))return console.warn("Invalid task status for time log:",s==null?void 0:s.status),k("Time can only be logged for tasks in Estimated or InProgress status.","warning"),!1;e.dateLogged||(e.dateLogged=O());const o=t.transaction("timeLogs","readwrite");return await o.store.put(e),await o.done,console.log("Time log saved successfully:",e),!0}catch(t){return console.error("Error saving time log:",t),!1}}async function es(e){console.log("Attempting to delete time log:",e);try{const s=(await S).transaction("timeLogs","readwrite");return await s.store.delete(e),await s.done,console.log("Time log deleted successfully:",e),!0}catch(t){return console.error("Error deleting time log:",t),!1}}async function R(e,t=null,s=null){console.log("Fetching time logs for task:",e,"range:",t,s);try{const o=await S,n=(e?await o.getAllFromIndex("timeLogs","taskId",e):await o.getAll("timeLogs")).filter(l=>!t||!s?!0:l.dateLogged>=t&&l.dateLogged<=s);return console.log("Fetched time logs:",n.length),n}catch(o){return console.error("Error fetching time logs:",o),[]}}async function Ue(e=null,t=null){return R(null,e,t)}const ts={Draft:["Ready","Estimated","OnDeck","Abandoned","Archived"],Ready:["Estimated","OnDeck","InProgress","Abandoned","Archived"],Estimated:["OnDeck","InProgress","Abandoned","Archived"],OnDeck:["InProgress","Abandoned","Archived"],InProgress:["Blocked","Backburner","OnHold","Completed","Abandoned","Archived"],Blocked:["InProgress","Backburner","OnHold","Abandoned","Archived"],Backburner:["InProgress","Blocked","OnHold","Abandoned","Archived"],OnHold:["InProgress","Abandoned","Archived"],Completed:["Abandoned","Archived"],Abandoned:["Archived"],Archived:[]};function ss(e,t){var s;return!e||!t?!1:e===t?!0:((s=ts[e])==null?void 0:s.includes(t))||!1}async function Ve(e,t=!1){console.log("Attempting to save task:",e);try{const s=await S;if(!t){if(e.statusHistory=[{status:e.status||"Ready",timestamp:new Date().toISOString(),note:"Task created"}],e.createdAt=new Date().toISOString(),e.remainingHours===void 0&&(e.remainingHours=e.estimate||0),e.remainingHours>0){const n={taskId:null,remainingHours:e.remainingHours,timestamp:new Date().toISOString(),note:"Initial estimate"};e._initialRemainingHoursEntry=n}console.log("New task - initialized status history:",e.statusHistory),console.log("New task - initialized remaining hours:",e.remainingHours)}if(t&&e.status&&e.id){const n=await s.get("tasks",e.id);if(console.log("Current task from DB:",n),console.log("Task being saved:",e),n){if(n.statusHistory||(console.log("No status history found, initializing..."),n.statusHistory=[{status:n.status,timestamp:n.createdAt||new Date().toISOString(),note:"Legacy task - initial status"}]),console.log("Current task status:",n.status,"New task status:",e.status),n.status!==e.status){if(console.log("Status changed! Adding to history..."),!ss(n.status,e.status))return console.warn(`Invalid status transition from ${n.status} to ${e.status}`),k(`Invalid status transition from ${n.status} to ${e.status}`,"error"),!1;e.statusHistory=[...n.statusHistory,{status:e.status,timestamp:new Date().toISOString(),note:`${n.status} => ${e.status}`}],console.log("Status changed - updated history:",e.statusHistory)}else console.log("Status unchanged, preserving existing history"),e.statusHistory=n.statusHistory;e.createdAt=n.createdAt||new Date().toISOString()}}const o=s.transaction(["tasks","remainingHoursHistory"],"readwrite"),a=await o.objectStore("tasks").put(e);return!t&&e._initialRemainingHoursEntry&&(e._initialRemainingHoursEntry.taskId=a,await o.objectStore("remainingHoursHistory").add(e._initialRemainingHoursEntry),delete e._initialRemainingHoursEntry),await o.done,console.log("Task saved successfully with status history:",e),t?I.emit("task:updated",{taskId:a,task:e}):I.emit("task:created",{taskId:a,task:e}),!0}catch(s){return console.error("Error saving task:",s),!1}}async function os(e){console.log("Attempting to delete task:",e);try{const s=(await S).transaction(["tasks","timeLogs","remainingHoursHistory"],"readwrite");await s.objectStore("tasks").delete(e);const o=await s.objectStore("timeLogs").index("taskId").getAll(e);for(const n of o)await s.objectStore("timeLogs").delete(n.id);const a=await s.objectStore("remainingHoursHistory").index("taskId").getAll(e);for(const n of a)await s.objectStore("remainingHoursHistory").delete(n.id);return await s.done,console.log("Task deleted successfully:",e),I.emit("task:deleted",{taskId:e}),!0}catch(t){return console.error("Error deleting task:",t),!1}}async function W(e={},t=!1){console.log("Fetching tasks with filters:",e,"includeAll:",t);try{const a=(await(await S).getAll("tasks")).filter(n=>!(e.status&&n.status!==e.status||e.urgency&&n.urgency!==e.urgency||e.projectId&&n.projectId!==e.projectId||e.dueOn&&n.dueOn!==e.dueOn||!t&&["Completed","Abandoned","Archived"].includes(n.status)));return console.log("Fetched tasks:",a.length),a}catch(s){return console.error("Error fetching tasks:",s),[]}}async function Ye(e,t,s=""){try{const o=await S,a=await o.get("tasks",e);if(!a)return console.error("Task not found:",e),!1;const n=a.remainingHours||0;if(n!==t){a.remainingHours=t;const l={taskId:e,remainingHours:t,previousRemainingHours:n,timestamp:new Date().toISOString(),note:s||`Updated remaining hours from ${n}h to ${t}h`},i=o.transaction(["tasks","remainingHoursHistory"],"readwrite");return await i.objectStore("tasks").put(a),await i.objectStore("remainingHoursHistory").add(l),await i.done,console.log("Remaining hours updated:",l),!0}return!1}catch(o){return console.error("Error updating remaining hours:",o),!1}}async function Le(e,t=""){const s={title:e,content:t,completed:!1,createdAt:new Date().toISOString(),completedAt:null};try{const a=await(await S).add("todos",s);return s.id=a,I.emit("todo:created",{todo:s}),s}catch(o){return console.error("Error adding todo:",o),null}}async function _e(e=!1){try{const s=await(await S).getAll("todos"),o=e?s:s.filter(a=>!a.completed);return o.sort((a,n)=>a.completed!==n.completed?a.completed?1:-1:new Date(n.createdAt)-new Date(a.createdAt)),o}catch(t){return console.error("Error loading todos:",t),[]}}async function as(e){try{const t=await S,s=await t.get("todos",e);return await t.delete("todos",e),s&&I.emit("todo:deleted",{todoId:e,todo:s}),!0}catch(t){return console.error("Error deleting todo:",t),!1}}async function ns(e){try{const t=await S,s=await t.get("todos",e);if(!s)return console.error("Todo not found:",e),!1;const o=s.completed;return s.completed=!s.completed,s.completed?s.completedAt=new Date().toISOString():s.completedAt=null,await t.put("todos",s),I.emit("todo:toggled",{todo:s,completed:s.completed}),s.completed&&!o?I.emit("todo:completed",{todo:s}):!s.completed&&o&&I.emit("todo:uncompleted",{todo:s}),!0}catch(t){return console.error("Error toggling todo:",t),!1}}async function pt(e,t="",s=null){const o={title:e,content:t,date:s||ie(),createdAt:new Date().toISOString()};try{const n=await(await S).add("accomplishments",o);return o.id=n,I.emit("accomplishment:added",{accomplishment:o}),o}catch(a){return console.error("Error adding accomplishment:",a),null}}async function Ge(e=null){try{const t=await S,s=e||ie(),a=(await t.getAll("accomplishments")).filter(n=>n.date===s);return a.sort((n,l)=>new Date(l.createdAt)-new Date(n.createdAt)),a}catch(t){return console.error("Error loading accomplishments:",t),[]}}async function is(e){try{const t=await S,s=await t.get("accomplishments",e);return await t.delete("accomplishments",e),s&&I.emit("accomplishment:deleted",{accomplishmentId:e,accomplishment:s}),!0}catch(t){return console.error("Error deleting accomplishment:",t),!1}}async function Z(){try{return(await(await S).getAll("workSessions")).find(o=>!o.punchOut)||null}catch(e){return console.error("Error getting active work session:",e),null}}async function ce(e=null){try{const t=await S,s=e||ie();return(await t.getAll("workSessions")).find(n=>n.date===s)||null}catch(t){return console.error("Error getting work session:",t),null}}async function ls(e){try{const t=await S;if(e.punchIn&&e.punchOut){let s=0;if(e.activities&&e.activities.length>0){for(const a of e.activities)if(a.startTime&&a.endTime){const n=new Date(a.startTime),l=new Date(a.endTime);s+=l-n}}const o=s/(1e3*60*60);e.totalHours=parseFloat(o.toFixed(2))}if(e.activities||(e.activities=[]),e.breaks||(e.breaks=[]),e.id)await t.put("workSessions",e);else{const{id:s,...o}=e,a=await t.add("workSessions",o);e.id=a}return e}catch(t){return console.error("Error saving work session:",t),k("Failed to save work session","error"),null}}async function rs(e){try{return await(await S).delete("workSessions",e),!0}catch(t){return console.error("Error deleting work session:",t),k("Failed to delete work session","error"),!1}}async function cs(){try{const e=je(),t=ie(),s=await Z();if(s)return k("You are already punched in!","warning"),s;const o=await ce(t);if(o){const a={startTime:e,endTime:null,category:"work",description:"Work Time"};return o.activities||(o.activities=[]),o.activities.push(a),o.punchOut=null,await(await S).put("workSessions",o),I.emit("session:punchedIn",{sessionId:o.id,timestamp:e,date:o.date}),o}else{const a=await S,n={date:t,punchIn:e,punchOut:null,totalHours:null,breaks:[],activities:[{startTime:e,endTime:null,category:"work",description:"Work Time"}]},l=await a.add("workSessions",n);return n.id=l,I.emit("session:punchedIn",{sessionId:l,timestamp:e,date:n.date}),n}}catch(e){return console.error("Error punching in:",e),null}}async function ds(){try{const e=await Z();if(!e)return k("No active work session found","warning"),null;const t=await S,s=je();if(e.activities&&e.activities.length>0){const n=e.activities[e.activities.length-1];n.endTime||(n.endTime=s)}let o=0;if(e.activities&&e.activities.length>0){for(const n of e.activities)if(n.startTime&&n.endTime){const l=new Date(n.startTime),i=new Date(n.endTime);o+=i-l}}const a=o/(1e3*60*60);return e.punchOut=s,e.totalHours=parseFloat(a.toFixed(2)),await t.put("workSessions",e),I.emit("session:punchedOut",{sessionId:e.id,timestamp:s,totalHours:e.totalHours,date:e.date}),e}catch(e){return console.error("Error punching out:",e),null}}async function us(e,t){try{const s=await Z();if(!s)return k("No active work session. Please punch in first.","warning"),null;const o=await S,a=je();if(s.activities||(s.activities=[]),s.activities.length>0){const l=s.activities[s.activities.length-1];l.endTime||(l.endTime=a)}const n={startTime:a,endTime:null,category:e,description:t};return s.activities.push(n),await o.put("workSessions",s),I.emit("session:activityChanged",{sessionId:s.id,category:e,description:t,timestamp:a}),s}catch(s){return console.error("Error recording activity:",s),null}}async function ms(){try{const e=await Z();if(!e||!e.activities||e.activities.length===0)return null;const t=e.activities[e.activities.length-1];return t.endTime?null:t}catch(e){return console.error("Error getting current activity:",e),null}}const gs="modulepreload",fs=function(e,t){return new URL(e,t).href},Ke={},yt=function(t,s,o){let a=Promise.resolve();if(s&&s.length>0){const l=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),r=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));a=Promise.allSettled(s.map(c=>{if(c=fs(c,o),c in Ke)return;Ke[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(!!o)for(let f=l.length-1;f>=0;f--){const h=l[f];if(h.href===c&&(!d||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${m}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":gs,d||(u.as="script"),u.crossOrigin="",u.href=c,r&&u.setAttribute("nonce",r),document.head.appendChild(u),d)return new Promise((f,h)=>{u.addEventListener("load",f),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(l){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=l,window.dispatchEvent(i),!i.defaultPrevented)throw l}return a.then(l=>{for(const i of l||[])i.status==="rejected"&&n(i.reason);return t().catch(n)})},vt=10,hs="1.0.0";async function ps(){console.log("Exporting all application data");try{const e=await S,t={version:vt,exportDate:new Date().toISOString(),appVersion:hs,data:{tasks:await e.getAll("tasks"),timeLogs:await e.getAll("timeLogs"),todos:await e.getAll("todos"),accomplishments:await e.getAll("accomplishments"),workSessions:await e.getAll("workSessions"),categoryLists:await e.getAll("categoryLists"),remainingHoursHistory:await e.getAll("remainingHoursHistory"),projects:await e.getAll("projects"),phaseLists:await e.getAll("phaseLists")},settings:{globalProjectFilter:localStorage.getItem("globalProjectFilter"),globalPhaseFilter:localStorage.getItem("globalPhaseFilter"),calendarStatusFilter:localStorage.getItem("calendarStatusFilter"),calendarUrgencyFilter:localStorage.getItem("calendarUrgencyFilter"),sortBy:sessionStorage.getItem("sortBy"),sortOrder:sessionStorage.getItem("sortOrder")}},a=`task-tracker-backup-${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.json`;if(window.showSaveFilePicker)try{const c=await(await window.showSaveFilePicker({suggestedName:a,types:[{description:"Task Tracker Backup",accept:{"application/json":[".json"]}}]})).createWritable();return await c.write(JSON.stringify(t,null,2)),await c.close(),k("Data exported successfully!","success"),console.log("Data exported to user-selected location"),!0}catch(r){if(r.name!=="AbortError")console.warn("File picker failed, falling back to download:",r);else return console.log("Export cancelled by user"),!1}const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),l=URL.createObjectURL(n),i=document.createElement("a");return i.href=l,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l),k("Data exported successfully!","success"),console.log("Data exported successfully"),!0}catch(e){return console.error("Error exporting data:",e),k("Failed to export data: "+e.message,"error"),!1}}async function ys(e){return console.log("Importing comprehensive application data from file"),new Promise(t=>{const s=new FileReader;s.onload=async o=>{try{const a=JSON.parse(o.target.result);let n,l;if(a.version&&a.data){if(n=a.data,l=a.settings||{},console.log(`Importing data from version ${a.version}, exported on ${a.exportDate}`),a.version>vt&&!confirm("This backup was created with a newer version of the app. Some data might not import correctly. Continue anyway?")){t(!1);return}if((n.categoryLists&&n.categoryLists.length>0||n.phaseLists&&n.phaseLists.length>0)&&!confirm("This will replace your existing Category Lists and Phase Lists. Your tasks and other data will be merged. Continue?")){t(!1);return}}else n=a,l={},console.log("Importing legacy format data");const i=await S,r=["tasks","timeLogs","todos","accomplishments","workSessions","categoryLists","remainingHoursHistory","projects","phaseLists"],c={imported:{},skipped:{},replaced:{}};for(const u of r)if(n[u]&&n[u].length>0){if(console.log(`Importing ${n[u].length} ${u}...`),u==="categoryLists"||u==="phaseLists"){const b=await i.getAll(u);c.replaced[u]=b.length;const y=i.transaction(u,"readwrite");for(const w of b)await y.store.delete(w.id);await y.done,console.log(`Cleared ${b.length} existing ${u}`)}const f=i.transaction(u,"readwrite");let h=0,p=0;for(const b of n[u])try{if(u==="categoryLists"||u==="phaseLists")await f.store.put(b),h++;else if(b.id)if(await f.store.get(b.id)){const w={...b};delete w.id,await f.store.add(w),h++}else await f.store.put(b),h++;else await f.store.add(b),h++}catch(y){console.warn(`Skipping ${u} record due to error:`,y),p++}await f.done,c.imported[u]=h,c.skipped[u]=p,console.log(`Imported ${h} ${u} (skipped ${p})`)}if(l&&Object.keys(l).length>0){console.log("Restoring settings...");for(const[u,f]of Object.entries(l))f!==null&&(u==="sortBy"||u==="sortOrder"?sessionStorage.setItem(u,f):localStorage.setItem(u,f))}const d=Object.values(c.imported).reduce((u,f)=>u+f,0),m=Object.values(c.skipped).reduce((u,f)=>u+f,0);let g=`Import complete!

`;g+=`✓ Imported: ${d} records
`,m>0&&(g+=`⚠ Skipped: ${m} records (duplicates or errors)
`),console.log("Import statistics:",c),k("Data imported successfully!","success",8e3),alert(g),t(!0)}catch(a){console.error("Error importing data:",a),k("Failed to import data: "+a.message,"error"),alert("Import failed: "+a.message),t(!1)}},s.onerror=()=>{console.error("Error reading file"),k("Failed to read file","error"),t(!1)},s.readAsText(e)})}async function vs(e){console.log("Rendering Today dashboard view");const t=`
    <div class="today-container">
      <div class="row g-4">
        \x3C!-- Quick Todos Column -->
        <div class="col-lg-6">
          <div class="today-card">
            <div class="today-card-header">
              <div class="d-flex justify-content-between align-items-center w-100">
                <div class="d-flex align-items-center">
                  <i class="fas fa-tasks me-2"></i>
                  <h5 class="mb-0">Quick Todos</h5>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="showCompletedTodos" onchange="window.toggleCompletedTodos()">
                  <label class="form-check-label small text-muted" for="showCompletedTodos">
                    Include completed
                  </label>
                </div>
              </div>
            </div>
            <div class="today-card-body">
              \x3C!-- Inline Todo Form -->
              <div class="todo-form mb-3">
                <div class="input-group mb-2">
                  <input type="text" id="todoTitleInput" class="form-control" placeholder="Add a todo..." maxlength="100">
                  <button class="btn btn-primary" type="button" id="addTodoBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div id="todoDetailsInput" class="todo-details" style="display: none;">
                  <textarea class="form-control" placeholder="Optional details..." rows="2" maxlength="300"></textarea>
                  <div class="mt-2 d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-outline-secondary" id="cancelTodoDetailsBtn">Cancel</button>
                    <button class="btn btn-sm btn-success" id="submitTodoWithDetailsBtn">Add Todo</button>
                  </div>
                </div>
                <small class="text-muted">Press Enter to add quickly, or click + for details</small>
              </div>
              
              <div id="todos-list" class="todos-list">
                \x3C!-- Todos will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        
        \x3C!-- Daily Accomplishments Column -->
        <div class="col-lg-6">
          <div class="today-card">
            <div class="today-card-header">
              <i class="fas fa-trophy me-2"></i>
              <h5 class="mb-0">Daily Accomplishments</h5>
            </div>
            <div class="today-card-body">
              \x3C!-- Inline Accomplishment Form -->
              <div class="accomplishment-form mb-3">
                <div class="input-group mb-2">
                  <input type="text" id="accomplishmentTitleInput" class="form-control" placeholder="What did you accomplish?" maxlength="100">
                  <button class="btn btn-success" type="button" id="addAccomplishmentBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div id="accomplishmentDetailsInput" class="accomplishment-details" style="display: none;">
                  <textarea class="form-control" placeholder="Tell us more about this accomplishment..." rows="3" maxlength="500"></textarea>
                  <div class="mt-2 d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-outline-secondary" id="cancelAccomplishmentDetailsBtn">Cancel</button>
                    <button class="btn btn-sm btn-warning" id="submitAccomplishmentWithDetailsBtn">Add Accomplishment</button>
                  </div>
                </div>
                <small class="text-muted">Press Enter to add quickly, or click + for details</small>
              </div>
              
              <div id="accomplishments-list" class="accomplishments-list">
                \x3C!-- Accomplishments will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      \x3C!-- Work Session Status -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="today-card" id="todayWorkSession">
            <div class="today-card-header">
              <i class="fas fa-clock me-2"></i>
              <h5 class="mb-0">Work Session</h5>
              <button class="btn btn-sm btn-outline-primary ms-auto" id="todayPunchBtn" onclick="document.getElementById('punchClockBtn').click()">
                <i class="fas fa-clock me-1"></i>
                <span id="todayPunchText">Punch In</span>
              </button>
            </div>
            <div class="today-card-body">
              <div class="row g-3 text-center" id="workSessionSummary">
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayTotalHours">0h 0m</div>
                    <div class="metric-label">Total</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayWorkHours">0h 0m</div>
                    <div class="metric-label">Work</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayBreakHours">0h 0m</div>
                    <div class="metric-label">Breaks</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayCurrentActivity">Not Started</div>
                    <div class="metric-label">Status</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      \x3C!-- Today's Task Overview -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="today-card">
            <div class="today-card-header">
              <i class="fas fa-flag me-2"></i>
              <h5 class="mb-0">Task Overview</h5>
              <span class="badge bg-primary ms-auto" id="today-hours">0.0 hours logged</span>
            </div>
            <div class="today-card-body">
              \x3C!-- Task Overview Filter Buttons -->
              <div class="task-overview-filters mb-3">
                <div class="btn-group" role="group" aria-label="Task time filters">
                  <button type="button" class="btn btn-outline-primary active" id="filterToday" data-filter="today">
                    <i class="fas fa-calendar-day me-1"></i>Today
                  </button>
                  <button type="button" class="btn btn-outline-primary" id="filterThisWeek" data-filter="thisWeek">
                    <i class="fas fa-calendar-week me-1"></i>This Week
                  </button>
                  <button type="button" class="btn btn-outline-primary" id="filterNextWeek" data-filter="nextWeek">
                    <i class="fas fa-calendar-alt me-1"></i>Next Week
                  </button>
                </div>
              </div>
              
              <div id="today-tasks" class="today-tasks">
                \x3C!-- Tasks will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;e.innerHTML=t,Ms(),Cs(e),await bs()}async function bs(){await Promise.all([X(),de(),bt(),kt("today")])}async function X(){var o;const e=((o=document.getElementById("showCompletedTodos"))==null?void 0:o.checked)||!1,t=await _e(e),s=document.getElementById("todos-list");if(s){if(t.length===0){s.innerHTML=e?'<p class="text-muted text-center">No todos yet. Add one to get started!</p>':'<p class="text-muted text-center">No active todos. Add one to get started!</p>';return}s.innerHTML=t.map(a=>`
    <div class="todo-item ${a.completed?"completed":""}" data-todo-id="${a.id}">
      <input type="checkbox" class="form-check-input todo-checkbox" 
             ${a.completed?"checked":""} 
             data-todo-id="${a.id}">
      <div class="todo-content">
        <div class="todo-title">${a.title}</div>
        ${a.content?`<p class="todo-text">${a.content}</p>`:""}
        ${a.completed&&a.completedAt?`<small class="text-muted">Completed: ${new Date(a.completedAt).toLocaleDateString()}</small>`:`<small class="text-muted">Created: ${new Date(a.createdAt).toLocaleDateString()}</small>`}
      </div>
      ${e?`
        <div class="todo-actions ms-2">
          <button class="btn btn-sm btn-outline-danger delete-todo-btn" data-todo-id="${a.id}">
            <i class="fas fa-trash"></i>
          </button>
          <div class="delete-confirmation d-none">
            <span class="me-2">Delete this todo?</span>
            <button class="btn btn-danger btn-sm me-1 confirm-delete-todo-btn" data-todo-id="${a.id}">
              <i class="fas fa-check me-1"></i>Yes
            </button>
            <button class="btn btn-outline-secondary btn-sm cancel-delete-todo-btn" data-todo-id="${a.id}">
              <i class="fas fa-times me-1"></i>Cancel
            </button>
          </div>
        </div>
      `:""}
    </div>
  `).join("")}}async function de(){const e=await Ge(),t=document.getElementById("accomplishments-list");if(t){if(e.length===0){t.innerHTML='<p class="text-muted text-center">No accomplishments logged today. Add one to celebrate your wins!</p>';return}t.innerHTML=e.map(s=>`
    <div class="accomplishment-item">
      <div class="accomplishment-title">${s.title}</div>
      ${s.content?`<div class="accomplishment-content">${s.content}</div>`:""}
      <div class="accomplishment-time">
        ${new Date(s.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}
        <button class="btn btn-sm btn-outline-danger ms-2 delete-accomplishment-btn" data-accomplishment-id="${s.id}">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  `).join("")}}async function bt(){const e=await ce(),t=document.getElementById("workSessionSummary");if(!e){document.getElementById("todayTotalHours").textContent="0h 0m",document.getElementById("todayWorkHours").textContent="0h 0m",document.getElementById("todayBreakHours").textContent="0h 0m",document.getElementById("todayCurrentActivity").textContent="Not Punched In";const p=document.getElementById("activityTimeline");p&&p.remove();return}const s=new Date(e.punchIn),a=(e.punchOut?new Date(e.punchOut):new Date)-s,n=Math.floor(a/(1e3*60*60)),l=Math.floor(a%(1e3*60*60)/(1e3*60));let i=0,r=0;e.activities&&e.activities.forEach(p=>{const b=new Date(p.startTime),w=(p.endTime?new Date(p.endTime):new Date)-b;p.category==="work"?i+=w:r+=w});const c=Math.floor(i/(1e3*60*60)),d=Math.floor(i%(1e3*60*60)/(1e3*60)),m=Math.floor(r/(1e3*60*60)),g=Math.floor(r%(1e3*60*60)/(1e3*60));document.getElementById("todayTotalHours").textContent=`${n}h ${l}m`,document.getElementById("todayWorkHours").textContent=`${c}h ${d}m`,document.getElementById("todayBreakHours").textContent=`${m}h ${g}m`;const u=e.activities&&e.activities.length>0?e.activities[e.activities.length-1]:null,f=e.punchOut?"Punched Out":u?u.description:"Working";document.getElementById("todayCurrentActivity").textContent=f;let h=document.getElementById("activityTimeline");if(h||(h=document.createElement("div"),h.id="activityTimeline",h.className="mt-3 pt-3 border-top",t.parentElement.appendChild(h)),e.activities&&e.activities.length>0){const p=`
      <h6 class="text-muted mb-2"><i class="fas fa-history me-1"></i> Activity Timeline</h6>
      <div class="activity-timeline">
        ${e.activities.map((b,y)=>{const w=new Date(b.startTime),T=b.endTime?new Date(b.endTime):null,E=T?(T-w)/(1e3*60):null,L={work:"fa-briefcase",lunch:"fa-utensils",meeting:"fa-users",personal:"fa-user",break:"fa-coffee"},P={work:"success",lunch:"warning",meeting:"info",personal:"secondary",break:"primary"},M=L[b.category]||"fa-circle",B=P[b.category]||"secondary",D=!b.endTime;return`
            <div class="activity-item ${D?"active":""}">
              <div class="activity-icon bg-${B}">
                <i class="fas ${M}"></i>
              </div>
              <div class="activity-details">
                <div class="activity-header">
                  <strong>${b.description}</strong>
                  ${D?'<span class="badge bg-success ms-2">Active</span>':""}
                </div>
                <div class="activity-time text-muted small">
                  ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}
                  ${T?` - ${T.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:" - Now"}
                  ${E?` (${Math.floor(E/60)}h ${Math.round(E%60)}m)`:""}
                </div>
              </div>
            </div>
          `}).join("")}
      </div>
    `;h.innerHTML=p}else h.innerHTML=""}async function kt(e){const t=new Date;t.setHours(0,0,0,0);const s=ie();let o,a,n,l;const i=await W({},!0);if(e==="today")o=a=s,n=i.filter(g=>g.dueOn===s||g.dueOn<s&&!["Completed","Abandoned","Archived"].includes(g.status)),l="today";else if(e==="thisWeek"){const g=new Date(t);g.setDate(t.getDate()-t.getDay());const u=new Date(g);u.setDate(g.getDate()+6),o=g.toISOString().split("T")[0],a=u.toISOString().split("T")[0],n=i.filter(f=>f.dueOn>=o&&f.dueOn<=a&&!["Completed","Abandoned","Archived"].includes(f.status)),l="this week"}else if(e==="nextWeek"){const g=new Date(t);g.setDate(t.getDate()-t.getDay()+7);const u=new Date(g);u.setDate(g.getDate()+6),o=g.toISOString().split("T")[0],a=u.toISOString().split("T")[0],n=i.filter(f=>f.dueOn>=o&&f.dueOn<=a&&!["Completed","Abandoned","Archived"].includes(f.status)),l="next week"}const c=(await Ue(o,a)).reduce((g,u)=>g+u.hours,0),d=document.getElementById("today-hours");d&&(d.textContent=`${c.toFixed(1)} hours logged ${l}`);const m=document.getElementById("today-tasks");if(m){if(n.length===0){let g="No tasks found";e==="today"?g="No tasks due today. Great job staying on top of things!":e==="thisWeek"?g="No tasks due this week. You're all caught up!":e==="nextWeek"&&(g="No tasks scheduled for next week yet."),m.innerHTML=`<p class="text-muted text-center">${g}</p>`;return}m.innerHTML=n.map(g=>{const u=g.dueOn<s,f=g.dueOn===s;return`
      <div class="today-task-item ${u?"overdue":""} ${f?"due-today":""}">
        <div class="today-task-urgency ${g.urgency.toLowerCase()}"></div>
        <div class="flex-grow-1">
          <strong>${g.title}</strong>
          <span class="badge bg-secondary ms-2">${g.status}</span>
          ${u?'<span class="badge bg-danger ms-1">OVERDUE</span>':""}
          ${f?'<span class="badge bg-warning ms-1">TODAY</span>':""}
        </div>
        <div class="text-muted d-flex flex-column text-end">
          <small>Due: ${new Date(g.dueOn).toLocaleDateString("en-US",{month:"short",day:"numeric"})}</small>
          <small>${g.estimate?`Est: ${g.estimate}h`:"No estimate"}</small>
        </div>
        <div class="ms-2">
          <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${g.id}" title="Work on task">
            <i class="fas fa-edit"></i>
          </button>
        </div>
      </div>
    `}).join("")}}async function ks(){const e=document.getElementById("todoTitleInput");if(!e)return;const t=e.value.trim();if(!t)return;await Le(t,"")?(e.value="",e.focus(),k("Todo added!","success"),await X()):k("Failed to add todo","error")}async function ws(){const e=document.getElementById("todoTitleInput"),t=document.querySelector("#todoDetailsInput textarea");if(!e||!t)return;const s=e.value.trim(),o=t.value.trim();if(!s)return;await Le(s,o)?(e.value="",t.value="",wt(),e.focus(),k("Todo added!","success"),await X()):k("Failed to add todo","error")}function Ts(){const e=document.getElementById("todoDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#todoDetailsInput textarea");t&&t.focus()}}function wt(){const e=document.getElementById("todoDetailsInput");if(e){e.style.display="none";const t=document.querySelector("#todoDetailsInput textarea");t&&(t.value="")}}async function Is(e){await ns(e)?await X():k("Failed to update todo","error")}async function Ss(e){await as(e)?(k("Todo deleted","info"),await X()):k("Failed to delete todo","error")}function Es(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-todo-btn"),o=t.querySelector(".delete-confirmation");s&&o&&(s.classList.add("d-none"),o.classList.remove("d-none"),t.classList.add("deleting"))}function Ls(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-todo-btn"),o=t.querySelector(".delete-confirmation");s&&o&&(s.classList.remove("d-none"),o.classList.add("d-none"),t.classList.remove("deleting"))}async function Bs(){const e=document.getElementById("accomplishmentTitleInput");if(!e)return;const t=e.value.trim();if(!t)return;await pt(t,"")?(e.value="",e.focus(),k("Accomplishment added!","success"),await de()):k("Failed to add accomplishment","error")}async function $s(){const e=document.getElementById("accomplishmentTitleInput"),t=document.querySelector("#accomplishmentDetailsInput textarea");if(!e||!t)return;const s=e.value.trim(),o=t.value.trim();if(!s)return;await pt(s,o)?(e.value="",t.value="",Tt(),e.focus(),k("Accomplishment added!","success"),await de()):k("Failed to add accomplishment","error")}function Ps(){const e=document.getElementById("accomplishmentDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#accomplishmentDetailsInput textarea");t&&t.focus()}}function Tt(){const e=document.getElementById("accomplishmentDetailsInput");if(e){e.style.display="none";const t=document.querySelector("#accomplishmentDetailsInput textarea");t&&(t.value="")}}async function Ds(e){await is(e)?(k("Accomplishment deleted","info"),await de()):k("Failed to delete accomplishment","error")}function Cs(e){if(e.dataset.todayEventListenersSetup==="true")return;e.dataset.todayEventListenersSetup="true";const t=async()=>{document.getElementById("today-tasks")&&(console.log("[Today] Task changed - refreshing task overview"),await loadTasksSection())};I.on("task:created",t),I.on("task:updated",t),I.on("task:deleted",t),I.on("task:timeLogged",t);const s=async()=>{document.getElementById("sessionSummary")&&(console.log("[Today] Work session changed - refreshing session summary"),await bt())};I.on("session:punchedIn",s),I.on("session:punchedOut",s),I.on("session:activityChanged",s);const o=async()=>{document.getElementById("todos-list")&&(console.log("[Today] Todo changed - refreshing todo list"),await X())};I.on("todo:created",o),I.on("todo:updated",o),I.on("todo:deleted",o),I.on("todo:toggled",o),I.on("todo:completed",o),I.on("todo:uncompleted",o);const a=async()=>{document.getElementById("accomplishments-list")&&(console.log("[Today] Accomplishment changed - refreshing accomplishment list"),await de())};I.on("accomplishment:added",a),I.on("accomplishment:updated",a),I.on("accomplishment:deleted",a)}function Ms(){var c,d,m,g;const e=document.getElementById("todoTitleInput"),t=document.getElementById("addTodoBtn");e&&t&&(e.addEventListener("keypress",u=>{u.key==="Enter"&&e.value.trim()&&ks()}),t.addEventListener("click",()=>{Ts()}));const s=document.getElementById("accomplishmentTitleInput"),o=document.getElementById("addAccomplishmentBtn");s&&o&&(s.addEventListener("keypress",u=>{u.key==="Enter"&&s.value.trim()&&Bs()}),o.addEventListener("click",()=>{Ps()}));const a=document.getElementById("cancelAccomplishmentDetailsBtn"),n=document.getElementById("submitAccomplishmentWithDetailsBtn");a&&a.addEventListener("click",()=>{Tt()}),n&&n.addEventListener("click",()=>{$s()});const l=document.getElementById("cancelTodoDetailsBtn"),i=document.getElementById("submitTodoWithDetailsBtn");l&&l.addEventListener("click",()=>{wt()}),i&&i.addEventListener("click",()=>{ws()});const r=document.querySelectorAll(".task-overview-filters button");r.forEach(u=>{u.addEventListener("click",async()=>{r.forEach(h=>h.classList.remove("active")),u.classList.add("active");const f=u.dataset.filter;await kt(f)})}),(c=document.getElementById("todos-list"))==null||c.addEventListener("change",async u=>{if(u.target.classList.contains("todo-checkbox")){const f=parseInt(u.target.dataset.todoId);await Is(f)}}),(d=document.getElementById("todos-list"))==null||d.addEventListener("click",async u=>{if(u.target.closest(".delete-todo-btn")){const f=parseInt(u.target.closest(".delete-todo-btn").dataset.todoId);Es(f)}if(u.target.closest(".confirm-delete-todo-btn")){const f=parseInt(u.target.closest(".confirm-delete-todo-btn").dataset.todoId);await Ss(f)}if(u.target.closest(".cancel-delete-todo-btn")){const f=parseInt(u.target.closest(".cancel-delete-todo-btn").dataset.todoId);Ls(f)}}),(m=document.getElementById("accomplishments-list"))==null||m.addEventListener("click",async u=>{if(u.target.closest(".delete-accomplishment-btn")){const f=parseInt(u.target.closest(".delete-accomplishment-btn").dataset.accomplishmentId);await Ds(f)}}),(g=document.getElementById("showCompletedTodos"))==null||g.addEventListener("change",async()=>{await X()})}async function q(e,t={},s="all"){console.log("Rendering Kanban Board view");let o=await W({},!0);t.project&&(o=o.filter(c=>c.projectId&&c.projectId.toString()===t.project)),t.phase&&(o=o.filter(c=>c.phaseKey===t.phase));const a=document.createElement("div");a.className="board-split-view";const n=document.createElement("div");n.className="board-kanban-pane";const l=document.createElement("div");l.className="kanban-board";const i=[{id:"backlog",title:"Backlog",statuses:["Draft","Ready","Estimated","OnDeck"],className:"lane-backlog"},{id:"inprogress",title:"In Progress",statuses:["InProgress"],className:"lane-inprogress"},{id:"blocked",title:"On Hold",statuses:["Blocked","Backburner","OnHold"],className:"lane-blocked"},{id:"done",title:"Done",statuses:["Completed","Abandoned","Archived"],className:"lane-done"}];for(const c of i){let d=o.filter(f=>c.statuses.includes(f.status));c.id==="done"&&s!=="all"&&(d=d.filter(f=>{const h=Rs(f);if(!h)return!1;const p=new Date;if(p.setHours(0,0,0,0),s==="today"){const b=p.toISOString().split("T")[0];return h===b}else if(s==="thisWeek"){const b=new Date(p);b.setDate(p.getDate()-p.getDay());const y=new Date(b);y.setDate(b.getDate()+6);const w=b.toISOString().split("T")[0],T=y.toISOString().split("T")[0];return h>=w&&h<=T}else if(s==="nextWeek"){const b=new Date(p);b.setDate(p.getDate()-p.getDay()+7);const y=new Date(b);y.setDate(b.getDate()+6);const w=b.toISOString().split("T")[0],T=y.toISOString().split("T")[0];return h>=w&&h<=T}return!0}));const m=document.createElement("div");m.className=`kanban-lane ${c.className}`,m.dataset.laneId=c.id;const g=c.id==="blocked"||c.id==="backlog"?`<button class="lane-status-filter" data-lane="${c.id}" data-filter="all" title="Filter: All">
           <i class="fas fa-list"></i>
         </button>`:"";m.innerHTML=`
      <div class="kanban-lane-header">
        <h5 class="lane-title">${c.title}</h5>
        <span class="lane-counter">${d.length}</span>
        ${g}
      </div>
      <div class="kanban-lane-content" data-lane="${c.id}">
        <div class="drop-zone"></div>
      </div>
    `;const u=m.querySelector(".kanban-lane-content");if(c.id==="backlog"){const f=m.querySelector(".lane-status-filter"),h=m.querySelector(".lane-title");f.addEventListener("click",b=>{b.stopPropagation();const y=f.dataset.filter;let w,T,E,L,P;y==="all"?(w="draft",T="fa-pencil",E="Filter: Draft",L="Draft",P="#6c757d"):y==="draft"?(w="ready",T="fa-check",E="Filter: Ready",L="Ready",P="#0d6efd"):y==="ready"?(w="estimated",T="fa-calculator",E="Filter: Estimated",L="Estimated",P="#198754"):y==="estimated"?(w="ondeck",T="fa-circle-dot",E="Filter: On Deck",L="On Deck",P="#fd7e14"):(w="all",T="fa-list",E="Filter: All",L="Backlog",P="#333"),f.dataset.filter=w,f.querySelector("i").className=`fas ${T}`,f.title=E,f.style.color=P,h.textContent=L,u.querySelectorAll(".kanban-card").forEach(B=>{const D=parseInt(B.dataset.taskId),A=d.find(_=>_.id===D);A&&(w==="all"?B.style.display="":w==="draft"?B.style.display=A.status==="Draft"?"":"none":w==="ready"?B.style.display=A.status==="Ready"?"":"none":w==="estimated"?B.style.display=A.status==="Estimated"?"":"none":w==="ondeck"&&(B.style.display=A.status==="OnDeck"?"":"none"))}),localStorage.setItem("backlogLaneFilter",w)});const p=localStorage.getItem("backlogLaneFilter")||"all";if(p!=="all"){f.dataset.filter=p;const y={draft:{icon:"fa-pencil",title:"Filter: Draft",header:"Draft",color:"#6c757d"},ready:{icon:"fa-check",title:"Filter: Ready",header:"Ready",color:"#0d6efd"},estimated:{icon:"fa-calculator",title:"Filter: Estimated",header:"Estimated",color:"#198754"},ondeck:{icon:"fa-circle-dot",title:"Filter: On Deck",header:"On Deck",color:"#fd7e14"}}[p];y&&(f.querySelector("i").className=`fas ${y.icon}`,f.title=y.title,f.style.color=y.color,h.textContent=y.header)}}if(c.id==="blocked"){const f=m.querySelector(".lane-status-filter"),h=m.querySelector(".lane-title");f.addEventListener("click",b=>{b.stopPropagation();const y=f.dataset.filter;let w,T,E,L;y==="all"?(w="backburner",T="fa-fire",E="Filter: Backburner",L="Backburner",f.style.color="orange"):y==="backburner"?(w="blocked",T="fa-ban",E="Filter: Blocked",L="Blocked",f.style.color="red"):(w="all",T="fa-list",E="Filter: All",L="On Hold",f.style.color="#333"),f.dataset.filter=w,f.querySelector("i").className=`fas ${T}`,f.title=E,h.textContent=L,u.querySelectorAll(".kanban-card").forEach(M=>{const B=parseInt(M.dataset.taskId),D=d.find(A=>A.id===B);D&&(w==="all"?M.style.display="":w==="backburner"?M.style.display=D.status==="Backburner"?"":"none":w==="blocked"&&(M.style.display=D.status==="Blocked"||D.status==="OnHold"?"":"none"))}),localStorage.setItem("blockedLaneFilter",w)});const p=localStorage.getItem("blockedLaneFilter")||"all";p!=="all"&&(f.dataset.filter=p,p==="backburner"?(f.querySelector("i").className="fas fa-fire",f.title="Filter: Backburner",f.style.color="orange",h.textContent="Backburner"):p==="blocked"&&(f.querySelector("i").className="fas fa-ban",f.title="Filter: Blocked",f.style.color="red",h.textContent="Blocked"))}for(const f of d){const h=await As(f);u.appendChild(h)}if(c.id==="backlog"){const f=localStorage.getItem("backlogLaneFilter")||"all";f!=="all"&&u.querySelectorAll(".kanban-card").forEach(p=>{const b=parseInt(p.dataset.taskId),y=d.find(w=>w.id===b);y&&(f==="draft"?p.style.display=y.status==="Draft"?"":"none":f==="ready"?p.style.display=y.status==="Ready"?"":"none":f==="estimated"?p.style.display=y.status==="Estimated"?"":"none":f==="ondeck"&&(p.style.display=y.status==="OnDeck"?"":"none"))})}if(c.id==="blocked"){const f=localStorage.getItem("blockedLaneFilter")||"all";f!=="all"&&u.querySelectorAll(".kanban-card").forEach(p=>{const b=parseInt(p.dataset.taskId),y=d.find(w=>w.id===b);y&&(f==="backburner"?p.style.display=y.status==="Backburner"?"":"none":f==="blocked"&&(p.style.display=y.status==="Blocked"||y.status==="OnHold"?"":"none"))})}l.appendChild(m)}n.appendChild(l);const r=document.createElement("div");r.className="board-task-detail-pane",r.id="boardTaskDetailPane",r.innerHTML=`
    <div class="board-task-empty-state">
      <i class="fas fa-tasks fa-2x mb-3"></i>
      <h5>Select a task</h5>
      <p>Click on any task card to view detailed information</p>
    </div>
  `,a.appendChild(n),a.appendChild(r),e.innerHTML="",e.appendChild(a),setTimeout(()=>{Fs(),Os(e,t,s),Us()},100)}async function As(e){const s=(await R(e.id)).reduce((d,m)=>d+m.hours,0),o=e.estimate||0,a=o>0?Math.min(s/o*100,100):0,n=O(),l=e.dueOn<n&&!["Completed","Abandoned","Archived"].includes(e.status),i=!l&&e.dueOn<=new Date(Date.now()+2*24*60*60*1e3).toISOString().split("T")[0],r=document.createElement("div");r.className=`kanban-card urgency-${e.urgency.toLowerCase()}`,r.dataset.taskId=e.id,r.dataset.taskStatus=e.status,r.draggable=!0,l&&r.classList.add("overdue");const c=await Hs(e);return r.innerHTML=`
    <div class="card-header">
      <div class="card-title" data-field="title" data-task-id="${e.id}">${e.title}</div>
      <div class="card-header-actions">
        <button class="card-edit-btn btn btn-outline-info work-task-btn" data-task-id="${e.id}" title="Edit task">
          <i class="fas fa-edit"></i>
        </button>
      </div>
    </div>
    ${c}
    <div class="card-meta">
      <div class="card-due-date ${l?"overdue":i?"due-soon":""}">
        <i class="fas fa-calendar"></i>
        ${new Date(e.dueOn).toLocaleDateString()}
      </div>
      <div class="card-meta-right">
        <div class="card-status-indicator status-${e.status.toLowerCase()}" title="Status: ${e.status}">
          <i class="fas fa-${xs(e.status)}"></i>
          <span>${e.status}</span>
        </div>
        ${e.notes&&e.notes.trim()?`
          <div class="card-notes-indicator" title="Has notes">
            <i class="fas fa-sticky-note"></i>
          </div>
        `:""}
      </div>
    </div>
    <div class="card-time-info">
      <div class="card-hours">
        <i class="fas fa-clock"></i>
        ${s.toFixed(1)}h logged
      </div>
      <div class="card-hours">
        <i class="fas fa-hourglass-half"></i>
        ${(e.remainingHours||0).toFixed(1)}h left
      </div>
    </div>
    ${o>0?`
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-bar-fill" style="width: ${a}%"></div>
        </div>
        <div class="progress-text">${s.toFixed(1)}h / ${o}h (${Math.round(a)}%)</div>
      </div>
    `:""}
    <div class="card-quick-actions">
      <div class="quick-time-buttons">
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.25">15m</button>
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.5">30m</button>
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="1">1h</button>
        <button class="quick-action-btn btn btn-outline-primary custom-time-btn" data-task-id="${e.id}">+</button>
      </div>
    </div>
  `,r}async function Hs(e){const t=[];if(e.projectId){const s=await Ne(e.projectId);s&&t.push(`
        <span class="badge badge-project" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}if(e.phaseKey){const s=await ze(e.phaseKey);s&&t.push(`
        <span class="badge badge-phase" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}return t.length>0?`<div class="card-badges">${t.join("")}</div>`:""}function xs(e){return{Draft:"pencil",Ready:"flag",Estimated:"calculator",OnDeck:"circle-dot",InProgress:"spinner",Completed:"check-circle",Blocked:"ban",Backburner:"fire",OnHold:"pause-circle",Abandoned:"times-circle",Archived:"archive"}[e]||"circle"}function Rs(e){var t;return["Completed","Abandoned","Archived"].includes(e.status)&&(e.completedOn||((t=e.lastModified)==null?void 0:t.split("T")[0]))||null}function Os(e,t,s){if(e.dataset.eventListenersSetup==="true")return;e.dataset.eventListenersSetup="true";const o=async({taskId:m})=>{document.getElementById("taskList")&&(console.log("[Board] Time logged for task",m,"- refreshing board"),await q(e,t,s))};e._timeLoggedHandler=o,I.on("task:timeLogged",o);const a=async({taskId:m})=>{document.getElementById("taskList")&&(console.log("[Board] Task updated",m,"- refreshing board"),await q(e,t,s))};e._taskUpdatedHandler=a,I.on("task:updated",a);const n=async({taskId:m})=>{document.getElementById("taskList")&&(console.log("[Board] Task created",m,"- refreshing board"),await q(e,t,s))};e._taskCreatedHandler=n,I.on("task:created",n);const l=async({taskId:m})=>{document.getElementById("taskList")&&(console.log("[Board] Task deleted",m,"- refreshing board"),await q(e,t,s))};e._taskDeletedHandler=l,I.on("task:deleted",l);const i=async({filters:m})=>{document.getElementById("taskList")&&(console.log("[Board] Filters changed - refreshing board with new filters",m),await q(e,m,s))};e._filtersChangedHandler=i,I.on("filters:changed",i);const r=({taskId:m,taskTitle:g})=>{const u=document.querySelector(`[data-task-id="${m}"]`);u&&(console.log("[Board] Rocket deployed for task",m,"- adding charge meter at 0 (frozen)"),He(u,g,Date.now(),!1))};e._rocketDeployedHandler=r,I.on("spaceport:rocketDeployed",r);const c=({taskId:m,taskTitle:g,totalTime:u})=>{const f=document.querySelector(`[data-task-id="${m}"]`);if(f){console.log("[Board] Rocket launched for task",m,"- starting LIVE charge meter from totalTime:",u);const h=(u||0)*1e3,p=Date.now()-h;He(f,g,p,!0)}};e._rocketLaunchedHandler=c,I.on("spaceport:rocketLaunched",c);const d=({taskId:m})=>{const g=document.querySelector(`[data-task-id="${m}"]`);g&&(console.log("[Board] Rocket landed for task",m,"- removing charge meter"),St(g))};e._rocketLandedHandler=d,I.on("spaceport:rocketLanded",d)}function Fs(){It(),js(),Ns()}function It(){const e=document.getElementById("taskList");e&&e.dataset.dragInitialized!=="true"&&(e.dataset.dragInitialized="true",e.addEventListener("dragstart",t=>{const s=t.target.closest(".kanban-card");s&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s.dataset.taskId),s.classList.add("dragging"))}),e.addEventListener("dragend",t=>{const s=t.target.closest(".kanban-card");s&&s.classList.remove("dragging")}),e.addEventListener("dragover",t=>{const s=t.target.closest(".kanban-lane-content");s&&(t.preventDefault(),t.dataTransfer.dropEffect="move",s.classList.add("drag-over"))}),e.addEventListener("dragleave",t=>{const s=t.target.closest(".kanban-lane-content");s&&(s.contains(t.relatedTarget)||s.classList.remove("drag-over"))}),e.addEventListener("drop",async t=>{const s=t.target.closest(".kanban-lane-content");if(!s)return;t.preventDefault(),s.classList.remove("drag-over");const o=parseInt(t.dataTransfer.getData("text/plain")),a=s.dataset.lane;await Ws(o,a)}))}async function Ws(e,t){const o={backlog:"Draft",inprogress:"InProgress",blocked:"Backburner",done:"Completed"}[t];if(o)try{const n=(await W({},!0)).find(i=>i.id===e);if(!n){k("Task not found","error");return}if(n.status=o,await Ve(n,!0)){k(`Task moved to ${o}`,"success");const i=document.getElementById("taskList");if(i){const r=z();await q(i,r)}}}catch(a){console.error("Error updating task status:",a),k("Failed to update task status","error")}}function js(){const e=document.querySelectorAll(".kanban-card");e.forEach(t=>{t.addEventListener("click",s=>{if(s.target.closest("button")||t.classList.contains("dragging"))return;e.forEach(a=>a.classList.remove("selected")),t.classList.add("selected");const o=parseInt(t.dataset.taskId);qs(o)})})}async function qs(e){const t=document.getElementById("boardTaskDetailPane");if(t){t.innerHTML='<div class="text-center p-4"><i class="fas fa-spinner fa-spin fa-2x"></i></div>';try{const o=(await W({},!0)).find(g=>g.id===e);if(!o){t.innerHTML=`
        <div class="board-task-empty-state">
          <i class="fas fa-exclamation-circle fa-3x text-muted mb-3"></i>
          <p>Task not found (ID: ${e})</p>
        </div>
      `;return}const a=await R(e),n=a.reduce((g,u)=>g+u.hours,0),l=o.estimate?Math.min(n/o.estimate*100,100):0;let i="";if(o.projectId){const g=await Ne(o.projectId);g&&(i=`<span class="badge" style="background-color: ${g.color||"#6c757d"}">${g.name}</span>`)}let r="";if(o.phaseKey){const g=await ze(o.phaseKey);g&&(r=`<span class="badge" style="background-color: ${g.color||"#6c757d"}">${g.name}</span>`)}const c=o.statusHistory?o.statusHistory.slice(-3).reverse().map(g=>`
        <div class="status-history-item mb-2">
          <span class="badge bg-${Xe(g.status)}">${g.status}</span>
          <small class="text-muted ms-2">${new Date(g.timestamp).toLocaleDateString()}</small>
        </div>
      `).join(""):'<p class="text-muted">No status history</p>',d=a.sort((g,u)=>u.dateLogged.localeCompare(g.dateLogged)).slice(0,5),m=d.length>0?d.map(g=>`
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>${ct(g.dateLogged,"short")}</span>
        <span class="fw-bold">${g.hours.toFixed(1)}h</span>
      </div>
    `).join(""):'<p class="text-muted">No time logged yet</p>';t.innerHTML=`
      <div class="board-task-detail-header">
        <div class="board-task-title">${o.title}</div>
        <div class="board-task-status-badges mt-2">
          <span class="badge bg-${Xe(o.status)}">${o.status}</span>
          <span class="badge bg-warning">${o.urgency}</span>
          ${i}
          ${r}
        </div>
      </div>
      
      <div class="board-task-section">
        <div class="board-task-section-title">Key Metrics</div>
        <div class="board-task-metrics">
          <div class="board-task-metric">
            <div class="board-task-metric-label">Due Date</div>
            <div class="board-task-metric-value">${o.dueOn?new Date(o.dueOn).toLocaleDateString():"Not set"}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Hours Logged</div>
            <div class="board-task-metric-value">${n.toFixed(1)}h</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Estimate</div>
            <div class="board-task-metric-value">${o.estimate||"None"}${o.estimate?"h":""}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Remaining</div>
            <div class="board-task-metric-value">${o.remainingHours!==null&&o.remainingHours!==void 0?o.remainingHours.toFixed(1)+"h":"N/A"}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Progress</div>
            <div class="board-task-metric-value">${l.toFixed(0)}%</div>
          </div>
        </div>
        ${o.estimate?`
          <div class="progress mt-2" style="height: 8px;">
            <div class="progress-bar bg-primary" style="width: ${l}%"></div>
          </div>
        `:""}
      </div>
      
      ${o.description?`
        <div class="board-task-section">
          <div class="board-task-section-title">Description</div>
          <div class="board-task-description">${o.description}</div>
        </div>
      `:""}
      
      ${o.notes?`
        <div class="board-task-section">
          <div class="board-task-section-title">Notes</div>
          <div class="board-task-description">${o.notes}</div>
        </div>
      `:""}
      
      <div class="board-task-section">
        <div class="board-task-section-title">Recent Status Changes</div>
        ${c}
      </div>
      
      <div class="board-task-section">
        <div class="board-task-section-title">Recent Time Logs</div>
        ${m}
      </div>
      
      <div class="board-task-section">
        <button class="btn btn-primary w-100 work-task-btn" data-task-id="${o.id}">
          <i class="fas fa-edit me-2"></i>Edit in Work View
        </button>
      </div>
    `}catch(s){console.error("Error loading task details:",s),t.innerHTML=`
      <div class="board-task-empty-state">
        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
        <p>Error loading task details</p>
        <small class="text-muted">${s.message}</small>
      </div>
    `}}}function Ns(){document.body.dataset.quickTimeInitialized!=="true"&&(document.body.dataset.quickTimeInitialized="true",document.addEventListener("click",e=>{const t=document.getElementById("taskList");if(!t)return;const s=e.target;if(t.contains(s)){if(e.target.closest(".quick-time-btn")){const o=e.target.closest(".quick-time-btn"),a=parseInt(o.dataset.taskId),n=parseFloat(o.dataset.hours);window.logQuickTime&&window.logQuickTime(a,n)}if(e.target.closest(".custom-time-btn")){const o=e.target.closest(".custom-time-btn"),a=parseInt(o.dataset.taskId);window.showCustomTimeModal&&window.showCustomTimeModal(a)}}}))}const K=new URLSearchParams(window.location.search).get("debug")==="true",zs=K?1e3:6e4;K&&console.log("[Board] 🚀 DEBUG MODE ACTIVE - Charge bars will fill every second instead of every minute!");function Je(e){return e<15?{bars:1,color:"dim-green"}:e<30?{bars:2,color:"medium-green"}:e<45?{bars:3,color:"bright-green"}:e<60?{bars:4,color:"brightest-green"}:e<75?{bars:4,color:"orange"}:{bars:4,color:"red"}}function He(e,t,s,o=!0){St(e),e.classList.remove("rocket-fueling","rocket-active"),e.classList.add("charge-active");const a=Math.floor((Date.now()-s)/zs),n=Je(a),l=document.createElement("div");l.className="charge-meter-indicator",l.setAttribute("data-start-time",s);const i=Array.from({length:4},(g,u)=>`<div class="charge-bar ${u<n.bars?"active":""}"></div>`).join("");l.innerHTML=`
    <div class="charge-meter ${n.color}">
      ${i}
    </div>
    <span class="charge-timer">00:00</span>
  `;const r=Math.floor(a),c=Math.floor(r/60),d=r%60;l.querySelector(".charge-timer").textContent=`${c}:${d.toString().padStart(2,"0")}`,l.title=`Power charging - ${n.bars} bar${n.bars>1?"s":""} ${K?"(DEBUG: seconds)":""}`;const m=e.querySelector(".card-header-actions");if(m)if(m.insertBefore(l,m.firstChild),console.log("[Board] Charge meter added to DOM, isLive:",o),o){const g=setInterval(()=>{const u=l.querySelector(".charge-timer"),f=l.querySelector(".charge-meter");if(!u||!document.body.contains(l)){clearInterval(g);return}const h=parseInt(l.getAttribute("data-start-time")),p=Math.floor((Date.now()-h)/1e3),b=Math.floor(p/(K?1:60)),y=Math.floor(b/60),w=b%60;u.textContent=`${y}:${w.toString().padStart(2,"0")}`;const T=Je(b);l.querySelectorAll(".charge-bar").forEach((L,P)=>{P<T.bars?L.classList.add("active"):L.classList.remove("active")}),f.className=`charge-meter ${T.color}`,l.title=`Power charging - ${T.bars} bar${T.bars>1?"s":""} ${K?"(DEBUG: seconds)":""}`},1e3);l.setAttribute("data-timer-id",g)}else l.style.opacity="0.6",l.title=`Deployed - ${n.bars} bar${n.bars>1?"s":""} accumulated ${K?"(DEBUG: seconds)":""}`;else console.error("[Board] Could not find .card-header-actions in task card")}function St(e){const t=e.querySelector(".charge-meter-indicator");if(t){const a=t.getAttribute("data-timer-id");a&&clearInterval(parseInt(a)),t.remove()}const s=e.querySelector(".fueling-indicator");s&&s.remove();const o=e.querySelector(".rocket-indicator");if(o){const a=o.getAttribute("data-timer-id");a&&clearInterval(parseInt(a)),o.remove()}e.classList.remove("charge-active","rocket-active","rocket-fueling")}function Us(){const e=C();if(!e||!e.rockets){console.log("[Board] No SpacePort session or rockets found");return}console.log("[Board] Syncing charge meters with SpacePort session",{rocketCount:e.rockets.size,activeRocket:e.activeRocket}),e.rockets.forEach((t,s)=>{const o=document.querySelector(`[data-task-id="${t.taskId}"]`);if(!o){console.log(`[Board] Card not found for task ${t.taskId}`);return}const a=(t.totalTime||0)*1e3,n=Date.now()-a,l=t.isActive&&e.activeRocket===s;console.log(`[Board] Adding charge meter for task ${t.taskId}`,{isActive:l,totalTime:t.totalTime,startTime:new Date(n),bars:Math.floor(t.totalTime/60)}),He(o,t.taskTitle,n,l)})}let be=[],fe=null;async function Vs(e,t={}){console.log("Rendering Calendar Month view"),console.log("Filters received:",JSON.stringify(t));try{const s=G(),o=new Date;o.setMonth(o.getMonth()+s);const a=o.getFullYear(),n=o.getMonth()+1;console.log(`Calendar: Year=${a}, Month=${n}, Offset=${s}`);const l=Ys(a,n);let i=await W({},!0);console.log(`Calendar: Loaded ${i.length} tasks`),t.status&&(i=i.filter(u=>u.status===t.status)),t.urgency&&(i=i.filter(u=>u.urgency===t.urgency)),t.project&&(i=i.filter(u=>u.projectId&&u.projectId.toString()===t.project)),t.phase&&(i=i.filter(u=>u.phaseKey===t.phase)),console.log(`Calendar: ${i.length} tasks after filters`),be=i;const c=`
    <div class="calendar-header">
      \x3C!-- Navigation & Period Label -->
      <div class="calendar-nav-section">
        <button class="btn btn-outline-primary btn-sm" id="calendarPrevMonth">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h5 class="mb-0 mx-3" id="calendarPeriodLabel">${o.toLocaleDateString("en-US",{month:"long",year:"numeric"})}</h5>
        <button class="btn btn-outline-primary btn-sm" id="calendarNextMonth">
          <i class="fas fa-chevron-right"></i>
        </button>
        <button class="btn btn-outline-secondary btn-sm ms-2" id="calendarTodayButton">Today</button>
      </div>
      
      \x3C!-- Filters -->
      <div class="calendar-filters-compact">
        <select id="calendarStatusFilter" class="form-select form-select-sm" title="Filter by status">
          <option value="">All Status</option>
          <option value="Draft">Draft</option>
          <option value="Ready">Ready</option>
          <option value="Estimated">Estimated</option>
          <option value="OnDeck">On Deck</option>
          <option value="InProgress">In Progress</option>
          <option value="Blocked">Blocked</option>
          <option value="Backburner">Backburner</option>
          <option value="OnHold">On Hold</option>
          <option value="Completed">Completed</option>
          <option value="Abandoned">Abandoned</option>
          <option value="Archived">Archived</option>
        </select>
        <select id="calendarUrgencyFilter" class="form-select form-select-sm" title="Filter by urgency">
          <option value="">All Urgency</option>
          <option value="High">High</option>
          <option value="Med">Med</option>
          <option value="Low">Low</option>
        </select>
        <button class="btn btn-outline-secondary btn-sm" id="clearCalendarFilters" title="Clear all filters">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      \x3C!-- Monthly Summary -->
      <div class="month-summary-compact">
        <div class="summary-item">
          <i class="fas fa-tasks text-primary"></i>
          <span class="summary-value" id="monthTotalTasks">0</span>
        </div>
        <div class="summary-item">
          <i class="fas fa-clock text-success"></i>
          <span class="summary-value" id="monthTotalHours">0h</span>
        </div>
        <div class="summary-item">
          <i class="fas fa-calendar-check text-info"></i>
          <span class="summary-value" id="monthWorkDays">0</span>
        </div>
      </div>
    </div>
  `,d=await _s(i,a,n),m=await Gs(l,d,a,n,i),g=`
    <div class="month-split-view">
      \x3C!-- Left Pane: Calendar -->
      <div class="month-calendar-pane">
        ${c}
        ${m}
      </div>
      
      \x3C!-- Right Pane: Details -->
      <div class="month-details-pane">
        <div class="month-details-header">
          <h6 id="selectedPeriodTitle" class="mb-0">Select a day or week</h6>
          <small id="selectedPeriodSubtitle" class="text-muted"></small>
        </div>
        <div id="selectedPeriodContent">
          <div class="text-muted text-center py-4">
            <i class="fas fa-calendar-alt fa-2x opacity-50 mb-3"></i>
            <p>Click on a day or week to view details</p>
          </div>
        </div>
      </div>
    </div>
  `;e.innerHTML=g,ao(d),xe=!1,Js(d,a,n),so(),oo(),console.log("✅ Calendar view rendered successfully")}catch(s){console.error("❌ Error rendering calendar view:",s),e.innerHTML=`
      <div class="alert alert-danger m-3">
        <h5><i class="fas fa-exclamation-triangle"></i> Calendar View Error</h5>
        <p>Failed to load calendar view: ${s.message}</p>
        <button class="btn btn-primary btn-sm" onclick="location.reload()">Reload Page</button>
      </div>
    `}}function Ys(e,t){const s=new Date(e,t-1,1),o=new Date(e,t,0),a=s.getDay(),n=o.getDate(),l=[];let i=new Array(7).fill(null);for(let c=a;c<7;c++)i[c]=c-a+1;l.push(i);let r=8-a;for(;r<=n;){i=[];for(let c=0;c<7;c++)r<=n?(i.push(r),r++):i.push(null);l.push(i)}return l}async function _s(e,t,s){const o={};for(const a of e){a.dueOn&&(o[a.dueOn]||(o[a.dueOn]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[a.dueOn].tasks.push(a));const n=Et(a);n&&n!==a.dueOn&&(o[n]||(o[n]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[n].tasks.some(i=>i.id===a.id)||o[n].tasks.push(a))}`${t}${s.toString().padStart(2,"0")}`,`${t}${s.toString().padStart(2,"0")}${new Date(t,s,0).getDate().toString().padStart(2,"0")}`;for(const a in o)for(const n of o[a].tasks){const l=await R(n.id,a,a);o[a].totalHours+=l.reduce((i,r)=>i+r.hours,0)}try{const a=await _e(!0),n=await Ge();a.forEach(l=>{var r;const i=(r=l.createdAt)==null?void 0:r.split("T")[0];i&&(o[i]||(o[i]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[i].todos++)}),n.forEach(l=>{var r;const i=(r=l.createdAt)==null?void 0:r.split("T")[0];i&&(o[i]||(o[i]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[i].accomplishments++)})}catch(a){console.error("Error loading calendar data:",a)}return o}function Et(e){var t;return["Completed","Abandoned","Archived"].includes(e.status)&&(e.completedOn||((t=e.lastModified)==null?void 0:t.split("T")[0]))||null}async function Gs(e,t,s,o,a){let n='<div class="calendar-table-container"><table class="table calendar-table"><thead><tr>';n+='<th class="week-selector-header" title="Select Week"><i class="fas fa-calendar-week"></i></th>',["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(i=>n+=`<th>${i}</th>`),n+="</tr></thead><tbody>";let l=0;for(const i of e){n+=`<tr class="calendar-week-row" data-week="${l}">`,n+=`<td class="week-selector-cell clickable-week-header" data-week="${l}">
      <span class="week-number">W${l+1}</span>
    </td>`;const c=i.slice(0,7).map(async m=>{if(!m)return{day:null,content:""};const g=`${s}-${o.toString().padStart(2,"0")}-${m.toString().padStart(2,"0")}`,u=t[g]||{tasks:[],workSession:null},f=g===O(),h=await Qs(u.tasks,g),p=await Xs(u.tasks,g,u.workSession,a),b=await Ks(u.tasks,g,a);return{day:m,dateStr:g,isToday:f,content:`
          <div class="calendar-day-inner">
            <div class="calendar-day-header">
              <div class="day-number-row">
                <span class="calendar-day-number">${m}</span>
                ${h}
              </div>
            </div>
            <div class="calendar-day-content">
              ${p}
              <div class="calendar-progress-bars">
                ${b}
              </div>
            </div>
          </div>
        `}}),d=await Promise.all(c);for(const m of d)m.day?(n+=`<td class="calendar-day ${m.isToday?"today":""}" data-date="${m.dateStr}">`,n+=m.content,n+="</td>"):n+='<td class="calendar-day empty-day"></td>';n+="</tr>",l++}return n+="</tbody></table></div>",n}async function Qs(e,t){const s=e.filter(a=>a.dueOn===t);return s.length===0?"":`<div class="due-badges-container">${s.map(a=>{const n=`status-${a.status.toLowerCase()}`,l=`urgency-${a.urgency.toLowerCase()}`,i=Yt(a.dueOn)&&!["Completed","Abandoned","Archived"].includes(a.status);return`<span class="due-task-badge ${n} ${l} ${i?"overdue-badge":""}" 
                  title="${a.title} - ${a.status}">
              <i class="fas fa-circle"></i>
            </span>`}).join("")}</div>`}async function Xs(e,t,s,o){const a=await R(null,t,t),n=new Set(o.map(r=>r.id)),i=a.filter(r=>n.has(r.taskId)).reduce((r,c)=>r+c.hours,0);return i===0?"":`<div class="day-time-summary"><span class="hours-worked"><i class="fas fa-clock"></i> ${i.toFixed(1)}h</span></div>`}async function Ks(e,t,s){const o=await R(null,t,t);if(o.length===0)return"";const a=new Set(s.map(r=>r.id)),n=o.filter(r=>a.has(r.taskId));if(n.length===0)return"";const l=[...new Set(n.map(r=>r.taskId))];let i="";for(const r of l){const c=s.find(h=>h.id===r);if(!c)continue;const m=n.filter(h=>h.taskId===r).reduce((h,p)=>h+p.hours,0),u=(await R(r)).reduce((h,p)=>h+p.hours,0),f=c.estimate||0;if(c.remainingHours,f>0){const h=Math.min(u/f*100,100),p=Math.max(0,100-h);i+=`
        <div class="mini-progress-bar" title="${c.title}: ${m.toFixed(1)}h logged on ${t} (${u.toFixed(1)}h / ${f}h total)">
          <div class="mini-progress-fill status-${c.status.toLowerCase()}" style="width: ${h}%"></div>
          <div class="mini-progress-remaining" style="width: ${p}%; left: ${h}%"></div>
        </div>
      `}else i+=`
        <div class="mini-progress-bar no-estimate" title="${c.title}: ${m.toFixed(1)}h logged on ${t} (${u.toFixed(1)}h total)">
          <div class="mini-progress-fill status-${c.status.toLowerCase()}" style="width: 100%"></div>
        </div>
      `}return i}function Js(e,t,s){const o=document.querySelectorAll(".clickable-week-header"),a=document.querySelectorAll(".calendar-day[data-date]");o.forEach(n=>{n.addEventListener("click",l=>{const i=parseInt(l.currentTarget.dataset.week),r=document.querySelector(`[data-week="${i}"]`);document.querySelectorAll(".calendar-week-row").forEach(d=>d.classList.remove("selected-week")),document.querySelectorAll(".clickable-week-header").forEach(d=>d.classList.remove("selected-week-header")),document.querySelectorAll(".calendar-day").forEach(d=>d.classList.remove("selected-day")),r.classList.add("selected-week"),l.currentTarget.classList.add("selected-week-header");const c=Array.from(r.querySelectorAll(".calendar-day[data-date]")).map(d=>d.dataset.date).filter(d=>d);if(c.length>0){const d=c[0],m=c[c.length-1];Zs(c,e,d,m)}})}),a.forEach(n=>{n.addEventListener("click",l=>{const i=l.currentTarget.dataset.date;i&&(document.querySelectorAll(".calendar-week-row").forEach(r=>r.classList.remove("selected-week")),document.querySelectorAll(".clickable-week-header").forEach(r=>r.classList.remove("selected-week-header")),document.querySelectorAll(".calendar-day").forEach(r=>r.classList.remove("selected-day")),l.currentTarget.classList.add("selected-day"),Be(i,e))})})}async function Zs(e,t,s,o){const a=document.getElementById("selectedPeriodTitle"),n=document.getElementById("selectedPeriodSubtitle"),l=document.getElementById("selectedPeriodContent"),i=new Date(s),r=new Date(o),c=`${i.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${r.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`;a.textContent=`Week: ${c}`,n.textContent="Weekly Tasks";const d=new Map;e.forEach(p=>{const b=t[p];b&&b.tasks&&b.tasks.forEach(y=>{if(!d.has(y.id))if(["Completed","Abandoned"].includes(y.status)){const w=Et(y);w&&e.includes(w)&&d.set(y.id,{task:y,reason:"due"})}else d.set(y.id,{task:y,reason:"due"})})});const m=await R(null,s,o),g=new Set(m.map(p=>p.taskId));if(g.size>0)for(const p of g)if(d.has(p))d.get(p).reason="both";else{const b=be.find(y=>y.id===p);b&&d.set(p,{task:b,reason:"time"})}const u=Array.from(d.values()).map(p=>p.task),f=await Lt(s,u);let h='<div class="week-details">';if(u.length>0){h+='<div class="tasks-section">';for(const p of Array.from(d.values())){const b=p.task,y=p.reason,w=f[b.id]||{totalHours:0},T=`status-${b.status.toLowerCase()}`,E=b.estimate?Math.min(w.totalHours/b.estimate*100,100):0,L=b.dueOn<o&&!["Completed","Abandoned","Archived"].includes(b.status),P=await Bt(b);let M="";y==="due"?M='<span class="task-reason-badge due-badge-reason" title="Task due this week"><i class="fas fa-calendar-check"></i> Due</span>':y==="time"?M='<span class="task-reason-badge time-badge-reason" title="Time logged this week"><i class="fas fa-clock"></i> Logged</span>':y==="both"&&(M='<span class="task-reason-badge both-badge-reason" title="Due & time logged this week"><i class="fas fa-calendar-check"></i> <i class="fas fa-clock"></i></span>'),h+=`
        <div class="progress-task-card ${L?"overdue":""}">
          <div class="task-card-header ${T}">
            <div class="status-info">
              <span class="status-label">${b.status}</span>
              <span class="urgency-indicator urgency-${b.urgency.toLowerCase()}">${b.urgency}</span>
            </div>
            <div class="task-card-header-actions">
              ${M}
              <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${b.id}" title="Edit task in Work view">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          ${P}
          <div class="task-card-body">
            <div class="task-title">${b.title}</div>
            <div class="task-progress-section">
              ${b.estimate?`
                <div class="progress-bar-container">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${E}%"></div>
                  </div>
                  <div class="progress-text">${w.totalHours.toFixed(1)}h / ${b.estimate}h (${E.toFixed(0)}%)</div>
                </div>
              `:`
                <div class="progress-text">Total: ${w.totalHours.toFixed(1)}h logged</div>
              `}
            </div>
            <div class="task-meta">
              <span class="task-due ${L?"overdue-text":""}">
                <i class="fas fa-calendar"></i> Due: ${new Date(b.dueOn).toLocaleDateString()}
              </span>
            </div>
          </div>
        </div>
      `}h+="</div>"}else h+=`
      <div class="no-tasks-message">
        <i class="fas fa-calendar-week fa-2x text-muted mb-3"></i>
        <p class="text-muted">No tasks scheduled or worked on this week</p>
      </div>
    `;h+="</div>",l.innerHTML=h}async function Be(e,t){const s=document.getElementById("selectedPeriodTitle"),o=document.getElementById("selectedPeriodSubtitle"),a=document.getElementById("selectedPeriodContent");fe=e;const l=new Date(e).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),i=t[e]||{tasks:[]};s.textContent=l;const r=e===O();o.textContent=r?"Today":"";const c=new Map;i.tasks.forEach(h=>{c.set(h.id,{task:h,reason:"due"})});const d=await R(null,e,e),m=new Set(be.map(h=>h.id)),g=d.filter(h=>m.has(h.taskId));for(const h of g){const p=be.find(b=>b.id===h.taskId);p&&!c.has(p.id)?c.set(p.id,{task:p,reason:"time"}):p&&c.has(p.id)&&(c.get(p.id).reason="both")}const u=await Lt(e,Array.from(c.values()).map(h=>h.task));let f='<div class="day-details">';if(f+=await eo(e),c.size>0){f+='<div class="tasks-section">';for(const[h,{task:p,reason:b}]of c){const y=u[p.id]||{totalHours:0,todayHours:0},w=`status-${p.status.toLowerCase()}`,T=p.estimate?Math.min(y.totalHours/p.estimate*100,100):0,E=p.dueOn<e&&!["Completed","Abandoned","Archived"].includes(p.status),L=await Bt(p);let P="";b==="due"?P='<span class="task-reason-badge due-badge-reason" title="Task due on this day"><i class="fas fa-calendar-check"></i> Due</span>':b==="time"?P='<span class="task-reason-badge time-badge-reason" title="Time logged on this day"><i class="fas fa-clock"></i> Logged</span>':b==="both"&&(P='<span class="task-reason-badge both-badge-reason" title="Due & time logged"><i class="fas fa-calendar-check"></i> <i class="fas fa-clock"></i></span>'),f+=`
        <div class="progress-task-card ${E?"overdue":""}">
          <div class="task-card-header ${w}">
            <div class="status-info">
              <span class="status-label">${p.status}</span>
              <span class="urgency-indicator urgency-${p.urgency.toLowerCase()}">${p.urgency}</span>
            </div>
            <div class="task-card-header-actions">
              ${P}
              <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${p.id}" title="Edit task in Work view">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          ${L}
          <div class="task-card-body">
            <div class="task-title">${p.title}</div>
            <div class="task-progress-section">
              ${p.estimate?`
                <div class="progress-bar-container">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${T}%"></div>
                  </div>
                  <div class="progress-text">${y.totalHours.toFixed(1)}h / ${p.estimate}h (${T.toFixed(0)}%)</div>
                </div>
              `:`
                <div class="progress-text">Total: ${y.totalHours.toFixed(1)}h logged</div>
              `}
              ${y.todayHours>0?`
                <div class="today-hours">
                  <i class="fas fa-clock text-primary"></i> ${y.todayHours.toFixed(1)}h on this day
                </div>
              `:""}
            </div>
            <div class="task-meta">
              <span class="task-due ${E?"overdue-text":""}">
                <i class="fas fa-calendar"></i> Due: ${new Date(p.dueOn).toLocaleDateString()}
              </span>
            </div>
          </div>
        </div>
      `}f+="</div>"}else f+=`
      <div class="no-tasks-message">
        <i class="fas fa-calendar-check fa-2x text-muted mb-3"></i>
        <p class="text-muted">No tasks scheduled or worked on this day</p>
      </div>
    `;f+="</div>",a.innerHTML=f,to(e)}async function eo(e){const t=await ce(e);let s="";if(t){const o=t.punchIn?new Date(t.punchIn).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A",a=t.punchOut?new Date(t.punchOut).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Not Punched Out",n=t.totalHours?`${t.totalHours.toFixed(2)}h`:"In Progress",l=!!t.punchOut;let i="";t.activities&&t.activities.length>0&&(i=`
        <div class="work-session-activities mt-3">
          <div class="small text-muted mb-2">Activities:</div>
          <div class="activities-list" style="max-height: 150px; overflow-y: auto;">
            ${t.activities.map(r=>{const c=new Date(r.startTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=r.endTime?new Date(r.endTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Current",g={work:"Work",lunch:"Lunch Break",meeting:"Meeting",personal:"Personal Time",custom:r.description||"Custom"}[r.category]||r.description||r.category;return`
                <div class="time-slot">
                  <span class="time">${c} - ${d}</span>
                  <span class="activity">${g}</span>
                </div>
              `}).join("")}
          </div>
        </div>
      `),s=`
      <div class="work-session-info">
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-sign-in-alt text-success"></i> Punch In:
          </span>
          <span class="work-session-value">${o}</span>
        </div>
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-sign-out-alt ${l?"text-danger":"text-muted"}"></i> Punch Out:
          </span>
          <span class="work-session-value ${l?"":"text-muted"}">${a}</span>
        </div>
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-clock text-primary"></i> Duration:
          </span>
          <span class="work-session-value fw-bold text-primary">${n}</span>
        </div>
        ${i}
      </div>
    `}else s=`
      <div class="no-session-message text-muted text-center py-2">
        <i class="fas fa-briefcase me-1"></i>
        No work session recorded for this day
      </div>
    `;return`
    <div class="work-session-section mt-4">
      <h6 class="mb-3">
        <i class="fas fa-briefcase me-2"></i>
        Work Session
      </h6>
      ${s}
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-sm btn-outline-primary flex-fill" id="editWorkSessionBtn" data-date="${e}">
          <i class="fas fa-edit me-1"></i>
          ${t?"Edit Session":"Add Session"}
        </button>
        ${t?`
          <button class="btn btn-sm btn-outline-danger" id="deleteWorkSessionBtn" data-session-id="${t.id}" data-date="${e}">
            <i class="fas fa-trash"></i>
          </button>
        `:""}
      </div>
    </div>
  `}function to(e){const t=document.getElementById("editWorkSessionBtn"),s=document.getElementById("deleteWorkSessionBtn");t&&t.addEventListener("click",async()=>{await no(e)}),s&&s.addEventListener("click",async()=>{const o=parseInt(s.dataset.sessionId);confirm("Are you sure you want to delete this work session?")&&await rs(o)&&(k("Work session deleted","success"),await Be(e,{}),window.renderTasks&&window.renderTasks("month"))})}async function Lt(e,t){const s={};for(const o of t){const n=(await R(o.id)).reduce((r,c)=>r+c.hours,0),i=(await R(o.id,e,e)).reduce((r,c)=>r+c.hours,0);s[o.id]={totalHours:n,todayHours:i}}return s}async function Bt(e){const t=[];if(e.projectId){const s=await Ne(e.projectId);s&&t.push(`
        <span class="badge badge-project" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}if(e.phaseKey){const s=await ze(e.phaseKey);s&&t.push(`
        <span class="badge badge-phase" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}return t.length>0?`<div class="card-badges">${t.join("")}</div>`:""}let xe=!1;function so(){if(xe){console.log("⚠️ Calendar controls already initialized, skipping");return}console.log("🔧 Initializing calendar controls...");const e=document.getElementById("calendarPrevMonth"),t=document.getElementById("calendarNextMonth"),s=document.getElementById("calendarTodayButton"),o=document.getElementById("calendarStatusFilter"),a=document.getElementById("calendarUrgencyFilter"),n=document.getElementById("clearCalendarFilters");console.log("Calendar buttons found:",{prev:!!e,next:!!t,today:!!s}),e&&e.addEventListener("click",()=>{console.log("📅 Previous month clicked, current offset:",G()),Pe(G()-1),console.log("📅 New offset:",G()),window.renderTasks&&window.renderTasks("month")}),t&&t.addEventListener("click",()=>{console.log("📅 Next month clicked, current offset:",G()),Pe(G()+1),console.log("📅 New offset:",G()),console.log("window.renderTasks exists?",!!window.renderTasks),window.renderTasks?(console.log('Calling window.renderTasks("month")'),window.renderTasks("month")):console.error("❌ window.renderTasks is not defined!")}),s&&s.addEventListener("click",()=>{console.log("📅 Today clicked, resetting offset to 0"),Pe(0),window.renderTasks&&window.renderTasks("month")}),o&&o.addEventListener("change",()=>{localStorage.setItem("calendarStatusFilter",o.value),J(o);const i=z();te({...i,status:o.value||null}),window.renderTasks&&window.renderTasks("month")}),a&&a.addEventListener("change",()=>{localStorage.setItem("calendarUrgencyFilter",a.value),J(a);const i=z();te({...i,urgency:a.value||null}),window.renderTasks&&window.renderTasks("month")}),n&&n.addEventListener("click",()=>{o&&(o.value="",localStorage.removeItem("calendarStatusFilter"),J(o)),a&&(a.value="",localStorage.removeItem("calendarUrgencyFilter"),J(a));const i=z();te({...i,status:null,urgency:null}),window.renderTasks&&window.renderTasks("month")});const l=async i=>{if(!fe)return;const r=(i==null?void 0:i.date)||O();fe===r&&(console.log("[Calendar] Work session changed - refreshing day details"),await Be(fe,{}),window.renderTasks&&window.renderTasks("month"))};I.on("session:punchedIn",l),I.on("session:punchedOut",l),I.on("session:activityChanged",l),xe=!0,console.log("✅ Calendar controls initialized successfully")}function J(e){e.value!==""?(e.style.borderColor="#007bff",e.style.backgroundColor="rgba(0, 123, 255, 0.1)"):(e.style.borderColor="",e.style.backgroundColor="")}function oo(){const e=document.getElementById("calendarStatusFilter"),t=document.getElementById("calendarUrgencyFilter");if(e){const s=localStorage.getItem("calendarStatusFilter");s&&(e.value=s,J(e))}if(t){const s=localStorage.getItem("calendarUrgencyFilter");s&&(t.value=s,J(t))}}function ao(e){const t=new Set;let s=0,o=0;for(const a in e){const n=e[a];n.tasks.forEach(l=>t.add(l.id)),s+=n.totalHours,(n.totalHours>0||n.workSession)&&o++}document.getElementById("monthTotalTasks").textContent=t.size,document.getElementById("monthTotalHours").textContent=`${s.toFixed(1)}h`,document.getElementById("monthWorkDays").textContent=o}async function no(e){const t=await ce(e);let s=document.getElementById("workSessionModal");if(s||(document.body.insertAdjacentHTML("beforeend",`
      <div class="modal fade" id="workSessionModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">
                <i class="fas fa-briefcase me-2"></i>
                <span id="workSessionModalTitle">Edit Work Session</span>
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="workSessionForm">
                <div class="mb-3">
                  <label for="workSessionDate" class="form-label">Date</label>
                  <input type="date" class="form-control" id="workSessionDate" required>
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="workSessionPunchIn" class="form-label">
                      <i class="fas fa-sign-in-alt text-success me-1"></i>
                      Punch In Time
                    </label>
                    <input type="time" class="form-control" id="workSessionPunchIn" required>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="workSessionPunchOut" class="form-label">
                      <i class="fas fa-sign-out-alt text-danger me-1"></i>
                      Punch Out Time
                    </label>
                    <input type="time" class="form-control" id="workSessionPunchOut">
                    <div class="form-text">Leave empty if still in progress</div>
                  </div>
                </div>
                
                <div class="alert alert-info" id="workSessionDuration">
                  <i class="fas fa-clock me-2"></i>
                  <span id="durationDisplay">Duration will be calculated</span>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="saveWorkSessionBtn">
                <i class="fas fa-save me-1"></i>Save
              </button>
            </div>
          </div>
        </div>
      </div>
    `),s=document.getElementById("workSessionModal")),document.getElementById("workSessionDate").value=e,t){if(document.getElementById("workSessionModalTitle").textContent="Edit Work Session",t.punchIn){const i=new Date(t.punchIn);document.getElementById("workSessionPunchIn").value=i.toTimeString().slice(0,5)}if(t.punchOut){const i=new Date(t.punchOut);document.getElementById("workSessionPunchOut").value=i.toTimeString().slice(0,5)}else document.getElementById("workSessionPunchOut").value=""}else document.getElementById("workSessionModalTitle").textContent="Add Work Session",document.getElementById("workSessionPunchIn").value="09:00",document.getElementById("workSessionPunchOut").value="";const o=()=>{const i=document.getElementById("workSessionPunchIn").value,r=document.getElementById("workSessionPunchOut").value;if(i&&r){const c=document.getElementById("workSessionDate").value,d=new Date(`${c}T${i}`),g=new Date(`${c}T${r}`)-d;if(g>0){const u=(g/36e5).toFixed(2);document.getElementById("durationDisplay").textContent=`Duration: ${u} hours`}else document.getElementById("durationDisplay").textContent="Invalid: Punch out must be after punch in"}else i?document.getElementById("durationDisplay").textContent="In Progress (no punch out time)":document.getElementById("durationDisplay").textContent="Duration will be calculated"};document.getElementById("workSessionPunchIn").addEventListener("change",o),document.getElementById("workSessionPunchOut").addEventListener("change",o),o();const a=document.getElementById("saveWorkSessionBtn"),n=async()=>{const i=document.getElementById("workSessionDate").value,r=document.getElementById("workSessionPunchIn").value,c=document.getElementById("workSessionPunchOut").value;if(!i||!r){k("Date and punch in time are required","error");return}const d=`${i}T${r}:00`,m=c?`${i}T${c}:00`:null,g={id:t==null?void 0:t.id,date:i,punchIn:d,punchOut:m,activities:(t==null?void 0:t.activities)||[],breaks:(t==null?void 0:t.breaks)||[]};await ls(g)&&(k("Work session saved","success"),bootstrap.Modal.getInstance(s).hide(),await Be(e,{}),window.renderTasks&&window.renderTasks("month"))};a.replaceWith(a.cloneNode(!0)),document.getElementById("saveWorkSessionBtn").addEventListener("click",n),new bootstrap.Modal(s).show()}async function $t(){try{const t=(await W({},!0)).filter(l=>{var i,r;return l.status==="Completed"&&((r=(i=l.estimationData)==null?void 0:i.scale)==null?void 0:r.expected)&&l.estimationData.scale.expected>0});if(t.length===0)return null;let s=0,o=0,a=0;for(const l of t){const r=(await R(l.id)).reduce((c,d)=>c+d.hours,0);r>0&&(s+=l.estimationData.scale.expected,o+=r,a++)}if(s===0||a===0)return null;const n=o/s;return{velocity:n,sampleSize:a,totalHours:o,totalPoints:s,averageHoursPerPoint:n}}catch(e){return console.error("Error calculating personal velocity:",e),null}}async function io(e){if(!(e!=null&&e.scale))return{canPredict:!1,message:"No estimation data provided"};const t=await $t();if(!t)return{canPredict:!1,message:"Complete more tasks with estimation data to enable predictions"};const{low:s,expected:o,high:a}=e.scale,n=t.velocity;return{canPredict:!0,low:s*n,expected:o*n,high:a*n,velocity:n,sampleSize:t.sampleSize,confidence:e.confidence||100}}function lo(e){return e>=90?"Very confident - I've done this before":e>=70?"Confident - Similar work completed":e>=50?"Reasonable guess - Some unknowns":e>=30?"Uncertain - Many unknowns":"Total guess - Could be way off"}async function he(e,t=null){console.log("Rendering Work view",t?`with task ${t}`:""),e.innerHTML=`
    <div class="work-container">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-edit me-2"></i>
            Task Workspace
          </h5>
        </div>
        <div class="card-body">
          <div id="workTaskContent">
            <div class="text-center text-muted py-5">
              <i class="fas fa-clipboard-list fa-3x mb-3"></i>
              <h4>Select a task to start working</h4>
              <p>Choose a task from the Board or Today view to edit and track time.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  `,t&&await ue(t)}async function ue(e){const s=(await W({},!0)).find(o=>o.id===e);if(!s){console.error("Task not found with ID:",e),k("Task not found","error");return}await ro(s)}async function ro(e){var a,n,l,i,r,c,d,m,g,u,f,h,p,b;console.log("Rendering work interface for task:",e.title);const t=document.getElementById("workTaskContent");if(!t){console.error("workTaskContent element not found!");return}const s=await R(e.id),o=s.reduce((y,w)=>y+w.hours,0);t.innerHTML=`
    <div class="work-task-header mb-4">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h4 class="mb-1">${e.title}</h4>
          <div class="text-muted">
            <span class="badge bg-secondary me-2">${e.status}</span>
            <span class="badge bg-${e.urgency==="High"?"danger":e.urgency==="Med"?"warning":"success"} me-2">${e.urgency}</span>
            <span class="badge bg-info">${e.importance}</span>
          </div>
        </div>
        <div class="text-end">
          <div class="h5 mb-1">${o.toFixed(1)}h logged</div>
          <div class="text-muted">${e.estimate?`of ${e.estimate}h estimated`:"No estimate"}</div>
        </div>
      </div>
    </div>
    
    <div class="row g-4">
      \x3C!-- Task Details Form -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="fas fa-tasks me-2"></i>Task Details</h6>
            <div class="d-flex gap-2">
              <button type="button" class="btn btn-sm btn-primary" id="saveWorkEditTop">
                <i class="fas fa-save me-1"></i>Save
              </button>
              <button type="button" class="btn btn-sm btn-outline-secondary" id="cancelWorkEditTop">
                <i class="fas fa-times me-1"></i>Cancel
              </button>
            </div>
          </div>
          <div class="card-body">
            <form id="workTaskForm">
              <input type="hidden" id="workTaskId" value="${e.id}">
              
              <div class="mb-3">
                <label for="workTaskTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="workTaskTitle" value="${e.title}" required>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="workTaskDueDate" class="form-label">Due Date</label>
                  <input type="date" class="form-control" id="workTaskDueDate" value="${e.dueOn}">
                </div>
                <div class="col-md-4">
                  <label for="workTaskEstimate" class="form-label">Estimate (hours)</label>
                  <input type="number" class="form-control" id="workTaskEstimate" step="0.25" min="0" value="${e.estimate||""}">
                </div>
                <div class="col-md-4">
                  <label for="workTaskRemaining" class="form-label">Remaining (hours)</label>
                  <input type="number" class="form-control" id="workTaskRemaining" step="0.1" min="0" value="${e.remainingHours||0}">
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="workTaskStatus" class="form-label">Status</label>
                  <select class="form-select" id="workTaskStatus">
                    <option value="Draft" ${e.status==="Draft"?"selected":""}>Draft</option>
                    <option value="Ready" ${e.status==="Ready"?"selected":""}>Ready</option>
                    <option value="Estimated" ${e.status==="Estimated"?"selected":""}>Estimated</option>
                    <option value="OnDeck" ${e.status==="OnDeck"?"selected":""}>On Deck</option>
                    <option value="InProgress" ${e.status==="InProgress"?"selected":""}>In Progress</option>
                    <option value="Blocked" ${e.status==="Blocked"?"selected":""}>Blocked</option>
                    <option value="Backburner" ${e.status==="Backburner"?"selected":""}>Backburner</option>
                    <option value="OnHold" ${e.status==="OnHold"?"selected":""}>On Hold</option>
                    <option value="Completed" ${e.status==="Completed"?"selected":""}>Completed</option>
                    <option value="Abandoned" ${e.status==="Abandoned"?"selected":""}>Abandoned</option>
                    <option value="Archived" ${e.status==="Archived"?"selected":""}>Archived</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="workTaskUrgency" class="form-label">Urgency</label>
                  <select class="form-select" id="workTaskUrgency">
                    <option value="Low" ${e.urgency==="Low"?"selected":""}>Low</option>
                    <option value="Med" ${e.urgency==="Med"?"selected":""}>Medium</option>
                    <option value="High" ${e.urgency==="High"?"selected":""}>High</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="workTaskImportance" class="form-label">Importance</label>
                  <select class="form-select" id="workTaskImportance">
                    <option value="Low" ${e.importance==="Low"?"selected":""}>Low</option>
                    <option value="Med" ${e.importance==="Med"?"selected":""}>Medium</option>
                    <option value="High" ${e.importance==="High"?"selected":""}>High</option>
                  </select>
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="workTaskProject" class="form-label">Project</label>
                  <select class="form-select" id="workTaskProject">
                    <option value="">No Project (AdHoc)</option>
                    \x3C!-- Projects will be populated here -->
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="workTaskPhase" class="form-label">Phase</label>
                  <select class="form-select" id="workTaskPhase">
                    <option value="">No Phase</option>
                    \x3C!-- Phases will be populated here -->
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="workTaskDescription" class="form-label">Description</label>
                <textarea class="form-control" id="workTaskDescription" rows="4">${e.description||""}</textarea>
              </div>
              
              <div class="mb-3">
                <label for="workTaskNotes" class="form-label">Notes</label>
                <textarea class="form-control" id="workTaskNotes" rows="6" placeholder="Add detailed notes, progress updates, reminders...">${e.notes||""}</textarea>
                <div class="form-text">Use this space for detailed notes, progress updates, links, or any other information.</div>
              </div>
              
              \x3C!-- Personal Scale Estimation -->
              <div class="mb-3">
                <label class="form-label">
                  <i class="fas fa-chart-line me-2"></i>Personal Scale Estimation
                </label>
                <div class="estimation-panel p-3 border rounded bg-light">
                  \x3C!-- Scale Estimates -->
                  <div class="row g-3 mb-3">
                    <div class="col-md-4">
                      <label for="estimateLow" class="form-label small">Low Estimate</label>
                      <input type="range" class="form-range" id="estimateLow" min="1" max="10" step="1" value="${((n=(a=e.estimationData)==null?void 0:a.scale)==null?void 0:n.low)||3}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateLowValue">${((i=(l=e.estimationData)==null?void 0:l.scale)==null?void 0:i.low)||3}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label for="estimateExpected" class="form-label small">Expected Estimate</label>
                      <input type="range" class="form-range" id="estimateExpected" min="1" max="10" step="1" value="${((c=(r=e.estimationData)==null?void 0:r.scale)==null?void 0:c.expected)||5}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateExpectedValue">${((m=(d=e.estimationData)==null?void 0:d.scale)==null?void 0:m.expected)||5}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label for="estimateHigh" class="form-label small">High Estimate</label>
                      <input type="range" class="form-range" id="estimateHigh" min="1" max="10" step="1" value="${((u=(g=e.estimationData)==null?void 0:g.scale)==null?void 0:u.high)||7}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateHighValue">${((h=(f=e.estimationData)==null?void 0:f.scale)==null?void 0:h.high)||7}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                  </div>
                  
                  \x3C!-- Confidence Level -->
                  <div class="mb-3">
                    <label for="estimateConfidence" class="form-label small">Confidence Level</label>
                    <input type="range" class="form-range" id="estimateConfidence" min="0" max="100" step="1" value="${((p=e.estimationData)==null?void 0:p.confidence)||100}">
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted">0%</small>
                      <div class="text-center">
                        <span class="fw-bold" id="estimateConfidenceValue">${((b=e.estimationData)==null?void 0:b.confidence)||100}%</span>
                        <div class="small text-muted" id="confidenceHint">Very confident</div>
                      </div>
                      <small class="text-muted">100%</small>
                    </div>
                  </div>
                  
                  \x3C!-- Velocity Prediction -->
                  <div class="mt-3 p-2 bg-white rounded border">
                    <h6 class="small mb-2"><i class="fas fa-clock me-1"></i>Hour Prediction</h6>
                    <div id="velocityPrediction">
                      <div class="text-muted">Complete more tasks to enable predictions</div>
                    </div>
                  </div>
                </div>
              </div>
              
              \x3C!-- Category Lists Management -->
              <div class="mb-3">
                <label class="form-label">
                  <i class="fas fa-tags me-2"></i>Category Lists for Time Tracking
                </label>
                <div class="category-lists-panel p-3 border rounded bg-light">
                  <div id="workTaskCategoryLists">
                    \x3C!-- Category lists will be populated here -->
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle me-1"></i>
                      Select which category lists to use when logging time for this task
                    </small>
                  </div>
                </div>
              </div>
              
              <div class="d-flex gap-2 justify-content-between">
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Save Changes
                  </button>
                  <button type="button" class="btn btn-outline-secondary" id="cancelWorkEdit">
                    <i class="fas fa-times me-2"></i>Cancel
                  </button>
                </div>
                <button type="button" class="btn btn-outline-danger" id="deleteTaskBtn" data-task-id="${e.id}">
                  <i class="fas fa-trash me-2"></i>Delete
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      \x3C!-- Time Logging Panel -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Time Tracking</h6>
          </div>
          <div class="card-body">
            \x3C!-- Quick Time Buttons -->
            <div class="mb-3">
              <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.25">
                  <i class="fas fa-plus me-1"></i>15m
                </button>
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.5">
                  <i class="fas fa-plus me-1"></i>30m
                </button>
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="1">
                  <i class="fas fa-plus me-1"></i>1h
                </button>
              </div>
            </div>
            
            \x3C!-- Custom Time Entry -->
            <div class="mb-3">
              <h6>Custom Time Entry</h6>
              <div class="row g-2 mb-2">
                <div class="col">
                  <input type="number" class="form-control" id="customHours" step="0.25" min="0" max="24" placeholder="Hours">
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary" id="logCustomTimeBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              
              \x3C!-- Category Selector for Time Logging -->
              <div class="mb-2">
                <label class="form-label small text-muted">Category (optional)</label>
                <div id="workCategoryContainer">
                  <select class="form-select" disabled>
                    <option>Loading categories...</option>
                  </select>
                </div>
              </div>
              
              \x3C!-- Date Selection Toggle -->
              <div class="mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="customDateToggle">
                  <label class="form-check-label text-muted small" for="customDateToggle">
                    Different date?
                  </label>
                </div>
              </div>
              
              \x3C!-- Custom Date Picker -->
              <div id="customDateContainer" style="display: none;" class="mb-2">
                <input type="date" class="form-control form-control-sm" id="customDate" value="${O()}">
                <div class="form-text">Select the date when this time was actually worked</div>
              </div>
            </div>
            
            \x3C!-- Time Logs -->
            <div class="mt-3">
              <h6>Recent Time Logs</h6>
              <div id="workTimeLogs" class="time-logs-list">
                \x3C!-- Time logs will be populated here -->
              </div>
            </div>
          </div>
        </div>
        
        \x3C!-- Status History Panel -->
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-history me-2"></i>Status History</h6>
          </div>
          <div class="card-body">
            <div id="workStatusHistory" class="status-history-container" style="max-height: 400px; overflow-y: auto;">
              ${co(e.statusHistory||[])}
            </div>
          </div>
        </div>
      </div>
    </div>
  `,await uo(s,e),await mo(e),await go(e.projectId),await Pt(e.phaseKey,e.projectId),fo(e)}function co(e){return!e||e.length===0?'<p class="text-muted">No status history available</p>':e.map(t=>{const s=new Date(t.timestamp);return`
      <div class="status-history-entry mb-2 p-2 border-bottom">
        <div class="d-flex justify-content-between">
          <span class="badge bg-secondary">${t.status}</span>
          <small class="text-muted">${s.toLocaleDateString()} ${s.toLocaleTimeString()}</small>
        </div>
        ${t.note?`<div class="small text-muted mt-1">${t.note}</div>`:""}
      </div>
    `}).reverse().join("")}async function uo(e,t){const s=document.getElementById("workTimeLogs");if(!s)return;if(e.length===0){s.innerHTML='<p class="text-muted small">No time logs yet</p>';return}const o=t.categoryLists||[];let a=[];if(o.length>0){const{getCategoryLists:i}=await yt(async()=>{const{getCategoryLists:d}=await Promise.resolve().then(()=>ht);return{getCategoryLists:d}},void 0,import.meta.url),c=(await i()).filter(d=>o.includes(d.slug));for(const d of c)d.categories&&d.categories.length>0&&d.categories.forEach(m=>{a.push({key:m.slug,title:m.title})})}const n=a.length>0,l=e.slice(-5).reverse();s.innerHTML=l.map(i=>`
    <div class="time-log-entry mb-2 p-2 border rounded" data-log-id="${i.id}">
      <div class="time-log-view">
        <div class="d-flex justify-content-between align-items-center">
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between">
              <strong>${i.hours.toFixed(2)}h</strong>
              <small class="text-muted">${ct(i.dateLogged,"short")}</small>
            </div>
            ${i.categoryKey?`<div class="small text-muted">${i.categoryKey}</div>`:""}
            ${i.notes?`<div class="small">${i.notes}</div>`:""}
          </div>
          <div class="d-flex gap-1 ms-2">
            ${n?`
              <button class="btn btn-sm btn-outline-primary edit-log-btn" data-log-id="${i.id}" title="Edit category">
                <i class="fas fa-edit"></i>
              </button>
            `:""}
            <button class="btn btn-sm btn-outline-danger delete-log-btn" data-log-id="${i.id}" title="Delete time entry">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
      
      ${n?`
        <div class="time-log-edit mt-2" style="display: none;">
          <div class="mb-2">
            <label class="form-label small">Category</label>
            <select class="form-select form-select-sm category-edit-select">
              <option value="">No Category</option>
              ${a.map(r=>`
                <option value="${r.key}" ${i.categoryKey===r.key?"selected":""}>${r.title}</option>
              `).join("")}
            </select>
          </div>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-success save-edit-btn" data-log-id="${i.id}">
              <i class="fas fa-check me-1"></i>Save
            </button>
            <button class="btn btn-sm btn-secondary cancel-edit-btn">
              <i class="fas fa-times me-1"></i>Cancel
            </button>
          </div>
        </div>
      `:""}
      
      <div class="delete-confirm mt-2" style="display: none;">
        <div class="alert alert-warning mb-2 py-2 small">
          <i class="fas fa-exclamation-triangle me-1"></i>
          Remove this time entry? This cannot be undone.
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-danger confirm-delete-btn" data-log-id="${i.id}">
            <i class="fas fa-check me-1"></i>Yes, Remove
          </button>
          <button class="btn btn-sm btn-secondary cancel-delete-btn">
            <i class="fas fa-times me-1"></i>Cancel
          </button>
        </div>
      </div>
    </div>
  `).join(""),s.querySelectorAll(".delete-log-btn").forEach(i=>{i.addEventListener("click",r=>{r.stopPropagation();const d=i.closest(".time-log-entry").querySelector(".delete-confirm");d.style.display="block",i.style.display="none"})}),s.querySelectorAll(".confirm-delete-btn").forEach(i=>{i.addEventListener("click",async r=>{r.stopPropagation();const c=parseInt(i.dataset.logId);await yo(c)})}),s.querySelectorAll(".cancel-delete-btn").forEach(i=>{i.addEventListener("click",r=>{r.stopPropagation();const c=i.closest(".time-log-entry"),d=c.querySelector(".delete-confirm"),m=c.querySelector(".delete-log-btn");d.style.display="none",m.style.display="block"})}),s.querySelectorAll(".edit-log-btn").forEach(i=>{i.addEventListener("click",r=>{r.stopPropagation();const c=i.closest(".time-log-entry"),d=c.querySelector(".time-log-view"),m=c.querySelector(".time-log-edit");d.style.display="none",m.style.display="block"})}),s.querySelectorAll(".save-edit-btn").forEach(i=>{i.addEventListener("click",async r=>{r.stopPropagation();const c=parseInt(i.dataset.logId),g=i.closest(".time-log-entry").querySelector(".category-edit-select").value;await po(c,g,t)})}),s.querySelectorAll(".cancel-edit-btn").forEach(i=>{i.addEventListener("click",r=>{r.stopPropagation();const c=i.closest(".time-log-entry"),d=c.querySelector(".time-log-view"),m=c.querySelector(".time-log-edit");d.style.display="block",m.style.display="none"})})}async function mo(e){const t=document.getElementById("workTaskCategoryLists");if(!t)return;const s=await Se();if(s.length===0){t.innerHTML=`
      <div class="text-muted">
        <i class="fas fa-plus-circle me-2"></i>
        No category lists available. Create one in Settings to enable time categorization.
      </div>
    `;return}const o=e.categoryLists||[];let a='<div class="row g-2">';s.forEach(n=>{const l=o.includes(n.slug);a+=`
      <div class="col-md-6">
        <div class="form-check">
          <input class="form-check-input category-list-checkbox" 
                 type="checkbox" 
                 id="categoryList_${n.slug}" 
                 value="${n.slug}"
                 ${l?"checked":""}>
          <label class="form-check-label" for="categoryList_${n.slug}">
            <strong>${n.title}</strong>
            <div class="small text-muted">${n.categories.length} categories</div>
          </label>
        </div>
      </div>
    `}),a+="</div>",t.innerHTML=a}async function go(e){const t=document.getElementById("workTaskProject");if(!t)return;const s=await le();let o='<option value="">No Project (AdHoc)</option>';s.forEach(a=>{o+=`<option value="${a.id}" ${a.id===e?"selected":""}>${a.name}</option>`}),t.innerHTML=o}async function Pt(e,t){const s=document.getElementById("workTaskPhase");if(!s)return;const o=await re();let a='<option value="">No Phase</option>';o.forEach(n=>{n.phases.forEach(l=>{const i=`${n.slug}.${l.slug}`;a+=`<option value="${i}" ${i===e?"selected":""}>${n.title}: ${l.title}</option>`})}),s.innerHTML=a}function fo(e){const t=document.getElementById("workTaskForm");t&&t.addEventListener("submit",async u=>{u.preventDefault(),await Ze(e)});const s=document.getElementById("cancelWorkEdit");s&&s.addEventListener("click",()=>{he(document.getElementById("workTaskContent").parentElement.parentElement.parentElement)});const o=document.getElementById("cancelWorkEditTop");o&&o.addEventListener("click",()=>{he(document.getElementById("workTaskContent").parentElement.parentElement.parentElement)});const a=document.getElementById("saveWorkEditTop");a&&a.addEventListener("click",async u=>{u.preventDefault(),await Ze(e)});const n=document.getElementById("deleteTaskBtn");n&&n.addEventListener("click",async()=>{confirm("Are you sure you want to delete this task?")&&(await os(e.id),k("Task deleted successfully","success"),he(document.getElementById("workTaskContent").parentElement.parentElement.parentElement))});const l=document.getElementById("workTaskProject");l&&l.addEventListener("change",async function(){await Pt(null,this.value)});const i=document.getElementById("customDateToggle"),r=document.getElementById("customDateContainer");i&&r&&i.addEventListener("change",()=>{r.style.display=i.checked?"block":"none"}),vo(),ho(e);const c=document.querySelector(".col-lg-4 .card");if(c){if(c.dataset.quickTimeInitialized==="true")return;c.dataset.quickTimeInitialized="true";const u=async f=>{const h=f.target.closest(".quick-time-btn");if(h){const p=parseFloat(h.dataset.hours);await Re(e.id,p)}};c.addEventListener("click",u)}const d=document.getElementById("logCustomTimeBtn");d&&d.addEventListener("click",async()=>{const u=parseFloat(document.getElementById("customHours").value);u>0&&(await Re(e.id,u),document.getElementById("customHours").value="")});const m=document.getElementById("workTaskEstimate"),g=document.getElementById("workTaskRemaining");m&&g&&(m.addEventListener("input",()=>{const u=parseFloat(m.value)||0,f=parseFloat(g.value)||0;(f===0||g.value===""||f===parseFloat(m.getAttribute("data-previous-value")||0))&&(g.value=u),m.setAttribute("data-previous-value",u)}),m.setAttribute("data-previous-value",m.value||0))}async function Ze(e){parseInt(document.getElementById("workTaskId").value);const t=Array.from(document.querySelectorAll(".category-list-checkbox:checked")).map(a=>a.value),s={...e,title:document.getElementById("workTaskTitle").value,dueOn:document.getElementById("workTaskDueDate").value,estimate:parseFloat(document.getElementById("workTaskEstimate").value)||null,remainingHours:parseFloat(document.getElementById("workTaskRemaining").value)||0,status:document.getElementById("workTaskStatus").value,urgency:document.getElementById("workTaskUrgency").value,importance:document.getElementById("workTaskImportance").value,projectId:document.getElementById("workTaskProject").value?parseInt(document.getElementById("workTaskProject").value):null,phaseKey:document.getElementById("workTaskPhase").value||null,description:document.getElementById("workTaskDescription").value,notes:document.getElementById("workTaskNotes").value,categoryLists:t,estimationData:{scale:{low:parseInt(document.getElementById("estimateLow").value),expected:parseInt(document.getElementById("estimateExpected").value),high:parseInt(document.getElementById("estimateHigh").value)},confidence:parseInt(document.getElementById("estimateConfidence").value),estimatedAt:new Date().toISOString()}};if(await Ve(s,!0)){k("Task updated successfully!","success");const a=document.getElementById("boardTab");a&&a.click()}}async function ho(e){const t=document.getElementById("workCategoryContainer");if(!t)return;const s=e.categoryLists||[];if(s.length===0){t.innerHTML=`
      <select class="form-select" disabled>
        <option>No categories available</option>
      </select>
      <small class="form-text text-muted">Add category lists to this task to enable categorization</small>
    `;return}const{getCategoryLists:o}=await yt(async()=>{const{getCategoryLists:c}=await Promise.resolve().then(()=>ht);return{getCategoryLists:c}},void 0,import.meta.url),n=(await o()).filter(c=>s.includes(c.slug)),l=[];for(const c of n)c.categories&&c.categories.length>0&&c.categories.forEach(d=>{l.push({key:d.slug,listTitle:c.title,categoryTitle:d.title})});if(l.length===0){t.innerHTML=`
      <select class="form-select" disabled>
        <option>No categories available</option>
      </select>
      <small class="form-text text-muted">Add categories to the assigned category lists</small>
    `;return}const i=l.reduce((c,d)=>(c[d.listTitle]||(c[d.listTitle]=[]),c[d.listTitle].push(d),c),{});let r='<option value="">Select category (optional)</option>';Object.keys(i).forEach(c=>{r+=`<optgroup label="${c}">`,i[c].forEach(d=>{r+=`<option value="${d.key}">${d.categoryTitle}</option>`}),r+="</optgroup>"}),t.innerHTML=`
    <select class="form-select category-selector" id="workCategorySelect">
      ${r}
    </select>
  `}let De=!1;async function Re(e,t,s){if(De){console.log("Already logging time, ignoring duplicate click");return}De=!0;try{const o=document.getElementById("customDateToggle"),a=document.getElementById("customDate"),n=document.getElementById("workCategorySelect"),l=o!=null&&o.checked&&a?a.value:O(),i={taskId:e,hours:t,dateLogged:l,categoryKey:(n==null?void 0:n.value)||null,notes:`Quick log: ${t}h`};if(!await Ee(i))return;const d=(await W({},!0)).find(g=>g.id===e);let m=`${t}h logged`;if(d&&d.remainingHours!==null&&d.remainingHours!==void 0){const g=qe(Math.max(0,d.remainingHours-t));console.log(`Decrementing remaining hours: ${d.remainingHours}h -> ${g}h (logged ${t}h)`),await Ye(e,g,`Auto-decremented by ${t}h time log`)&&(m+=" and remaining hours updated!")}k(m,"success"),n&&(n.value=""),I.emit("task:timeLogged",{taskId:e,hours:t,dateLogged:l}),await ue(e),s&&typeof s=="function"&&await s()}finally{De=!1}}async function po(e,t,s){console.log("Updating time log category:",e,t);const a=(await R(s.id)).find(l=>l.id===e);if(!a){k("Time log not found","error");return}if(a.categoryKey=t||null,!await Ee(a)){k("Failed to update category","error");return}k("Category updated","success"),await ue(s.id)}async function yo(e){console.log("Deleting time log:",e);const s=(await R()).find(r=>r.id===e);if(!s){k("Time log not found","error");return}const o=s.taskId,a=s.hours;if(!await es(e))return;const i=(await W({},!0)).find(r=>r.id===o);if(i&&i.remainingHours!==null&&i.remainingHours!==void 0){const r=qe(i.remainingHours+a);await Ye(o,r,`Restored ${a}h from deleted time log`)}k("Time entry removed","success"),await ue(o)}async function vo(){const e=document.getElementById("estimateLow"),t=document.getElementById("estimateExpected"),s=document.getElementById("estimateHigh"),o=document.getElementById("estimateConfidence");if(!e||!t||!s||!o)return;function a(){const n=parseInt(e.value),l=parseInt(t.value),i=parseInt(s.value),r=parseInt(o.value);document.getElementById("estimateLowValue").textContent=n,document.getElementById("estimateExpectedValue").textContent=l,document.getElementById("estimateHighValue").textContent=i,document.getElementById("estimateConfidenceValue").textContent=`${r}%`;const c=document.getElementById("confidenceHint");c&&(c.textContent=lo(r)),n>l&&(e.value=l,document.getElementById("estimateLowValue").textContent=l),l<n&&(t.value=n,document.getElementById("estimateExpectedValue").textContent=n),l>i&&(t.value=i,document.getElementById("estimateExpectedValue").textContent=i),i<l&&(s.value=l,document.getElementById("estimateHighValue").textContent=l),bo()}e.addEventListener("input",a),t.addEventListener("input",a),s.addEventListener("input",a),o.addEventListener("input",a),a()}async function bo(){const e=document.getElementById("velocityPrediction");if(!e)return;const t=document.getElementById("estimateLow"),s=document.getElementById("estimateExpected"),o=document.getElementById("estimateHigh"),a=document.getElementById("estimateConfidence");if(!t||!s||!o||!a)return;const n={scale:{low:parseInt(t.value),expected:parseInt(s.value),high:parseInt(o.value)},confidence:parseInt(a.value)},l=await io(n);if(!l.canPredict){e.innerHTML=`
      <div class="text-muted">
        <i class="fas fa-info-circle me-1"></i>
        ${l.message}
      </div>
    `;return}e.innerHTML=`
    <div class="row g-3 text-center">
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">Low</div>
        <div class="fw-bold text-success fs-6">${l.low.toFixed(1)}h</div>
      </div>
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">Expected</div>
        <div class="fw-bold text-primary fs-6">${l.expected.toFixed(1)}h</div>
      </div>
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">High</div>
        <div class="fw-bold text-warning fs-6">${l.high.toFixed(1)}h</div>
      </div>
    </div>
    <div class="text-center mt-3">
      <div class="text-muted" style="font-size: 0.8rem;">
        Based on ${l.sampleSize} completed task${l.sampleSize===1?"":"s"}<br>
        Personal velocity: ${l.velocity.toFixed(2)}h per scale point
      </div>
    </div>
  `}let H=null;async function ko(e){console.log("Rendering Reports view"),e.innerHTML=`
    <div class="reports-container">
      <div class="row g-4">
        \x3C!-- Report Controls -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-cog me-2"></i>
                Report Settings
              </h5>
            </div>
            <div class="card-body">
              \x3C!-- Time Period Selection -->
              <div class="mb-3">
                <label class="form-label">Time Period</label>
                <select class="form-select" id="reportPeriod">
                  <option value="thisWeek">This Week</option>
                  <option value="lastWeek">Last Week</option>
                  <option value="thisMonth">This Month</option>
                  <option value="lastMonth">Last Month</option>
                  <option value="custom">Custom Range</option>
                </select>
              </div>
              
              \x3C!-- Custom Date Range -->
              <div id="customDateRange" style="display: none;">
                <div class="row g-2 mb-3">
                  <div class="col">
                    <label class="form-label small">From</label>
                    <input type="date" class="form-control" id="reportStartDate">
                  </div>
                  <div class="col">
                    <label class="form-label small">To</label>
                    <input type="date" class="form-control" id="reportEndDate">
                  </div>
                </div>
              </div>
              
              \x3C!-- Report Type Selection -->
              <div class="mb-3">
                <label class="form-label">Report Sections</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeExecutiveSummary" checked>
                  <label class="form-check-label" for="includeExecutiveSummary">
                    Executive Summary
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeTimesheet" checked>
                  <label class="form-check-label" for="includeTimesheet">
                    Time Summary
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeTaskProgress" checked>
                  <label class="form-check-label" for="includeTaskProgress">
                    Task Progress
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeAccomplishments" checked>
                  <label class="form-check-label" for="includeAccomplishments">
                    Accomplishments
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeCategoryAnalytics" checked>
                  <label class="form-check-label" for="includeCategoryAnalytics">
                    Category Analytics
                  </label>
                </div>
              </div>
              
              \x3C!-- Generate Button -->
              <button class="btn btn-primary w-100 mb-2" id="generateReportBtn">
                <i class="fas fa-chart-line me-2"></i>
                Generate Report
              </button>
              
              \x3C!-- Export Button -->
              <button class="btn btn-outline-success w-100" id="exportReportBtn" disabled>
                <i class="fas fa-download me-2"></i>
                Export as Markdown
              </button>
            </div>
          </div>
        </div>
        
        \x3C!-- Report Preview -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-file-alt me-2"></i>
                Report Preview
              </h5>
            </div>
            <div class="card-body">
              <div id="reportPreview" class="report-preview">
                <div class="text-center text-muted py-5">
                  <i class="fas fa-chart-bar fa-3x mb-3"></i>
                  <h4>Ready to Generate Report</h4>
                  <p>Select your preferences and click "Generate Report" to create your custom report.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `,wo()}function wo(){const e=document.getElementById("reportPeriod");e&&e.addEventListener("change",To);const t=document.getElementById("generateReportBtn");t&&t.addEventListener("click",Io);const s=document.getElementById("exportReportBtn");s&&s.addEventListener("click",Bo)}function To(){const e=document.getElementById("reportPeriod").value,t=document.getElementById("customDateRange"),s=document.getElementById("reportStartDate"),o=document.getElementById("reportEndDate");e==="custom"?(t.style.display="block",s.value||(s.value=O()),o.value||(o.value=O())):t.style.display="none"}async function Io(){const e=document.getElementById("reportPeriod").value,t=document.getElementById("includeExecutiveSummary").checked,s=document.getElementById("includeTimesheet").checked,o=document.getElementById("includeTaskProgress").checked,a=document.getElementById("includeAccomplishments").checked,n=document.getElementById("includeCategoryAnalytics").checked;let l,i,r;const c=new Date;switch(e){case"thisWeek":const d=new Date(c);d.setDate(c.getDate()-c.getDay());const m=new Date(d);m.setDate(d.getDate()+6),l=d.toISOString().split("T")[0],i=m.toISOString().split("T")[0],r="This Week";break;case"lastWeek":const g=new Date(c);g.setDate(c.getDate()-c.getDay()-7);const u=new Date(g);u.setDate(g.getDate()+6),l=g.toISOString().split("T")[0],i=u.toISOString().split("T")[0],r="Last Week";break;case"thisMonth":const f=new Date(c.getFullYear(),c.getMonth(),1),h=new Date(c.getFullYear(),c.getMonth()+1,0);l=f.toISOString().split("T")[0],i=h.toISOString().split("T")[0],r="This Month";break;case"lastMonth":const p=new Date(c.getFullYear(),c.getMonth()-1,1),b=new Date(c.getFullYear(),c.getMonth(),0);l=p.toISOString().split("T")[0],i=b.toISOString().split("T")[0],r="Last Month";break;case"custom":l=document.getElementById("reportStartDate").value,i=document.getElementById("reportEndDate").value,r=`${new Date(l).toLocaleDateString()} - ${new Date(i).toLocaleDateString()}`;break}try{const d=await So(l,i,r,{includeExecutiveSummary:t,includeTimesheet:s,includeTaskProgress:o,includeAccomplishments:a,includeCategoryAnalytics:n});H=d;const m=document.getElementById("reportPreview");m.innerHTML=await Eo(d),document.getElementById("exportReportBtn").disabled=!1}catch(d){console.error("Error generating report:",d),alert("Error generating report: "+d.message)}}async function So(e,t,s,o){const a=await W({},!0),n=await Ue(),l=await _e(!0),i=await Ge(),r=n.filter(y=>y.dateLogged>=e&&y.dateLogged<=t),c=l.filter(y=>{var T;const w=((T=y.createdAt)==null?void 0:T.split("T")[0])||y.date;return w>=e&&w<=t}),d=i.filter(y=>{var T;const w=((T=y.createdAt)==null?void 0:T.split("T")[0])||y.date;return w>=e&&w<=t}),m={};let g=0;for(const y of r){if(!m[y.taskId]){const w=a.find(T=>T.id===y.taskId);m[y.taskId]={task:w,hours:0,logs:[]}}m[y.taskId].hours+=y.hours,m[y.taskId].logs.push(y),g+=y.hours}const u=[],f=[];for(const y of a)if(y.statusHistory){const w=y.statusHistory.find(E=>E.status==="Completed");if(w){const E=w.timestamp.split("T")[0];E>=e&&E<=t&&u.push({...y,completedAt:w.timestamp})}const T=y.statusHistory.find(E=>E.status==="Abandoned");if(T){const E=T.timestamp.split("T")[0];E>=e&&E<=t&&f.push({...y,abandonedAt:T.timestamp})}}const h={created:0,estimated:0,started:0,blocked:0,completed:0,abandoned:0};for(const y of a)if(y.statusHistory)for(const w of y.statusHistory){const T=w.timestamp.split("T")[0];if(T>=e&&T<=t)switch(w.status){case"Ready":w.note&&w.note.includes("created")&&h.created++;break;case"Estimated":h.estimated++;break;case"InProgress":h.started++;break;case"Blocked":h.blocked++;break;case"Completed":h.completed++;break;case"Abandoned":h.abandoned++;break}}const p=ft(r),b=a.filter(y=>["InProgress","Blocked","Backburner","OnHold"].includes(y.status)&&r.some(w=>w.taskId===y.id));return{period:s,startDate:e,endDate:t,options:o,summary:{totalHours:g,completedTasks:u.length,abandonedTasks:f.length,activeTasks:b.length,accomplishments:d.length,todos:c.length},statusTransitions:h,timeByTask:m,tasksCompletedInPeriod:u,tasksAbandonedInPeriod:f,activeTasks:b,accomplishments:d,todos:c,categoryAnalytics:p}}async function Eo(e){var s,o;let t=`
    <div class="report-content">
      <h2>Report for ${e.period}</h2>
      <p class="text-muted">Generated on ${new Date().toLocaleDateString()}</p>
  `;if(e.options.includeExecutiveSummary&&(t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-star me-2"></i>Executive Summary</h3>
        <div class="row g-3 mb-3">
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-primary mb-1">${e.summary.totalHours.toFixed(1)}h</div>
              <div class="text-muted">Total Hours</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-success mb-1">${e.summary.completedTasks}</div>
              <div class="text-muted">Completed</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-danger mb-1">${e.summary.abandonedTasks}</div>
              <div class="text-muted">Abandoned</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-warning mb-1">${e.summary.activeTasks}</div>
              <div class="text-muted">Active Tasks</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${e.statusTransitions.started}</div>
              <div class="text-muted">Tasks Started</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${e.summary.accomplishments}</div>
              <div class="text-muted">Accomplishments</div>
            </div>
          </div>
        </div>
        
        \x3C!-- Status Transitions -->
        <div class="row g-3 mb-3">
          <div class="col-12">
            <h5><i class="fas fa-chart-line me-2"></i>Status Transitions in Period</h5>
            <div class="row g-2">
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-primary">${e.statusTransitions.created}</div>
                  <small class="text-muted">Created</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-info">${e.statusTransitions.estimated}</div>
                  <small class="text-muted">Estimated</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-primary">${e.statusTransitions.started}</div>
                  <small class="text-muted">Started</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-danger">${e.statusTransitions.blocked}</div>
                  <small class="text-muted">Blocked</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-success">${e.statusTransitions.completed}</div>
                  <small class="text-muted">Completed</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-dark">${e.statusTransitions.abandoned}</div>
                  <small class="text-muted">Abandoned</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `),e.options.includeTimesheet){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-clock me-2"></i>Time Summary</h3>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead class="table-dark">
              <tr>
                <th>Task</th>
                <th>Status</th>
                <th>Hours</th>
                <th>Sessions</th>
              </tr>
            </thead>
            <tbody>
    `;const a=Object.values(e.timeByTask).sort((n,l)=>l.hours-n.hours);for(const n of a)t+=`
              <tr>
                <td>${((s=n.task)==null?void 0:s.title)||"Unknown Task"}</td>
                <td><span class="badge bg-secondary">${((o=n.task)==null?void 0:o.status)||"N/A"}</span></td>
                <td><strong>${n.hours.toFixed(1)}h</strong></td>
                <td>${n.logs.length}</td>
              </tr>
      `;t+=`
            </tbody>
          </table>
        </div>
      </div>
    `}if(e.options.includeTaskProgress&&e.tasksCompletedInPeriod.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-check-circle me-2"></i>Completed Tasks</h3>
        <ul class="list-group mb-3">
    `;for(const a of e.tasksCompletedInPeriod){const n=new Date(a.completedAt);t+=`
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <span class="fw-bold">${a.title}</span>
              <small class="text-muted d-block">Completed: ${n.toLocaleDateString()}</small>
            </div>
            <span class="badge bg-success">Completed</span>
          </li>
      `}t+=`
        </ul>
      </div>
    `}if(e.options.includeAccomplishments&&e.accomplishments.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-trophy me-2"></i>Accomplishments</h3>
        <ul class="list-group">
    `;for(const a of e.accomplishments)t+=`
          <li class="list-group-item">
            <strong>${a.title}</strong>
            ${a.content?`<div class="small text-muted">${a.content}</div>`:""}
          </li>
      `;t+=`
        </ul>
      </div>
    `}if(e.options.includeCategoryAnalytics&&e.categoryAnalytics.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-tags me-2"></i>Category Analytics</h3>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead class="table-dark">
              <tr>
                <th>Category</th>
                <th>Hours</th>
                <th>% of Total</th>
              </tr>
            </thead>
            <tbody>
    `;for(const a of e.categoryAnalytics)t+=`
              <tr>
                <td>${a.name}</td>
                <td><strong>${a.hours.toFixed(1)}h</strong></td>
                <td>${a.percentage.toFixed(1)}%</td>
              </tr>
      `;t+=`
            </tbody>
          </table>
        </div>
      </div>
    `}return t+=await Lo(),t+="</div>",t}async function Lo(){const e=await $t();if(!e)return`
      <div class="report-section mb-4">
        <h3><i class="fas fa-tachometer-alt me-2"></i>Personal Velocity Analysis</h3>
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          Complete tasks with estimation data to see velocity metrics. 
          Add scale estimates (Low/Expected/High) when editing tasks in the Work view.
        </div>
      </div>
    `;const s=(await W({},!0)).filter(n=>{var l,i;return n.status==="Completed"&&((i=(l=n.estimationData)==null?void 0:l.scale)==null?void 0:i.expected)});let o={totalTasks:0,withinRange:0,underestimated:0,overestimated:0,avgConfidence:0};if(s.length>0){let n=0;for(const l of s){const c=(await Ue()).filter(d=>d.taskId===l.id).reduce((d,m)=>d+m.hours,0);if(c>0){o.totalTasks++;const d=l.estimationData.scale.low*e.velocity,m=l.estimationData.scale.high*e.velocity;c>=d&&c<=m?o.withinRange++:c>m?o.underestimated++:o.overestimated++,n+=l.estimationData.confidence||100}}o.avgConfidence=n/o.totalTasks}const a=o.totalTasks>0?(o.withinRange/o.totalTasks*100).toFixed(1):0;return`
    <div class="report-section mb-4">
      <h3><i class="fas fa-tachometer-alt me-2"></i>Personal Velocity Analysis</h3>
      
      \x3C!-- Velocity Metrics -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-primary mb-1">${e.velocity.toFixed(2)}h</div>
            <div class="text-muted">Hours per Point</div>
            <small class="text-muted">Current Velocity</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-success mb-1">${e.sampleSize}</div>
            <div class="text-muted">Completed Tasks</div>
            <small class="text-muted">With Estimates</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-info mb-1">${e.totalHours.toFixed(1)}h</div>
            <div class="text-muted">Total Hours</div>
            <small class="text-muted">Actual Time Logged</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-warning mb-1">${e.totalPoints}</div>
            <div class="text-muted">Scale Points</div>
            <small class="text-muted">Expected Estimates</small>
          </div>
        </div>
      </div>
      
      \x3C!-- Estimation Accuracy -->
      ${o.totalTasks>0?`
      <div class="mb-4">
        <h5><i class="fas fa-bullseye me-2"></i>Estimation Accuracy</h5>
        <div class="row g-3">
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-success mb-1">${a}%</div>
              <div class="text-muted">Within Range</div>
              <small class="text-muted">${o.withinRange} of ${o.totalTasks} tasks</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-warning mb-1">${o.underestimated}</div>
              <div class="text-muted">Underestimated</div>
              <small class="text-muted">Took longer than High</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${o.overestimated}</div>
              <div class="text-muted">Overestimated</div>
              <small class="text-muted">Took less than Low</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-primary mb-1">${o.avgConfidence.toFixed(0)}%</div>
              <div class="text-muted">Avg Confidence</div>
              <small class="text-muted">Your certainty level</small>
            </div>
          </div>
        </div>
      </div>
      `:""}
      
      \x3C!-- Interpretation Guide -->
      <div class="alert alert-light border">
        <h6><i class="fas fa-lightbulb me-2"></i>Understanding Your Velocity</h6>
        <ul class="mb-0">
          <li><strong>Velocity ${e.velocity.toFixed(2)}h/point</strong> means each scale point represents about ${e.velocity.toFixed(1)} hours of work for you</li>
          ${o.totalTasks>0?`
          <li><strong>${a}% accuracy</strong> means your estimates are ${a>=80?"excellent":a>=60?"good":"improving"} - actual hours fall within your Low-High range</li>
          <li><strong>Underestimated tasks</strong> suggest adding buffer or adjusting your scale interpretation for complex work</li>
          <li><strong>Overestimated tasks</strong> indicate you might be too conservative - trust your skills more</li>
          `:"<li>Complete more tasks to see accuracy metrics</li>"}
        </ul>
      </div>
    </div>
  `}function Bo(){var a,n;if(!H){alert("Please generate a report first");return}let e=`# Report for ${H.period}

`;if(e+=`Generated on ${new Date().toLocaleDateString()}

`,H.options.includeExecutiveSummary&&(e+=`## Executive Summary

`,e+=`- **Total Hours**: ${H.summary.totalHours.toFixed(1)}h
`,e+=`- **Completed Tasks**: ${H.summary.completedTasks}
`,e+=`- **Abandoned Tasks**: ${H.summary.abandonedTasks}
`,e+=`- **Active Tasks**: ${H.summary.activeTasks}
`,e+=`- **Accomplishments**: ${H.summary.accomplishments}

`),H.options.includeTimesheet){e+=`## Time Summary

`,e+=`| Task | Status | Hours | Sessions |
`,e+=`|------|--------|-------|----------|
`;const l=Object.values(H.timeByTask).sort((i,r)=>r.hours-i.hours);for(const i of l)e+=`| ${((a=i.task)==null?void 0:a.title)||"Unknown"} | ${((n=i.task)==null?void 0:n.status)||"N/A"} | ${i.hours.toFixed(1)}h | ${i.logs.length} |
`;e+=`
`}if(H.options.includeTaskProgress&&H.tasksCompletedInPeriod.length>0){e+=`## Completed Tasks

`;for(const l of H.tasksCompletedInPeriod){const i=new Date(l.completedAt);e+=`- **${l.title}** - Completed: ${i.toLocaleDateString()}
`}e+=`
`}if(H.options.includeAccomplishments&&H.accomplishments.length>0){e+=`## Accomplishments

`;for(const l of H.accomplishments)e+=`- **${l.title}**
`,l.content&&(e+=`  ${l.content}
`);e+=`
`}const t=new Blob([e],{type:"text/markdown"}),s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=`report-${H.startDate}-to-${H.endDate}.md`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}let $,v,x,et=!1,tt=0;const $o=5e3;async function Po(){if(console.log("🚀 Initializing Mission Control Spaceport..."),!document.getElementById("spaceportView")){console.error("SpacePort container not found");return}if($=document.getElementById("spaceportCanvas"),!$){console.error("SpacePort canvas not found");return}if(et){console.log("🛸 Spaceport already initialized, restarting animation..."),ot();return}v=$.getContext("2d"),st(),window.addEventListener("resize",st),Mo(),Co(),ot(),et=!0,console.log("🛸 Spaceport Mission Control Online!")}function st(){const e=document.getElementById("spaceportView");$.width=e.clientWidth,$.height=e.clientHeight-40,x=$.height*.75,Do()}function Do(){const e=C();if(!(!e.rockets||e.rockets.size===0))for(const[t,s]of e.rockets){s.launchPad.y=x;const o=j(s.type||"scout");s.y=x-o/2-40}}function Co(){const e=C();if(e.isOperational&&e.rockets&&e.rockets.size>0){const t=Date.now();for(const[s,o]of e.rockets)if(o.isActive&&o.startTime){const a=t-o.startTime;o.totalTime+=a,o.startTime=t,console.log(`⏰ Restored rocket "${o.taskTitle}" - accrued ${(a/1e3/60).toFixed(2)} minutes while browser was closed. Total: ${(o.totalTime/1e3/60).toFixed(2)} minutes`)}Y()}if(e.isOperational){const t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus");t&&(t.textContent="End Operations",t.className="punch-btn punch-out"),s&&(s.textContent="Mission Control Operational",s.className="punch-status-display operational");const o=document.querySelector(".mission-control");o&&(o.style.display="block"),Dt();const a=document.getElementById("rocketsCount");if(a&&(a.textContent=e.rockets.size),e.activeRocket){const n=e.rockets.get(e.activeRocket);if(n){const l=document.getElementById("activeMissionName"),i=document.getElementById("activeRocketDisplay"),r=document.getElementById("energyStatus"),c=document.getElementById("launchControls");l&&(l.textContent=n.taskTitle),i&&(i.textContent=n.taskTitle.substring(0,20)),r&&(r.textContent="Charging"),c&&(c.className="launch-controls active"),console.log(`⚡ Restored active rocket: ${n.taskTitle}`)}}console.log(`🚀 Restored SpacePort session with ${e.rockets.size} rocket(s)`)}}function Mo(){const e=document.getElementById("spaceportPunchBtn");e?e.addEventListener("click",Ao):console.warn("SpacePort punch button not found"),$&&$.addEventListener("click",qo);const t=document.getElementById("launchBtn");t?t.addEventListener("click",Yo):console.warn("SpacePort launch button not found"),xo()}async function Ao(){const e=C(),t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus"),o=document.querySelector(".mission-control");e.isOperational?await Ho():(e.isOperational=!0,e.sessionStartTime=Date.now(),Y(),t.textContent="End Operations",t.className="punch-btn punch-out",s.textContent="Mission Control Operational",s.className="punch-status-display operational",o&&(o.style.display="block"),await Dt(),console.log("🚀 Spaceport Operations Initiated!"))}async function Ho(){console.log("🛸 Ending Spaceport Operations...");const e=C();for(const[a,n]of e.rockets)n.totalTime>0&&await Ct(n);e.isOperational=!1,e.activeRocket=null,e.rockets.clear(),e.launchPads=[],e.sessionStartTime=null,Y();const t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus"),o=document.querySelector(".mission-control");t.textContent="Initiate Operations",t.className="punch-btn",s.textContent="Operations Complete",s.className="punch-status-display",o&&(o.style.display="none"),document.getElementById("launchControls").className="launch-controls",document.getElementById("missionList").innerHTML='<div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">Operations Ended</div>',console.log("✅ Mission Control Shutdown Complete!")}async function Dt(){const e=await W({status:"InProgress"},!1);console.log(`🛸 Found ${e.length} available missions`);const t=document.getElementById("missionList");if(e.length===0){t.innerHTML='<div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">No In-Progress Tasks Available</div>';return}t.innerHTML=e.map(s=>`
    <div class="mission-item" data-task-id="${s.id}">
      🎯 ${s.title.substring(0,30)}${s.title.length>30?"...":""}
    </div>
  `).join(""),t.querySelectorAll(".mission-item").forEach(s=>{s.addEventListener("click",()=>{const o=s.dataset.taskId,a=e.find(n=>n.id.toString()===o);a&&Oo(a)})})}let se="random";function xo(){const e=document.getElementById("spaceshipPickerToggle"),t=document.querySelector(".spaceship-picker"),s=document.getElementById("spaceshipOptions"),o=document.getElementById("spaceshipCurrent"),a=document.querySelectorAll(".spaceship-btn");e&&e.addEventListener("click",()=>{t.classList.contains("expanded")?(t.classList.remove("expanded"),s.style.display="none"):(t.classList.add("expanded"),s.style.display="flex")}),a.forEach(n=>{n.dataset.type===se&&n.classList.add("selected"),n.addEventListener("click",()=>{se=n.dataset.type,a.forEach(i=>i.classList.remove("selected")),n.classList.add("selected");const l=n.querySelector(".spaceship-name").textContent;o&&(o.textContent=l),t.classList.remove("expanded"),s.style.display="none",console.log(`🚀 Spaceship type selected: ${se}`),k(`Spaceship Type: ${l}`,"info")})}),console.log("🛸 Spaceship picker initialized")}function Ro(e){return se==="random"?Fo(e):se}function Oo(e){const t=C(),s=Array.from(t.rockets.values()).find(i=>i.taskId===e.id&&!i.category);if(s){console.log(`🚀 Rocket already deployed for task: ${e.title}`),ke(s.id);return}const o=`rocket_${e.id}_${Date.now()}`,a=Wo();t.launchPads.push(a),Y();const n=Ro(e),l={id:o,taskId:e.id,taskTitle:e.title,category:null,totalTime:0,x:a.x,y:x-j(n)/2-40,launchPad:a,isActive:!1,isReadyForCategory:!0,deployTime:Date.now(),type:n};t.rockets.set(o,l),Y(),I.emit("spaceport:rocketDeployed",{rocketId:o,taskId:e.id,taskTitle:e.title,rocketType:n}),t.activeRocket||ke(o),document.getElementById("rocketsCount").textContent=t.rockets.size,console.log(`🚀 ${n.toUpperCase()} rocket deployed for mission: ${e.title} - Click to select category!`)}function Fo(e){const t=e.title.toLowerCase();return t.includes("dev")||t.includes("code")||t.includes("bug")||t.includes("fix")||t.includes("technical")||t.includes("api")?"v2":t.includes("project")||t.includes("launch")||t.includes("deploy")||t.includes("release")||t.includes("major")||t.includes("milestone")?"apollo":t.includes("fun")||t.includes("creative")||t.includes("experiment")||t.includes("prototype")||t.includes("test")||t.includes("play")||t.includes("brainstorm")||t.includes("sketch")||t.includes("demo")||t.includes("looney")||t.includes("tunes")||t.includes("cartoon")?"cartoon":"scout"}function Wo(){const e=C(),t=$.width*.1,o=$.width*.65-70,a=t+150,n=o-40,l=n-a,i=e.launchPads.length,r=90,c=130;let d;return i===0?d=a+l*.4:d=jo(a,n,r,c),d=Math.max(a,Math.min(n,d)),{x:d,y:x,radius:35,isActive:!1}}function jo(e,t,s,o){const n=C().launchPads.map(c=>c.x),l=t-e,i=[],r=20;for(let c=0;c<r;c++){const d=e+l*c/(r-1);let m=0,g=!0;for(const u of n){const f=Math.abs(d-u);if(f<s){g=!1;break}f>=o?m+=100:m+=f/o*100}g&&i.push({x:d,score:m})}return i.length===0?e+Math.random()*l:(i.sort((c,d)=>d.score-c.score),i[0].x)}function qo(e){const t=C();if(!t.isOperational)return;const s=$.getBoundingClientRect(),o=e.clientX-s.left,a=e.clientY-s.top,n=$.width*.65,l=140,r=x-120;if(o>=n-l/2&&o<=n+l/2&&a>=r&&a<=x){Uo();return}for(const[c,d]of t.rockets){const m=d.launchPad,g=m.radius*.6,u=m.y-m.radius*.8*.3;if(Math.sqrt(Math.pow(o-m.x,2)+Math.pow(a-u,2))<=g){No(c),ke(c);return}}zo(),Vo()}function ke(e){const t=C(),s=t.rockets.get(e);if(s){if(t.activeRocket){const o=t.rockets.get(t.activeRocket);if(o&&(o.isActive=!1,o.launchPad.isActive=!1,o.startTime)){const a=Date.now()-o.startTime;o.totalTime+=a}}t.activeRocket=e,s.isActive=!0,s.launchPad.isActive=!0,s.startTime=Date.now(),Y(),I.emit("spaceport:rocketLaunched",{rocketId:e,taskId:s.taskId,taskTitle:s.taskTitle,category:s.category}),document.getElementById("activeMissionName").textContent=s.taskTitle,document.getElementById("activeRocketDisplay").textContent=s.taskTitle.substring(0,20),document.getElementById("energyStatus").textContent="Charging",document.getElementById("launchControls").className="launch-controls active",console.log(`⚡ Activated rocket: ${s.taskTitle}`)}}function No(e){console.log(`🎛️ Showing control form for rocket: ${e}`)}function zo(){document.querySelectorAll(".rocket-control-form").forEach(t=>t.remove())}function Uo(){console.log("🏢 Mission Control Interface Activated")}function Vo(){const e=document.getElementById("missionControlOverlay");e&&e.remove()}async function Yo(){const e=C();if(!e.activeRocket)return;const t=e.rockets.get(e.activeRocket);if(t){if(t.startTime){const s=Date.now()-t.startTime;t.totalTime+=s}if(await Ct(t),console.log("🚀 Starting epic blastoff for:",t.taskTitle),t.isLaunching=!0,await _o(t),console.log("🚀 Blastoff complete, removing rocket"),e.rockets.delete(e.activeRocket),e.launchPads=e.launchPads.filter(s=>s!==t.launchPad),e.activeRocket=null,Y(),document.getElementById("launchControls").className="launch-controls",document.getElementById("rocketsCount").textContent=e.rockets.size,document.getElementById("activeRocketDisplay").textContent="None",document.getElementById("energyStatus").textContent=e.rockets.size>0?"Standby":"Offline",e.rockets.size>0){const s=e.rockets.keys().next().value;ke(s)}}}async function _o(e){console.log(`🚀 EPIC BLASTOFF START: ${e.taskTitle} - ${(e.totalTime/(1e3*60)).toFixed(1)} minutes`),console.log("🚀 Phase 1: Preparation"),e.launchPhase="preparation",e.launchStartTime=Date.now(),await ge(1e3),console.log("🚀 Phase 2: Ignition"),e.launchPhase="ignition";const t=C();t.screenShake={intensity:2,duration:2e3,startTime:Date.now()},await ge(500),console.log("🚀 Phase 3: Liftoff"),e.launchPhase="liftoff",e.liftoffStartTime=Date.now(),e.originalY=e.y,e.scale=1,t.screenShake={intensity:5,duration:3e3,startTime:Date.now()},e.launchPad.hasBlastCrater=!0,e.launchPad.craterStartTime=Date.now(),t.particles=t.particles||[],Go(e),await ge(3e3),console.log("🚀 Phase 4: Launch completed"),e.launchPhase="completed",await ge(1e3);const s=C();s.screenShake=null}function Go(e){const t=C();e.type==="apollo"?Qo(e,t):e.type==="cartoon"?Ko(e,t):Xo(e,t)}function Qo(e,t){[{x:0,y:0},{x:-10,y:0},{x:10,y:0},{x:0,y:-10},{x:0,y:10}].forEach(o=>{const a=e.x+o.x,n=e.y+j(e.type)/2;for(let l=0;l<20;l++)t.particles.push({type:"apollo-exhaust",x:a+(Math.random()-.5)*8,y:n+Math.random()*10,vx:(Math.random()-.5)*6+o.x*.3,vy:Math.random()*12+8,life:1,decay:.015,size:Math.random()*10+8,color:`hsl(${Math.random()*40+10}, 100%, ${60+Math.random()*30}%)`,intensity:1})});for(let o=0;o<60;o++)t.particles.push({type:"apollo-smoke",x:e.x+(Math.random()-.5)*50,y:e.y+20+Math.random()*30,vx:(Math.random()-.5)*8,vy:-(Math.random()*5+2),life:1,decay:.006,size:Math.random()*15+12,color:`rgba(120, 120, 120, ${Math.random()*.7+.3})`,expansion:1.02});for(let o=0;o<40;o++)t.particles.push({type:"apollo-debris",x:e.x+(Math.random()-.5)*60,y:e.y+20,vx:(Math.random()-.5)*20,vy:-(Math.random()*15+5),life:1,decay:.012,size:Math.random()*5+2,color:`hsl(${Math.random()*40+20}, 60%, ${30+Math.random()*30}%)`,gravity:.3});for(let o=0;o<3;o++)setTimeout(()=>{t.particles.push({type:"apollo-shockwave",x:e.x,y:e.y+25,radius:10,maxRadius:150+o*50,life:1,decay:.008,color:`hsla(${30+o*10}, 80%, 60%, 0.6)`,wave:o})},o*200)}function Xo(e,t){for(let o=0;o<50;o++)t.particles.push({type:"flame",x:e.x+(Math.random()-.5)*10,y:e.y+20,vx:(Math.random()-.5)*4,vy:Math.random()*8+5,life:1,decay:.02,size:Math.random()*6+4,color:`hsl(${Math.random()*60+10}, 100%, ${50+Math.random()*30}%)`}),o<20&&t.particles.push({type:"debris",x:e.x+(Math.random()-.5)*30,y:e.y+10,vx:(Math.random()-.5)*12,vy:-(Math.random()*6+2),life:1,decay:.015,size:Math.random()*3+1,color:"#888"}),o<30&&t.particles.push({type:"smoke",x:e.x+(Math.random()-.5)*20,y:e.y+15,vx:(Math.random()-.5)*3,vy:-(Math.random()*3+1),life:1,decay:.008,size:Math.random()*8+6,color:`rgba(100, 100, 100, ${Math.random()*.5+.2})`});t.particles.push({type:"shockwave",x:e.x,y:e.y+10,radius:0,maxRadius:100,life:1,decay:.03,color:"rgba(255, 255, 100, 0.6)"})}function Ko(e,t){for(let s=0;s<30;s++)t.particles.push({type:"cartoon-puff",x:e.x+(Math.random()-.5)*40,y:e.y+(Math.random()-.5)*20,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:1,decay:.015,size:Math.random()*10+5,color:`hsl(${Math.random()*360}, 90%, 70%)`});for(let s=0;s<20;s++)t.particles.push({type:"cartoon-star",x:e.x+(Math.random()-.5)*30,y:e.y+(Math.random()-.5)*15,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,life:1,decay:.012,size:Math.random()*6+3,color:`hsl(${Math.random()*360}, 100%, 60%)`});t.particles.push({type:"cartoon-boing",x:e.x,y:e.y+15,radius:5,maxRadius:80,life:1,decay:.04,color:"hsl(60, 100%, 50%)",bouncy:!0})}function ge(e){return new Promise(t=>setTimeout(t,e))}function ot(){function e(){Jo(),ta(),requestAnimationFrame(e)}e()}function Jo(){const e=C();if(!e.isOperational)return;const t=Date.now();if(t-tt>$o&&(Y(),tt=t),e.sessionStartTime){const s=Date.now()-e.sessionStartTime,o=Math.floor(s/(1e3*60*60)),a=Math.floor(s%(1e3*60*60)/(1e3*60)),n=Math.floor(s%(1e3*60)/1e3);document.getElementById("missionTimeDisplay").textContent=`${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}for(const[s,o]of e.rockets)if(o.launchPhase==="liftoff"&&o.liftoffStartTime){const a=Date.now()-o.liftoffStartTime;o.type==="cartoon"?Zo(o,a,e):ea(o,a,e)}e.particles&&(e.particles=e.particles.filter(s=>(s.x+=s.vx,s.y+=s.vy,s.life-=s.decay,(s.type==="debris"||s.type==="flame")&&(s.vy+=.2),s.type==="shockwave"&&(s.radius+=(s.maxRadius-s.radius)*.1),s.life>0))),e.screenShake&&Date.now()-e.screenShake.startTime>e.screenShake.duration&&(e.screenShake=null)}function Zo(e,t,s){const o=Math.min(t/6e3,1);if(!e.balloonPhysics){e.balloonPhysics={vx:(Math.random()-.5)*100,vy:-Math.random()*200-100,thrust:1,escapeAngle:Math.random()*Math.PI*2,spin:(Math.random()-.5)*20,spiralPhase:0,loopPhase:0,lastMajorChange:0,airBursts:[],momentum:1};for(let u=0;u<3;u++)e.balloonPhysics.airBursts.push({angle:Math.random()*Math.PI*2,strength:Math.random()*.8+.2,frequency:Math.random()*5+2})}const a=e.balloonPhysics,n=t*.001;if(a.thrust=Math.max(.05,1.2-o*.8),a.momentum=Math.max(.1,1-o*.6),t-a.lastMajorChange>300+Math.random()*800){const u=a.thrust*(200+Math.random()*300),f=Math.random()*Math.PI*2;a.vx+=Math.cos(f)*u,a.vy+=Math.sin(f)*u,a.escapeAngle+=(Math.random()-.5)*Math.PI,a.spin+=(Math.random()-.5)*30,a.lastMajorChange=t}let l=0,i=0;a.airBursts.forEach((u,f)=>{const h=n*u.frequency,p=Math.sin(h)*u.strength*a.thrust*80;l+=Math.cos(u.angle)*p,i+=Math.sin(u.angle)*p,Math.random()<.01&&(u.angle+=(Math.random()-.5)*.5)}),a.vx+=l,a.vy+=i,a.spiralPhase+=n*3,a.loopPhase+=n*2;const r=Math.sin(a.spiralPhase)*a.thrust*50;a.vx+=Math.cos(n*4)*r,a.vy+=Math.sin(n*4)*r;const c=Math.cos(a.loopPhase)*a.thrust*40;a.vx+=Math.sin(n*6)*c,a.vy+=Math.cos(n*6)*c,a.vy+=30*(1-a.thrust),a.vx+=(Math.random()-.5)*a.thrust*60,a.vy+=(Math.random()-.5)*a.thrust*60,a.vx*=.98,a.vy*=.98,e.x+=a.vx*.016*a.momentum,e.y+=a.vy*.016*a.momentum;const d=$.width,m=$.height,g=30;(e.x<g||e.x>d-g)&&(a.vx*=-.9,a.vy*=.95,a.spin+=(Math.random()-.5)*20,a.vx+=(Math.random()-.5)*100,a.vy+=(Math.random()-.5)*100),(e.y<g||e.y>m-g)&&(a.vy*=-.9,a.vx*=.95,a.spin+=(Math.random()-.5)*20,a.vx+=(Math.random()-.5)*150,a.vy+=(Math.random()-.5)*150),a.spin+=a.thrust*8,e.tilt=a.spin+Math.sin(n*10)*20,e.scale=1+Math.sin(n*12)*.15+a.thrust*.1,Math.random()<a.thrust*1.5&&(s.particles=s.particles||[],a.airBursts.forEach((u,f)=>{Math.random()<.3&&s.particles.push({type:Math.random()<.4?"cartoon-star":"cartoon-puff",x:e.x+Math.cos(u.angle)*20,y:e.y+Math.sin(u.angle)*20,vx:-Math.cos(u.angle)*50+(Math.random()-.5)*30,vy:-Math.sin(u.angle)*50+(Math.random()-.5)*30,life:1,decay:.02,size:Math.random()*8+4,color:`hsl(${(f*120+n*100)%360}, 90%, 70%)`})}))}function ea(e,t,s){const o=Math.min(t/3e3,1);if(o<=.2){const a=o/.2,n=1-Math.pow(1-a,3);e.y=e.originalY-n*50,e.scale=1,e.thrust=1,e.tilt=Math.sin(t*.01)*2}else if(o<=.6){const a=(o-.2)/.4,n=Math.pow(a,2);e.y=e.originalY-50-n*300,e.scale=1-a*.2,e.thrust=.8,e.tilt=0,Math.random()<.6&&(s.particles=s.particles||[],s.particles.push({type:"velocity-trail",x:e.x+(Math.random()-.5)*8,y:e.y+j(e.type)/2,vx:(Math.random()-.5)*3,vy:Math.random()*8+5,life:1,decay:.03,size:Math.random()*6+4,color:`hsl(${Math.random()*60+15}, 100%, ${70+Math.random()*20}%)`}))}else{const a=(o-.6)/.4,n=1-Math.pow(1-a,4);e.y=e.originalY-350-n*($.height*.8);const l=1-a*.85;e.scale=Math.max(.15,l),e.thrust=.6-a*.4,e.atmospheric=a,Math.random()<.2&&(s.particles=s.particles||[],s.particles.push({type:"high-altitude-trail",x:e.x+(Math.random()-.5)*4,y:e.y+j(e.type)/2,vx:(Math.random()-.5)*1,vy:Math.random()*3+2,life:1,decay:.02,size:Math.random()*3+2,color:`hsla(${Math.random()*40+10}, 80%, 60%, 0.7)`}))}if(Math.random()<.4){s.particles=s.particles||[];const a=e.thrust||.5;s.particles.push({type:"exhaust-trail",x:e.x+(Math.random()-.5)*6,y:e.y+j(e.type)/2+10,vx:(Math.random()-.5)*4,vy:Math.random()*6+3,life:1,decay:.025,size:Math.random()*5+3,color:`hsl(${Math.random()*50+10}, 90%, ${50+a*30}%)`,intensity:a})}}function ta(){if(!$||!v)return;const e=C();if(v.save(),e.screenShake){const s=(Date.now()-e.screenShake.startTime)/e.screenShake.duration,o=e.screenShake.intensity*(1-s),a=(Math.random()-.5)*o,n=(Math.random()-.5)*o;v.translate(a,n)}v.fillStyle="transparent",v.clearRect(0,0,$.width,$.height),sa(),oa(),aa(),ra(),la(),ca(),ma(),v.restore()}function sa(){if(!(!$||!v)){v.fillStyle="rgba(255, 255, 255, 0.8)";for(let e=0;e<50;e++){const t=Math.random()*$.width,s=Math.random()*(x-100),o=Math.random()*2;v.beginPath(),v.arc(t,s,o,0,Math.PI*2),v.fill()}}}function oa(){v.strokeStyle="#4a6741",v.lineWidth=3,v.beginPath(),v.moveTo(0,x),v.lineTo($.width,x),v.stroke();const e=v.createLinearGradient(0,x,0,$.height);e.addColorStop(0,"rgba(100, 150, 255, 0.1)"),e.addColorStop(1,"rgba(50, 100, 150, 0.3)"),v.fillStyle=e,v.fillRect(0,x,$.width,$.height-x)}function aa(){const e=C(),t=$.width*.1,s=x,a=s-240,n=Date.now()*.001,l=e.activeRocket?.7+Math.sin(n*3)*.3:.2+Math.sin(n*.5)*.1,i=n*.7%(Math.PI*2),r=e.activeRocket?180+Math.sin(i)*60:200+Math.sin(i*.3)*20,c=`hsl(${r}, 80%, ${60+l*20}%)`;v.strokeStyle=c,v.lineWidth=3;const d=25;v.beginPath(),v.moveTo(t-d,s),v.lineTo(t-8,a+60),v.lineTo(t-8,a+20),v.moveTo(t+d,s),v.lineTo(t+8,a+60),v.lineTo(t+8,a+20),v.stroke(),v.lineWidth=4,v.beginPath(),v.moveTo(t,s),v.lineTo(t,a+20),v.stroke();const m=35,g=a-10,u=`hsl(${r}, 90%, 70%)`;for(let h=0;h<4;h++){const p=m-h*6,b=l*(1-h*.2),y=Math.max(.1,b);v.strokeStyle=`hsla(${r}, 80%, 70%, ${y})`,v.lineWidth=3-h*.5,v.beginPath(),v.arc(t,g,p,0,Math.PI*2),v.stroke()}const f=12+Math.sin(n*4)*4;v.shadowColor=u,v.shadowBlur=20+l*20,v.fillStyle=u,v.beginPath(),v.arc(t,g,f,0,Math.PI*2),v.fill(),v.shadowBlur=0,e.activeRocket&&l>.6&&na(t,g,m+10,r,l),e.activeRocket&&Math.random()<.0011&&ia(t,g,r)}function na(e,t,s,o,a){const n=3+Math.floor(Math.random()*3);for(let l=0;l<n;l++){const i=Math.PI*2*l/n+Math.random()*.5,r=s+Math.random()*15;v.strokeStyle=`hsla(${o+Math.random()*40-20}, 90%, 80%, ${a})`,v.lineWidth=1+Math.random()*2,v.shadowColor=v.strokeStyle,v.shadowBlur=8,v.beginPath(),v.moveTo(e,t);const c=4+Math.floor(Math.random()*3);for(let d=1;d<=c;d++){const m=e+Math.cos(i)*(r*d/c)+(Math.random()-.5)*10,g=t+Math.sin(i)*(r*d/c)+(Math.random()-.5)*10;v.lineTo(m,g)}v.stroke(),v.shadowBlur=0}}function ia(e,t,s){const o=C();if(!o.activeRocket)return;const a=o.rockets.get(o.activeRocket);if(!a)return;const n={startX:e,startY:t,endX:a.x,endY:a.y,hue:s,intensity:1,duration:15,createdAt:Date.now()};o.zapEffects||(o.zapEffects=[]),o.zapEffects.push(n),console.log(`⚡ ZAP! Tesla tower energizes rocket: ${a.taskTitle}`)}function la(){const e=C();if(!e.zapEffects)return;const t=Date.now();e.zapEffects=e.zapEffects.filter(s=>{const o=t-s.createdAt,a=s.duration*(1e3/60);if(o>a)return!1;const l=1-o/a;v.shadowColor=`hsl(${s.hue}, 90%, 80%)`,v.shadowBlur=15*l,v.strokeStyle=`hsla(${s.hue}, 90%, 85%, ${l})`,v.lineWidth=3*l,v.beginPath(),v.moveTo(s.startX,s.startY);const i=8,r=(s.endX-s.startX)/i,c=(s.endY-s.startY)/i;for(let d=1;d<=i;d++){const m=s.startX+r*d,g=s.startY+c*d,u=(Math.random()-.5)*30*l,f=(Math.random()-.5)*30*l;v.lineTo(m+u,g+f)}return v.lineTo(s.endX,s.endY),v.stroke(),v.shadowBlur=0,!0})}function ra(){const e=C(),t=$.width*.65,s=x,o=120,a=140,n=s-o;v.strokeStyle="#64d6ff",v.lineWidth=3,v.fillStyle="rgba(0, 20, 40, 0.8)",v.fillRect(t-a/2,n,a,o),v.strokeRect(t-a/2,n,a,o),v.fillStyle="rgba(100, 214, 255, 0.2)",v.fillRect(t-15,s-30,30,30),v.strokeRect(t-15,s-30,30,30);for(let c=0;c<4;c++){const d=n+20+c*25;for(let m=0;m<5;m++){const g=t-50+m*25;v.fillStyle=e.isOperational?"rgba(100, 214, 255, 0.6)":"rgba(100, 214, 255, 0.2)",v.fillRect(g,d,12,15),v.strokeStyle="#64d6ff",v.lineWidth=1,v.strokeRect(g,d,12,15)}}const l=25;v.fillStyle="rgba(0, 30, 60, 0.9)",v.fillRect(t-20,n-l,40,l),v.strokeRect(t-20,n-l,40,l),v.strokeStyle="#64d6ff",v.lineWidth=2,v.beginPath(),v.moveTo(t,n-l),v.lineTo(t,n-l-20),v.stroke();const i=8,r=e.isOperational?Date.now()*.001%(Math.PI*2):0;v.save(),v.translate(t,n-l-15),v.rotate(r),v.beginPath(),v.arc(0,0,i,0,Math.PI),v.stroke(),v.restore(),e.isOperational&&(v.fillStyle="#64d6ff",v.font="bold 12px Arial",v.textAlign="center",v.fillText("MISSION CONTROL",t,s+15))}function ca(){const e=C();for(const[t,s]of e.rockets)da(s.launchPad),(!s.launchPhase||s.launchPhase!=="completed")&&ua(s)}function da(e){const t=v,s=e.x,o=e.y,a=e.radius,n=a*3,l=a*2,i=a*.8;t.fillStyle=e.isActive?"rgba(80, 180, 80, 0.9)":"rgba(100, 100, 100, 0.9)",t.strokeStyle=e.isActive?"#50b450":"#666",t.lineWidth=2,t.beginPath(),t.moveTo(s-n/2,o),t.lineTo(s-l/2,o-i),t.lineTo(s+l/2,o-i),t.lineTo(s+n/2,o),t.closePath(),t.fill(),t.stroke();const r=a*2.4,c=a*1.6,d=i*.6;t.fillStyle=e.isActive?"rgba(100, 200, 100, 0.9)":"rgba(120, 120, 120, 0.9)",t.strokeStyle=e.isActive?"#64c864":"#777",t.beginPath(),t.moveTo(s-r/2,o-i*.4),t.lineTo(s-c/2,o-i*.4-d),t.lineTo(s+c/2,o-i*.4-d),t.lineTo(s+r/2,o-i*.4),t.closePath(),t.fill(),t.stroke();const m=a*1.6,g=i*.3;if(t.fillStyle=e.isActive?"rgba(120, 255, 120, 0.9)":"rgba(140, 140, 140, 0.9)",t.strokeStyle=e.isActive?"#78ff78":"#888",t.lineWidth=3,t.beginPath(),t.moveTo(s-m/2,o-i),t.lineTo(s-m/3,o-i-g),t.lineTo(s+m/3,o-i-g),t.lineTo(s+m/2,o-i),t.closePath(),t.fill(),t.stroke(),e.isActive){const h=a+Math.sin(Date.now()*.005)*5;t.strokeStyle="rgba(100, 255, 100, 0.6)",t.lineWidth=2,t.beginPath(),t.arc(s,o,h,0,Math.PI*2),t.stroke()}const u=a*.6,f=o-i*.3;if(t.fillStyle=e.isActive?"rgba(0, 150, 0, 0.7)":"rgba(80, 80, 80, 0.7)",t.strokeStyle=e.isActive?"#00aa00":"#555",t.lineWidth=2,t.beginPath(),t.arc(s,f,u,0,Math.PI*2),t.fill(),t.stroke(),t.fillStyle=e.isActive?"rgba(100, 255, 100, 0.4)":"rgba(150, 150, 150, 0.4)",t.beginPath(),t.arc(s-u*.3,f-u*.3,u*.5,0,Math.PI*2),t.fill(),e.hasBlastCrater&&e.craterStartTime){const h=Date.now()-e.craterStartTime,p=Math.min(h/3e3,1),b=a*.8*p;t.fillStyle=`rgba(60, 30, 20, ${.8*p})`,t.beginPath(),t.arc(s,o-i*.2,b,0,Math.PI*2),t.fill(),h>3e4&&(e.hasBlastCrater=!1,e.craterStartTime=null)}}function ua(e){const t=v,s=e.x,o=e.y;t.save(),e.tilt!==void 0&&(t.translate(s,o),t.rotate(e.tilt*Math.PI/180),t.translate(-s,-o)),e.scale!==void 0&&(t.translate(s,o),t.scale(e.scale,e.scale),t.translate(-s,-o)),e.atmospheric!==void 0&&(t.globalAlpha=1-e.atmospheric*.6);let a="#888",n=null;if(e.launchPhase==="preparation"){a="#ffff64",n="#ffff64";const m=Math.sin(Date.now()*.05)*2;t.translate(m,0)}else if(e.launchPhase==="ignition")a="#ff6464",n="#ff6464",t.shadowBlur=25;else if(e.launchPhase==="liftoff"){const m=e.thrust||.5;a=`hsl(${60-m*60}, 100%, ${70+m*20}%)`,n=a,t.shadowBlur=20+m*20;const g=Math.sin(Date.now()*.02)*m*2;t.translate(g,0)}else e.category?e.isActive?(a="#64ff64",n="#64ff64"):a="#64d6ff":(a="#ffaa00",n="#ffaa00");switch(n&&(t.shadowColor=n,t.shadowBlur=t.shadowBlur||15),e.type){case"v2":fa(t,s,o,a);break;case"apollo":ha(t,s,o,a),pa(t,e,s,o);break;case"cartoon":ya(t,s,o,a);break;case"xwing":va(t,s,o,a);break;case"tie":ba(t,s,o);break;case"scout":default:ga(t,s,o,a);break}if(e.isActive){const m=o+j(e.type)/2+15;t.fillStyle="rgba(255, 100, 100, 0.8)",t.beginPath(),t.ellipse(s,m,8,12,0,0,Math.PI*2),t.fill()}if(!e.category){const g=j(e.type)/2+Math.sin(Date.now()*.008)*12;t.beginPath(),t.arc(s,o,g,0,Math.PI*2),t.strokeStyle="#ffaa0040",t.lineWidth=3,t.stroke()}if(t.shadowBlur=0,e.category){if(e.category){t.fillStyle="#64d6ff",t.font="12px Arial",t.textAlign="center";const m=e.category.split(".").pop()||"Work",g=o-j(e.type)/2-5;t.fillText(m.substring(0,8),s,g)}}else{t.fillStyle="#ffaa00",t.font="bold 20px Arial",t.textAlign="center";const m=o-j(e.type)/2-10;t.fillText("?",s+20,m)}let l=e.totalTime;e.isActive&&e.startTime&&(l+=Date.now()-e.startTime);const i=Math.floor(l/(1e3*60)),r=`${Math.floor(i/60)}:${(i%60).toString().padStart(2,"0")}`,c=t.measureText(r).width+8,d=o+j(e.type)/2+35;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(s-c/2,d-5,c,16),t.fillStyle=e.isActive?"#64ff64":a,t.font="12px Courier New",t.textAlign="center",t.fillText(r,s,d+8),t.restore()}function ma(){const e=C();if(!e.particles)return;const t=v;e.particles.forEach(s=>{switch(t.save(),s.type){case"flame":t.globalAlpha=s.life,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"trail":t.globalAlpha=s.life*.8,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*2,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"velocity-trail":t.globalAlpha=s.life*.9,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*1.5,t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size*2);break;case"high-altitude-trail":t.globalAlpha=s.life*.5,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*.8,t.beginPath(),t.arc(s.x,s.y,s.size*.8,0,Math.PI*2),t.fill();break;case"exhaust-trail":const o=s.intensity||.5;t.globalAlpha=s.life*(.6+o*.4),t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*(1+o),t.beginPath(),t.arc(s.x,s.y,s.size*(.8+o*.4),0,Math.PI*2),t.fill();break;case"debris":t.globalAlpha=s.life,t.fillStyle=s.color,t.fillRect(s.x,s.y,s.size,s.size);break;case"smoke":t.globalAlpha=s.life*.3,t.fillStyle=s.color,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"shockwave":t.globalAlpha=s.life*.5,t.strokeStyle=s.color,t.lineWidth=3,t.setLineDash([5,5]),t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.PI*2),t.stroke(),t.setLineDash([]);break;case"apollo-exhaust":const a=s.intensity||1;t.globalAlpha=s.life*a,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*2,t.beginPath(),t.arc(s.x,s.y,s.size*a,0,Math.PI*2),t.fill(),t.globalAlpha=s.life*a*.8,t.fillStyle="#ffffff",t.beginPath(),t.arc(s.x,s.y,s.size*.3,0,Math.PI*2),t.fill();break;case"apollo-smoke":s.expansion&&(s.size*=s.expansion),t.globalAlpha=s.life*.4,t.fillStyle=s.color,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"apollo-debris":s.gravity&&(s.vy+=s.gravity),t.globalAlpha=s.life,t.fillStyle=s.color,t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size);break;case"apollo-shockwave":s.radius=Math.min(s.radius+4,s.maxRadius),t.globalAlpha=s.life*.6,t.strokeStyle=s.color,t.lineWidth=4-(s.wave||0),t.setLineDash([8,4]),t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.PI*2),t.stroke(),t.setLineDash([]);break;case"cartoon-puff":t.globalAlpha=s.life*.8,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=s.life*.6,t.strokeStyle="#000",t.lineWidth=2,t.stroke();break;case"cartoon-star":t.globalAlpha=s.life,t.fillStyle=s.color,t.save(),t.translate(s.x,s.y),t.rotate(Date.now()*.01),t.beginPath();for(let l=0;l<5;l++){const i=l*Math.PI*2/5,r=Math.cos(i)*s.size,c=Math.sin(i)*s.size;l===0?t.moveTo(r,c):t.lineTo(r,c);const d=i+Math.PI/5,m=Math.cos(d)*(s.size*.4),g=Math.sin(d)*(s.size*.4);t.lineTo(m,g)}t.closePath(),t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.stroke(),t.restore();break;case"cartoon-boing":s.radius+=3,s.radius>s.maxRadius&&(s.radius=s.maxRadius),t.globalAlpha=s.life*.8,t.strokeStyle=s.color,t.lineWidth=5,t.setLineDash([]),t.beginPath();const n=16;for(let l=0;l<=n;l++){const i=l/n*Math.PI*2,r=Math.sin(l*2)*5,c=s.radius+r,d=s.x+Math.cos(i)*c,m=s.y+Math.sin(i)*c;l===0?t.moveTo(d,m):t.lineTo(d,m)}t.closePath(),t.stroke();break}t.restore()})}function j(e){switch(e){case"v2":return 120;case"apollo":return 150;case"cartoon":return 70;case"scout":return 80;case"xwing":return 100;case"tie":return 90;default:return 80}}function ga(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-18/2,s-40+15,18,50),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,s-40-5),e.lineTo(t-18/2,s-40+15),e.lineTo(t+18/2,s-40+15),e.closePath(),e.fill(),e.stroke();const i=s+40-15,r=12;e.beginPath(),e.moveTo(t-18/2,i),e.lineTo(t-18/2-r,i+r),e.lineTo(t-18/2,i+r),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+18/2,i),e.lineTo(t+18/2+r,i+r),e.lineTo(t+18/2,i+r),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t-4,i),e.lineTo(t,i+r),e.lineTo(t+4,i),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t-4,i+r),e.lineTo(t,i),e.lineTo(t+4,i+r),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.rect(t-6,s+40-15,12,15),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(t-18/2+2,s),e.lineTo(t+18/2-2,s),e.stroke()}function fa(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-24/2,s-60+20,24,80),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,s-60-5),e.lineTo(t-24/2,s-60+20),e.lineTo(t+24/2,s-60+20),e.closePath(),e.fill(),e.stroke();const i=s+60-20,r=25,c=15;e.beginPath(),e.moveTo(t-24/2,i),e.lineTo(t-24/2-c,i+r),e.lineTo(t-24/2,i+r),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+24/2,i),e.lineTo(t+24/2+c,i+r),e.lineTo(t+24/2,i+r),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,i),e.lineTo(t-6,i+r),e.lineTo(t+6,i+r),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.rect(t-8,s+60-20,16,20),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(t-24/2+2,s-10),e.lineTo(t+24/2-2,s-10),e.stroke(),e.beginPath(),e.moveTo(t-24/2+2,s+10),e.lineTo(t+24/2-2,s+10),e.stroke()}function ha(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2;const l=32,i=45;e.beginPath(),e.rect(t-l/2,s+75-i,l,i),e.fill(),e.stroke(),e.strokeStyle="#555",e.lineWidth=1;for(let y=1;y<4;y++){const w=s+75-i*y/4;e.beginPath(),e.moveTo(t-l/2,w),e.lineTo(t+l/2,w),e.stroke()}const r=26,c=45;e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-r/2,s+75-i-c,r,c),e.fill(),e.stroke();const d=22,m=35;e.beginPath(),e.rect(t-d/2,s+75-i-c-m,d,m),e.fill(),e.stroke();const g=18,u=25;e.beginPath(),e.rect(t-g/2,s-75,g,u),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=3,e.beginPath(),e.moveTo(t,s-75),e.lineTo(t,s-75-20),e.stroke(),e.fillStyle="#ff4444",e.beginPath(),e.moveTo(t,s-75-25),e.lineTo(t-4,s-75-15),e.lineTo(t+4,s-75-15),e.closePath(),e.fill(),e.stroke(),e.fillStyle=o,e.fillStyle="#222";const f=s+75,h=5;e.beginPath(),e.arc(t,f,h,0,Math.PI*2),e.fill(),e.strokeStyle="#444",e.stroke(),[{x:-10,y:0},{x:10,y:0},{x:0,y:-10},{x:0,y:10}].forEach(y=>{e.fillStyle="#222",e.beginPath(),e.arc(t+y.x,f+y.y,h-1,0,Math.PI*2),e.fill(),e.strokeStyle="#444",e.stroke()}),e.strokeStyle="#555",e.lineWidth=2,e.beginPath(),e.moveTo(t-l/2,s+75-i),e.lineTo(t+l/2,s+75-i),e.stroke(),e.beginPath(),e.moveTo(t-r/2,s+75-i-c),e.lineTo(t+r/2,s+75-i-c),e.stroke(),e.fillStyle="#000";const b=3;for(let y=0;y<3;y++){const w=s+75-i-c-y*8;e.fillRect(t-d/2,w,d,b)}}function pa(e,t,s,o){if(t.launchPhase==="liftoff"||t.launchPhase==="completed")return;const a=s+60,n=180,l=o-90,i=o+90;let r=0;if(t.launchPhase==="ignition"){const g=(Date.now()-t.launchStartTime-1e3)/500;g>0&&(r=Math.min(g,1)*40)}const c=a+r;e.save(),e.strokeStyle="#666",e.fillStyle="#555",e.lineWidth=3,e.beginPath(),e.moveTo(c,i),e.lineTo(c,l),e.stroke(),[.2,.4,.6,.8].forEach(g=>{const u=i-n*g;e.beginPath(),e.moveTo(c-15,u),e.lineTo(c+8,u),e.stroke(),e.beginPath(),e.moveTo(c,u),e.lineTo(c-8,u+10),e.stroke()});const m=o-20;t.launchPhase!=="ignition"&&(e.strokeStyle="#777",e.lineWidth=4,e.beginPath(),e.moveTo(c,m),e.lineTo(s+16,m),e.stroke(),e.strokeStyle="#888",e.lineWidth=2,e.beginPath(),e.moveTo(s+16,m),e.lineTo(s+16,m+5),e.stroke()),e.fillStyle="#444",e.fillRect(c-8,i,16,8),e.strokeStyle="#777",e.lineWidth=1;for(let g=0;g<20;g++){const u=i-g*8;u>l&&(e.beginPath(),e.moveTo(c-3,u),e.lineTo(c+3,u),e.stroke())}e.restore()}function ya(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=3,e.beginPath(),e.ellipse(t,s,45/2,30,0,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.moveTo(t,s-35-8),e.lineTo(t-4,s-35+5),e.lineTo(t+4,s-35+5),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#ffff00",e.beginPath(),e.arc(t,s-35-12,3,0,Math.PI*2),e.fill(),e.fillStyle="#222",e.fillRect(t-45/2,s-3,45,6),e.fillStyle=o,e.strokeStyle="#333",e.beginPath(),e.moveTo(t-45/2,s+35-15),e.lineTo(t-45/2-8,s+35),e.lineTo(t-45/2+2,s+35),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+45/2,s+35-15),e.lineTo(t+45/2+8,s+35),e.lineTo(t+45/2-2,s+35),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.arc(t,s+35,8,0,Math.PI*2),e.fill(),e.strokeStyle="#666",e.stroke(),e.fillStyle="#555",[{x:-45/3,y:-10},{x:45/3,y:-10},{x:-45/3,y:0},{x:45/3,y:0},{x:-45/3,y:10},{x:45/3,y:10}].forEach(r=>{e.beginPath(),e.arc(t+r.x,s+r.y,2,0,Math.PI*2),e.fill()}),e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.ellipse(t-45/4,s-35/2,45/6,35/3,0,0,Math.PI*2),e.fill()}function va(e,t,s,o){e.strokeStyle="#333",e.lineWidth=2,e.fillStyle=o,e.fillRect(t-10/2,s-70/2,10,70),e.strokeRect(t-10/2,s-70/2,10,70),e.fillStyle=o,e.beginPath(),e.moveTo(t,s-70/2-25),e.lineTo(t-10/2,s-70/2),e.lineTo(t+10/2,s-70/2),e.closePath(),e.fill(),e.stroke(),e.fillStyle="rgba(79, 195, 247, 0.7)",e.fillRect(t-10/2+1,s-70/2+10,8,12),e.strokeRect(t-10/2+1,s-70/2+10,8,12),e.fillStyle="#4fc3f7",e.beginPath(),e.arc(t,s-70/2+28,4,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle=o,e.lineWidth=1.5;const d=s+15;e.save(),e.translate(t,d),e.rotate(-Math.PI/6),e.fillRect(-6/2-15,-30,6,30),e.strokeRect(-6/2-15,-30,6,30),e.fillStyle="#555",e.fillRect(-6/2-15-1,-38,8,8),e.strokeRect(-6/2-15-1,-38,8,8),e.fillStyle="#ff6b6b",e.fillRect(-6/2-15,-37,6,4),e.fillStyle="#ff4444",e.fillRect(-6/2-15+6/2-1,-30,2,-4),e.restore(),e.save(),e.translate(t,d),e.rotate(Math.PI/6),e.fillStyle=o,e.fillRect(15-6/2,-30,6,30),e.strokeRect(15-6/2,-30,6,30),e.fillStyle="#555",e.fillRect(15-6/2-1,-38,8,8),e.strokeRect(15-6/2-1,-38,8,8),e.fillStyle="#ff6b6b",e.fillRect(15-6/2,-37,6,4),e.fillStyle="#ff4444",e.fillRect(15-6/2+6/2-1,-30,2,-4),e.restore(),e.save(),e.translate(t,d),e.rotate(-Math.PI/6),e.fillStyle=o,e.fillRect(-6/2-15,0,6,30),e.strokeRect(-6/2-15,0,6,30),e.fillStyle="#555",e.fillRect(-6/2-15-1,30,8,8),e.strokeRect(-6/2-15-1,30,8,8),e.fillStyle="#ff6b6b",e.fillRect(-6/2-15,31,6,4),e.fillStyle="#ff4444",e.fillRect(-6/2-15+6/2-1,30,2,4),e.restore(),e.save(),e.translate(t,d),e.rotate(Math.PI/6),e.fillStyle=o,e.fillRect(15-6/2,0,6,30),e.strokeRect(15-6/2,0,6,30),e.fillStyle="#555",e.fillRect(15-6/2-1,30,8,8),e.strokeRect(15-6/2-1,30,8,8),e.fillStyle="#ff6b6b",e.fillRect(15-6/2,31,6,4),e.fillStyle="#ff4444",e.fillRect(15-6/2+6/2-1,30,2,4),e.restore(),e.fillStyle="#ff8844",e.fillRect(t-3,s+70/2-2,2,4),e.fillRect(t+1,s+70/2-2,2,4),e.strokeStyle="#555",e.lineWidth=.5;for(let m=-20;m<30;m+=8)e.beginPath(),e.moveTo(t-10/2,s+m),e.lineTo(t+10/2,s+m),e.stroke()}function ba(e,t,s,o){e.fillStyle="#222",e.strokeStyle="#333",e.lineWidth=2;const n=12;e.beginPath(),e.arc(t,s,n,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#4fc3f7",e.beginPath(),e.arc(t,s,n-3,0,Math.PI*2),e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.beginPath(),e.moveTo(t,s-n+3),e.lineTo(t,s+n-3),e.moveTo(t-n+3,s),e.lineTo(t+n-3,s),e.stroke(),e.strokeStyle="#444",e.lineWidth=3,e.beginPath(),e.moveTo(t-n,s),e.lineTo(t-35-10,s),e.stroke(),e.beginPath(),e.moveTo(t+n,s),e.lineTo(t+35+10,s),e.stroke();function l(i,r,c){e.fillStyle="#1a237e",e.strokeStyle="#333",e.lineWidth=2,e.beginPath();for(let d=0;d<6;d++){const m=Math.PI/3*d,g=i+c*Math.cos(m),u=r+c*Math.sin(m);d===0?e.moveTo(g,u):e.lineTo(g,u)}e.closePath(),e.fill(),e.stroke(),e.strokeStyle="#283593",e.lineWidth=1;for(let d=0;d<6;d++){const m=Math.PI/3*d,g=i+c*Math.cos(m),u=r+c*Math.sin(m);e.beginPath(),e.moveTo(i,r),e.lineTo(g,u),e.stroke()}e.beginPath();for(let d=0;d<6;d++){const m=Math.PI/3*d,g=i+c*.6*Math.cos(m),u=r+c*.6*Math.sin(m);d===0?e.moveTo(g,u):e.lineTo(g,u)}e.closePath(),e.stroke()}l(t-35-10,s,35),l(t+35+10,s,35),e.fillStyle="#4eff4e",e.beginPath(),e.arc(t,s+n-2,3,0,Math.PI*2),e.fill()}async function Ct(e){if(e.totalTime<1e3)return;const t=e.totalTime/(1e3*60*60),s=e.category||"work";try{const o={taskId:parseInt(e.taskId),hours:t,dateLogged:O(),description:`Spaceport Mission: ${e.taskTitle}`,category:s,loggedAt:new Date().toISOString()};await Ee(o)&&(console.log(`💾 Mission Complete: ${t.toFixed(2)} hours for ${e.taskTitle}`),k(`🚀 Mission Complete: ${t.toFixed(2)}h logged`,"success"),I.emit("spaceport:rocketLanded",{taskId:parseInt(e.taskId),taskTitle:e.taskTitle,hours:t,category:s}))}catch(o){console.error("Error saving rocket mission time:",o),k("Failed to save mission time","error")}}async function F(e="board"){console.log("Rendering tasks for view:",e),zt(e),Ta(e);const t=document.getElementById("taskList");if(!t){console.error("Container element #taskList not found");return}const s=document.getElementById("spaceportView");e==="spaceport"?(t.style.display="none",s&&(s.style.display="block")):(t.style.display="block",s&&(s.style.display="none"));const o=z();switch(e){case"board":await q(t,o);break;case"month":await Vs(t,o);break;case"today":await vs(t);break;case"work":await he(t);break;case"reports":await ko(t);break;case"spaceport":await ka();break;case"all":await wa();break;default:await q(t,o)}}async function ka(){await Po()}async function wa(){console.log("All tasks view not yet implemented")}function Ta(e){document.querySelectorAll(".nav-link").forEach(o=>{o.classList.remove("active")});const s={board:"boardTab",month:"monthTab",today:"todayTab",work:"workTab",reports:"reportsTab",spaceport:"spaceportTab",all:"allTab"}[e];if(s){const o=document.getElementById(s);o&&o.classList.add("active")}}function Ia(){var e,t,s,o,a,n;(e=document.getElementById("boardTab"))==null||e.addEventListener("click",l=>{l.preventDefault(),F("board")}),(t=document.getElementById("monthTab"))==null||t.addEventListener("click",l=>{l.preventDefault(),F("month")}),(s=document.getElementById("todayTab"))==null||s.addEventListener("click",l=>{l.preventDefault(),F("today")}),(o=document.getElementById("workTab"))==null||o.addEventListener("click",l=>{l.preventDefault(),F("work")}),(a=document.getElementById("reportsTab"))==null||a.addEventListener("click",l=>{l.preventDefault(),F("reports")}),(n=document.getElementById("spaceportTab"))==null||n.addEventListener("click",l=>{l.preventDefault(),F("spaceport")})}function Sa(){var e,t,s,o,a,n,l;(e=document.getElementById("exportBtn"))==null||e.addEventListener("click",async()=>{await ps()}),(t=document.getElementById("importBtn"))==null||t.addEventListener("click",()=>{document.getElementById("importFile").click()}),(s=document.getElementById("importFile"))==null||s.addEventListener("change",async i=>{const r=i.target.files[0];r&&(await ys(r),F(ne()))}),(o=document.getElementById("globalFilterClear"))==null||o.addEventListener("click",()=>{document.getElementById("globalProjectFilter").value="",document.getElementById("globalPhaseFilter").value="",Ut(),localStorage.removeItem("globalProjectFilter"),localStorage.removeItem("globalPhaseFilter")}),(a=document.getElementById("globalProjectFilter"))==null||a.addEventListener("change",i=>{const r=i.target.value,c=z();te({...c,project:r||null}),localStorage.setItem("globalProjectFilter",r)}),(n=document.getElementById("globalPhaseFilter"))==null||n.addEventListener("change",i=>{const r=i.target.value,c=z();te({...c,phase:r||null}),localStorage.setItem("globalPhaseFilter",r)}),(l=document.getElementById("punchClockBtn"))==null||l.addEventListener("click",()=>{new bootstrap.Modal(document.getElementById("punchClockModal")).show()}),document.addEventListener("click",i=>{if(i.target.closest(".work-task-btn")){const r=parseInt(i.target.closest(".work-task-btn").dataset.taskId);r&&(console.log("Opening work tab for task:",r),Ea(r))}})}async function Ea(e){console.log("openWorkTab called with taskId:",e),document.querySelectorAll(".nav-link").forEach(s=>s.classList.remove("active"));const t=document.getElementById("workTab");t&&(t.classList.add("active"),t.style.display="block");try{await F("work"),setTimeout(async()=>{await ue(e)},100)}catch(s){console.error("Error opening work tab:",s),k("Failed to open task","error")}}window.renderTasks=F;window.toggleSidebar=function(){const e=document.getElementById("sidebar"),t=document.getElementById("toggleIcon");e.classList.contains("collapsed")?(e.classList.remove("collapsed"),t.className="fas fa-chevron-left",localStorage.setItem("sidebarCollapsed","false")):(e.classList.add("collapsed"),t.className="fas fa-chevron-right",localStorage.setItem("sidebarCollapsed","true"))};window.showQuickAdd=function(){document.getElementById("sidebar").classList.contains("collapsed")&&toggleSidebar(),setTimeout(()=>{var t;(t=document.getElementById("quickTaskTitle"))==null||t.focus()},300)};function La(){const e=document.getElementById("sidebar"),t=document.getElementById("toggleIcon");localStorage.getItem("sidebarCollapsed")==="true"?(e.classList.add("collapsed"),t.className="fas fa-chevron-right"):(e.classList.remove("collapsed"),t.className="fas fa-chevron-left")}function Ba(){var t,s,o;const e=document.getElementById("quickTaskDue");if(e){const a=new Date;a.setDate(a.getDate()+7),e.value=a.toISOString().split("T")[0]}(t=document.getElementById("quickAddBtn"))==null||t.addEventListener("click",async()=>{await $a()}),(s=document.getElementById("expandAddBtn"))==null||s.addEventListener("click",()=>{const a=document.getElementById("expandedAddForm"),n=document.getElementById("expandAddBtn");a.style.display==="none"||!a.style.display?(a.style.display="block",n.innerHTML='<i class="fas fa-chevron-up"></i> Less Options'):(a.style.display="none",n.innerHTML='<i class="fas fa-chevron-down"></i> More Options')}),(o=document.getElementById("quickTaskProject"))==null||o.addEventListener("change",a=>{Ha(a.target.value)})}async function $a(){var a,n,l,i,r,c,d,m;const e=document.getElementById("quickTaskTitle").value.trim(),t=document.getElementById("quickTaskDue").value,s=document.getElementById("quickTaskStatus").value;if(!e||!t){k("Please fill in task title and due date","error");return}const o={title:e,dueOn:t,status:s,text:((a=document.getElementById("quickTaskText"))==null?void 0:a.value)||"",notes:((n=document.getElementById("quickTaskNotes"))==null?void 0:n.value)||"",urgency:((l=document.getElementById("quickTaskUrgency"))==null?void 0:l.value)||"Med",importance:((i=document.getElementById("quickTaskImportance"))==null?void 0:i.value)||"Med",estimate:parseFloat(((r=document.getElementById("quickTaskEstimate"))==null?void 0:r.value)||0),remainingHours:parseFloat(((c=document.getElementById("quickTaskRemaining"))==null?void 0:c.value)||0),projectId:(d=document.getElementById("quickTaskProject"))!=null&&d.value?parseInt(document.getElementById("quickTaskProject").value):null,phaseKey:((m=document.getElementById("quickTaskPhase"))==null?void 0:m.value)||null,categoryLists:Pa(),createdAt:new Date().toISOString()};try{if(await Ve(o,!1)){k("Task added successfully!","success"),document.getElementById("quickTaskTitle").value="",document.getElementById("quickTaskText").value="",document.getElementById("quickTaskNotes").value="",document.getElementById("quickTaskEstimate").value="0",document.getElementById("quickTaskRemaining").value="0";const u=document.getElementById("quickTaskDue");if(u){const f=new Date;f.setDate(f.getDate()+7),u.value=f.toISOString().split("T")[0]}F(ne())}else k("Failed to add task","error")}catch(g){console.error("Error adding task:",g),k("Failed to add task","error")}}function Pa(){const e=document.querySelectorAll(".category-list-checkbox:checked");return Array.from(e).map(t=>t.value)}function Da(){const e=document.getElementById("saveQuickTimeBtn"),t=document.getElementById("quickTimeModal");e==null||e.addEventListener("click",async()=>{const s=parseInt(document.getElementById("quickTimeTaskId").value),o=parseFloat(document.getElementById("quickTimeHours").value),a=document.getElementById("quickTimeDate").value,n=document.getElementById("quickTimeNotes").value.trim();if(!o||o<=0){k("Please enter a valid number of hours","error");return}if(!a){k("Please select a date","error");return}const l={taskId:s,hours:o,dateLogged:a,notes:n||`Custom log: ${o}h`,categoryKey:null};if(!await Ee(l))return;const c=(await W({},!0)).find(g=>g.id===s);if(c&&c.remainingHours!==null&&c.remainingHours!==void 0){const g=qe(Math.max(0,c.remainingHours-o));await Ye(s,g,`Auto-decremented by ${o}h time log`)}k(`${o}h logged successfully!`,"success"),bootstrap.Modal.getInstance(t).hide();const m=ne();if(m==="board"){const g=document.getElementById("taskList"),u=z();await q(g,u)}else await F(m)})}window.manageCategoryLists=function(){const e=document.getElementById("expandedAddForm"),t=document.getElementById("expandAddBtn");(e.style.display==="none"||!e.style.display)&&t.click(),setTimeout(()=>{const s=document.getElementById("quickTaskCategoryLists");s&&s.scrollIntoView({behavior:"smooth",block:"nearest"})},100)};window.manageProjects=function(){new bootstrap.Modal(document.getElementById("projectsModal")).show()};window.managePhases=function(){new bootstrap.Modal(document.getElementById("phaseListsModal")).show()};window.logQuickTime=async function(e,t){await Re(e,t,async()=>{if(ne()==="board"){const o=document.getElementById("taskList"),a=z();await q(o,a)}})};window.showCustomTimeModal=function(e){const t=new bootstrap.Modal(document.getElementById("quickTimeModal")),s=document.getElementById("quickTimeTaskId"),o=document.getElementById("quickTimeHours"),a=document.getElementById("quickTimeDate"),n=document.getElementById("quickTimeNotes");s.value=e,a.value=O(),o.value="",n.value="",t._element.addEventListener("shown.bs.modal",()=>{o.focus()},{once:!0}),t.show()};async function Ca(){const e=document.getElementById("globalProjectFilter");if(e){const s=await le();e.innerHTML='<option value="">All Projects</option>',s.forEach(a=>{e.innerHTML+=`<option value="${a.id}">${a.name}</option>`});const o=localStorage.getItem("globalProjectFilter");o&&(e.value=o)}const t=document.getElementById("globalPhaseFilter");if(t){const s=await re();t.innerHTML='<option value="">All Phases</option>',s.forEach(a=>{a.phases&&a.phases.forEach(n=>{t.innerHTML+=`<option value="${n.slug}">${a.title}: ${n.title}</option>`})});const o=localStorage.getItem("globalPhaseFilter");o&&(t.value=o)}}async function Ma(){const e=document.getElementById("quickTaskProject");if(e){const s=await le();e.innerHTML='<option value="">No Project (AdHoc)</option>',s.forEach(o=>{e.innerHTML+=`<option value="${o.id}">${o.name}</option>`})}const t=document.getElementById("quickTaskPhase");t&&(t.innerHTML='<option value="">No Phase</option>'),await Aa()}async function Aa(){const e=document.getElementById("quickTaskCategoryLists");if(!e)return;const t=await Se();if(t.length===0){e.innerHTML='<div class="text-muted small">No category lists available</div>';return}e.innerHTML=t.map(s=>`
    <div class="form-check">
      <input class="form-check-input category-list-checkbox" type="checkbox" value="${s.slug}" id="catList_${s.slug}">
      <label class="form-check-label" for="catList_${s.slug}">
        ${s.title}
      </label>
    </div>
  `).join("")}async function Ha(e){const t=document.getElementById("quickTaskPhase");if(!t||(t.innerHTML='<option value="">No Phase</option>',!e))return;const o=(await le()).find(l=>l.id===parseInt(e));if(!o||!o.phaseListId)return;const n=(await re()).find(l=>l.id===o.phaseListId);!n||!n.phases||n.phases.length===0||n.phases.forEach(l=>{t.innerHTML+=`<option value="${l.slug}">${l.title}</option>`})}function xa(){const e=document.getElementById("modalTodoTitleInput"),t=document.getElementById("modalTodoAddBtn"),s=document.getElementById("modalShowCompletedTodos"),o=document.getElementById("modalCancelTodoDetails"),a=document.getElementById("modalSubmitTodoWithDetails");e&&e.addEventListener("keypress",l=>{l.key==="Enter"&&(l.shiftKey?nt():at()?Ce():it())}),t&&t.addEventListener("click",l=>{l.preventDefault(),document.getElementById("modalTodoTitleInput").value.trim()?at()?Ce():it():nt()}),s&&s.addEventListener("change",ee),o&&o.addEventListener("click",Mt),a&&a.addEventListener("click",Ce);const n=document.getElementById("todoListModal");n&&n.addEventListener("show.bs.modal",function(){ee(),setTimeout(()=>e==null?void 0:e.focus(),100)})}function at(){const e=document.getElementById("modalTodoDetailsInput"),t=document.querySelector("#modalTodoDetailsInput textarea");return e&&e.style.display!=="none"&&t&&t.value.trim()}function nt(){const e=document.getElementById("modalTodoDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#modalTodoDetailsInput textarea");t&&t.focus()}}function Mt(){const e=document.getElementById("modalTodoDetailsInput"),t=document.querySelector("#modalTodoDetailsInput textarea");e&&(e.style.display="none"),t&&(t.value="")}async function it(){const e=document.getElementById("modalTodoTitleInput"),t=e.value.trim();t&&(await Le(t,""),e.value="",ee(),e.focus())}async function Ce(){const e=document.getElementById("modalTodoTitleInput"),t=document.querySelector("#modalTodoDetailsInput textarea"),s=e.value.trim(),o=t.value.trim();s&&(await Le(s,o),e.value="",t.value="",Mt(),ee(),e.focus())}async function ee(){try{const t=await(await S).getAll("todos"),s=document.getElementById("modalShowCompletedTodos"),o=(s==null?void 0:s.checked)||!1,a=o?t:t.filter(l=>!l.completed);a.sort((l,i)=>l.completed!==i.completed?l.completed?1:-1:new Date(i.createdAt)-new Date(l.createdAt));const n=document.getElementById("modalTodosList");if(!n)return;if(a.length===0){n.innerHTML=o?'<p class="text-muted text-center">No todos yet. Add one to get started!</p>':'<p class="text-muted text-center">No active todos. Add one to get started!</p>';return}n.innerHTML=a.map(l=>`
      <div class="todo-item ${l.completed?"completed":""}" data-todo-id="${l.id}">
        <input type="checkbox" class="form-check-input todo-checkbox" 
               ${l.completed?"checked":""} 
               data-todo-id="${l.id}">
        <div class="todo-content">
          <div class="todo-title">${l.title}</div>
          ${l.content?`<p class="todo-text">${l.content}</p>`:""}
          ${l.completed&&l.completedAt?`<small class="text-muted">Completed: ${new Date(l.completedAt).toLocaleDateString()}</small>`:`<small class="text-muted">Created: ${new Date(l.createdAt).toLocaleDateString()}</small>`}
        </div>
        <div class="todo-actions ms-auto">
          <button class="btn btn-sm btn-outline-danger delete-btn" data-todo-id="${l.id}" title="Delete todo">
            <i class="fas fa-trash"></i>
          </button>
          <div class="delete-confirmation d-none">
            <span class="me-2">Delete this todo?</span>
            <button class="btn btn-danger btn-sm me-1 confirm-delete-btn" data-todo-id="${l.id}">
              <i class="fas fa-check me-1"></i>Yes
            </button>
            <button class="btn btn-outline-secondary btn-sm cancel-delete-btn" data-todo-id="${l.id}">
              <i class="fas fa-times me-1"></i>Cancel
            </button>
          </div>
        </div>
      </div>
    `).join(""),n.querySelectorAll(".todo-checkbox").forEach(l=>{l.addEventListener("change",async i=>{const r=parseInt(i.target.dataset.todoId);await Ra(r)})}),n.querySelectorAll(".delete-btn").forEach(l=>{l.addEventListener("click",i=>{const r=parseInt(i.currentTarget.dataset.todoId);Oa(r)})}),n.querySelectorAll(".confirm-delete-btn").forEach(l=>{l.addEventListener("click",async i=>{const r=parseInt(i.currentTarget.dataset.todoId);await Wa(r)})}),n.querySelectorAll(".cancel-delete-btn").forEach(l=>{l.addEventListener("click",i=>{const r=parseInt(i.currentTarget.dataset.todoId);Fa(r)})})}catch(e){console.error("Error loading modal todos:",e)}}async function Ra(e){try{const t=await S,s=await t.get("todos",e);if(!s)return;s.completed=!s.completed,s.completedAt=s.completed?new Date().toISOString():null,await t.put("todos",s),await ee()}catch(t){console.error("Error toggling todo:",t),k("Failed to update todo","error")}}function Oa(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-btn"),o=t.querySelector(".delete-confirmation");s.classList.add("d-none"),o.classList.remove("d-none"),t.classList.add("deleting")}function Fa(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-btn"),o=t.querySelector(".delete-confirmation");s.classList.remove("d-none"),o.classList.add("d-none"),t.classList.remove("deleting")}async function Wa(e){try{await(await S).delete("todos",e),await ee(),k("Todo deleted","success")}catch(t){console.error("Error deleting todo:",t),k("Failed to delete todo","error")}}let U=null;function ja(){const e=document.getElementById("phaseListsModal");pe(),document.getElementById("newPhaseListBtn").addEventListener("click",()=>{At()}),document.getElementById("phaseListForm").addEventListener("submit",async t=>{t.preventDefault(),await za()}),document.getElementById("cancelPhaseListBtn").addEventListener("click",()=>{Oe()}),document.getElementById("deletePhaseListBtn").addEventListener("click",async()=>{if(U&&confirm(`Are you sure you want to delete "${U.title}"?

This will permanently delete the phase list and all its phases.`))try{await Zt(U.id),Oe(),pe(),k("Phase list deleted","success")}catch(t){console.error("Error deleting phase list:",t),k("Failed to delete phase list","error")}}),document.getElementById("addPhaseBtn").addEventListener("click",()=>{qa()}),document.getElementById("phaseListTitle").addEventListener("input",t=>{const s=we(t.target.value);document.getElementById("phaseListSlugPreview").textContent=s||"(auto-generated)"}),e&&(e.addEventListener("show.bs.modal",function(){pe(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}function we(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function pe(){const e=document.getElementById("phaseListsContainer"),t=await re();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-layer-group fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No phase lists yet.<br>Create your first list!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>{var o;return`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-list-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.title}</div>
        <small class="text-muted">${((o=s.phases)==null?void 0:o.length)||0} phases</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `}).join(""),e.querySelectorAll("[data-list-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.listId),a=t.find(n=>n.id===o);a&&At(a)})})}function At(e=null){U=e,document.getElementById("phaseListPlaceholder").style.display="none",document.getElementById("phaseListEditor").style.display="block",e?(document.getElementById("phaseListTitle").value=e.title,document.getElementById("phaseListDescription").value=e.description||"",document.getElementById("phaseListSlugPreview").textContent=e.slug,document.getElementById("deletePhaseListBtn").style.display="inline-block",Te(e.phases||[])):(document.getElementById("phaseListTitle").value="",document.getElementById("phaseListDescription").value="",document.getElementById("phaseListSlugPreview").textContent="(auto-generated)",document.getElementById("deletePhaseListBtn").style.display="none",Te([]))}function Oe(){U=null,document.getElementById("phaseListEditor").style.display="none",document.getElementById("phaseListPlaceholder").style.display="block",document.getElementById("phaseListForm").reset()}function Te(e){const t=document.getElementById("phasesContainer");if(e.length===0){t.innerHTML=`
      <div class="text-muted text-center py-3">
        <i class="fas fa-layer-group fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No phases yet.<br>Click "Add Phase" to get started!</p>
      </div>
    `;return}t.innerHTML=e.map((s,o)=>`
    <div class="d-flex align-items-center mb-2 phase-item">
      <input type="text" class="form-control phase-title" value="${s.title}" placeholder="Phase name" data-phase-index="${o}">
      <small class="text-muted ms-2 me-2">Slug: <span class="phase-slug">${s.slug||"(auto-generated)"}</span></small>
      <button type="button" class="btn btn-outline-danger btn-sm ms-2" data-remove-phase="${o}">
        <i class="fas fa-trash"></i>
      </button>
    </div>
  `).join(""),t.querySelectorAll(".phase-title").forEach(s=>{s.addEventListener("input",o=>{const a=o.target.parentElement.querySelector(".phase-slug"),n=we(o.target.value);a.textContent=n||"(auto-generated)"})}),t.querySelectorAll("[data-remove-phase]").forEach(s=>{s.addEventListener("click",o=>{const a=parseInt(o.currentTarget.dataset.removePhase);Na(a)})})}function qa(){const e=Qe();e.push({title:"",slug:""}),Te(e);const s=document.getElementById("phasesContainer").querySelectorAll(".phase-title");s.length>0&&s[s.length-1].focus()}function Na(e){const t=Qe();t.splice(e,1),Te(t)}function Qe(){const t=document.getElementById("phasesContainer").querySelectorAll(".phase-title"),s=document.getElementById("phaseListTitle").value.trim(),o=we(s);return Array.from(t).map(a=>({title:a.value.trim(),slug:`${o}.${we(a.value.trim())}`})).filter(a=>a.title)}async function za(){const e=document.getElementById("phaseListTitle").value.trim(),t=document.getElementById("phaseListDescription").value.trim(),s=Qe();if(!e){k("Phase list title is required","error");return}for(const a of s)if(!a.title){k("All phases must have a title","error");return}const o={title:e,description:t,phases:s};U&&(o.id=U.id,o.slug=U.slug);try{await Jt(o),Oe(),pe(),k("Phase list saved","success")}catch(a){console.error("Error saving phase list:",a),k("Failed to save phase list","error")}}let V=null;function Ua(){const e=document.getElementById("categoryListsModal");ye(),document.getElementById("newCategoryListBtn").addEventListener("click",()=>{Ht()}),document.getElementById("categoryListForm").addEventListener("submit",async t=>{t.preventDefault(),await Ya()}),document.getElementById("cancelCategoryListBtn").addEventListener("click",()=>{Fe()}),document.getElementById("deleteCategoryListBtn").addEventListener("click",async()=>{if(V&&confirm(`Are you sure you want to delete "${V.title}"?

This will permanently delete the category list and all its categories.`))try{await mt(V.id),Fe(),ye(),k("Category list deleted","success")}catch(t){console.error("Error deleting category list:",t),k("Failed to delete category list","error")}}),document.getElementById("addCategoryBtn").addEventListener("click",()=>{Va()}),document.getElementById("categoryListTitle").addEventListener("input",t=>{const s=ae(t.target.value);document.getElementById("categoryListSlugPreview").textContent=s||"(auto-generated)"}),e&&(e.addEventListener("show.bs.modal",function(){ye(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}function ae(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function ye(){const e=document.getElementById("categoryListsContainer"),t=await Se();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-tags fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No category lists yet.<br>Create your first list!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>{var o;return`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-list-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.title}</div>
        <small class="text-muted">${((o=s.categories)==null?void 0:o.length)||0} categories</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `}).join(""),e.querySelectorAll("[data-list-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.listId),a=t.find(n=>n.id===o);a&&Ht(a)})})}function Ht(e=null){V=e,document.getElementById("categoryListPlaceholder").style.display="none",document.getElementById("categoryListEditor").style.display="block",e?(document.getElementById("categoryListTitle").value=e.title,document.getElementById("categoryListDescription").value=e.description||"",document.getElementById("categoryListSlugPreview").textContent=e.slug,document.getElementById("deleteCategoryListBtn").style.display="inline-block",Ie(e.categories||[])):(document.getElementById("categoryListForm").reset(),document.getElementById("categoryListSlugPreview").textContent="(auto-generated)",document.getElementById("deleteCategoryListBtn").style.display="none",Ie([]))}function Fe(){V=null,document.getElementById("categoryListEditor").style.display="none",document.getElementById("categoryListPlaceholder").style.display="block"}function Ie(e){const t=document.getElementById("categoriesContainer");if(e.length===0){t.innerHTML=`
      <div class="text-muted text-center py-3">
        <i class="fas fa-tag opacity-50 mb-2"></i>
        <p class="small mb-0">No categories yet. Add some below!</p>
      </div>
    `;return}t.innerHTML=e.map((s,o)=>`
    <div class="category-item d-flex align-items-center gap-2 mb-2 p-2 border rounded" data-index="${o}">
      <div class="drag-handle text-muted" style="cursor: grab;">
        <i class="fas fa-grip-vertical"></i>
      </div>
      <div class="flex-grow-1">
        <input type="text" class="form-control form-control-sm category-title" 
               value="${s.title}" placeholder="Category name" required>
        <small class="text-muted">Slug: <span class="category-slug">${s.slug}</span></small>
      </div>
      <button type="button" class="btn btn-outline-danger btn-sm remove-category">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `).join(""),t.querySelectorAll(".category-title").forEach(s=>{s.addEventListener("input",o=>{const a=ae(o.target.value),n=o.target.parentElement.querySelector(".category-slug");n.textContent=a||"(auto-generated)"})}),t.querySelectorAll(".remove-category").forEach(s=>{s.addEventListener("click",o=>{o.target.closest(".category-item").remove(),t.children.length===0&&Ie([])})})}function Va(){const e=document.getElementById("categoriesContainer");e.querySelector(".text-muted.text-center")&&(e.innerHTML="");const s=e.children.length,o=document.createElement("div");o.className="category-item d-flex align-items-center gap-2 mb-2 p-2 border rounded",o.dataset.index=s,o.innerHTML=`
    <div class="drag-handle text-muted" style="cursor: grab;">
      <i class="fas fa-grip-vertical"></i>
    </div>
    <div class="flex-grow-1">
      <input type="text" class="form-control form-control-sm category-title" 
             placeholder="Category name" required>
      <small class="text-muted">Slug: <span class="category-slug">(auto-generated)</span></small>
    </div>
    <button type="button" class="btn btn-outline-danger btn-sm remove-category">
      <i class="fas fa-times"></i>
    </button>
  `,e.appendChild(o);const a=o.querySelector(".category-title"),n=o.querySelector(".category-slug"),l=o.querySelector(".remove-category");a.addEventListener("input",i=>{const r=ae(i.target.value);n.textContent=r||"(auto-generated)"}),l.addEventListener("click",()=>{o.remove(),e.children.length===0&&Ie([])}),a.focus()}async function Ya(){const e=document.getElementById("categoryListTitle").value.trim(),t=document.getElementById("categoryListDescription").value.trim();if(!e){k("Please enter a list title","error");return}const s=document.querySelectorAll(".category-item"),o=[];for(const n of s){const i=n.querySelector(".category-title").value.trim();i&&o.push({title:i,slug:`${ae(e)}.${ae(i)}`})}const a={title:e,description:t,categories:o};V&&(a.id=V.id,a.slug=V.slug);try{await ut(a),Fe(),ye(),k("Category list saved","success")}catch(n){console.error("Error saving category list:",n),k("Failed to save category list","error")}}let Q=null;function _a(){const e=document.getElementById("projectsModal");ve(),document.getElementById("newProjectBtn").addEventListener("click",()=>{xt()}),document.getElementById("projectForm").addEventListener("submit",async t=>{t.preventDefault(),await Qa()}),document.getElementById("cancelProjectBtn").addEventListener("click",()=>{We()}),document.getElementById("deleteProjectBtn").addEventListener("click",async()=>{if(Q&&confirm(`Are you sure you want to delete "${Q.name}"?

This will permanently delete the project. Tasks linked to this project will become unassigned.`))try{await Xt(Q.id),We(),ve(),k("Project deleted","success")}catch(t){console.error("Error deleting project:",t),k("Failed to delete project","error")}}),e&&(e.addEventListener("show.bs.modal",function(){ve(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}async function ve(){const e=document.getElementById("projectsContainer"),t=await le();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-project-diagram fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No projects yet.<br>Create your first project!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-project-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.name}</div>
        <small class="text-muted">Status: ${s.status}</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `).join(""),e.querySelectorAll("[data-project-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.projectId),a=t.find(n=>n.id===o);a&&xt(a)})})}async function xt(e=null){Q=e,document.getElementById("projectPlaceholder").style.display="none",document.getElementById("projectEditor").style.display="block",await Ga("projectPhaseList",e==null?void 0:e.phaseListId),e?(document.getElementById("projectName").value=e.name,document.getElementById("projectDescription").value=e.description||"",document.getElementById("projectStatus").value=e.status||"Ready",document.getElementById("deleteProjectBtn").style.display="inline-block"):(document.getElementById("projectName").value="",document.getElementById("projectDescription").value="",document.getElementById("projectStatus").value="Ready",document.getElementById("deleteProjectBtn").style.display="none")}function We(){Q=null,document.getElementById("projectEditor").style.display="none",document.getElementById("projectPlaceholder").style.display="block",document.getElementById("projectForm").reset()}async function Ga(e,t=null){const s=document.getElementById(e),o=await re();s.innerHTML='<option value="">No Phase List</option>',o.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=a.title,t&&a.id==t&&(n.selected=!0),s.appendChild(n)})}async function Qa(){const e=document.getElementById("projectName").value.trim(),t=document.getElementById("projectDescription").value.trim(),s=document.getElementById("projectStatus").value;if(!e){k("Project name is required","error");return}const o={name:e,description:t,status:s,phaseListId:document.getElementById("projectPhaseList").value||null};Q&&(o.id=Q.id);try{await Qt(o),We(),ve(),k("Project saved","success")}catch(a){console.error("Error saving project:",a),k("Failed to save project","error")}}async function Xa(){const e=document.getElementById("punchClockBtn"),t=document.getElementById("punchClockText"),s=document.getElementById("primaryPunchBtn"),o=document.getElementById("primaryPunchText");if(!e)return;async function a(){const f=await Z(),h=await ms(),p=await ce();console.log("[Punch Clock] Today session:",p);const b=document.getElementById("timeSlots");if(b&&p){const L=p.activities||[];console.log("[Punch Clock] Activities:",L);const P=O(),M=L.filter(B=>{const D=new Date(B.startTime);return`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}-${String(D.getDate()).padStart(2,"0")}`===P});console.log("[Punch Clock] Today activities:",M),M.length>0?(b.innerHTML=M.map(B=>{const D=new Date(B.startTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),A=B.endTime?new Date(B.endTime).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):"Current",me={work:"Work",lunch:"Lunch Break",meeting:"Meeting",personal:"Personal Time",custom:B.description||"Custom"}[B.category]||B.description||B.category;return`
            <div class="time-slot">
              <span class="time">${D} - ${A}</span>
              <span class="activity">${me}</span>
            </div>
          `}).join(""),console.log("[Punch Clock] Activities HTML updated")):(b.innerHTML='<div class="text-muted small">No activities recorded yet today</div>',console.log("[Punch Clock] No activities for today"))}else b&&(b.innerHTML='<div class="text-muted small">No activities recorded yet</div>',console.log("[Punch Clock] No session or container"));if(f){const L={work:"Working",lunch:"Lunch",meeting:"Meeting",personal:"Personal",custom:(h==null?void 0:h.description)||"Activity"},P=h?L[h.category]||h.description:"Punched In";t.textContent=P,e.classList.remove("btn-outline-primary"),e.classList.add("btn-outline-danger"),s&&o&&(o.textContent="End Work Day",s.classList.remove("btn-primary"),s.classList.add("btn-danger"));const M=document.getElementById("interruptionButtons"),B=document.getElementById("returnToWorkSection"),D=document.getElementById("interruptionButtonsRow");M&&(M.style.display="block"),h&&h.category!=="work"?(B&&(B.style.display="block"),D&&(D.style.display="none")):(B&&(B.style.display="none"),D&&(D.style.display="block"))}else{t.textContent="Punch In",e.classList.remove("btn-outline-danger"),e.classList.add("btn-outline-primary"),s&&o&&(o.textContent="Start Work Day",s.classList.remove("btn-danger"),s.classList.add("btn-primary"));const L=document.getElementById("interruptionButtons");L&&(L.style.display="none")}const y=document.getElementById("totalHours"),w=document.getElementById("workHours"),T=document.getElementById("breakHours"),E=document.getElementById("currentSession");if(p&&p.activities){let L=0,P=0,M=0;for(const A of p.activities)if(A.startTime){const _=new Date(A.startTime),$e=(A.endTime?new Date(A.endTime):new Date)-_;L+=$e,A.category==="work"?P+=$e:M+=$e}let B=0;if(h&&h.startTime){const A=new Date(h.startTime);B=new Date-A}const D=A=>{const _=Math.floor(A/36e5),me=Math.floor(A%(1e3*60*60)/(1e3*60));return`${_}h ${me}m`};y&&(y.textContent=D(L)),w&&(w.textContent=D(P)),T&&(T.textContent=D(M)),E&&(E.textContent=D(B))}else y&&(y.textContent="0h 0m"),w&&(w.textContent="0h 0m"),T&&(T.textContent="0h 0m"),E&&(E.textContent="0h 0m")}async function n(){if(await Z()){const p=await ds();p?k(`Punched Out! Total: ${p.totalHours}h`,"success"):k("Failed to punch out","error")}else await cs()?k("Punched In! Good luck! 🚀","success"):k("Failed to punch in","error");await a();const h=bootstrap.Modal.getInstance(document.getElementById("punchClockModal"));h&&h.hide(),ne()==="today"&&await F("today")}async function l(f,h){await us(f,h)?k({lunch:"Enjoy your lunch break! 🍽️",meeting:"Meeting time - make it productive! 🤝",personal:"Taking care of personal matters. ⏰",work:"Back to work! Let's be productive! 💼"}[f]||`${h} activity started.`,"info"):k("Failed to record activity","error"),await a()}e.addEventListener("click",async()=>{await a()}),s&&s.addEventListener("click",n);const i=document.getElementById("lunchBtn"),r=document.getElementById("meetingBtn"),c=document.getElementById("personalBtn"),d=document.getElementById("returnToWorkBtn"),m=document.getElementById("addCustomInterruptionBtn"),g=document.getElementById("customInterruptionInput");if(i&&i.addEventListener("click",()=>l("lunch","Lunch Break")),r&&r.addEventListener("click",()=>l("meeting","Meeting")),c&&c.addEventListener("click",()=>l("personal","Personal Time")),d&&d.addEventListener("click",()=>l("work","Work Time")),m&&g){const f=async()=>{const h=g.value.trim();if(!h){k("Please enter a description for the interruption.","warning"),g.focus();return}await l("custom",h),g.value=""};m.addEventListener("click",f),g.addEventListener("keypress",h=>{h.key==="Enter"&&f()})}const u=document.getElementById("punchClockModal");u&&u.addEventListener("shown.bs.modal",async()=>{await a()}),await a()}function Ka(){const e=document.getElementById("activeRocketIndicator"),t=document.getElementById("spaceportTab"),s=document.getElementById("activeRocketTaskName"),o=document.getElementById("activeRocketTime");if(!e||!t){console.warn("[ActiveRocket] Could not find indicator or spaceport tab elements");return}console.log("[ActiveRocket] Initializing header indicator");let a=null;function n(){const l=C();if(console.log("[ActiveRocket] Updating indicator, session:",l),!l||!l.activeRocket){console.log("[ActiveRocket] No active rocket, hiding indicator"),e.style.display="none",a&&(clearInterval(a),a=null);return}const i=l.rockets.get(l.activeRocket);if(console.log("[ActiveRocket] Active rocket data:",i),!i||!i.isActive){console.log("[ActiveRocket] Rocket not found or not active, hiding indicator"),e.style.display="none",a&&(clearInterval(a),a=null);return}console.log("[ActiveRocket] Showing indicator for:",i.taskTitle),e.style.display="flex",s.textContent=i.taskTitle;const r=i.totalTime||0,c=Date.now()-i.startTime,d=r+c,m=Math.floor(d/1e3),g=Math.floor(m/3600),u=Math.floor(m%3600/60),f=m%60;g>0?o.textContent=`${g}:${u.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`:o.textContent=`${u}:${f.toString().padStart(2,"0")}`,a||(a=setInterval(n,1e3))}e.addEventListener("click",()=>{const l=document.getElementById("spaceportTab");l&&l.click()}),I.on("spaceport:rocketLaunched",()=>{console.log("[ActiveRocket] Received rocketLaunched event"),n()}),I.on("spaceport:rocketLanded",()=>{console.log("[ActiveRocket] Received rocketLanded event"),n()}),I.on("spaceport:rocketDeployed",()=>{console.log("[ActiveRocket] Received rocketDeployed event"),n()}),console.log("[ActiveRocket] Running initial update"),n()}function Ja(){const e=document.getElementById("toggleExpandableBtn"),t=document.getElementById("expandableActions");if(!e||!t){console.warn("Header expandable actions elements not found");return}e.addEventListener("click",()=>{const s=t.style.display!=="none";t.style.display=s?"none":"flex";const o=e.querySelector("i");o&&(o.className=s?"fas fa-ellipsis-v":"fas fa-times")}),document.addEventListener("click",s=>{if(!e.contains(s.target)&&!t.contains(s.target)&&t.style.display==="flex"){t.style.display="none";const o=e.querySelector("i");o&&(o.className="fas fa-ellipsis-v")}})}async function Za(){console.log("🚀 Initializing Task Time Tracker..."),La(),Ia(),Sa(),Ba(),Da(),xa(),Ua(),_a(),ja(),await Xa(),Ka(),Ja(),It(),await Ca(),await Ma(),await F("board"),console.log("✅ App initialized successfully!")}document.addEventListener("DOMContentLoaded",function(){Za()});</script>
  <style rel="stylesheet" crossorigin>#spaceportView{display:none;height:calc(100vh - 200px);background:linear-gradient(to bottom,#0a0a1a,#1a1a2e 70%,#16213e);border-radius:15px;position:relative;overflow:hidden;box-shadow:inset 0 0 50px #6496ff1a}#spaceportCanvas{width:100%;height:100%;cursor:pointer;background:radial-gradient(ellipse at 50% 100%,rgba(100,150,255,.05) 0%,transparent 50%)}.mission-control{position:absolute;bottom:20px;right:20px;z-index:10;display:flex;flex-direction:column;gap:10px;max-width:250px;opacity:.7}.control-panel{background:#00142899;padding:10px;border-radius:8px;border:1px solid rgba(100,150,255,.2);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:0 0 10px #6496ff1a;font-size:.85rem}.control-panel h6{color:#64d6ff;margin-bottom:10px;font-family:Courier New,monospace;font-size:.9rem;text-transform:uppercase;letter-spacing:1px}.mission-list{max-height:200px;overflow-y:auto}.mission-item{background:#6496ff0d;border:1px solid rgba(100,150,255,.15);border-radius:4px;padding:6px 8px;margin:3px 0;cursor:pointer;transition:all .2s ease;font-size:.75rem;color:#fffc}.mission-item:hover{background:#6496ff26;border-color:#64d6ff80;color:#fff}.mission-item.active{background:#64ff6433;border-color:#64ff64;box-shadow:0 0 15px #64ff6466}.rocket-control-form{font-family:Courier New,monospace}.rocket-control-form button:hover{transform:translateY(-1px);box-shadow:0 2px 8px #0000004d}.rocket-control-form button:active{transform:translateY(0)}.launch-controls{display:none;margin-top:15px;padding:10px;background:#ff64641a;border:1px solid rgba(255,100,100,.3);border-radius:5px}.launch-controls.active{display:block}.launch-btn{background:linear-gradient(45deg,#f44,#f66);border:none;color:#fff;padding:10px 20px;border-radius:20px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:1px;font-size:.9rem;box-shadow:0 4px 15px #ff44444d;transition:all .3s ease;width:100%}.launch-btn:hover{background:linear-gradient(45deg,#f66,#f88);box-shadow:0 6px 20px #ff444480;transform:translateY(-2px)}.spaceport-stats{position:absolute;top:20px;right:20px;background:#001428e6;padding:15px;border-radius:10px;border:2px solid rgba(100,150,255,.3);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#fff;min-width:200px;font-family:Courier New,monospace}.spaceport-stats h6{color:#64d6ff;margin-bottom:10px;font-size:.9rem;text-transform:uppercase;letter-spacing:1px}.stat-row{display:flex;justify-content:space-between;margin-bottom:5px;font-size:.8rem}.stat-value{color:#64ff64;font-weight:700}.punch-controls{position:absolute;bottom:30px;left:50%;transform:translate(-50%);display:flex;gap:15px;align-items:center}.punch-status-display{background:#001428e6;padding:10px 20px;border-radius:25px;border:2px solid rgba(100,150,255,.3);color:#64d6ff;font-family:Courier New,monospace;font-size:.9rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.punch-status-display.operational{border-color:#64ff64;color:#64ff64;box-shadow:0 0 20px #64ff644d}.punch-btn{background:linear-gradient(45deg,#44f,#66f);border:none;color:#fff;padding:12px 25px;border-radius:25px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:1px;font-size:.9rem;box-shadow:0 4px 15px #4444ff4d;transition:all .3s ease}.punch-btn:hover{background:linear-gradient(45deg,#66f,#88f);box-shadow:0 6px 20px #4444ff80;transform:translateY(-2px)}.punch-btn.operational{background:linear-gradient(45deg,#f44,#f66);box-shadow:0 4px 15px #ff44444d}.punch-btn.operational:hover{background:linear-gradient(45deg,#f66,#f88);box-shadow:0 6px 20px #ff444480}.rocket-form-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#001428f2;border:2px solid rgba(100,150,255,.4);border-radius:15px;padding:20px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:0 10px 30px #00000080;color:#fff;font-family:Courier New,monospace;min-width:300px;z-index:1000}.rocket-form-title{color:#64d6ff;text-align:center;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;font-size:1.1rem}.rocket-form-buttons{display:flex;gap:10px;margin-top:15px}.rocket-form-buttons button{flex:1;padding:8px 15px;border:1px solid rgba(100,150,255,.3);border-radius:5px;background:#6496ff1a;color:#64d6ff;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;text-transform:uppercase;font-size:.8rem}.rocket-form-buttons button:hover{background:#6496ff33;border-color:#6496ff80}.rocket-form-buttons .btn-danger{background:#ff64641a;border-color:#ff64644d;color:#ff6464}.rocket-form-buttons .btn-danger:hover{background:#ff646433;border-color:#ff646480}.rocket-form-buttons .btn-success{background:#64ff641a;border-color:#64ff644d;color:#64ff64}.rocket-form-buttons .btn-success:hover{background:#64ff6433;border-color:#64ff6480}.category-selector-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#001428f2;border:2px solid rgba(100,150,255,.4);border-radius:15px;padding:25px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:0 10px 30px #00000080;color:#fff;font-family:Courier New,monospace;min-width:350px;max-width:400px;z-index:1001}.category-list{max-height:250px;overflow-y:auto;margin:15px 0}.category-option{background:#6496ff0d;border:1px solid rgba(100,150,255,.15);border-radius:5px;padding:10px;margin:5px 0;cursor:pointer;transition:all .2s ease;font-size:.85rem}.category-option:hover{background:#6496ff26;border-color:#64d6ff80}.category-option-title{color:#64d6ff;font-weight:700;margin-bottom:5px}.category-option-time{color:#64ff64;font-size:.75rem}.spaceship-picker{margin:10px 0}.spaceship-picker-header{display:flex;align-items:center;justify-content:space-between;gap:8px;background:#6496ff1a;border:1px solid rgba(100,150,255,.3);border-radius:6px;padding:8px 10px;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;font-size:.75rem;color:#64d6ff}.spaceship-picker-header:hover{background:#6496ff33;border-color:#64d6ff80}.spaceship-current{flex:1;text-align:center;color:#aaa;font-style:italic}.spaceship-toggle-icon{color:#64d6ff;font-size:.7rem;transition:transform .2s ease}.spaceship-picker.expanded .spaceship-toggle-icon{transform:rotate(180deg)}.spaceship-options{display:flex;flex-direction:column;gap:6px;margin-top:6px;max-height:0;overflow:hidden;transition:max-height .3s ease}.spaceship-picker.expanded .spaceship-options{max-height:250px;overflow-y:auto}.spaceship-options::-webkit-scrollbar{width:6px}.spaceship-options::-webkit-scrollbar-track{background:#6496ff0d;border-radius:3px}.spaceship-options::-webkit-scrollbar-thumb{background:#6496ff4d;border-radius:3px}.spaceship-options::-webkit-scrollbar-thumb:hover{background:#64d6ff80}.spaceship-btn{display:flex;align-items:center;gap:8px;background:#6496ff0d;border:1px solid rgba(100,150,255,.2);border-radius:6px;padding:6px 10px;color:#aaa;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;font-size:.75rem}.spaceship-btn:hover{background:#6496ff26;border-color:#64d6ff66;color:#64d6ff}.spaceship-btn.selected{background:#64d6ff33;border-color:#64d6ff99;color:#64d6ff;box-shadow:0 0 10px #64d6ff4d}.spaceship-icon{font-size:1.2rem;min-width:20px;text-align:center}.spaceship-name{flex:1;text-align:left}.summary-card{background-color:#e9ecef;margin-bottom:.75rem!important}.summary-card p{margin-bottom:0;font-size:.9rem;color:#495057}.calendar-table td{height:100px;border:1px solid #dee2e6}.task-event{background-color:#007bff;color:#fff;padding:2px 5px;margin:2px;border-radius:3px;cursor:pointer}.editing{background-color:#fff3cd;border:1px solid #ffeaa7}.sidebar{width:320px;background-color:#f8f9fa;border-right:1px solid #dee2e6;padding:1rem;flex-shrink:0;transition:width .3s ease,padding .3s ease;overflow-x:hidden;position:relative}.sidebar-toggle{position:absolute;top:1rem;right:.5rem;background:#6c757d;color:#fff;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.8rem;z-index:10;transition:all .2s ease}.sidebar-toggle:hover{background:#495057;transform:scale(1.1)}.sidebar-nav-item{padding:.75rem;border-radius:.375rem;background:#fff;border:1px solid #dee2e6;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.75rem;text-decoration:none;color:#495057}.sidebar-nav-item:hover{background:#e9ecef;border-color:#adb5bd;text-decoration:none;color:#343a40}.sidebar-nav-item.active{background:#007bff;border-color:#007bff;color:#fff}.sidebar-nav-item i{width:16px;text-align:center;flex-shrink:0}#categoryListsBadgeContainer{display:flex;flex-wrap:wrap;gap:.375rem}.category-list-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;background:#e7f3ff;border:1px solid #b8daff;border-radius:.375rem;font-size:.75rem;color:#0c5aa6;transition:all .2s ease}.category-list-badge:hover{background:#cce7ff;border-color:#9fcdff}.category-list-badge .remove-badge{cursor:pointer;padding:0;border:none;background:none;color:#6c757d;font-size:.7rem;line-height:1;transition:color .2s ease}.category-list-badge .remove-badge:hover{color:#dc3545}.main-content{flex:1;display:flex;flex-direction:column}.header-bar{background-color:#fff;border-bottom:1px solid #dee2e6;padding:.75rem 1.5rem;display:flex;justify-content:space-between;align-items:center}.month-split-view{display:flex;height:calc(100vh - 200px);gap:1.5rem}.board-split-view{display:flex;height:calc(100vh - 200px);gap:1rem;width:100%;max-width:100vw;overflow:hidden;box-sizing:border-box}.board-kanban-pane{flex:1;min-width:0;overflow-x:auto;overflow-y:hidden;width:0}.board-task-detail-pane{width:320px;flex-shrink:0;background:#f8f9fa;border:1px solid #dee2e6;border-radius:.5rem;padding:1rem;overflow-y:auto}.board-task-detail-header{border-bottom:1px solid #dee2e6;padding-bottom:1rem;margin-bottom:1.5rem}.board-task-title{font-size:1.25rem;font-weight:600;margin-bottom:.5rem;color:#212529}.board-task-status-badges{display:flex;gap:.5rem;flex-wrap:wrap}.board-task-section{margin-bottom:1.5rem}.board-task-section-title{font-size:.9rem;font-weight:600;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;margin-bottom:.75rem}.board-task-metrics{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.board-task-metric{background:#fff;padding:.75rem;border-radius:.375rem;border:1px solid #e9ecef}.board-task-metric-label{font-size:.8rem;color:#6c757d;margin-bottom:.25rem}.board-task-metric-value{font-size:1.1rem;font-weight:600;color:#212529}.board-task-description{background:#fff;padding:1rem;border-radius:.375rem;border:1px solid #e9ecef;max-height:200px;overflow-y:auto;white-space:pre-wrap;line-height:1.5}.board-task-empty-state{text-align:center;color:#6c757d;padding:3rem 1rem}.burndown-chart-container{background:#f8f9fa;border:1px solid #dee2e6;border-radius:.375rem;padding:1rem;margin-bottom:1rem}.burndown-chart{width:100%;height:150px;position:relative;background:linear-gradient(to bottom,#fff,#f8f9fa);border:1px solid #e9ecef;border-radius:.25rem}.burndown-line{stroke:#0d6efd;stroke-width:2;fill:none}.burndown-point{fill:#0d6efd;stroke:#fff;stroke-width:2}.burndown-axis{stroke:#dee2e6;stroke-width:1}.burndown-label{font-size:.75rem;fill:#6c757d}.board-task-edit-btn{width:100%;margin-top:1.5rem}.kanban-card.selected-task{box-shadow:0 0 0 2px #007bff;transform:scale(1.02)}.status-history-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:#fff;border-radius:.25rem;margin-bottom:.5rem;border:1px solid #e9ecef}.status-badge{font-size:.75rem;padding:.25rem .5rem}.status-badge.status-completed{background-color:#28a745}.status-badge.status-abandoned{background-color:#dc3545}.status-badge.status-archived{background-color:#6c757d}.status-badge.status-inprogress{background-color:#007bff}.status-badge.status-blocked{background-color:#dc3545}.status-badge.status-backburner{background-color:#ffc107;color:#212529}.status-badge.status-onhold{background-color:#17a2b8}.status-badge.status-ready{background-color:#28a745}.status-badge.status-estimated{background-color:#17a2b8}@media (max-width: 1400px){.board-task-detail-pane{width:280px;padding:.75rem}}@media (max-width: 1200px){.board-task-detail-pane{width:260px;padding:.75rem}}@media (max-width: 992px){.board-split-view{flex-direction:column;height:auto;overflow:visible}.board-kanban-pane{flex:none;margin-bottom:1rem;overflow-x:auto;overflow-y:visible}.board-task-detail-pane{width:100%;flex:none;max-height:400px}.kanban-lane{min-width:220px}}.month-calendar-pane{flex:1;min-width:0}.month-details-pane{width:350px;flex-shrink:0;background:#f8f9fa;border:1px solid #dee2e6;border-radius:.5rem;padding:1.5rem;overflow-y:auto}.calendar-table-container{position:relative}.week-selector{position:absolute;left:-30px;width:25px;height:100%;cursor:pointer;border-radius:.25rem;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.week-selector:hover{background-color:#e9ecef}.week-selector.selected{background-color:#007bff}.week-selector.selected:before{content:"";position:absolute;right:-5px;width:3px;height:80%;background-color:#007bff;border-radius:2px}.calendar-day.selected-day{background-color:#007bff!important;color:#fff}.calendar-day.selected-day .calendar-day-number{color:#fff}.month-details-header{border-bottom:2px solid #dee2e6;padding-bottom:1rem;margin-bottom:1.5rem}@media (max-width: 768px){.month-split-view{flex-direction:column;height:auto}.month-details-pane{width:100%;max-height:400px}}.stat-card{text-align:center;padding:.75rem;border-radius:.375rem;min-height:60px;display:flex;flex-direction:column;justify-content:center}.stat-value{font-size:1.25rem;font-weight:700;line-height:1}.stat-label{font-size:.75rem;opacity:.9;margin-top:.25rem}.day-summary{padding:.75rem;border:1px solid #dee2e6;border-radius:.375rem;margin-bottom:.5rem;cursor:pointer;transition:all .2s ease}.day-summary:hover{background-color:#f8f9fa;border-color:#007bff}.day-summary.today{border-color:#007bff;background-color:#007bff0d}.day-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.work-indicator{color:#28a745;font-size:1.2rem}.day-stats{display:flex;gap:.25rem;flex-wrap:wrap}.day-stats .badge{font-size:.7rem}.work-session-card{padding:1rem;border:1px solid #dee2e6;border-radius:.375rem;background-color:#f8f9fa}.work-details{font-size:.9rem}.work-details>div{margin-bottom:.25rem}.task-card{padding:.75rem;border:1px solid;border-radius:.375rem;margin-bottom:.5rem;background-color:#fff}.task-title{font-weight:500;margin-bottom:.5rem}.task-meta{display:flex;gap:.5rem}.day-badge{font-size:.65rem;padding:.2rem .4rem;border-radius:.25rem;margin:.1rem}.day-badge.tasks{background-color:#007bff;color:#fff}.day-badge.hours{background-color:#28a745;color:#fff}.day-badge.work{background-color:#ffc107;color:#212529;font-weight:700}.project-badge{font-size:.65rem;padding:2px 6px;border-radius:3px;margin:1px 2px 1px 0;display:inline-block;font-weight:600;background:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.phase-badge{font-size:.65rem;padding:2px 6px;border-radius:3px;margin:1px 2px 1px 0;display:inline-block;font-weight:500;background:#f3e5f5;color:#7b1fa2;border:1px solid #e1bee7}.badge-container{margin-bottom:4px;line-height:1.2}.global-filters{display:flex;align-items:center;gap:12px;opacity:.7;transition:opacity .2s ease}.global-filters:hover{opacity:1}.global-filters select{background:linear-gradient(135deg,#ffffffe6,#f8f9fae6);border:1px solid rgba(206,212,218,.6);border-radius:4px;padding:2px 8px;font-size:.8rem;color:#495057;min-width:100px;transition:all .2s ease}.global-filters select:focus{opacity:1;border-color:#007bff66;box-shadow:0 0 0 .1rem #007bff1a}.global-filters .filter-clear{background:transparent;border:1px solid rgba(206,212,218,.4);color:#6c757d;border-radius:3px;padding:2px 6px;font-size:.7rem;transition:all .2s ease}.global-filters .filter-clear:hover{background:#dc35451a;border-color:#dc35454d;color:#dc3545}.week-selector-cell{width:60px;padding:0;vertical-align:middle;background-color:#f8f9fa;border-right:2px solid #dee2e6}.clickable-week-header{cursor:pointer;transition:all .2s ease;text-align:center;font-size:.7rem;font-weight:600;color:#6c757d;height:120px;position:relative}.clickable-week-header:hover{background-color:#e9ecef;color:#495057;transform:scale(1.02)}.clickable-week-header.selected-week-header{background-color:#007bff;color:#fff}.week-number{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-90deg);white-space:nowrap}.week-selector{width:12px;height:12px;border:2px solid #007bff;border-radius:50%;cursor:pointer;transition:background-color .2s ease}.week-selector:hover{background-color:#007bff4d}.selected-week .week-selector{background-color:#007bff}.week-selector-header{width:30px;text-align:center;color:#6c757d;font-size:.8rem;background-color:#f8f9fa;border-right:2px solid #dee2e6}.week-selector-header i{opacity:.7}.month-header-line{border-bottom:2px solid #e9ecef;padding-bottom:.75rem}.month-summary{flex-shrink:0}.summary-item{min-width:60px}.summary-value{font-size:1.1rem;line-height:1.2}@media (max-width: 992px){.month-summary{display:none!important}}.calendar-filters select:not([value=""]){border-color:#007bff;background-color:#007bff1a}.calendar-filters select:focus{border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.status-ready{background-color:#6c757d;color:#fff}.status-estimated{background-color:#17a2b8;color:#fff}.status-inprogress{background-color:#007bff;color:#fff}.status-blocked{background-color:#dc3545;color:#fff}.status-backburner{background-color:#fd7e14;color:#fff}.status-onhold{background-color:#6f42c1;color:#fff}.status-completed{background-color:#28a745;color:#fff}.status-abandoned{background-color:#6c757d;color:#fff}.status-archived{background-color:#343a40;color:#fff}.calendar-day{position:relative;vertical-align:top;height:120px;min-height:120px;padding:0;border:1px solid #dee2e6;overflow:hidden;cursor:pointer;transition:all .2s ease}.calendar-day-inner{display:flex;flex-direction:column;height:100%;width:100%}.calendar-day.empty-day{background-color:#f8f9fa;cursor:default;pointer-events:none;border-color:#e9ecef}.calendar-day:hover{border-color:#007bff;box-shadow:0 2px 8px #007bff26;transform:translateY(-1px);z-index:2}.calendar-day.empty-day:hover{border-color:#e9ecef;box-shadow:none;transform:none}.calendar-day.selected-day{border-color:#007bff;box-shadow:0 0 0 2px #007bff4d;z-index:3}.calendar-day.today{border-color:#28a745;background-color:#28a7450d}.calendar-day.today:hover{border-color:#28a745;box-shadow:0 2px 8px #28a74533}.calendar-week-row.selected-week{position:relative;z-index:1}.calendar-week-row.selected-week .calendar-day,.calendar-week-row.selected-week .week-selector-cell{box-shadow:inset 0 0 0 3px #007bff;border-radius:.25rem}.calendar-day-header{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-bottom:1px solid #dee2e6;padding:.2rem .4rem;font-size:.75rem;font-weight:600;flex-shrink:0;transition:all .2s ease;display:flex;flex-direction:column;gap:1px;justify-content:space-between}.day-number-row{display:flex;justify-content:space-between;align-items:center}.calendar-day:hover .calendar-day-header{background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-bottom-color:#007bff}.calendar-day.today .calendar-day-header{background:linear-gradient(135deg,#e8f5e8,#c8e6c9);border-bottom-color:#28a745}.calendar-day-content{padding:.5rem;flex:1;overflow:hidden;transition:all .2s ease;display:flex;flex-direction:column;gap:.5rem}.calendar-day:hover .calendar-day-content{background-color:#007bff05}.day-time-summary{display:flex;justify-content:center;align-items:center;padding:.3rem .5rem;background:linear-gradient(90deg,#28a7451f,#1987541f);border-radius:.35rem;border:1px solid rgba(40,167,69,.25);flex-shrink:0}.hours-worked{color:#198754;display:flex;align-items:center;gap:.3rem;font-weight:700;font-size:.75rem}.hours-worked i{font-size:.7rem}.calendar-day:hover .day-time-summary{background:linear-gradient(90deg,#28a7452e,#1987542e);border-color:#28a74559;box-shadow:0 1px 3px #0000001a}.calendar-day.today .day-time-summary{background:linear-gradient(90deg,#28a74533,#19875433);border-color:#28a74566;box-shadow:0 1px 2px #28a74533}.day-work-summary{display:flex;gap:.25rem;font-size:.65rem;color:#495057}.punch-indicator{background:#28a745;color:#fff;padding:.1rem .3rem;border-radius:.2rem;font-size:.6rem}.task-hours{background:#007bff;color:#fff;padding:.1rem .3rem;border-radius:.2rem;font-size:.6rem}.status-badges{display:flex;gap:.2rem;margin-bottom:.3rem;flex-wrap:wrap}.status-badge{padding:.1rem .3rem;border-radius:.25rem;font-size:.6rem;font-weight:500;line-height:1}.task-bars{display:flex;flex-direction:column;gap:.2rem}.task-bar{height:6px;border-radius:2px;position:relative;overflow:hidden;box-shadow:0 1px 2px #0000001a}.task-bar-progress{height:100%;background:#fff6;transition:width .3s ease;border-radius:1px}.task-overflow{color:#6c757d;font-size:.6rem;margin-top:.2rem;text-align:center}.category-time-summary{background:#f8f9fa;border-radius:.5rem;padding:1rem;border:1px solid #e9ecef}.category-summary-grid{display:flex;flex-direction:column;gap:.5rem}.category-summary-item{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:#fff;border-radius:.375rem;border:1px solid #e9ecef}.category-indicator{width:12px;height:12px;border-radius:50%;flex-shrink:0}.category-info{flex:1}.category-name{font-weight:600;font-size:.9rem;color:#495057}.category-stats{font-size:.8rem;color:#6c757d}.progress-task-card{border-radius:.5rem;overflow:hidden;margin-bottom:1rem;box-shadow:0 2px 8px #0000001a;border:1px solid #e9ecef;transition:box-shadow .2s ease,transform .2s ease}.progress-task-card:hover{box-shadow:0 4px 12px #00000026;transform:translateY(-1px)}.task-card-header{padding:.75rem;display:flex;justify-content:space-between;align-items:center;font-size:.85rem;font-weight:600}.task-card-header-actions{display:flex;align-items:center;gap:.5rem}.task-card-header-actions .btn{padding:.25rem .5rem;font-size:.8rem;line-height:1}.task-reason-badge{font-size:.7rem;padding:.25rem .5rem;border-radius:.25rem;background:#ffffff4d;font-weight:500;display:inline-flex;align-items:center;gap:.25rem}.status-info{display:flex;align-items:center;gap:.5rem}.status-label{color:inherit;font-weight:600}.urgency-indicator{font-size:.7rem;padding:.2rem .4rem;border-radius:.25rem;background:#fff3;font-weight:500}.urgency-high{background-color:#dc35454d!important}.urgency-med{background-color:#ffc1074d!important}.urgency-low{background-color:#28a7454d!important}.edit-task-btn{background:#ffffffe6;border:1px solid rgba(255,255,255,.5);border-radius:.375rem;padding:.25rem .5rem;font-size:.75rem;color:#495057;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.25rem}.edit-task-btn:hover{background:#fff;border-color:#007bff;color:#007bff;transform:scale(1.05)}.task-card-body{padding:.75rem;background:#fff}.task-title{font-weight:600;margin-bottom:.75rem;color:#212529;line-height:1.4}.task-progress-section{margin-bottom:.75rem}.progress-bar{height:8px;background-color:#e9ecef;border-radius:4px;overflow:hidden;margin-bottom:.25rem}.progress-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);transition:width .3s ease}.progress-text{font-size:.8rem;color:#6c757d;font-weight:500}.today-hours{margin-top:.5rem;font-size:.8rem;color:#007bff;font-weight:500;display:flex;align-items:center;gap:.25rem}.task-meta{display:flex;flex-wrap:wrap;gap:.75rem;font-size:.8rem;color:#6c757d}.task-due,.task-category{display:flex;align-items:center;gap:.25rem}.overdue-text{color:#dc3545!important;font-weight:600}.no-tasks-message{text-align:center;padding:3rem 1rem}.tasks-section{margin-bottom:1rem}.header-title{margin:0;font-size:1.5rem;flex-shrink:0}.header-filters{flex:1;justify-content:center}.header-actions{display:flex;gap:.5rem;flex-shrink:0;align-items:center;position:relative}.header-actions-expandable{display:none;gap:.5rem;align-items:center;position:absolute;right:2.5rem;top:100%;background:#fff;border:1px solid #dee2e6;border-radius:.375rem;padding:.5rem;margin-top:.25rem;box-shadow:0 4px 6px #0000001a;z-index:1000}.content-area{flex:1;padding:1.5rem}.quick-add-form{background-color:#fff;border:1px solid #dee2e6;border-radius:.375rem;padding:1rem}@media (max-width: 768px){.sidebar,.sidebar.collapsed{width:100%}.app-container{flex-direction:column}.header-bar{flex-direction:column;gap:1rem;padding:1rem}.header-filters{flex-direction:column;gap:.5rem}.header-title{font-size:1.25rem}.kanban-board{flex-direction:column}.kanban-lane{min-width:100%;margin-bottom:1rem}.sidebar-toggle{display:none}}.today-container{padding:20px}.today-card{background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid #e9ecef;border-radius:12px;box-shadow:0 4px 6px #00000012;transition:all .3s ease;height:100%}.today-card:hover{box-shadow:0 8px 25px #0000001a;transform:translateY(-2px)}.today-card-header{display:flex;align-items:center;padding:20px 20px 15px;border-bottom:1px solid #e9ecef;margin-bottom:0}.today-card-header h5{color:#495057;font-weight:600;margin:0}.today-card-header i{color:#6c757d;font-size:1.1em}.today-card-body{padding:20px;min-height:300px}.todos-list{max-height:400px;overflow-y:auto}.todo-item{display:flex;align-items:flex-start;padding:12px 16px;margin-bottom:8px;background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;transition:all .2s ease}.todo-item:hover{background:#e9ecef;border-color:#dee2e6}.todo-item.completed{opacity:.6;background:#f1f3f4;border-color:#d1d5db}.todo-item.completed .todo-title{text-decoration:line-through;color:#6c757d}.todo-item.completed .todo-text{text-decoration:line-through}.todo-checkbox{margin-right:12px;margin-top:2px}.todo-content{flex:1}.todo-title{font-weight:500;color:#495057;margin-bottom:4px}.todo-text{font-size:.9em;color:#6c757d;margin:0}.accomplishments-list{max-height:400px;overflow-y:auto}.accomplishment-item{padding:16px;margin-bottom:12px;background:linear-gradient(135deg,#fff3cd,#ffeaa7);border:1px solid #ffeaa7;border-radius:8px;transition:all .2s ease}.accomplishment-item:hover{box-shadow:0 4px 8px #ffeaa74d;transform:translateY(-1px)}.accomplishment-title{font-weight:600;color:#856404;margin-bottom:8px}.accomplishment-content{color:#856404;margin:0}.accomplishment-time{font-size:.8em;color:#6c757d;margin-top:8px}.today-tasks{max-height:300px;overflow-y:auto}.today-task-item{display:flex;align-items:center;padding:12px 16px;margin-bottom:8px;background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;transition:all .2s ease}.today-task-item:hover{background:#e9ecef;border-color:#dee2e6}.today-task-item.overdue{border-left:4px solid #dc3545;background:linear-gradient(135deg,#fff5f5,#fed7d7)}.today-task-urgency{width:8px;height:8px;border-radius:50%;margin-right:12px}.today-task-urgency.high{background:#dc3545}.today-task-urgency.med{background:#ffc107}.today-task-urgency.low{background:#28a745}.task-overview-filters{display:flex;justify-content:center;margin-bottom:20px}.task-overview-filters .btn-group .btn{padding:8px 16px;font-size:.9em;font-weight:500;border:1px solid #0d6efd;color:#0d6efd;background:#fff;transition:all .2s ease;position:relative;overflow:hidden}.task-overview-filters .btn-group .btn:hover{background:linear-gradient(135deg,#e7f1ff,#cce7ff);transform:translateY(-1px);box-shadow:0 4px 8px #0d6efd33}.task-overview-filters .btn-group .btn.active{background:linear-gradient(135deg,#0d6efd,#0b5ed7);color:#fff;border-color:#0d6efd;box-shadow:0 4px 12px #0d6efd4d}.task-overview-filters .btn-group .btn.active:hover{background:linear-gradient(135deg,#0b5ed7,#0a58ca);transform:translateY(-1px)}.task-overview-filters .btn-group .btn i{margin-right:6px}.today-task-item.due-today{border-left:4px solid #ffc107;background:linear-gradient(135deg,#fff9e6,#fffaf0)}.today-task-item .badge{font-size:.7em;padding:2px 6px}.today-task-item .text-end small{font-size:.75em;line-height:1.2}.today-task-item .text-end small:first-child{font-weight:500;color:#495057}@keyframes buttonPress{0%{transform:translateY(0)}50%{transform:translateY(1px)}to{transform:translateY(0)}}.task-overview-filters .btn:active{animation:buttonPress .1s ease}.work-container{max-width:1400px;margin:0 auto}.work-task-header{padding:20px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:8px;border:1px solid #dee2e6}.work-task-header h4{color:#495057;font-weight:600}.time-logs-list{max-height:200px;overflow-y:auto}.time-logs-list::-webkit-scrollbar{width:6px}.time-logs-list::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.time-logs-list::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.time-logs-list::-webkit-scrollbar-thumb:hover{background:#a8a8a8}#workTab{transition:opacity .2s ease}#workTab.active{opacity:1}#customDateContainer{background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:8px;transition:all .3s ease}#customDateToggle:checked+label{color:#007bff!important;font-weight:500}.form-check-label{cursor:pointer;-webkit-user-select:none;user-select:none}.todo-form,.accomplishment-form{padding:16px;background:linear-gradient(135deg,#f8f9fa,#fff);border:1px solid #e9ecef;border-radius:8px;margin-bottom:16px;box-shadow:0 2px 4px #0000000d}.todo-form .input-group,.accomplishment-form .input-group{margin-bottom:8px}.todo-form input,.accomplishment-form input{border:1px solid #dee2e6;border-radius:6px 0 0 6px;padding:10px 12px;font-size:.95em;transition:all .2s ease}.todo-form input:focus,.accomplishment-form input:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}.todo-form .btn,.accomplishment-form .btn{border-radius:0 6px 6px 0;padding:10px 16px;transition:all .2s ease}.todo-details,.accomplishment-details{animation:slideDown .3s ease;overflow:hidden}.todo-details textarea,.accomplishment-details textarea{border:1px solid #dee2e6;border-radius:6px;padding:10px 12px;font-size:.9em;resize:vertical;min-height:60px;transition:border-color .2s ease}.todo-details textarea:focus,.accomplishment-details textarea:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}.todo-form small,.accomplishment-form small{color:#6c757d;font-size:.8em;font-style:italic}@keyframes slideDown{0%{opacity:0;max-height:0;transform:translateY(-10px)}to{opacity:1;max-height:200px;transform:translateY(0)}}.todo-form .btn-primary:hover{background:linear-gradient(135deg,#0b5ed7,#0a58ca);transform:translateY(-1px);box-shadow:0 4px 8px #0d6efd4d}.accomplishment-form .btn-success:hover{background:linear-gradient(135deg,#198754,#157347);transform:translateY(-1px);box-shadow:0 4px 8px #1987544d}.todo-form input::placeholder,.accomplishment-form input::placeholder{color:#adb5bd;font-style:italic}.todo-details textarea::placeholder,.accomplishment-details textarea::placeholder{color:#adb5bd;font-style:italic}.delete-confirmation{padding:12px 16px;background:linear-gradient(135deg,#fff3cd,#ffeaa7);border:1px solid #ffc107;border-radius:6px;animation:slideIn .3s ease}.todo-item.deleting,.accomplishment-item.deleting{transform:scale(.98);transition:transform .2s ease}.delete-confirmation .btn{padding:4px 12px;font-size:.85em;border-radius:4px}.delete-confirmation .btn-danger{background:linear-gradient(135deg,#dc3545,#c82333);border:none;color:#fff}.delete-confirmation .btn-danger:hover{background:linear-gradient(135deg,#c82333,#a71e2a);transform:translateY(-1px);box-shadow:0 4px 8px #dc35454d}.delete-confirmation .btn-outline-secondary{border-color:#6c757d;color:#6c757d}.delete-confirmation .btn-outline-secondary:hover{background:#6c757d;color:#fff;transform:translateY(-1px)}@keyframes slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.error-toast{position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#f8d7da,#f5c6cb);border:1px solid #f5c6cb;border-radius:8px;padding:12px 16px;box-shadow:0 4px 12px #00000026;z-index:9999;opacity:0;transform:translate(100%);transition:all .3s ease;max-width:300px}.error-toast.show{opacity:1;transform:translate(0)}.error-toast .fas{color:#721c24}.error-toast span{color:#721c24;font-weight:500}.calendar-table{table-layout:fixed;border-collapse:separate;border-spacing:2px;width:100%;min-width:800px}.calendar-due-badge{background:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.7rem;font-weight:600;display:inline-flex;align-items:center;gap:2px}.calendar-time-indicators{display:flex;gap:2px;flex-wrap:nowrap;align-items:center;justify-content:flex-start;overflow:hidden}.calendar-task-time{background:#28a745;color:#fff;border-radius:8px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:1px;white-space:nowrap}.calendar-punch-time{background:#ffc107;color:#212529;border-radius:8px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:1px;white-space:nowrap}.calendar-progress-bars{display:flex;flex-direction:column;gap:1px;height:100%;min-height:73px;overflow:hidden;padding:2px}.mini-progress-bar{height:14px;background:#0000001a;border-radius:3px;position:relative;margin-bottom:3px;overflow:hidden}.mini-progress-bar.no-estimate{height:12px}.mini-progress-fill{height:100%;position:absolute;left:0;top:0;transition:width .3s ease;border-radius:2px 0 0 2px}.mini-progress-remaining{height:100%;position:absolute;top:0;background:#ffc1074d;border-radius:0 2px 2px 0}.mini-progress-fill.status-inprogress{background:#0d6efd}.mini-progress-fill.status-completed{background:#28a745}.mini-progress-fill.status-estimated{background:#17a2b8}.mini-progress-fill.status-ready{background:#6c757d}.mini-progress-fill.status-blocked{background:#dc3545}.mini-progress-fill.status-onhold,.mini-progress-fill.status-backburner{background:#ffc107}.due-badges-container{display:flex;gap:2px;flex-wrap:wrap;margin-left:4px}.due-task-badge{display:inline-flex;align-items:center;font-size:8px;width:10px;height:10px;border-radius:50%;transition:all .2s ease}.due-task-badge i{font-size:8px}.due-task-badge.status-inprogress{color:#0d6efd}.due-task-badge.status-completed{color:#28a745}.due-task-badge.status-estimated{color:#17a2b8}.due-task-badge.status-ready{color:#6c757d}.due-task-badge.status-blocked{color:#dc3545}.due-task-badge.status-onhold,.due-task-badge.status-backburner{color:#ffc107}.due-task-badge.urgency-high{font-size:10px;width:12px;height:12px}.due-task-badge.overdue-badge{color:#e91e63!important;animation:pulse-badge 1.5s infinite}@keyframes pulse-badge{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.2)}}.calendar-task-bar{border-radius:3px;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,.1);display:flex;transition:all .2s ease;flex-shrink:0}.calendar-task-bar.today-tomorrow{border-width:2px;animation:pulse-urgent 2s infinite}.calendar-task-bar.overdue{border-color:#dc3545!important;border-width:2px}.calendar-task-bar.in-progress-no-time{border-style:dashed;border-width:2px}.task-bar-progress{height:100%;background:#ffffff4d;transition:width .3s ease}.task-bar-remaining{height:100%;flex:1;background:#0000001a}.urgency-high-next-week{background:#fcc}.urgency-high-this-week{background:#ff6b6b}.urgency-high-today-tomorrow{background:#e74c3c}.urgency-med-next-week{background:#fff3cd}.urgency-med-this-week{background:#ffd93d}.urgency-med-today-tomorrow{background:#f39c12}.urgency-low-next-week{background:#d4edda}.urgency-low-this-week{background:#6bcf7f}.urgency-low-today-tomorrow{background:#27ae60}@keyframes pulse-urgent{0%,to{opacity:1;transform:scale(1)}50%{opacity:.8;transform:scale(1.02)}}.calendar-table .week-selector-header{width:60px;min-width:60px;max-width:60px}.calendar-table th:not(.week-selector-header){width:calc((100% - 60px) / 7)}.calendar-table .week-selector-cell{width:60px;min-width:60px;max-width:60px}.calendar-table .calendar-day{width:calc((100% - 60px) / 7);max-width:calc((100% - 60px) / 7)}.calendar-day{position:relative;height:125px;vertical-align:top;padding:8px;border:1px solid #e9ecef;border-radius:8px;background:linear-gradient(135deg,#fff,#f8f9fa);transition:all .2s ease;cursor:pointer}.calendar-day:hover{background:linear-gradient(135deg,#f8f9fa,#e9ecef);box-shadow:0 4px 8px #0000001a}.calendar-day.today{background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-color:#2196f3;box-shadow:0 0 0 2px #2196f34d}.calendar-day-number{font-weight:600;color:#495057;margin-bottom:8px;font-size:1.1em}.calendar-indicators{display:flex;flex-wrap:wrap;gap:4px}.day-indicator{display:inline-block;padding:2px 6px;border-radius:12px;font-size:.75em;font-weight:500;line-height:1;white-space:nowrap}.day-indicator.urgent{background:#dc3545;color:#fff;animation:pulse 2s infinite}.day-indicator.overdue{background:#fd7e14;color:#fff;font-weight:700}.day-indicator.tasks{background:#6c757d;color:#fff}.day-indicator.hours{background:#198754;color:#fff}.day-indicator.todos{background:#0d6efd;color:#fff}.day-indicator.accomplishments{background:#ffc107;color:#212529}@keyframes pulse{0%,to{opacity:1}50%{opacity:.7}}.calendar-tooltip{position:absolute;background:#000000e6;color:#fff;padding:12px 16px;border-radius:8px;font-size:.9em;max-width:300px;z-index:1000;pointer-events:none;opacity:0;transition:opacity .3s ease}.calendar-tooltip.show{opacity:1}.tooltip-content h6{margin:0 0 8px;color:#ffc107;border-bottom:1px solid #444;padding-bottom:4px}.tooltip-content .tooltip-section{margin-bottom:8px}.tooltip-content .tooltip-section:last-child{margin-bottom:0}.tooltip-content .tooltip-label{font-weight:600;color:#adb5bd;margin-bottom:4px}.tooltip-content .task-item{margin-left:8px;margin-bottom:2px}.tooltip-content .urgency-high{color:#ff6b6b}.tooltip-content .urgency-med{color:#ffd93d}.tooltip-content .urgency-low{color:#6bcf7f}.calendar-header{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6;border-radius:6px;padding:.75rem 1rem;box-shadow:0 1px 3px #00000014;display:flex;align-items:center;justify-content:space-between;gap:1.5rem;margin-bottom:1rem}.calendar-nav-section{display:flex;align-items:center;gap:.5rem}.calendar-nav-section h5{color:#495057;font-weight:600;font-size:1.1rem;min-width:160px;text-align:center;margin:0}.calendar-filters-compact{display:flex;align-items:center;gap:.5rem}.calendar-filters-compact .form-select{min-width:110px;font-size:.875rem}.month-summary-compact{display:flex;align-items:center;gap:1.25rem}.month-summary-compact .summary-item{display:flex;align-items:center;gap:.4rem;font-size:.9rem;font-weight:600}.month-summary-compact .summary-item i{font-size:1rem}.month-summary-compact .summary-value{color:#495057}.kanban-board{display:flex;gap:.75rem;height:100%;overflow-x:auto;padding:.5rem 0;width:100%;max-width:100%;box-sizing:border-box}.kanban-lane{flex:1;min-width:200px;width:0;background:linear-gradient(145deg,#f8f9fa,#e9ecef);border-radius:12px;box-shadow:0 4px 6px #00000012;display:flex;flex-direction:column;overflow:hidden}.kanban-lane-header{background:linear-gradient(135deg,#6c757d,#495057);color:#fff;padding:1rem;text-align:center;font-weight:600;position:relative}.kanban-lane-header h5{margin:0;font-size:1.1rem;color:#495057;font-weight:600}.lane-counter{background:#fff;border:1px solid #dee2e6;color:#6c757d;border-radius:12px;padding:.25rem .5rem;font-size:.8rem;position:absolute;top:.5rem;right:.5rem}.lane-status-filter{position:absolute;top:.5rem;left:.5rem;background:#dcdcdc;border:1px solid #bbb;color:#333;padding:.25rem .5rem;border-radius:.25rem;cursor:pointer;font-size:.8rem;transition:all .2s ease}.lane-status-filter:hover{background:#d3d3d3;border-color:#999}.kanban-lane-content{flex:1;padding:.5rem 1rem 1rem;overflow-y:auto;min-height:200px}.kanban-card{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:1rem;padding:1rem;cursor:grab;transition:all .3s ease;border-left:4px solid #6c757d;position:relative;overflow:hidden}.kanban-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.kanban-card.dragging{opacity:.5;transform:rotate(5deg);cursor:grabbing}.kanban-card.urgency-high{border-left-color:#dc3545;background:linear-gradient(135deg,#fff,#fff5f5)}.kanban-card.urgency-med{border-left-color:#ffc107;background:linear-gradient(135deg,#fff,#fffdf0)}.kanban-card.urgency-low{border-left-color:#28a745;background:linear-gradient(135deg,#fff,#f0fff4)}.kanban-card.overdue{background:linear-gradient(135deg,#fff,#ffebee);border-left-color:#e91e63;animation:pulse-overdue 2s infinite}@keyframes pulse-overdue{0%,to{opacity:1}50%{opacity:.8}}.card-notes-indicator{color:#ffc107;font-size:.9em;cursor:help;transition:color .2s ease}.card-notes-indicator:hover{color:#ffb300}.card-status-indicator{display:inline-flex;align-items:center;gap:.25rem;font-size:.7rem;font-weight:600;padding:.15rem .4rem;border-radius:.25rem;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.3px;white-space:nowrap;flex-shrink:0}.card-status-indicator span{display:inline}@media (max-width: 1400px){.card-status-indicator span{display:none}.card-status-indicator{padding:.25rem .35rem;gap:0}}.card-status-indicator.status-completed{background-color:#28a7451a;color:#28a745;border:1px solid rgba(40,167,69,.3)}.card-status-indicator.status-abandoned{background-color:#dc35451a;color:#dc3545;border:1px solid rgba(220,53,69,.3)}.card-status-indicator.status-archived{background-color:#6c757d1a;color:#6c757d;border:1px solid rgba(108,117,125,.3)}.card-status-indicator.status-blocked{background-color:#dc35451a;color:#dc3545;border:1px solid rgba(220,53,69,.3)}.card-status-indicator.status-backburner{background-color:#ffc1071a;color:#ffc107;border:1px solid rgba(255,193,7,.3)}.card-status-indicator.status-onhold{background-color:#17a2b81a;color:#17a2b8;border:1px solid rgba(23,162,184,.3)}.card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.25rem}.card-title{font-weight:600;font-size:1rem;margin-bottom:0;color:#2c3e50;line-height:1.3;cursor:pointer;flex:1;margin-right:.5rem}.card-edit-btn{padding:.2rem .4rem;font-size:.7rem;border:1px solid #17a2b8;background:transparent;color:#17a2b8;border-radius:3px;cursor:pointer;transition:all .2s ease;flex-shrink:0}.card-edit-btn:hover{background-color:#17a2b8;color:#fff}.card-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.85rem;color:#6c757d;gap:.5rem;flex-wrap:wrap}.card-meta-right{display:flex;align-items:center;gap:.5rem;flex-shrink:0}.card-time-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;font-size:.85rem;color:#6c757d}.card-due-date{display:flex;align-items:center;gap:.25rem}.card-due-date.overdue{color:#e91e63;font-weight:600}.card-due-date.due-soon{color:#ff9800;font-weight:600}.card-hours{display:flex;align-items:center;gap:.25rem;font-weight:500}.progress-bar-container{margin-bottom:.75rem}.progress-bar{height:6px;background:#e9ecef;border-radius:3px;overflow:hidden}.progress-bar-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);transition:width .3s ease;border-radius:3px}.progress-text{font-size:.75rem;color:#6c757d;margin-top:.25rem}.card-quick-actions{display:flex;opacity:0;transition:opacity .2s ease;margin-top:.5rem}.kanban-card:hover .card-quick-actions{opacity:1}.quick-time-buttons{display:flex;gap:.25rem;width:100%}.quick-action-btn{padding:.25rem .5rem;font-size:.75rem;border:none;border-radius:4px;cursor:pointer;transition:all .2s ease;flex:1;min-width:0;white-space:nowrap}.quick-time-btn{max-width:4rem}.quick-action-btn:hover{transform:scale(1.05)}.kanban-lane-header{background:#f8f9fa;border:1px solid #dee2e6;border-bottom:3px solid #6c757d;padding:12px 16px;border-radius:6px 6px 0 0;margin-bottom:8px;transition:all .2s ease}.lane-backlog .kanban-lane-header{border-bottom-color:#6c757d}.lane-inprogress .kanban-lane-header{border-bottom-color:#007bff}.lane-blocked .kanban-lane-header{border-bottom-color:#ffc107}.lane-done .kanban-lane-header{border-bottom-color:#28a745}.kanban-lane-header:hover{background:#e9ecef;box-shadow:0 2px 4px #0000001a}.kanban-lane.drag-over{background:linear-gradient(145deg,#e3f2fd,#bbdefb);transform:scale(1.02)}.drop-zone{min-height:20px;border:2px dashed transparent;border-radius:8px;transition:all .3s ease}.drop-zone.drag-over{min-height:60px;border-color:#007bff;background:#007bff1a}.status-history-entry{min-height:44px;border-left:2px solid transparent;margin-left:-2px;padding:8px 0 8px 2px}.status-history-entry.recent-status{border-left-color:#007bff;background:#007bff05;border-radius:4px;padding-left:8px;margin-left:-8px}.status-timeline-dot{position:relative}.status-timeline-dot:after{content:"";position:absolute;left:50%;top:20px;transform:translate(-50%);width:2px;height:30px;background:#dee2e6;z-index:-1}.status-history-entry:last-child .status-timeline-dot:after{display:none}@media (max-width: 576px){.status-history-entry .d-flex.flex-column.flex-md-row{align-items:stretch!important}.status-history-entry .badge{align-self:flex-start;margin-bottom:4px}.status-history-entry small{font-size:.7rem!important;line-height:1.2}}.estimation-panel .form-range{margin:8px 0}.estimation-panel .form-range::-webkit-slider-thumb{background:#007bff}.estimation-panel .form-range::-moz-range-thumb{background:#007bff;border:none}.estimation-panel .small{font-size:.8rem}#velocityPrediction{background:#fffc;min-height:80px;padding:.5rem}@media (max-width: 768px){.estimation-panel .col-md-4{margin-bottom:1rem}}.punch-card-container{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:15px;padding:20px;box-shadow:0 4px 15px #0000001a}.punch-card{background:#fff;border:2px dashed #6c757d;border-radius:10px;padding:15px;max-width:400px;margin:0 auto;font-family:Courier New,monospace}.punch-card-header{border-bottom:1px solid #dee2e6;padding-bottom:10px;margin-bottom:15px}.card-date{font-size:.9rem;color:#6c757d}.time-slots{min-height:60px}.time-slots::-webkit-scrollbar{width:6px}.time-slots::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.time-slots::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.time-slots::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.time-slot{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px dotted #dee2e6;font-size:.9rem}.time-slot:last-child{border-bottom:none}.time-slot .time{font-weight:700;color:#495057}.time-slot .activity{color:#6c757d;font-style:italic}.current-status{background:#0d6efd1a;border-radius:15px;padding:20px}.status-display{display:flex;flex-direction:column;align-items:center;gap:10px}.status-icon{font-size:2.5rem;height:80px;width:80px;display:flex;align-items:center;justify-content:center;background:#ffffffe6;border-radius:50%;box-shadow:0 2px 10px #0000001a}.status-text{font-size:1.2rem;font-weight:600;color:#495057}.status-time{font-size:1rem;color:#6c757d}.punch-btn{min-width:200px;min-height:60px;font-size:1.1rem;font-weight:600;border-radius:15px;transition:all .3s ease}.punch-btn.btn-success{background:linear-gradient(135deg,#28a745,#20c997);border:none;box-shadow:0 4px 15px #28a7454d}.punch-btn.btn-danger{background:linear-gradient(135deg,#dc3545,#fd7e14);border:none;box-shadow:0 4px 15px #dc35454d}.punch-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px #0003}.interruption-buttons .btn{border-radius:10px;padding:8px 10px;transition:all .2s ease;font-size:.9rem}.interruption-buttons .btn:hover{transform:translateY(-1px)}.summary-item{padding:10px}.summary-value{font-size:1.2rem;font-weight:700;color:#495057}.summary-label{font-size:.85rem;color:#6c757d;text-transform:uppercase;letter-spacing:.5px}.punched-in{background:linear-gradient(135deg,#28a745,#20c997);color:#fff}.punched-out{background:linear-gradient(135deg,#6c757d,#adb5bd);color:#fff}.on-break{background:linear-gradient(135deg,#ffc107,#fd7e14);color:#fff}.toast{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#fffffff2;border:1px solid rgba(0,0,0,.1);box-shadow:0 8px 32px #0000001a}.toast-success{border-left:4px solid #28a745}.toast-warning{border-left:4px solid #ffc107}.toast-error{border-left:4px solid #dc3545}.toast-info{border-left:4px solid #17a2b8}.toast-header{background:#f8f9facc;border-bottom:1px solid rgba(0,0,0,.1)}.toast-body{font-size:.95rem}.validation-message{display:none;margin-top:.5rem;padding:.5rem;border-radius:.375rem;font-size:.875rem;animation:fadeIn .3s ease-in-out}.validation-message.show{display:block}.validation-message.warning{background-color:#fff3cd;border:1px solid #ffeaa7;color:#856404}.validation-message.error{background-color:#f8d7da;border:1px solid #f5c6cb;color:#721c24}@keyframes fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.day-indicator.punch-clock{background-color:#17a2b8;color:#fff;font-size:.8rem}.day-indicator.punch-clock:hover{background-color:#138496}.metric-small{padding:10px}.metric-small .metric-value{font-size:1rem;font-weight:600;color:#495057}.metric-small .metric-label{font-size:.75rem;color:#6c757d;text-transform:uppercase;letter-spacing:.5px}.category-item{transition:all .2s ease}.category-item:hover{background-color:#f8f9fa}.category-item .drag-handle{opacity:.5;transition:opacity .2s ease}.category-item:hover .drag-handle{opacity:1}.category-item .form-control{border:1px solid #dee2e6}.category-item .form-control:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd40}#categoriesContainer{background-color:#fafbfc}#categoriesContainer::-webkit-scrollbar{width:8px}#categoriesContainer::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}#categoriesContainer::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}#categoriesContainer::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.list-group-item.active,.list-group-item:hover{background-color:#f8f9fa;border-color:#dee2e6}.category-lists-selector{max-height:200px;overflow-y:auto;border:1px solid #dee2e6;border-radius:.375rem;padding:.75rem;background-color:#fafbfc}.category-lists-selector .form-check{margin-bottom:.75rem}.category-lists-selector .form-check:last-child{margin-bottom:0}.category-lists-selector .form-check-label{line-height:1.4;cursor:pointer}.category-lists-selector .badge{font-size:.7em}.category-selector{margin-top:.5rem}#timeLogTaskDisplay{background-color:#f8f9fa!important;border:1px solid #dee2e6}.quick-time{transition:all .2s ease}.quick-time:hover{transform:translateY(-1px)}.quick-time.active{background-color:#198754;border-color:#198754;color:#fff}#timeLogModal .d-flex .quick-time{min-width:50px;padding:6px 12px;font-size:.875rem}.time-logs-list .badge{font-size:.7em}.time-logs-list .fw-bold{color:#495057}.time-logs-list .border-bottom:last-child{border-bottom:none!important}.time-logs-list .delete-log-btn{opacity:.6;transition:opacity .2s ease}.time-logs-list .border-bottom:hover .delete-log-btn{opacity:1}.report-section .progress{background-color:#e9ecef}.report-section .card{border:1px solid #dee2e6}.report-section .card-header{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.report-section .table th{background-color:#f8f9fa;border-top:none}.estimation-panel{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6!important}.estimation-panel .form-range{cursor:pointer}.estimation-panel .form-range::-webkit-slider-thumb{background-color:#0d6efd;cursor:pointer}.estimation-panel .form-range::-moz-range-thumb{background-color:#0d6efd;cursor:pointer}.estimation-panel .form-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 .25rem #0d6efd40}.estimation-panel .form-range:focus::-moz-range-thumb{box-shadow:0 0 0 .25rem #0d6efd40}#velocityPrediction{min-height:80px;display:flex;align-items:center;justify-content:center}#velocityPrediction .row{width:100%}#velocityPrediction .text-muted{font-size:.875rem}#velocityPrediction .fs-6{font-size:1.1rem!important;font-weight:600}#confidenceHint{font-size:.75rem;color:#6c757d;margin-top:.25rem}.estimation-panel label.small{font-weight:600;color:#495057}.work-session-section{padding-top:1rem;border-top:1px solid #e9ecef}.work-session-info{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6;border-radius:.375rem;padding:1rem}.work-session-row:not(:last-child){border-bottom:1px solid #dee2e6}.work-session-label{font-weight:500;color:#495057}.work-session-value{font-family:Courier New,monospace;color:#212529}.no-session-message{padding:1.5rem;background:#f8f9fa;border:1px dashed #dee2e6;border-radius:.375rem}.activity-timeline{display:flex;flex-direction:column;gap:.75rem}.activity-item{display:flex;align-items:flex-start;gap:.75rem;padding:.5rem;border-radius:.375rem;transition:background-color .2s}.activity-item:hover{background-color:#00000005}.activity-item.active{background-color:#28a7450d;border-left:3px solid #28a745;padding-left:calc(.5rem - 3px)}.activity-icon{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:.875rem;flex-shrink:0}.activity-details{flex:1}.activity-header{display:flex;align-items:center;margin-bottom:.25rem}.activity-time{font-size:.813rem}.app-container{display:flex;min-height:100vh}.sidebar{width:320px;padding:1rem;flex-shrink:0;transition:width .3s ease,padding .3s ease;overflow-x:hidden;position:relative}.sidebar.collapsed{width:60px;padding:1rem .5rem}.sidebar.collapsed .sidebar-content{opacity:0;pointer-events:none}.sidebar.collapsed .sidebar-nav{opacity:1;pointer-events:all}.sidebar-toggle{position:absolute;top:1rem;right:.5rem;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.8rem;z-index:10;transition:all .2s ease}.sidebar-toggle:hover{transform:scale(1.1)}.sidebar-nav{display:flex;flex-direction:column;gap:.5rem;margin-top:3rem;transition:opacity .3s ease}.sidebar.collapsed .sidebar-nav{margin-top:4rem}.sidebar-nav-item{padding:.75rem;border-radius:.375rem;cursor:pointer;transition:all .2s ease;text-align:center;font-weight:500;display:flex;align-items:center;gap:.5rem;white-space:nowrap}.sidebar.collapsed .sidebar-nav-item{justify-content:center;padding:.75rem .5rem}.sidebar.collapsed .sidebar-nav-item .nav-text{display:none}.sidebar-nav-item:hover{transform:translate(4px)}.sidebar.collapsed .sidebar-nav-item:hover{transform:translate(0) scale(1.05)}.sidebar-content{transition:opacity .3s ease}.main-content{flex:1;padding:2rem;overflow-y:auto}.task-card{margin-bottom:1rem}.action-btn{margin-right:.5rem}.due-badge{font-size:.9rem}.summary-card{margin-bottom:.75rem!important}.summary-card .card-body{padding:.5rem 1rem}.summary-card h5{font-size:1rem;margin-bottom:.25rem;font-weight:600}.summary-card p{margin-bottom:0;font-size:.9rem}.sortable:hover{cursor:pointer;text-decoration:underline}.editable{cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color .2s}.editing{border:1px solid #ffeaa7}.task-actions{opacity:0;transition:opacity .2s}.task-card:hover .task-actions{opacity:1}.quick-time-btn{margin:0 2px}.calendar-table{width:100%;table-layout:fixed}.calendar-table th,.calendar-table td{text-align:center;vertical-align:top}.calendar-table td{height:100px;border:1px solid}.task-event{padding:2px 5px;margin:2px;border-radius:3px;cursor:pointer}.calendar-split-view{display:flex;gap:1rem;height:calc(100vh - 150px)}.calendar-grid-section{flex:1;overflow-y:auto}.calendar-detail-section{width:400px;overflow-y:auto;padding:1rem;border-radius:.5rem}.calendar-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding:1rem;border-radius:.5rem;gap:1rem}.calendar-controls h3{margin:0;font-size:1.5rem;font-weight:600}.calendar-nav-buttons{display:flex;gap:.5rem;align-items:center}.calendar-filters{display:flex;gap:.5rem;flex-wrap:wrap}.calendar-day-cell{padding:.5rem;min-height:120px;position:relative;cursor:pointer;transition:all .2s ease}.calendar-day-cell:hover{transform:translateY(-2px)}.calendar-day-number{font-weight:600;font-size:.9rem;margin-bottom:.25rem}.calendar-day-tasks{font-size:.75rem;display:flex;flex-direction:column;gap:2px}.calendar-task-indicator{padding:2px 4px;border-radius:3px;font-size:.7rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.calendar-hours-badge{position:absolute;bottom:.25rem;right:.25rem;font-size:.65rem;padding:.15rem .4rem;border-radius:.25rem;font-weight:600}.progress-task-card{margin-bottom:1rem;border-radius:.5rem;overflow:hidden;transition:all .2s ease}.progress-task-card:hover{transform:translateY(-2px)}.task-card-header{padding:.75rem;display:flex;justify-content:space-between;align-items:center;gap:.5rem}.task-card-header-actions,.status-info{display:flex;gap:.5rem;align-items:center}.status-label{font-weight:600;font-size:.85rem}.urgency-indicator{font-size:.75rem;padding:.15rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.task-reason-badge{font-size:.7rem;padding:.25rem .5rem;border-radius:.25rem;font-weight:500;display:inline-flex;align-items:center;gap:.25rem}.card-badges{display:flex;gap:.5rem;padding:0 .75rem;flex-wrap:wrap}.badge-project,.badge-phase{font-size:.75rem;padding:.25rem .6rem;border-radius:.25rem;font-weight:500}.task-card-body{padding:.75rem}.task-title{font-weight:600;margin-bottom:.5rem;font-size:.95rem;line-height:1.4}.task-progress-section{margin-top:.5rem}.progress-bar-container{margin-bottom:.5rem}.progress-label{font-size:.75rem;margin-bottom:.25rem;display:flex;justify-content:space-between}.progress{height:8px;border-radius:4px}.task-dates{font-size:.75rem;display:flex;gap:1rem;margin-top:.5rem}.kanban-board{display:flex;gap:1rem;overflow-x:auto;padding:1rem;min-height:500px}.kanban-column{flex:0 0 300px;display:flex;flex-direction:column;border-radius:.5rem;padding:1rem;max-height:calc(100vh - 200px)}.kanban-column-header{font-weight:600;font-size:1.1rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:2px solid;display:flex;justify-content:space-between;align-items:center}.task-count-badge{font-size:.85rem;padding:.25rem .6rem;border-radius:.25rem;font-weight:500}.kanban-column-tasks{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:.75rem}.kanban-task-card{border-radius:.375rem;padding:.75rem;cursor:pointer;transition:all .2s ease}.kanban-task-card:hover{transform:translateY(-2px)}.kanban-task-title{font-weight:600;margin-bottom:.5rem;font-size:.9rem}.kanban-task-meta{font-size:.75rem;display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.board-detail-pane{width:400px;padding:1.5rem;border-radius:.5rem;overflow-y:auto;max-height:calc(100vh - 200px)}.board-detail-empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;text-align:center}.board-detail-empty i{font-size:3rem;margin-bottom:1rem;opacity:.3}.detail-task-title{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.detail-task-badges{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}.detail-metrics-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin-bottom:1.5rem}.detail-metric{padding:.75rem;border-radius:.375rem;text-align:center}.detail-metric-label{font-size:.75rem;font-weight:500;text-transform:uppercase;margin-bottom:.25rem;opacity:.7}.detail-metric-value{font-size:1.25rem;font-weight:700}.detail-section{margin-bottom:1.5rem}.detail-section-title{font-weight:600;font-size:.9rem;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.5px}.detail-description,.detail-notes{font-size:.9rem;line-height:1.6;padding:.75rem;border-radius:.375rem}.detail-status-history,.detail-time-logs{display:flex;flex-direction:column;gap:.5rem}.detail-history-item,.detail-log-item{padding:.5rem .75rem;border-radius:.375rem;font-size:.85rem;display:flex;justify-content:space-between;align-items:center}.detail-history-date,.detail-log-date{font-size:.75rem;opacity:.7}.estimation-panel{padding:1.5rem;border-radius:.5rem;margin-bottom:1.5rem}.estimation-title{font-size:1.1rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.slider-group{margin-bottom:1.25rem}.slider-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-weight:500}.slider-value{font-weight:700;font-size:1.1rem}.form-range{width:100%;height:8px;cursor:pointer}.form-range:focus{outline:none}.form-range::-webkit-slider-thumb{width:20px;height:20px;border-radius:50%;cursor:pointer;transition:all .2s ease}.form-range::-webkit-slider-thumb:hover{transform:scale(1.2)}.form-range::-moz-range-thumb{width:20px;height:20px;border-radius:50%;cursor:pointer;transition:all .2s ease;border:none}.form-range::-moz-range-thumb:hover{transform:scale(1.2)}.scale-hint{font-size:.8rem;margin-top:.25rem;font-style:italic}#velocityPrediction{margin-top:1.5rem;padding:1rem;border-radius:.5rem;font-size:.95rem;text-align:center;display:flex;flex-direction:column;align-items:center;gap:.5rem}#velocityPrediction strong{font-size:1.2rem}.work-session-section{padding-top:1rem;border-top:1px solid}.work-session-info{border-radius:.375rem;padding:1rem;border:1px solid}.work-session-row{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0}.work-session-row:not(:last-child){border-bottom:1px solid}.work-session-label{font-weight:500}.work-session-value{font-family:Courier New,monospace}.no-session-message{padding:1.5rem;border:1px dashed;border-radius:.375rem}.velocity-section{margin-top:2rem;padding:1.5rem;border-radius:.5rem}.velocity-metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.velocity-metric{padding:1rem;border-radius:.375rem;text-align:center}.velocity-metric-label{font-size:.85rem;font-weight:500;text-transform:uppercase;margin-bottom:.5rem;opacity:.8}.velocity-metric-value{font-size:1.75rem;font-weight:700}.velocity-accuracy{margin-top:1.5rem;padding:1rem;border-radius:.375rem}.accuracy-bars{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1rem}.accuracy-bar-row{display:flex;align-items:center;gap:1rem}.accuracy-label{width:120px;font-size:.85rem;font-weight:500}.accuracy-bar-container{flex:1;height:24px;border-radius:4px;overflow:hidden;position:relative}.accuracy-bar{height:100%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:600;transition:width .3s ease}.accuracy-percentage{width:50px;text-align:right;font-weight:600;font-size:.9rem}.velocity-interpretation{margin-top:1.5rem;padding:1rem;border-radius:.375rem;font-size:.9rem;line-height:1.6}.velocity-interpretation h5{margin-bottom:.75rem;font-size:1rem;font-weight:600}.velocity-interpretation ul{margin-left:1.5rem;margin-bottom:0}.velocity-interpretation li{margin-bottom:.5rem}@media (max-width: 768px){.sidebar{width:250px}.main-content{padding:1rem}.calendar-split-view{flex-direction:column;height:auto}.calendar-detail-section{width:100%}.kanban-board{flex-direction:column}.kanban-column{flex:1 1 auto}.board-detail-pane{width:100%}.detail-metrics-grid{grid-template-columns:1fr}}.card-header-actions{display:flex;align-items:center;gap:.5rem;margin-left:auto}.task-card.charge-active{position:relative;border:2px solid rgba(102,126,234,.4);box-shadow:0 0 8px #667eea4d}.charge-meter-indicator{display:flex;align-items:center;gap:.35rem;padding:.25rem .4rem;background:transparent;border-radius:4px;font-size:.7rem;cursor:help;transition:all .2s ease}.charge-meter-indicator:hover{transform:scale(1.05)}.charge-meter{display:flex;gap:2px;align-items:center;padding:2px;border-radius:3px;background:transparent}.charge-bar{width:5px;height:16px;background:#fff3;border-radius:2px;transition:all .3s ease;box-shadow:inset 0 0 2px #0000004d}.charge-bar.active{box-shadow:0 0 4px currentColor,inset 0 0 2px #ffffff4d}.charge-meter.dim-green .charge-bar.active,.charge-meter.medium-green .charge-bar.active,.charge-meter.bright-green .charge-bar.active{background:linear-gradient(to top,#32cd32,#7fff00);color:#7fff00;animation:bar-pulse-bright 1.5s ease-in-out infinite}.charge-meter.brightest-green .charge-bar.active{background:linear-gradient(to top,#7fff00,#adff2f);color:#adff2f;animation:bar-pulse-full 1s ease-in-out infinite}.charge-meter.orange .charge-bar.active{background:linear-gradient(to top,#ff8c00,orange);color:orange;animation:bar-pulse-overcharge .8s ease-in-out infinite}.charge-meter.red .charge-bar.active{background:linear-gradient(to top,#dc143c,#f44);color:#f44;animation:bar-pulse-danger .5s ease-in-out infinite}.charge-timer{display:none;font-family:Courier New,monospace;font-size:.7rem;font-weight:700;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.8);letter-spacing:.5px;min-width:40px;order:-1}.charge-meter-indicator:hover .charge-timer{display:block}@keyframes bar-pulse-medium{0%,to{opacity:1}50%{opacity:.8}}@keyframes bar-pulse-bright{0%,to{opacity:1;transform:scaleY(1)}50%{opacity:.9;transform:scaleY(1.05)}}@keyframes bar-pulse-full{0%,to{opacity:1;transform:scaleY(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.1);filter:brightness(1.2)}}@keyframes bar-pulse-overcharge{0%,to{opacity:1;transform:scaleY(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.15);filter:brightness(1.3)}}@keyframes bar-pulse-danger{0%,to{opacity:1;transform:scaleY(1) scaleX(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.2) scaleX(1.1);filter:brightness(1.5)}}.active-rocket-indicator{display:flex;align-items:center;gap:.5rem;padding:.375rem .75rem;border-radius:.375rem;background:transparent;border:1px solid rgba(150,150,150,.2);font-size:.875rem;cursor:pointer;transition:all .2s ease;opacity:.6}.active-rocket-indicator:hover{background:#9696960d;border-color:#96969659;opacity:.8}.active-rocket-indicator .rocket-icon{color:#999;opacity:.7}.active-rocket-indicator .rocket-task-name{color:#aaa;font-weight:400;max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.active-rocket-indicator .rocket-time{color:#999;font-family:Courier New,monospace;font-weight:400;font-size:.8rem}.task-card.rocket-fueling{position:relative;border:2px solid #667eea;box-shadow:0 0 0 1px #667eea33;background:linear-gradient(135deg,#667eea08,#764ba208)}.task-card.rocket-fueling:before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent 0%,#667eea 50%,transparent 100%);animation:fueling-progress 2s ease-in-out infinite}.fueling-indicator{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .5rem;border-radius:12px;font-size:.7rem;font-weight:600;margin-left:auto;background:linear-gradient(135deg,#667eea,#764ba2);border:1px solid rgba(255,255,255,.3);color:#fff;box-shadow:0 2px 8px #667eea66}.fueling-badge{position:relative;display:flex;align-items:center;justify-content:center;width:16px;height:16px}.fueling-badge i{font-size:.75rem;color:gold;transform:rotate(-45deg);animation:fueling-bob 2s ease-in-out infinite;filter:drop-shadow(0 0 2px rgba(0,0,0,.5))}.fueling-drops{position:absolute;width:100%;height:100%;top:0;left:0}.fueling-drops:before,.fueling-drops:after{content:"";position:absolute;width:3px;height:3px;background:#ffd700cc;border-radius:50%;bottom:-6px;animation:fuel-drop 2s ease-in-out infinite}.fueling-drops:before{left:30%;animation-delay:0s}.fueling-drops:after{right:30%;animation-delay:.5s}.fueling-status{font-size:.7rem;white-space:nowrap;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3)}.task-card.rocket-active{position:relative;animation:card-glow-pulse 3s ease-in-out infinite}.task-card.rocket-active:before{content:"";position:absolute;top:-2px;right:-2px;bottom:-2px;left:-2px;border-radius:.5rem;background:linear-gradient(45deg,#667eea,#764ba2,#f093fb,#4facfe,#667eea);background-size:300% 300%;z-index:-1;animation:gradient-shift 4s ease infinite,glow-pulse 2s ease-in-out infinite;filter:blur(4px);opacity:.8}.task-card.rocket-active:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;border-radius:.5rem;background:inherit;z-index:-1}.rocket-indicator{display:inline-flex;align-items:center;gap:.4rem;padding:.25rem .6rem;border-radius:14px;font-size:.7rem;font-weight:600;margin-left:auto;background:linear-gradient(135deg,#667eea,#764ba2);border:1px solid rgba(255,255,255,.4);box-shadow:0 4px 16px #667eea80,0 0 20px #667eea4d;position:relative;overflow:hidden;animation:indicator-pulse 2s ease-in-out infinite}.rocket-indicator:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.4),transparent);animation:shimmer 3s infinite}.rocket-badge{position:relative;display:flex;align-items:center;justify-content:center;width:18px;height:18px}.rocket-badge i{font-size:.85rem;color:gold;animation:rocket-fly 2s ease-in-out infinite;filter:drop-shadow(0 0 4px rgba(255,215,0,.9)) drop-shadow(0 0 2px rgba(0,0,0,.5));z-index:2}.rocket-trail{position:absolute;width:6px;height:6px;background:radial-gradient(circle,rgba(255,215,0,.9),transparent);border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);animation:trail-pulse 1s ease-in-out infinite;filter:blur(1px)}.rocket-timer{display:none;font-family:Courier New,monospace;font-size:.75rem;font-weight:700;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.5),0 0 10px rgba(255,255,255,.3);letter-spacing:.5px}.rocket-indicator:hover .rocket-timer{display:block}@keyframes card-glow-pulse{0%,to{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes gradient-shift{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}@keyframes glow-pulse{0%,to{opacity:.6}50%{opacity:1}}@keyframes rocket-fly{0%,to{transform:translateY(0) translate(0) rotate(-45deg)}25%{transform:translateY(-3px) translate(2px) rotate(-43deg)}50%{transform:translateY(-5px) translate(3px) rotate(-45deg)}75%{transform:translateY(-3px) translate(2px) rotate(-47deg)}}@keyframes trail-pulse{0%,to{transform:translate(-50%,-50%) scale(1);opacity:.8}50%{transform:translate(-50%,-50%) scale(1.5);opacity:.4}}@keyframes shimmer{0%{transform:translate(-100%) translateY(-100%) rotate(45deg)}to{transform:translate(100%) translateY(100%) rotate(45deg)}}@keyframes fueling-progress{0%{transform:translate(-100%)}to{transform:translate(100%)}}@keyframes fueling-bob{0%,to{transform:rotate(-45deg) translateY(0)}50%{transform:rotate(-45deg) translateY(-2px)}}@keyframes fuel-drop{0%{transform:translateY(0);opacity:1}to{transform:translateY(8px);opacity:0}}@keyframes indicator-pulse{0%,to{box-shadow:0 4px 16px #667eea80,0 0 20px #667eea4d}50%{box-shadow:0 4px 20px #667eeab3,0 0 30px #667eea80}}body{background-color:#f8f9fa}.urgency-high{color:#dc3545}.urgency-med{color:#ffc107}.urgency-low{color:#28a745}.importance-high{background-color:#dc3545;color:#fff}.importance-med{background-color:#ffc107;color:#000}.importance-low{background-color:#28a745;color:#fff}.sidebar{background-color:#f8f9fa;border-right:1px solid #dee2e6}.sidebar-toggle{background:#6c757d;color:#fff}.sidebar-toggle:hover{background:#495057}.sidebar-nav-item{background:#fff;border:1px solid #dee2e6;color:#495057}.sidebar-nav-item:hover{background:#e9ecef;border-color:#6c757d}.sidebar-nav-item.active{background:#007bff;color:#fff;border-color:#007bff}.summary-card{background-color:#e9ecef}.summary-card p{color:#495057}.editable:hover{background-color:#f8f9fa}.editing{background-color:#fff3cd}.calendar-table td{border-color:#dee2e6}.task-event{background-color:#007bff;color:#fff}.calendar-controls{background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid #e9ecef;box-shadow:0 2px 4px #0000000d}.calendar-detail-section{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 8px #0000000d}.calendar-day-cell{background:#fff;border:1px solid #e9ecef}.calendar-day-cell:hover{background:#f8f9fa;box-shadow:0 4px 8px #0000001a}.calendar-day-cell.selected{background:#e7f3ff;border-color:#007bff}.calendar-day-cell.other-month{background:#fafafa;color:#adb5bd}.calendar-day-cell.today{background:#fff3cd;border-color:#ffc107}.calendar-task-indicator{background:#e7f3ff;color:#0056b3;border-left:3px solid #007bff}.calendar-hours-badge{background:#007bff1a;color:#0056b3}.progress-task-card{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 4px #0000000d}.progress-task-card:hover{box-shadow:0 4px 12px #0000001a}.progress-task-card.overdue{border-left:4px solid #dc3545}.task-card-header.status-not-started{background:linear-gradient(135deg,#e9ecef,#dee2e6);color:#495057}.task-card-header.status-in-progress{background:linear-gradient(135deg,#cfe2ff,#b6d4fe);color:#084298}.task-card-header.status-blocked{background:linear-gradient(135deg,#f8d7da,#f5c2c7);color:#842029}.task-card-header.status-completed{background:linear-gradient(135deg,#d1e7dd,#badbcc);color:#0a3622}.task-card-header.status-deferred{background:linear-gradient(135deg,#fff3cd,#ffecb5);color:#664d03}.urgency-indicator.urgency-high{background-color:#dc354533;color:#dc3545}.urgency-indicator.urgency-med{background-color:#ffc10733;color:#cc7a00}.urgency-indicator.urgency-low{background-color:#28a74533;color:#28a745}.task-reason-badge{background:#ffffff4d}.due-badge-reason,.time-badge-reason,.both-badge-reason{background-color:#6c757d26;color:#6c757d}.task-dates{color:#6c757d}.progress{background-color:#e9ecef}.progress-bar{background:linear-gradient(90deg,#007bff,#0056b3)}.progress-label{color:#6c757d}.kanban-column{background:#f8f9fa;border:1px solid #dee2e6}.kanban-column-header{color:#212529;border-bottom-color:#dee2e6}.kanban-column.status-not-started .kanban-column-header{border-bottom-color:#6c757d}.kanban-column.status-in-progress .kanban-column-header{border-bottom-color:#0d6efd}.kanban-column.status-blocked .kanban-column-header{border-bottom-color:#dc3545}.kanban-column.status-completed .kanban-column-header{border-bottom-color:#198754}.kanban-column.status-deferred .kanban-column-header{border-bottom-color:#ffc107}.task-count-badge{background:#0000001a;color:#495057}.kanban-task-card{background:#fff;border:1px solid #e9ecef;box-shadow:0 1px 3px #0000001a}.kanban-task-card:hover{box-shadow:0 4px 12px #00000026;border-color:#007bff}.kanban-task-meta{color:#6c757d}.board-detail-pane{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 8px #0000000d}.board-detail-empty{color:#6c757d}.detail-metric{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6}.detail-metric-label{color:#6c757d}.detail-metric-value{color:#212529}.detail-description,.detail-notes{background:#f8f9fa;color:#495057;border:1px solid #e9ecef}.detail-history-item,.detail-log-item{background:#f8f9fa;border:1px solid #e9ecef}.detail-history-date,.detail-log-date{color:#6c757d}.estimation-panel{background:linear-gradient(135deg,#e7f3ff,#cfe2ff);border:1px solid #b6d4fe}.estimation-title{color:#084298}.slider-label{color:#212529}.form-range{background:linear-gradient(to right,#e9ecef,#dee2e6)}.form-range::-webkit-slider-thumb{background:#007bff;border:2px solid white;box-shadow:0 2px 4px #0003}.form-range::-webkit-slider-thumb:hover{background:#0056b3;box-shadow:0 3px 8px #0000004d}.form-range::-moz-range-thumb{background:#007bff;border:2px solid white;box-shadow:0 2px 4px #0003}.form-range::-moz-range-thumb:hover{background:#0056b3;box-shadow:0 3px 8px #0000004d}.scale-hint{color:#6c757d}#velocityPrediction{background:linear-gradient(135deg,#d1e7dd,#badbcc);border:1px solid #a3cfbb;color:#0a3622}#velocityPrediction i{color:#198754}.work-session-section{border-top-color:#e9ecef}.work-session-info{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-color:#dee2e6}.work-session-row:not(:last-child){border-bottom-color:#dee2e6}.work-session-label{color:#495057}.work-session-value{color:#212529}.no-session-message{background:#f8f9fa;border-color:#dee2e6;color:#6c757d}.velocity-section{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6}.velocity-metric{background:#fff;border:1px solid #dee2e6}.velocity-metric-label{color:#6c757d}.velocity-metric-value{color:#007bff}.velocity-accuracy{background:#fff;border:1px solid #dee2e6}.accuracy-bar-container{background:#e9ecef}.accuracy-bar.within-range{background:linear-gradient(90deg,#28a745,#20c997);color:#fff}.accuracy-bar.underestimated{background:linear-gradient(90deg,#ffc107,#ffb300);color:#000}.accuracy-bar.overestimated{background:linear-gradient(90deg,#dc3545,#c82333);color:#fff}.velocity-interpretation{background:#fff3cd;border:1px solid #ffecb5;color:#664d03}.velocity-interpretation h5{color:#523502}.badge.bg-info{background-color:#0dcaf0!important;color:#000}.btn-outline-info{color:#0dcaf0;border-color:#0dcaf0}.btn-outline-info:hover{background-color:#0dcaf0;border-color:#0dcaf0;color:#000}.report-section{background:#fff;border:1px solid #e9ecef;border-radius:.5rem;padding:1.5rem;margin-bottom:1rem;box-shadow:0 2px 4px #0000000d}.report-section h4{color:#212529;border-bottom:2px solid #007bff;padding-bottom:.5rem;margin-bottom:1rem}.report-section .badge.bg-info{background-color:#0dcaf0!important}.rocket-indicator{color:#fff}.rocket-badge i{color:gold}.rocket-timer{color:#e0e7ff}</style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar for Quick Add -->
    <div class="sidebar" id="sidebar">
      <!-- Sidebar Toggle Button -->
      <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
        <i class="fas fa-chevron-left" id="toggleIcon"></i>
      </button>
      
      <!-- Sidebar Content (Hidden when collapsed) -->
      <div class="sidebar-content">
        <!--
        <h5 class="mb-3"><i class="fas fa-plus-circle"></i> Quick Add Task</h5>
      -->
        
        <!-- Selected Category Lists Badge Display -->
        <div id="selectedCategoryListsBadges" class="mb-3" style="display: none;">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <div class="small text-muted">Active Category Lists:</div>
            <button class="btn btn-outline-secondary btn-sm" onclick="manageCategoryLists()" title="Manage category list selection">
              <i class="fas fa-cog fa-sm"></i>
            </button>
          </div>
          <div id="categoryListsBadgeContainer"></div>
        </div>
        
      <div class="quick-add-form">
        <div class="mb-3">
          <label class="form-label">Task Title</label>
          <input type="text" class="form-control" id="quickTaskTitle" placeholder="Enter task title..." required>
        </div>
        <div class="mb-3">
          <label class="form-label">Due Date</label>
          <input type="date" class="form-control" id="quickTaskDue" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Status</label>
          <select class="form-select" id="quickTaskStatus">
            <option value="Draft">Draft</option>
            <option value="Ready">Ready</option>
            <option value="Estimated">Estimated</option>
            <option value="OnDeck">On Deck</option>
            <option value="InProgress">In Progress</option>
          </select>
        </div>
        <button class="btn btn-primary w-100 mb-3" id="quickAddBtn">
          <i class="fas fa-plus"></i> Add Task
        </button>
        
        <!-- Advanced Options Toggle -->
        <button class="btn btn-outline-secondary w-100 mb-2" id="expandAddBtn">
          <i class="fas fa-chevron-down"></i> More Options
        </button>
        
        <!-- Expanded form (hidden by default) -->
        <div id="expandedAddForm" style="display: none;">
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="quickTaskText" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Notes</label>
            <textarea class="form-control" id="quickTaskNotes" rows="4" placeholder="Additional notes, links, reminders..."></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Urgency</label>
            <select class="form-select" id="quickTaskUrgency">
              <option value="Low">Low</option>
              <option value="Med">Med</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Importance</label>
            <select class="form-select" id="quickTaskImportance">
              <option value="Low">Low</option>
              <option value="Med">Med</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Estimate (hrs)</label>
            <input type="number" class="form-control" id="quickTaskEstimate" min="0" step="0.1" value="0">
          </div>
          <div class="mb-3">
            <label class="form-label">Remaining (hrs)</label>
            <input type="number" class="form-control" id="quickTaskRemaining" min="0" step="0.1" value="0">
            <small class="form-text text-muted">Auto-syncs with estimate until you manually edit it</small>
          </div>
          <div class="mb-3">
            <label class="form-label">Project</label>
            <select class="form-select" id="quickTaskProject">
              <option value="">No Project (AdHoc)</option>
              <!-- Projects will be populated here -->
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Phase</label>
            <select class="form-select" id="quickTaskPhase">
              <option value="">No Phase</option>
              <!-- Phases will be populated here -->
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Category Lists</label>
            <div id="quickTaskCategoryLists" class="category-lists-selector">
              <!-- Category lists will be populated here -->
            </div>
            <small class="form-text text-muted">Select which category lists to use for time logging on this task</small>
          </div>
        </div>
      </div>
      </div> <!-- End sidebar-content -->
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Header Bar -->
      <div class="header-bar">
        <h1 class="header-title"><i class="fas fa-tasks"></i> Task Time Tracker</h1>
        
        <!-- Global Filters -->
        <div class="global-filters">
          <select id="globalProjectFilter">
            <option value="">All Projects</option>
          </select>
          <select id="globalPhaseFilter">
            <option value="">All Phases</option>
          </select>
          <button class="filter-clear" id="globalFilterClear" title="Clear all filters">×</button>
        </div>
        
        <!-- Active Rocket Indicator (hidden by default, shown when rocket is active) -->
        <div class="active-rocket-indicator" id="activeRocketIndicator" style="display: none;" title="Click to view in SpacePort">
          <i class="fas fa-rocket rocket-icon"></i>
          <span class="rocket-task-name" id="activeRocketTaskName">Task Name</span>
          <span class="rocket-time" id="activeRocketTime">00:00</span>
        </div>
        
        <!-- Import/Export on the far right -->
        <div class="header-actions">
          <!-- Punch Clock Button (Always Visible) -->
          <button class="btn btn-outline-primary btn-sm" id="punchClockBtn">
            <i class="fas fa-clock"></i> <span id="punchClockText">Punch In</span>
          </button>
          
          <!-- Todo List Button (Always Visible) -->
          <button class="btn btn-outline-success btn-sm" id="todoListBtn" data-bs-toggle="modal" data-bs-target="#todoListModal">
            <i class="fas fa-list-check"></i>
          </button>
          
          <!-- Expandable Actions Container -->
          <div class="header-actions-expandable" id="expandableActions" style="display: none;">
            <!-- Projects Button -->
            <button class="btn btn-outline-warning btn-sm" id="projectsBtn" data-bs-toggle="modal" data-bs-target="#projectsModal">
              <i class="fas fa-project-diagram"></i> Projects
            </button>
            <!-- Phases Button -->
            <button class="btn btn-outline-secondary btn-sm" id="phasesBtn" data-bs-toggle="modal" data-bs-target="#phaseListsModal">
              <i class="fas fa-layer-group"></i> Phases
            </button>
            <!-- Import Button -->
            <input type="file" id="importFile" accept=".json" style="display: none;">
            <button class="btn btn-outline-secondary btn-sm" id="importBtn">
              <i class="fas fa-upload"></i> Import
            </button>
            <!-- Export Button -->
            <button class="btn btn-outline-secondary btn-sm" id="exportBtn">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
          
          <!-- Toggle Button for Expandable Actions -->
          <button class="btn btn-outline-secondary btn-sm" id="toggleExpandableBtn" title="More options">
            <i class="fas fa-ellipsis-v"></i>
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <ul class="nav nav-tabs mb-3">
          <li class="nav-item">
            <a class="nav-link active" id="boardTab" href="#board">Board</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="monthTab" href="#month">Month</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="todayTab" href="#today">Today</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="reportsTab" href="#reports">
              <i class="fas fa-chart-bar me-1"></i>Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="workTab" href="#work" style="display: none;">
              <i class="fas fa-edit me-1"></i>Work
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="spaceportTab" href="#spaceport" title="SpacePort">
              <i class="fas fa-rocket"></i>
            </a>
          </li>
        </ul>
    
    <div id="summary"></div>
    <div id="taskList"></div>
    
    <!-- SpacePort View -->
    <div id="spaceportView">
      <!-- Mission Control Panel - Hidden (building serves as interface) -->
      <div class="mission-control" style="display: none;">
        <div class="control-panel">
          <h6>◊ Mission Control ◊</h6>
          <div class="mission-list" id="missionList">
            <div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">
              Punch In to Load Missions
            </div>
          </div>
          
          <div class="launch-controls" id="launchControls">
            <div style="color: #fff; font-size: 0.8rem; margin-bottom: 8px;">
              Active Mission: <span id="activeMissionName">None</span>
            </div>
            <button class="launch-btn" id="launchBtn">
              🚀 Launch Mission
            </button>
          </div>
        </div>
      </div>
      
      <!-- Spaceport Stats -->
      <div class="spaceport-stats">
        <h6>◊ Spaceport Status ◊</h6>
        <div class="stat-row">
          <span>Active Rocket:</span>
          <span class="stat-value" id="activeRocketDisplay">None</span>
        </div>
        <div class="stat-row">
          <span>Mission Time:</span>
          <span class="stat-value" id="missionTimeDisplay">00:00:00</span>
        </div>
        <div class="stat-row">
          <span>Rockets Deployed:</span>
          <span class="stat-value" id="rocketsCount">0</span>
        </div>
        <div class="stat-row">
          <span>Energy Status:</span>
          <span class="stat-value" id="energyStatus">Standby</span>
        </div>
        
        <hr style="border-color: rgba(100, 150, 255, 0.3); margin: 10px 0;">
        
        <!-- Spaceship Picker -->
        <div class="spaceship-picker">
          <div class="spaceship-picker-header" id="spaceshipPickerToggle">
            <strong>◊ Spaceship Type ◊</strong>
            <span class="spaceship-current" id="spaceshipCurrent">Random</span>
            <span class="spaceship-toggle-icon">▼</span>
          </div>
          <div class="spaceship-options" id="spaceshipOptions" style="display: none;">
            <button class="spaceship-btn" data-type="random" title="Random - Auto-select based on task">
              <span class="spaceship-icon">🎲</span>
              <span class="spaceship-name">Random</span>
            </button>
            <button class="spaceship-btn" data-type="scout" title="Scout - Small and agile">
              <span class="spaceship-icon">🚀</span>
              <span class="spaceship-name">Scout</span>
            </button>
            <button class="spaceship-btn" data-type="v2" title="V2 - Technical missions">
              <span class="spaceship-icon">🛸</span>
              <span class="spaceship-name">V2</span>
            </button>
            <button class="spaceship-btn" data-type="apollo" title="Apollo - Large projects">
              <span class="spaceship-icon">🚁</span>
              <span class="spaceship-name">Apollo</span>
            </button>
            <button class="spaceship-btn" data-type="cartoon" title="Cartoon - Fun and creative">
              <span class="spaceship-icon">🎈</span>
              <span class="spaceship-name">Cartoon</span>
            </button>
            <button class="spaceship-btn" data-type="xwing" title="X-Wing - Rebel Alliance fighter">
              <span class="spaceship-icon">⚔️</span>
              <span class="spaceship-name">X-Wing</span>
            </button>
            <button class="spaceship-btn" data-type="tie" title="TIE Fighter - Imperial starfighter">
              <span class="spaceship-icon">⬢</span>
              <span class="spaceship-name">TIE Fighter</span>
            </button>
          </div>
        </div>
        
        <hr style="border-color: rgba(100, 150, 255, 0.3); margin: 10px 0;">
        <div style="font-size: 0.7rem; color: #888; line-height: 1.3;">
          <div><strong>Operations:</strong></div>
          <div>• Select mission to deploy rocket</div>
          <div>• Click rocket to switch context</div>
          <div>• Launch to commit time</div>
        </div>
      </div>
      
      <!-- Spaceport Canvas -->
      <canvas id="spaceportCanvas" width="1200" height="800"></canvas>
      
      <!-- Punch Controls -->
      <div class="punch-controls">
        <div class="punch-status-display" id="spaceportStatus">
          Mission Control Standby
        </div>
        <button class="punch-btn" id="spaceportPunchBtn">
          Initiate Operations
        </button>
      </div>
    </div>
      </div>
    </div>
  </div>

  <!-- Category Lists Manager Modal -->
  <div class="modal fade" id="categoryListsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-tags me-2"></i>Category Lists Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Lists Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Category Lists</h6>
                <button id="newCategoryListBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New List
                </button>
              </div>
              <div id="categoryListsContainer" class="list-group">
                <!-- Lists will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="categoryListEditor" style="display: none;">
                <form id="categoryListForm">
                  <div class="mb-3">
                    <label for="categoryListTitle" class="form-label">List Title</label>
                    <input type="text" class="form-control" id="categoryListTitle" required>
                    <div class="form-text">Slug: <span id="categoryListSlugPreview"></span></div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="categoryListDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="categoryListDescription" rows="2"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label mb-0">Categories</label>
                      <button type="button" id="addCategoryBtn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus me-1"></i>Add Category
                      </button>
                    </div>
                    <div id="categoriesContainer" class="border rounded p-2" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                      <!-- Categories will be populated here -->
                    </div>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save List
                    </button>
                    <button type="button" id="deleteCategoryListBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete List
                    </button>
                    <button type="button" id="cancelCategoryListBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="categoryListPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-tags fa-3x mb-3 opacity-50"></i>
                <p>Select a category list to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Manager Modal -->
  <div class="modal fade" id="projectsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-project-diagram me-2"></i>Projects Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Projects Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Projects</h6>
                <button id="newProjectBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New Project
                </button>
              </div>
              <div id="projectsContainer" class="list-group">
                <!-- Projects will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="projectEditor" style="display: none;">
                <form id="projectForm">
                  <div class="mb-3">
                    <label for="projectName" class="form-label">Project Name</label>
                    <input type="text" class="form-control" id="projectName" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="projectDescription" rows="3"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectStatus" class="form-label">Status</label>
                    <select class="form-select" id="projectStatus" required>
                      <option value="Ready">Ready</option>
                      <option value="Estimated">Estimated</option>
                      <option value="InProgress">In Progress</option>
                      <option value="Blocked">Blocked</option>
                      <option value="Backburner">Backburner</option>
                      <option value="OnHold">On Hold</option>
                      <option value="Completed">Completed</option>
                      <option value="Abandoned">Abandoned</option>
                      <option value="Archived">Archived</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectPhaseList" class="form-label">Phase List</label>
                    <select class="form-select" id="projectPhaseList">
                      <option value="">No Phase List</option>
                      <!-- Phase lists will be populated here -->
                    </select>
                    <small class="form-text text-muted">Select a phase list to associate with this project</small>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save Project
                    </button>
                    <button type="button" id="deleteProjectBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete Project
                    </button>
                    <button type="button" id="cancelProjectBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="projectPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-project-diagram fa-3x mb-3 opacity-50"></i>
                <p>Select a project to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase Lists Manager Modal -->
  <div class="modal fade" id="phaseListsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-layer-group me-2"></i>Phase Lists Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Lists Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Phase Lists</h6>
                <button id="newPhaseListBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New List
                </button>
              </div>
              <div id="phaseListsContainer" class="list-group">
                <!-- Lists will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="phaseListEditor" style="display: none;">
                <form id="phaseListForm">
                  <div class="mb-3">
                    <label for="phaseListTitle" class="form-label">List Title</label>
                    <input type="text" class="form-control" id="phaseListTitle" required>
                    <div class="form-text">Slug: <span id="phaseListSlugPreview"></span></div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="phaseListDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="phaseListDescription" rows="2"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label mb-0">Phases</label>
                      <button type="button" id="addPhaseBtn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus me-1"></i>Add Phase
                      </button>
                    </div>
                    <div id="phasesContainer" class="border rounded p-2" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                      <!-- Phases will be populated here -->
                    </div>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save List
                    </button>
                    <button type="button" id="deletePhaseListBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete List
                    </button>
                    <button type="button" id="cancelPhaseListBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="phaseListPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-layer-group fa-3x mb-3 opacity-50"></i>
                <p>Select a phase list to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Todo List Modal -->
  <div class="modal fade" id="todoListModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-list-check me-2"></i>Todo List
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Todo Form -->
          <div class="todo-form mb-4">
            <div class="input-group mb-2">
              <input type="text" id="modalTodoTitleInput" class="form-control" placeholder="Add a new todo..." maxlength="100">
              <button class="btn btn-primary" type="button" id="modalTodoAddBtn">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div id="modalTodoDetailsInput" class="todo-details" style="display: none;">
              <textarea class="form-control" placeholder="Optional details..." rows="2" maxlength="300"></textarea>
              <div class="mt-2 d-flex justify-content-end gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="modalCancelTodoDetails">Cancel</button>
                <button class="btn btn-sm btn-success" id="modalSubmitTodoWithDetails">Add Todo</button>
              </div>
            </div>
            <small class="text-muted">Press Enter to add quickly, or click + for details</small>
          </div>
          
          <!-- Todo List Controls -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">Your Todos</h6>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="modalShowCompletedTodos">
              <label class="form-check-label" for="modalShowCompletedTodos">
                Show completed
              </label>
            </div>
          </div>
          
          <!-- Todo List Container -->
          <div id="modalTodosList" style="max-height: 400px; overflow-y: auto;">
            <!-- Todos will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Details Modal -->
  <div class="modal fade" id="taskDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-tasks me-2"></i>Task Details
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="taskDetailsForm">
            <input type="hidden" id="taskDetailsId">
            
            <div class="row">
              <div class="col-md-8">
                <div class="mb-3">
                  <label for="taskDetailsTitle" class="form-label">Title</label>
                  <input type="text" class="form-control" id="taskDetailsTitle" required>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsDescription" class="form-label">Description</label>
                  <textarea class="form-control" id="taskDetailsDescription" rows="3"></textarea>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsNotes" class="form-label">Notes</label>
                  <textarea class="form-control" id="taskDetailsNotes" rows="4"></textarea>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="taskDetailsDueOn" class="form-label">Due Date</label>
                  <input type="date" class="form-control" id="taskDetailsDueOn" required>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsStatus" class="form-label">Status</label>
                  <select class="form-select" id="taskDetailsStatus">
                    <option value="Ready">Ready</option>
                    <option value="Estimated">Estimated</option>
                    <option value="InProgress">InProgress</option>
                    <option value="Blocked">Blocked</option>
                    <option value="Backburner">Backburner</option>
                    <option value="OnHold">OnHold</option>
                    <option value="Completed">Completed</option>
                    <option value="Abandoned">Abandoned</option>
                    <option value="Archived">Archived</option>
                  </select>
                </div>
                
                <div class="row">
                  <div class="col-6">
                    <div class="mb-3">
                      <label for="taskDetailsUrgency" class="form-label">Urgency</label>
                      <select class="form-select" id="taskDetailsUrgency">
                        <option value="Low">Low</option>
                        <option value="Med">Med</option>
                        <option value="High">High</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-3">
                      <label for="taskDetailsImportance" class="form-label">Importance</label>
                      <select class="form-select" id="taskDetailsImportance">
                        <option value="Low">Low</option>
                        <option value="Med">Med</option>
                        <option value="High">High</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsEstimate" class="form-label">Estimate (hrs)</label>
                  <input type="number" class="form-control" id="taskDetailsEstimate" min="0" step="0.1" value="0">
                </div>
              </div>
            </div>
            
            <hr>
            
            <div class="row">
              <div class="col-6">
                <div class="mb-3">
                  <label for="taskDetailsProject" class="form-label">Project</label>
                  <select class="form-select" id="taskDetailsProject">
                    <option value="">No Project (AdHoc)</option>
                    <!-- Projects will be populated here -->
                  </select>
                </div>
              </div>
              <div class="col-6">
                <div class="mb-3">
                  <label for="taskDetailsPhase" class="form-label">Phase</label>
                  <select class="form-select" id="taskDetailsPhase">
                    <option value="">No Phase</option>
                    <!-- Phases will be populated here -->
                  </select>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Category Lists</label>
              <div id="taskDetailsCategoryLists" class="category-lists-selector">
                <!-- Category lists will be populated here -->
              </div>
              <small class="form-text text-muted">Select which category lists to use for time logging on this task</small>
            </div>
            
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-1"></i>Save Changes
              </button>
              <button type="button" id="deleteTaskDetailsBtn" class="btn btn-outline-danger">
                <i class="fas fa-trash me-1"></i>Delete Task
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Time Log Modal -->
  <div class="modal fade" id="timeLogModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-clock me-2"></i>Log Time
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="timeLogForm">
            <input type="hidden" id="timeLogTaskId">
            
            <div class="mb-3">
              <label class="form-label fw-semibold">Task</label>
              <div id="timeLogTaskDisplay" class="p-2 bg-light rounded">
                <!-- Task title will be displayed here -->
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="timeLogHours" class="form-label">Hours</label>
                  <input type="number" class="form-control" id="timeLogHours" 
                         min="0" step="0.25" placeholder="0.0" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="timeLogDate" class="form-label">Date</label>
                  <input type="date" class="form-control" id="timeLogDate" required>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Category</label>
              <div id="timeLogCategoryContainer">
                <!-- Category selector will be populated here -->
              </div>
            </div>
            
            <div class="mb-3">
              <label for="timeLogDescription" class="form-label">Description (optional)</label>
              <textarea class="form-control" id="timeLogDescription" rows="3" 
                        placeholder="What did you work on?"></textarea>
            </div>
            
            <div class="d-flex justify-content-between">
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="0.25">15m</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="0.5">30m</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="1">1h</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="2">2h</button>
              </div>
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-1"></i>Log Time
              </button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-danger delete-task-btn" data-task-id="" title="Delete Task">
            <i class="fas fa-trash me-1"></i>Delete Task
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteConfirmModalLabel">
            <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-danger bg-opacity-10 rounded-circle p-3 me-3">
              <i class="fas fa-trash text-danger fa-2x"></i>
            </div>
            <div>
              <h6 class="mb-1">Are you sure you want to delete this item?</h6>
              <p class="text-muted mb-0" id="deleteConfirmMessage">This action cannot be undone.</p>
            </div>
          </div>
          <div class="alert alert-warning mb-0">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Warning:</strong> <span id="deleteWarningText">This will permanently delete the item and all associated data.</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
            <i class="fas fa-trash me-2"></i>Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container for Notifications -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <!-- Toasts will be dynamically added here -->
  </div>

  <!-- Punch Clock Modal -->
  <div class="modal fade" id="punchClockModal" tabindex="-1" aria-labelledby="punchClockModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="punchClockModalLabel">
            <i class="fas fa-clock me-2"></i>Time Clock Station
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Punch Card Visual -->
          <div class="punch-card-container text-center mb-4">
            <div class="punch-card">
              <div class="punch-card-header">
                <h6 class="mb-1">Daily Time Card</h6>
                <div class="card-date" id="punchCardDate"></div>
              </div>
              <div class="punch-card-content">
                <div class="time-slots" id="timeSlots" style="max-height: 150px; overflow-y: auto;">
                  <!-- Dynamic time slots will be added here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Current Status -->
          <div class="current-status text-center mb-4">
            <div class="status-display" id="currentStatus">
              <div class="status-icon" id="statusIcon">🕘</div>
              <div class="status-text" id="statusText">Ready to Start Work</div>
              <div class="status-time" id="statusTime"></div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons text-center">
            <!-- Validation Messages -->
            <div class="validation-message warning" id="punchOutWarning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <span id="punchOutWarningText"></span>
              <div class="mt-2">
                <button class="btn btn-sm btn-warning me-2" id="confirmEarlyPunchOut">Yes, End Early</button>
                <button class="btn btn-sm btn-secondary" id="cancelEarlyPunchOut">Continue Working</button>
              </div>
            </div>

            <!-- Primary Action (Punch In/Out) -->
            <div class="primary-action mb-3">
              <button class="btn btn-lg punch-btn" id="primaryPunchBtn">
                <i class="fas fa-play"></i>
                <span id="primaryPunchText">Start Work Day</span>
              </button>
            </div>

            <!-- Interruption Buttons (shown when punched in) -->
            <div class="interruption-buttons" id="interruptionButtons" style="display: none;">
              <!-- Return to Work button (shown when on break) -->
              <div class="return-to-work mb-3" id="returnToWorkSection" style="display: none;">
                <button class="btn btn-success w-100" id="returnToWorkBtn">
                  <i class="fas fa-briefcase"></i> Return to Work
                </button>
              </div>
              
              <div class="row g-2 mb-3" id="interruptionButtonsRow">
                <div class="col-4">
                  <button class="btn btn-outline-warning w-100" id="lunchBtn">
                    <i class="fas fa-utensils me-1"></i>Lunch
                  </button>
                </div>
                <div class="col-4">
                  <button class="btn btn-outline-info w-100" id="meetingBtn">
                    <i class="fas fa-users me-1"></i>Meeting
                  </button>
                </div>
                <div class="col-4">
                  <button class="btn btn-outline-secondary w-100" id="personalBtn">
                    <i class="fas fa-user me-1"></i>Personal
                  </button>
                </div>
              </div>
              <div class="custom-interruption">
                <div class="input-group">
                  <input type="text" class="form-control" id="customInterruptionInput" placeholder="Custom interruption...">
                  <button class="btn btn-outline-primary" id="addCustomInterruptionBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Daily Summary -->
          <div class="daily-summary" id="dailySummary">
            <hr>
            <h6><i class="fas fa-chart-bar me-2"></i>Today's Summary</h6>
            <div class="row text-center">
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="totalHours">0h 0m</div>
                  <div class="summary-label">Total</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="workHours">0h 0m</div>
                  <div class="summary-label">Work</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="breakHours">0h 0m</div>
                  <div class="summary-label">Breaks</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="currentSession">0h 0m</div>
                  <div class="summary-label">Session</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Time Entry Modal -->
  <div class="modal fade" id="quickTimeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-clock me-2"></i>Log Time</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="quickTimeTaskId">
          <div class="mb-3">
            <label for="quickTimeHours" class="form-label">Hours</label>
            <input type="number" class="form-control" id="quickTimeHours" step="0.25" min="0" placeholder="e.g., 1.5">
          </div>
          <div class="mb-3">
            <label for="quickTimeDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="quickTimeDate">
          </div>
          <div class="mb-3">
            <label for="quickTimeNotes" class="form-label">Notes (optional)</label>
            <textarea class="form-control" id="quickTimeNotes" rows="2" placeholder="What did you work on?"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveQuickTimeBtn">Log Time</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>