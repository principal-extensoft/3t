<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Time Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  
  <!-- New Modular CSS Architecture -->

  <script type="module" crossorigin>import{openDB as Et}from"https://cdn.jsdelivr.net/npm/idb@7.1.1/build/index.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();const Lt="TaskTimeTracker",Bt=10,I=Et(Lt,Bt,{upgrade(e,t){if(console.log("Upgrading database from version",t),t<1){const s=e.createObjectStore("tasks",{keyPath:"id",autoIncrement:!0});s.createIndex("dueOn","dueOn"),s.createIndex("status","status"),s.createIndex("urgency","urgency");const o=e.createObjectStore("timeLogs",{keyPath:"id",autoIncrement:!0});o.createIndex("taskId","taskId"),o.createIndex("dateLogged","dateLogged")}if(t<5){if(!e.objectStoreNames.contains("todos")){const s=e.createObjectStore("todos",{keyPath:"id",autoIncrement:!0});s.createIndex("date","date"),s.createIndex("completed","completed")}e.objectStoreNames.contains("accomplishments")||e.createObjectStore("accomplishments",{keyPath:"id",autoIncrement:!0}).createIndex("date","date")}if(t<6&&!e.objectStoreNames.contains("workSessions")){const s=e.createObjectStore("workSessions",{keyPath:"id",autoIncrement:!0});s.createIndex("date","date"),s.createIndex("punchIn","punchIn"),s.createIndex("punchOut","punchOut")}if(t<7&&!e.objectStoreNames.contains("categoryLists")){const s=e.createObjectStore("categoryLists",{keyPath:"id",autoIncrement:!0});s.createIndex("slug","slug",{unique:!0}),s.createIndex("title","title")}if(t<8&&!e.objectStoreNames.contains("remainingHoursHistory")){const s=e.createObjectStore("remainingHoursHistory",{keyPath:"id",autoIncrement:!0});s.createIndex("taskId","taskId"),s.createIndex("timestamp","timestamp")}if(t<9){if(!e.objectStoreNames.contains("projects")){const s=e.createObjectStore("projects",{keyPath:"id",autoIncrement:!0});s.createIndex("name","name"),s.createIndex("status","status")}e.objectStoreNames.contains("phases")||e.createObjectStore("phases",{keyPath:"id",autoIncrement:!0}).createIndex("name","name")}if(t<10&&(e.objectStoreNames.contains("phases")&&e.deleteObjectStore("phases"),!e.objectStoreNames.contains("phaseLists"))){const s=e.createObjectStore("phaseLists",{keyPath:"id",autoIncrement:!0});s.createIndex("slug","slug",{unique:!0}),s.createIndex("title","title")}}});class $t{constructor(){this.listeners={},this.debug=!1}on(t,s){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(s),this.debug&&console.log(`[EventBus] Subscribed to '${t}' (${this.listeners[t].length} listeners)`),()=>this.off(t,s)}once(t,s){const o=(...a)=>{s(...a),this.off(t,o)};return this.on(t,o)}off(t,s){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(o=>o!==s),this.debug&&console.log(`[EventBus] Unsubscribed from '${t}' (${this.listeners[t].length} listeners remaining)`),this.listeners[t].length===0&&delete this.listeners[t])}clear(t=null){t?(delete this.listeners[t],this.debug&&console.log(`[EventBus] Cleared all listeners for '${t}'`)):(this.listeners={},this.debug&&console.log("[EventBus] Cleared all listeners"))}emit(t,s){if(!this.listeners[t]||this.listeners[t].length===0){this.debug&&console.log(`[EventBus] No listeners for '${t}'`);return}this.debug&&console.log(`[EventBus] Emitting '${t}' to ${this.listeners[t].length} listener(s)`,s),this.listeners[t].forEach(o=>{try{o(s)}catch(a){console.error(`[EventBus] Error in listener for '${t}':`,a)}})}listenerCount(t){return this.listeners[t]?this.listeners[t].length:0}eventNames(){return Object.keys(this.listeners)}setDebug(t){this.debug=t,console.log(`[EventBus] Debug mode ${t?"enabled":"disabled"}`)}}const T=new $t;let ke="board",Je=0,we=Pt();function Pt(){try{const e=localStorage.getItem("trackerSpaceportSession");if(e){const t=JSON.parse(e);return t.rockets&&Array.isArray(t.rockets)?t.rockets=new Map(t.rockets):t.rockets=new Map,console.log("Loaded spaceport session from storage:",t),t}}catch(e){console.warn("Could not load spaceport session from localStorage:",e)}return{isOperational:!1,startTime:null,activeRocket:null,rockets:new Map,sessionStartTime:null,launchPads:[]}}function Dt(){try{const e={...we,rockets:Array.from(we.rockets.entries())};localStorage.setItem("trackerSpaceportSession",JSON.stringify(e))}catch(e){console.warn("Could not save spaceport session to localStorage:",e)}}let W=Mt();function Mt(){try{const e=localStorage.getItem("trackerGlobalFilters");if(e)return JSON.parse(e)}catch(e){console.warn("Could not load filters from localStorage:",e)}return{projectId:null,phaseId:null,categoryId:null,dateRange:null}}function Ze(){try{localStorage.setItem("trackerGlobalFilters",JSON.stringify(W))}catch(e){console.warn("Could not save filters to localStorage:",e)}}function ee(){return ke}function Ct(e){["board","month","calendar","today","spaceport","work","reports","all"].includes(e)||(console.warn(`Invalid view: ${e}. Defaulting to 'board'`),e="board"),ke=e,console.log("View changed to:",ke)}function N(){return Je}function ye(e){Je=e}function L(){return we}function q(){Dt()}function R(){return{...W}}function X(e){const t={...W};W={...W,...e},Ze(),T.emit("filters:changed",{filters:{...W},oldFilters:t})}function At(){const e={...W};W={projectId:null,phaseId:null,categoryId:null,dateRange:null},Ze(),T.emit("filters:changed",{filters:{...W},oldFilters:e})}function Ne(e){return{Ready:"secondary",Estimated:"info",InProgress:"primary",Blocked:"danger",Backburner:"warning",OnHold:"warning",Completed:"success",Abandoned:"dark",Archived:"light"}[e]||"secondary"}function v(e,t="info",s=5e3){const o=document.querySelector(".toast-container");if(!o){console.warn("Toast container not found in DOM");return}const a="toast-"+Date.now(),n=`
    <div class="toast toast-${t}" role="alert" aria-live="assertive" aria-atomic="true" id="${a}">
      <div class="toast-header">
        <i class="fas ${Ht(t)} me-2"></i>
        <strong class="me-auto">${xt(t)}</strong>
        <small class="text-muted">now</small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        ${e}
      </div>
    </div>
  `;o.insertAdjacentHTML("beforeend",n);const i=document.getElementById(a);new bootstrap.Toast(i,{delay:s}).show(),i.addEventListener("hidden.bs.toast",()=>{i.remove()})}function Ht(e){return{success:"fa-check-circle",warning:"fa-exclamation-triangle",error:"fa-times-circle",info:"fa-info-circle"}[e]||"fa-info-circle"}function xt(e){return{success:"Success",warning:"Warning",error:"Error",info:"Info"}[e]||"Notification"}function te(){return new Date().toISOString().split("T")[0]}function Pe(e){return Math.round(e*4)/4}function J(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}async function et(e,t=null){try{const o=await(await I).getAllFromIndex("categoryLists","slug",e);return t?!o.some(a=>a.id!==t):o.length===0}catch(s){return console.error("Error checking slug uniqueness:",s),!1}}async function he(){try{return await(await I).getAll("categoryLists")}catch(e){return console.error("Error loading category lists:",e),[]}}async function tt(e){try{const t=await I;if(!e.slug&&e.title&&(e.slug=J(e.title)),e.categories&&(e.categories=e.categories.map(o=>({title:o.title,slug:o.slug||`${e.slug}.${J(o.title)}`}))),!await et(e.slug,e.id))throw new Error(`Slug "${e.slug}" already exists. Please choose a different title.`);const s=await t.put("categoryLists",e);return e.id||(e.id=s),v(`Category list "${e.title}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving category list:",t),v("Failed to save category list: "+t.message,"error"),t}}async function st(e){try{return await(await I).delete("categoryLists",e),v("Category list deleted successfully!","success"),!0}catch(t){return console.error("Error deleting category list:",t),v("Failed to delete category list: "+t.message,"error"),!1}}function ot(e){if(!e||!e.includes("."))return{listSlug:null,itemSlug:null};const[t,...s]=e.split("."),o=s.join(".");return{listSlug:t,itemSlug:o}}function at(e){const t={};for(const s of e){const o=s.category||"uncategorized";t[o]||(t[o]=0),t[o]+=s.hours||0}return t}const Ot=Object.freeze(Object.defineProperty({__proto__:null,calculateCategoryTimeSummaries:at,deleteCategoryList:st,generateSlug:J,getCategoryLists:he,isSlugUnique:et,parseCategoryKey:ot,saveCategoryList:tt},Symbol.toStringTag,{value:"Module"}));async function se(){try{return await(await I).getAll("projects")}catch(e){return console.error("Error loading projects:",e),[]}}async function Wt(e){try{const t=await I;if(!e.name||e.name.trim()==="")throw new Error("Project name is required");e.status||(e.status="Ready"),e.createdAt||(e.createdAt=new Date().toISOString());const s=await t.put("projects",e);return e.id||(e.id=s),v(`Project "${e.name}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving project:",t),v("Failed to save project: "+t.message,"error"),t}}async function Rt(e){try{const t=await I,o=(await t.getAll("tasks")).filter(a=>a.projectId===e);if(o.length>0)throw new Error(`Cannot delete project: ${o.length} task(s) are still linked to it`);return await t.delete("projects",e),v("Project deleted successfully!","success"),!0}catch(t){return console.error("Error deleting project:",t),v("Failed to delete project: "+t.message,"error"),!1}}async function De(e){if(!e)return{name:"",shortName:""};try{const s=await(await I).get("projects",parseInt(e));return s?{name:s.name,shortName:s.name.length>12?s.name.substring(0,12)+"...":s.name}:{name:`Project ${e}`,shortName:`P${e}`}}catch(t){return console.error("Error getting project display info:",t),{name:`Project ${e}`,shortName:`P${e}`}}}async function oe(){try{return await(await I).getAll("phaseLists")}catch(e){return console.error("Error loading phase lists:",e),[]}}async function Ft(e){try{const s=await(await I).getAllFromIndex("phaseLists","slug",e);return s.length>0?s[0]:null}catch(t){return console.error("Error loading phase list by slug:",t),null}}async function jt(e){try{const t=await I;!e.slug&&e.title&&(e.slug=J(e.title)),e.phases&&(e.phases=e.phases.map(o=>({title:o.title,slug:o.slug||`${e.slug}.${J(o.title)}`})));const s=await t.put("phaseLists",e);return e.id||(e.id=s),v(`Phase list "${e.title}" saved successfully!`,"success"),e}catch(t){throw console.error("Error saving phase list:",t),v("Failed to save phase list: "+t.message,"error"),t}}async function qt(e){try{return await(await I).delete("phaseLists",e),v("Phase list deleted successfully!","success"),!0}catch(t){return console.error("Error deleting phase list:",t),v("Failed to delete phase list: "+t.message,"error"),!1}}async function Me(e){var o;if(!e)return{listTitle:"",itemTitle:"",shortTitle:""};const{listSlug:t,itemSlug:s}=ot(e);if(!t||!s)return{listTitle:"",itemTitle:e,shortTitle:e};try{const a=await Ft(t);if(!a)return{listTitle:t,itemTitle:s,shortTitle:s};const n=(o=a.phases)==null?void 0:o.find(c=>c.slug===s),i=n?n.title:s,l=i.length>10?i.substring(0,10)+"...":i;return{listTitle:a.title,itemTitle:i,shortTitle:l}}catch(a){return console.error("Error getting phase display info:",a),{listTitle:t,itemTitle:s,shortTitle:s}}}async function Ce(e){console.log("Attempting to save time log:",e);try{const t=await I,s=await t.get("tasks",e.taskId);if(!s||!["Estimated","InProgress"].includes(s.status))return console.warn("Invalid task status for time log:",s==null?void 0:s.status),v("Time can only be logged for tasks in Estimated or InProgress status.","warning"),!1;e.dateLogged||(e.dateLogged=new Date().toISOString().split("T")[0]);const o=t.transaction("timeLogs","readwrite");return await o.store.put(e),await o.done,console.log("Time log saved successfully:",e),!0}catch(t){return console.error("Error saving time log:",t),!1}}async function Nt(e){console.log("Attempting to delete time log:",e);try{const s=(await I).transaction("timeLogs","readwrite");return await s.store.delete(e),await s.done,console.log("Time log deleted successfully:",e),!0}catch(t){return console.error("Error deleting time log:",t),!1}}async function D(e,t=null,s=null){console.log("Fetching time logs for task:",e,"range:",t,s);try{const o=await I,n=(e?await o.getAllFromIndex("timeLogs","taskId",e):await o.getAll("timeLogs")).filter(i=>!t||!s?!0:i.dateLogged>=t&&i.dateLogged<=s);return console.log("Fetched time logs:",n.length),n}catch(o){return console.error("Error fetching time logs:",o),[]}}async function Ae(e=null,t=null){return D(null,e,t)}const zt={Ready:["Estimated","InProgress","Abandoned","Archived"],Estimated:["InProgress","Abandoned","Archived"],InProgress:["Blocked","Backburner","OnHold","Completed","Abandoned","Archived"],Blocked:["InProgress","Backburner","OnHold","Abandoned","Archived"],Backburner:["InProgress","Blocked","OnHold","Abandoned","Archived"],OnHold:["InProgress","Abandoned","Archived"],Completed:["Abandoned","Archived"],Abandoned:["Archived"],Archived:[]};function Vt(e,t){var s;return!e||!t?!1:e===t?!0:((s=zt[e])==null?void 0:s.includes(t))||!1}async function He(e,t=!1){console.log("Attempting to save task:",e);try{const s=await I;if(!t){if(e.statusHistory=[{status:e.status||"Ready",timestamp:new Date().toISOString(),note:"Task created"}],e.createdAt=new Date().toISOString(),e.remainingHours===void 0&&(e.remainingHours=e.estimate||0),e.remainingHours>0){const n={taskId:null,remainingHours:e.remainingHours,timestamp:new Date().toISOString(),note:"Initial estimate"};e._initialRemainingHoursEntry=n}console.log("New task - initialized status history:",e.statusHistory),console.log("New task - initialized remaining hours:",e.remainingHours)}if(t&&e.status&&e.id){const n=await s.get("tasks",e.id);if(console.log("Current task from DB:",n),console.log("Task being saved:",e),n){if(n.statusHistory||(console.log("No status history found, initializing..."),n.statusHistory=[{status:n.status,timestamp:n.createdAt||new Date().toISOString(),note:"Legacy task - initial status"}]),console.log("Current task status:",n.status,"New task status:",e.status),n.status!==e.status){if(console.log("Status changed! Adding to history..."),!Vt(n.status,e.status))return console.warn(`Invalid status transition from ${n.status} to ${e.status}`),v(`Invalid status transition from ${n.status} to ${e.status}`,"error"),!1;e.statusHistory=[...n.statusHistory,{status:e.status,timestamp:new Date().toISOString(),note:`${n.status} => ${e.status}`}],console.log("Status changed - updated history:",e.statusHistory)}else console.log("Status unchanged, preserving existing history"),e.statusHistory=n.statusHistory;e.createdAt=n.createdAt||new Date().toISOString()}}const o=s.transaction(["tasks","remainingHoursHistory"],"readwrite"),a=await o.objectStore("tasks").put(e);return!t&&e._initialRemainingHoursEntry&&(e._initialRemainingHoursEntry.taskId=a,await o.objectStore("remainingHoursHistory").add(e._initialRemainingHoursEntry),delete e._initialRemainingHoursEntry),await o.done,console.log("Task saved successfully with status history:",e),t?T.emit("task:updated",{taskId:a,task:e}):T.emit("task:created",{taskId:a,task:e}),!0}catch(s){return console.error("Error saving task:",s),!1}}async function Ut(e){console.log("Attempting to delete task:",e);try{const s=(await I).transaction(["tasks","timeLogs","remainingHoursHistory"],"readwrite");await s.objectStore("tasks").delete(e);const o=await s.objectStore("timeLogs").index("taskId").getAll(e);for(const n of o)await s.objectStore("timeLogs").delete(n.id);const a=await s.objectStore("remainingHoursHistory").index("taskId").getAll(e);for(const n of a)await s.objectStore("remainingHoursHistory").delete(n.id);return await s.done,console.log("Task deleted successfully:",e),T.emit("task:deleted",{taskId:e}),!0}catch(t){return console.error("Error deleting task:",t),!1}}async function C(e={},t=!1){console.log("Fetching tasks with filters:",e,"includeAll:",t);try{const a=(await(await I).getAll("tasks")).filter(n=>!(e.status&&n.status!==e.status||e.urgency&&n.urgency!==e.urgency||e.projectId&&n.projectId!==e.projectId||e.dueOn&&n.dueOn!==e.dueOn||!t&&["Completed","Abandoned","Archived"].includes(n.status)));return console.log("Fetched tasks:",a.length),a}catch(s){return console.error("Error fetching tasks:",s),[]}}async function xe(e,t,s=""){try{const o=await I,a=await o.get("tasks",e);if(!a)return console.error("Task not found:",e),!1;const n=a.remainingHours||0;if(n!==t){a.remainingHours=t;const i={taskId:e,remainingHours:t,previousRemainingHours:n,timestamp:new Date().toISOString(),note:s||`Updated remaining hours from ${n}h to ${t}h`},l=o.transaction(["tasks","remainingHoursHistory"],"readwrite");return await l.objectStore("tasks").put(a),await l.objectStore("remainingHoursHistory").add(i),await l.done,console.log("Remaining hours updated:",i),!0}return!1}catch(o){return console.error("Error updating remaining hours:",o),!1}}async function fe(e,t=""){const s={title:e,content:t,completed:!1,createdAt:new Date().toISOString(),completedAt:null};try{const a=await(await I).add("todos",s);return s.id=a,T.emit("todo:created",{todo:s}),s}catch(o){return console.error("Error adding todo:",o),null}}async function Oe(e=!1){try{const s=await(await I).getAll("todos"),o=e?s:s.filter(a=>!a.completed);return o.sort((a,n)=>a.completed!==n.completed?a.completed?1:-1:new Date(n.createdAt)-new Date(a.createdAt)),o}catch(t){return console.error("Error loading todos:",t),[]}}async function Yt(e){try{const t=await I,s=await t.get("todos",e);return await t.delete("todos",e),s&&T.emit("todo:deleted",{todoId:e,todo:s}),!0}catch(t){return console.error("Error deleting todo:",t),!1}}async function _t(e){try{const t=await I,s=await t.get("todos",e);if(!s)return console.error("Todo not found:",e),!1;const o=s.completed;return s.completed=!s.completed,s.completed?s.completedAt=new Date().toISOString():s.completedAt=null,await t.put("todos",s),T.emit("todo:toggled",{todo:s,completed:s.completed}),s.completed&&!o?T.emit("todo:completed",{todo:s}):!s.completed&&o&&T.emit("todo:uncompleted",{todo:s}),!0}catch(t){return console.error("Error toggling todo:",t),!1}}async function nt(e,t="",s=null){const o={title:e,content:t,date:s||te(),createdAt:new Date().toISOString()};try{const n=await(await I).add("accomplishments",o);return o.id=n,T.emit("accomplishment:added",{accomplishment:o}),o}catch(a){return console.error("Error adding accomplishment:",a),null}}async function We(e=null){try{const t=await I,s=e||te(),a=(await t.getAll("accomplishments")).filter(n=>n.date===s);return a.sort((n,i)=>new Date(i.createdAt)-new Date(n.createdAt)),a}catch(t){return console.error("Error loading accomplishments:",t),[]}}async function Gt(e){try{const t=await I,s=await t.get("accomplishments",e);return await t.delete("accomplishments",e),s&&T.emit("accomplishment:deleted",{accomplishmentId:e,accomplishment:s}),!0}catch(t){return console.error("Error deleting accomplishment:",t),!1}}async function G(){try{return(await(await I).getAll("workSessions")).find(o=>!o.punchOut)||null}catch(e){return console.error("Error getting active work session:",e),null}}async function Re(e=null){try{const t=await I,s=e||te();return(await t.getAll("workSessions")).find(n=>n.date===s)||null}catch(t){return console.error("Error getting work session:",t),null}}async function Qt(e){try{const t=await I;if(e.punchIn&&e.punchOut){const s=new Date(e.punchIn),n=(new Date(e.punchOut)-s)/(1e3*60*60);e.totalHours=parseFloat(n.toFixed(2))}if(e.activities||(e.activities=[]),e.breaks||(e.breaks=[]),e.id)await t.put("workSessions",e);else{const{id:s,...o}=e,a=await t.add("workSessions",o);e.id=a}return e}catch(t){return console.error("Error saving work session:",t),v("Failed to save work session","error"),null}}async function Xt(e){try{return await(await I).delete("workSessions",e),!0}catch(t){return console.error("Error deleting work session:",t),v("Failed to delete work session","error"),!1}}async function Kt(){try{const e=await G();if(e)return v("You are already punched in!","warning"),e;const t=await I,s=new Date().toISOString(),o={date:te(),punchIn:s,punchOut:null,totalHours:null,breaks:[],activities:[{startTime:s,endTime:null,category:"work",description:"Work Time"}]},a=await t.add("workSessions",o);return o.id=a,T.emit("session:punchedIn",{sessionId:a,timestamp:s,date:o.date}),o}catch(e){return console.error("Error punching in:",e),null}}async function Jt(){try{const e=await G();if(!e)return v("No active work session found","warning"),null;const t=await I,s=new Date().toISOString();if(e.activities&&e.activities.length>0){const l=e.activities[e.activities.length-1];l.endTime||(l.endTime=s)}const o=new Date(e.punchIn),i=(new Date(s)-o)/(1e3*60*60);return e.punchOut=s,e.totalHours=parseFloat(i.toFixed(2)),await t.put("workSessions",e),T.emit("session:punchedOut",{sessionId:e.id,timestamp:s,totalHours:e.totalHours,date:e.date}),e}catch(e){return console.error("Error punching out:",e),null}}async function Zt(e,t){try{const s=await G();if(!s)return v("No active work session. Please punch in first.","warning"),null;const o=await I,a=new Date().toISOString();if(s.activities||(s.activities=[]),s.activities.length>0){const i=s.activities[s.activities.length-1];i.endTime||(i.endTime=a)}const n={startTime:a,endTime:null,category:e,description:t};return s.activities.push(n),await o.put("workSessions",s),T.emit("session:activityChanged",{sessionId:s.id,category:e,description:t,timestamp:a}),s}catch(s){return console.error("Error recording activity:",s),null}}async function es(){try{const e=await G();if(!e||!e.activities||e.activities.length===0)return null;const t=e.activities[e.activities.length-1];return t.endTime?null:t}catch(e){return console.error("Error getting current activity:",e),null}}const ts="modulepreload",ss=function(e,t){return new URL(e,t).href},ze={},os=function(t,s,o){let a=Promise.resolve();if(s&&s.length>0){const i=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));a=Promise.allSettled(s.map(r=>{if(r=ss(r,o),r in ze)return;ze[r]=!0;const m=r.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(!!o)for(let h=i.length-1;h>=0;h--){const f=i[h];if(f.href===r&&(!m||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${g}`))return;const d=document.createElement("link");if(d.rel=m?"stylesheet":ts,m||(d.as="script"),d.crossOrigin="",d.href=r,c&&d.setAttribute("nonce",c),document.head.appendChild(d),m)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${r}`)))})}))}function n(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return a.then(i=>{for(const l of i||[])l.status==="rejected"&&n(l.reason);return t().catch(n)})},it=10,as="1.0.0";async function ns(){console.log("Exporting all application data");try{const e=await I,t={version:it,exportDate:new Date().toISOString(),appVersion:as,data:{tasks:await e.getAll("tasks"),timeLogs:await e.getAll("timeLogs"),todos:await e.getAll("todos"),accomplishments:await e.getAll("accomplishments"),workSessions:await e.getAll("workSessions"),categoryLists:await e.getAll("categoryLists"),remainingHoursHistory:await e.getAll("remainingHoursHistory"),projects:await e.getAll("projects"),phaseLists:await e.getAll("phaseLists")},settings:{globalProjectFilter:localStorage.getItem("globalProjectFilter"),globalPhaseFilter:localStorage.getItem("globalPhaseFilter"),calendarStatusFilter:localStorage.getItem("calendarStatusFilter"),calendarUrgencyFilter:localStorage.getItem("calendarUrgencyFilter"),sortBy:sessionStorage.getItem("sortBy"),sortOrder:sessionStorage.getItem("sortOrder")}},a=`task-tracker-backup-${new Date().toISOString().slice(0,19).replace(/[:.]/g,"-")}.json`;if(window.showSaveFilePicker)try{const r=await(await window.showSaveFilePicker({suggestedName:a,types:[{description:"Task Tracker Backup",accept:{"application/json":[".json"]}}]})).createWritable();return await r.write(JSON.stringify(t,null,2)),await r.close(),v("Data exported successfully!","success"),console.log("Data exported to user-selected location"),!0}catch(c){if(c.name!=="AbortError")console.warn("File picker failed, falling back to download:",c);else return console.log("Export cancelled by user"),!1}const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),l=document.createElement("a");return l.href=i,l.download=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),v("Data exported successfully!","success"),console.log("Data exported successfully"),!0}catch(e){return console.error("Error exporting data:",e),v("Failed to export data: "+e.message,"error"),!1}}async function is(e){return console.log("Importing comprehensive application data from file"),new Promise(t=>{const s=new FileReader;s.onload=async o=>{try{const a=JSON.parse(o.target.result);let n,i;if(a.version&&a.data){if(n=a.data,i=a.settings||{},console.log(`Importing data from version ${a.version}, exported on ${a.exportDate}`),a.version>it&&!confirm("This backup was created with a newer version of the app. Some data might not import correctly. Continue anyway?")){t(!1);return}if((n.categoryLists&&n.categoryLists.length>0||n.phaseLists&&n.phaseLists.length>0)&&!confirm("This will replace your existing Category Lists and Phase Lists. Your tasks and other data will be merged. Continue?")){t(!1);return}}else n=a,i={},console.log("Importing legacy format data");const l=await I,c=["tasks","timeLogs","todos","accomplishments","workSessions","categoryLists","remainingHoursHistory","projects","phaseLists"],r={imported:{},skipped:{},replaced:{}};for(const d of c)if(n[d]&&n[d].length>0){if(console.log(`Importing ${n[d].length} ${d}...`),d==="categoryLists"||d==="phaseLists"){const k=await l.getAll(d);r.replaced[d]=k.length;const b=l.transaction(d,"readwrite");for(const w of k)await b.store.delete(w.id);await b.done,console.log(`Cleared ${k.length} existing ${d}`)}const h=l.transaction(d,"readwrite");let f=0,y=0;for(const k of n[d])try{if(d==="categoryLists"||d==="phaseLists")await h.store.put(k),f++;else if(k.id)if(await h.store.get(k.id)){const w={...k};delete w.id,await h.store.add(w),f++}else await h.store.put(k),f++;else await h.store.add(k),f++}catch(b){console.warn(`Skipping ${d} record due to error:`,b),y++}await h.done,r.imported[d]=f,r.skipped[d]=y,console.log(`Imported ${f} ${d} (skipped ${y})`)}if(i&&Object.keys(i).length>0){console.log("Restoring settings...");for(const[d,h]of Object.entries(i))h!==null&&(d==="sortBy"||d==="sortOrder"?sessionStorage.setItem(d,h):localStorage.setItem(d,h))}const m=Object.values(r.imported).reduce((d,h)=>d+h,0),g=Object.values(r.skipped).reduce((d,h)=>d+h,0);let u=`Import complete!

`;u+=`✓ Imported: ${m} records
`,g>0&&(u+=`⚠ Skipped: ${g} records (duplicates or errors)
`),console.log("Import statistics:",r),v("Data imported successfully!","success",8e3),alert(u),t(!0)}catch(a){console.error("Error importing data:",a),v("Failed to import data: "+a.message,"error"),alert("Import failed: "+a.message),t(!1)}},s.onerror=()=>{console.error("Error reading file"),v("Failed to read file","error"),t(!1)},s.readAsText(e)})}async function ls(e){console.log("Rendering Today dashboard view");const t=`
    <div class="today-container">
      <div class="row g-4">
        \x3C!-- Quick Todos Column -->
        <div class="col-lg-6">
          <div class="today-card">
            <div class="today-card-header">
              <div class="d-flex justify-content-between align-items-center w-100">
                <div class="d-flex align-items-center">
                  <i class="fas fa-tasks me-2"></i>
                  <h5 class="mb-0">Quick Todos</h5>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="showCompletedTodos" onchange="window.toggleCompletedTodos()">
                  <label class="form-check-label small text-muted" for="showCompletedTodos">
                    Include completed
                  </label>
                </div>
              </div>
            </div>
            <div class="today-card-body">
              \x3C!-- Inline Todo Form -->
              <div class="todo-form mb-3">
                <div class="input-group mb-2">
                  <input type="text" id="todoTitleInput" class="form-control" placeholder="Add a todo..." maxlength="100">
                  <button class="btn btn-primary" type="button" id="addTodoBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div id="todoDetailsInput" class="todo-details" style="display: none;">
                  <textarea class="form-control" placeholder="Optional details..." rows="2" maxlength="300"></textarea>
                  <div class="mt-2 d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-outline-secondary" id="cancelTodoDetailsBtn">Cancel</button>
                    <button class="btn btn-sm btn-success" id="submitTodoWithDetailsBtn">Add Todo</button>
                  </div>
                </div>
                <small class="text-muted">Press Enter to add quickly, or click + for details</small>
              </div>
              
              <div id="todos-list" class="todos-list">
                \x3C!-- Todos will be loaded here -->
              </div>
            </div>
          </div>
        </div>
        
        \x3C!-- Daily Accomplishments Column -->
        <div class="col-lg-6">
          <div class="today-card">
            <div class="today-card-header">
              <i class="fas fa-trophy me-2"></i>
              <h5 class="mb-0">Daily Accomplishments</h5>
            </div>
            <div class="today-card-body">
              \x3C!-- Inline Accomplishment Form -->
              <div class="accomplishment-form mb-3">
                <div class="input-group mb-2">
                  <input type="text" id="accomplishmentTitleInput" class="form-control" placeholder="What did you accomplish?" maxlength="100">
                  <button class="btn btn-success" type="button" id="addAccomplishmentBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
                <div id="accomplishmentDetailsInput" class="accomplishment-details" style="display: none;">
                  <textarea class="form-control" placeholder="Tell us more about this accomplishment..." rows="3" maxlength="500"></textarea>
                  <div class="mt-2 d-flex justify-content-end gap-2">
                    <button class="btn btn-sm btn-outline-secondary" id="cancelAccomplishmentDetailsBtn">Cancel</button>
                    <button class="btn btn-sm btn-warning" id="submitAccomplishmentWithDetailsBtn">Add Accomplishment</button>
                  </div>
                </div>
                <small class="text-muted">Press Enter to add quickly, or click + for details</small>
              </div>
              
              <div id="accomplishments-list" class="accomplishments-list">
                \x3C!-- Accomplishments will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      \x3C!-- Work Session Status -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="today-card" id="todayWorkSession">
            <div class="today-card-header">
              <i class="fas fa-clock me-2"></i>
              <h5 class="mb-0">Work Session</h5>
              <button class="btn btn-sm btn-outline-primary ms-auto" id="todayPunchBtn" onclick="document.getElementById('punchClockBtn').click()">
                <i class="fas fa-clock me-1"></i>
                <span id="todayPunchText">Punch In</span>
              </button>
            </div>
            <div class="today-card-body">
              <div class="row g-3 text-center" id="workSessionSummary">
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayTotalHours">0h 0m</div>
                    <div class="metric-label">Total</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayWorkHours">0h 0m</div>
                    <div class="metric-label">Work</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayBreakHours">0h 0m</div>
                    <div class="metric-label">Breaks</div>
                  </div>
                </div>
                <div class="col-3">
                  <div class="metric-small">
                    <div class="metric-value" id="todayCurrentActivity">Not Started</div>
                    <div class="metric-label">Status</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      \x3C!-- Today's Task Overview -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="today-card">
            <div class="today-card-header">
              <i class="fas fa-flag me-2"></i>
              <h5 class="mb-0">Task Overview</h5>
              <span class="badge bg-primary ms-auto" id="today-hours">0.0 hours logged</span>
            </div>
            <div class="today-card-body">
              \x3C!-- Task Overview Filter Buttons -->
              <div class="task-overview-filters mb-3">
                <div class="btn-group" role="group" aria-label="Task time filters">
                  <button type="button" class="btn btn-outline-primary active" id="filterToday" data-filter="today">
                    <i class="fas fa-calendar-day me-1"></i>Today
                  </button>
                  <button type="button" class="btn btn-outline-primary" id="filterThisWeek" data-filter="thisWeek">
                    <i class="fas fa-calendar-week me-1"></i>This Week
                  </button>
                  <button type="button" class="btn btn-outline-primary" id="filterNextWeek" data-filter="nextWeek">
                    <i class="fas fa-calendar-alt me-1"></i>Next Week
                  </button>
                </div>
              </div>
              
              <div id="today-tasks" class="today-tasks">
                \x3C!-- Tasks will be loaded here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;e.innerHTML=t,ws(),ks(e),await rs()}async function rs(){await Promise.all([V(),ae(),lt(),rt("today")])}async function V(){var o;const e=((o=document.getElementById("showCompletedTodos"))==null?void 0:o.checked)||!1,t=await Oe(e),s=document.getElementById("todos-list");if(s){if(t.length===0){s.innerHTML=e?'<p class="text-muted text-center">No todos yet. Add one to get started!</p>':'<p class="text-muted text-center">No active todos. Add one to get started!</p>';return}s.innerHTML=t.map(a=>`
    <div class="todo-item ${a.completed?"completed":""}" data-todo-id="${a.id}">
      <input type="checkbox" class="form-check-input todo-checkbox" 
             ${a.completed?"checked":""} 
             data-todo-id="${a.id}">
      <div class="todo-content">
        <div class="todo-title">${a.title}</div>
        ${a.content?`<p class="todo-text">${a.content}</p>`:""}
        ${a.completed&&a.completedAt?`<small class="text-muted">Completed: ${new Date(a.completedAt).toLocaleDateString()}</small>`:`<small class="text-muted">Created: ${new Date(a.createdAt).toLocaleDateString()}</small>`}
      </div>
      ${e?`
        <div class="todo-actions ms-2">
          <button class="btn btn-sm btn-outline-danger delete-todo-btn" data-todo-id="${a.id}">
            <i class="fas fa-trash"></i>
          </button>
          <div class="delete-confirmation d-none">
            <span class="me-2">Delete this todo?</span>
            <button class="btn btn-danger btn-sm me-1 confirm-delete-todo-btn" data-todo-id="${a.id}">
              <i class="fas fa-check me-1"></i>Yes
            </button>
            <button class="btn btn-outline-secondary btn-sm cancel-delete-todo-btn" data-todo-id="${a.id}">
              <i class="fas fa-times me-1"></i>Cancel
            </button>
          </div>
        </div>
      `:""}
    </div>
  `).join("")}}async function ae(){const e=await We(),t=document.getElementById("accomplishments-list");if(t){if(e.length===0){t.innerHTML='<p class="text-muted text-center">No accomplishments logged today. Add one to celebrate your wins!</p>';return}t.innerHTML=e.map(s=>`
    <div class="accomplishment-item">
      <div class="accomplishment-title">${s.title}</div>
      ${s.content?`<div class="accomplishment-content">${s.content}</div>`:""}
      <div class="accomplishment-time">
        ${new Date(s.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}
        <button class="btn btn-sm btn-outline-danger ms-2 delete-accomplishment-btn" data-accomplishment-id="${s.id}">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>
  `).join("")}}async function lt(){const e=await Re(),t=document.getElementById("workSessionSummary");if(!e){document.getElementById("todayTotalHours").textContent="0h 0m",document.getElementById("todayWorkHours").textContent="0h 0m",document.getElementById("todayBreakHours").textContent="0h 0m",document.getElementById("todayCurrentActivity").textContent="Not Punched In";const y=document.getElementById("activityTimeline");y&&y.remove();return}const s=new Date(e.punchIn),a=(e.punchOut?new Date(e.punchOut):new Date)-s,n=Math.floor(a/(1e3*60*60)),i=Math.floor(a%(1e3*60*60)/(1e3*60));let l=0,c=0;e.activities&&e.activities.forEach(y=>{const k=new Date(y.startTime),w=(y.endTime?new Date(y.endTime):new Date)-k;y.category==="work"?l+=w:c+=w});const r=Math.floor(l/(1e3*60*60)),m=Math.floor(l%(1e3*60*60)/(1e3*60)),g=Math.floor(c/(1e3*60*60)),u=Math.floor(c%(1e3*60*60)/(1e3*60));document.getElementById("todayTotalHours").textContent=`${n}h ${i}m`,document.getElementById("todayWorkHours").textContent=`${r}h ${m}m`,document.getElementById("todayBreakHours").textContent=`${g}h ${u}m`;const d=e.activities&&e.activities.length>0?e.activities[e.activities.length-1]:null,h=e.punchOut?"Punched Out":d?d.description:"Working";document.getElementById("todayCurrentActivity").textContent=h;let f=document.getElementById("activityTimeline");if(f||(f=document.createElement("div"),f.id="activityTimeline",f.className="mt-3 pt-3 border-top",t.parentElement.appendChild(f)),e.activities&&e.activities.length>0){const y=`
      <h6 class="text-muted mb-2"><i class="fas fa-history me-1"></i> Activity Timeline</h6>
      <div class="activity-timeline">
        ${e.activities.map((k,b)=>{const w=new Date(k.startTime),S=k.endTime?new Date(k.endTime):null,B=S?(S-w)/(1e3*60):null,O={work:"fa-briefcase",lunch:"fa-utensils",meeting:"fa-users",personal:"fa-user",break:"fa-coffee"},H={work:"success",lunch:"warning",meeting:"info",personal:"secondary",break:"primary"},U=O[k.category]||"fa-circle",St=H[k.category]||"secondary",qe=!k.endTime;return`
            <div class="activity-item ${qe?"active":""}">
              <div class="activity-icon bg-${St}">
                <i class="fas ${U}"></i>
              </div>
              <div class="activity-details">
                <div class="activity-header">
                  <strong>${k.description}</strong>
                  ${qe?'<span class="badge bg-success ms-2">Active</span>':""}
                </div>
                <div class="activity-time text-muted small">
                  ${w.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}
                  ${S?` - ${S.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:" - Now"}
                  ${B?` (${Math.floor(B/60)}h ${Math.round(B%60)}m)`:""}
                </div>
              </div>
            </div>
          `}).join("")}
      </div>
    `;f.innerHTML=y}else f.innerHTML=""}async function rt(e){const t=new Date;t.setHours(0,0,0,0);const s=te();let o,a,n,i;const l=await C({},!0);if(e==="today")o=a=s,n=l.filter(u=>u.dueOn===s||u.dueOn<s&&!["Completed","Abandoned","Archived"].includes(u.status)),i="today";else if(e==="thisWeek"){const u=new Date(t);u.setDate(t.getDate()-t.getDay());const d=new Date(u);d.setDate(u.getDate()+6),o=u.toISOString().split("T")[0],a=d.toISOString().split("T")[0],n=l.filter(h=>h.dueOn>=o&&h.dueOn<=a&&!["Completed","Abandoned","Archived"].includes(h.status)),i="this week"}else if(e==="nextWeek"){const u=new Date(t);u.setDate(t.getDate()-t.getDay()+7);const d=new Date(u);d.setDate(u.getDate()+6),o=u.toISOString().split("T")[0],a=d.toISOString().split("T")[0],n=l.filter(h=>h.dueOn>=o&&h.dueOn<=a&&!["Completed","Abandoned","Archived"].includes(h.status)),i="next week"}const r=(await Ae(o,a)).reduce((u,d)=>u+d.hours,0),m=document.getElementById("today-hours");m&&(m.textContent=`${r.toFixed(1)} hours logged ${i}`);const g=document.getElementById("today-tasks");if(g){if(n.length===0){let u="No tasks found";e==="today"?u="No tasks due today. Great job staying on top of things!":e==="thisWeek"?u="No tasks due this week. You're all caught up!":e==="nextWeek"&&(u="No tasks scheduled for next week yet."),g.innerHTML=`<p class="text-muted text-center">${u}</p>`;return}g.innerHTML=n.map(u=>{const d=u.dueOn<s,h=u.dueOn===s;return`
      <div class="today-task-item ${d?"overdue":""} ${h?"due-today":""}">
        <div class="today-task-urgency ${u.urgency.toLowerCase()}"></div>
        <div class="flex-grow-1">
          <strong>${u.title}</strong>
          <span class="badge bg-secondary ms-2">${u.status}</span>
          ${d?'<span class="badge bg-danger ms-1">OVERDUE</span>':""}
          ${h?'<span class="badge bg-warning ms-1">TODAY</span>':""}
        </div>
        <div class="text-muted d-flex flex-column text-end">
          <small>Due: ${new Date(u.dueOn).toLocaleDateString("en-US",{month:"short",day:"numeric"})}</small>
          <small>${u.estimate?`Est: ${u.estimate}h`:"No estimate"}</small>
        </div>
        <div class="ms-2">
          <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${u.id}" title="Work on task">
            <i class="fas fa-edit"></i>
          </button>
        </div>
      </div>
    `}).join("")}}async function cs(){const e=document.getElementById("todoTitleInput");if(!e)return;const t=e.value.trim();if(!t)return;await fe(t,"")?(e.value="",e.focus(),v("Todo added!","success"),await V()):v("Failed to add todo","error")}async function ds(){const e=document.getElementById("todoTitleInput"),t=document.querySelector("#todoDetailsInput textarea");if(!e||!t)return;const s=e.value.trim(),o=t.value.trim();if(!s)return;await fe(s,o)?(e.value="",t.value="",ct(),e.focus(),v("Todo added!","success"),await V()):v("Failed to add todo","error")}function us(){const e=document.getElementById("todoDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#todoDetailsInput textarea");t&&t.focus()}}function ct(){const e=document.getElementById("todoDetailsInput");if(e){e.style.display="none";const t=document.querySelector("#todoDetailsInput textarea");t&&(t.value="")}}async function ms(e){await _t(e)?await V():v("Failed to update todo","error")}async function gs(e){await Yt(e)?(v("Todo deleted","info"),await V()):v("Failed to delete todo","error")}function hs(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-todo-btn"),o=t.querySelector(".delete-confirmation");s&&o&&(s.classList.add("d-none"),o.classList.remove("d-none"),t.classList.add("deleting"))}function fs(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-todo-btn"),o=t.querySelector(".delete-confirmation");s&&o&&(s.classList.remove("d-none"),o.classList.add("d-none"),t.classList.remove("deleting"))}async function ps(){const e=document.getElementById("accomplishmentTitleInput");if(!e)return;const t=e.value.trim();if(!t)return;await nt(t,"")?(e.value="",e.focus(),v("Accomplishment added!","success"),await ae()):v("Failed to add accomplishment","error")}async function ys(){const e=document.getElementById("accomplishmentTitleInput"),t=document.querySelector("#accomplishmentDetailsInput textarea");if(!e||!t)return;const s=e.value.trim(),o=t.value.trim();if(!s)return;await nt(s,o)?(e.value="",t.value="",dt(),e.focus(),v("Accomplishment added!","success"),await ae()):v("Failed to add accomplishment","error")}function vs(){const e=document.getElementById("accomplishmentDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#accomplishmentDetailsInput textarea");t&&t.focus()}}function dt(){const e=document.getElementById("accomplishmentDetailsInput");if(e){e.style.display="none";const t=document.querySelector("#accomplishmentDetailsInput textarea");t&&(t.value="")}}async function bs(e){await Gt(e)?(v("Accomplishment deleted","info"),await ae()):v("Failed to delete accomplishment","error")}function ks(e){if(e.dataset.todayEventListenersSetup==="true")return;e.dataset.todayEventListenersSetup="true";const t=async()=>{document.getElementById("today-tasks")&&(console.log("[Today] Task changed - refreshing task overview"),await loadTasksSection())};T.on("task:created",t),T.on("task:updated",t),T.on("task:deleted",t),T.on("task:timeLogged",t);const s=async()=>{document.getElementById("sessionSummary")&&(console.log("[Today] Work session changed - refreshing session summary"),await lt())};T.on("session:punchedIn",s),T.on("session:punchedOut",s),T.on("session:activityChanged",s);const o=async()=>{document.getElementById("todos-list")&&(console.log("[Today] Todo changed - refreshing todo list"),await V())};T.on("todo:created",o),T.on("todo:updated",o),T.on("todo:deleted",o),T.on("todo:toggled",o),T.on("todo:completed",o),T.on("todo:uncompleted",o);const a=async()=>{document.getElementById("accomplishments-list")&&(console.log("[Today] Accomplishment changed - refreshing accomplishment list"),await ae())};T.on("accomplishment:added",a),T.on("accomplishment:updated",a),T.on("accomplishment:deleted",a)}function ws(){var r,m,g,u;const e=document.getElementById("todoTitleInput"),t=document.getElementById("addTodoBtn");e&&t&&(e.addEventListener("keypress",d=>{d.key==="Enter"&&e.value.trim()&&cs()}),t.addEventListener("click",()=>{us()}));const s=document.getElementById("accomplishmentTitleInput"),o=document.getElementById("addAccomplishmentBtn");s&&o&&(s.addEventListener("keypress",d=>{d.key==="Enter"&&s.value.trim()&&ps()}),o.addEventListener("click",()=>{vs()}));const a=document.getElementById("cancelAccomplishmentDetailsBtn"),n=document.getElementById("submitAccomplishmentWithDetailsBtn");a&&a.addEventListener("click",()=>{dt()}),n&&n.addEventListener("click",()=>{ys()});const i=document.getElementById("cancelTodoDetailsBtn"),l=document.getElementById("submitTodoWithDetailsBtn");i&&i.addEventListener("click",()=>{ct()}),l&&l.addEventListener("click",()=>{ds()});const c=document.querySelectorAll(".task-overview-filters button");c.forEach(d=>{d.addEventListener("click",async()=>{c.forEach(f=>f.classList.remove("active")),d.classList.add("active");const h=d.dataset.filter;await rt(h)})}),(r=document.getElementById("todos-list"))==null||r.addEventListener("change",async d=>{if(d.target.classList.contains("todo-checkbox")){const h=parseInt(d.target.dataset.todoId);await ms(h)}}),(m=document.getElementById("todos-list"))==null||m.addEventListener("click",async d=>{if(d.target.closest(".delete-todo-btn")){const h=parseInt(d.target.closest(".delete-todo-btn").dataset.todoId);hs(h)}if(d.target.closest(".confirm-delete-todo-btn")){const h=parseInt(d.target.closest(".confirm-delete-todo-btn").dataset.todoId);await gs(h)}if(d.target.closest(".cancel-delete-todo-btn")){const h=parseInt(d.target.closest(".cancel-delete-todo-btn").dataset.todoId);fs(h)}}),(g=document.getElementById("accomplishments-list"))==null||g.addEventListener("click",async d=>{if(d.target.closest(".delete-accomplishment-btn")){const h=parseInt(d.target.closest(".delete-accomplishment-btn").dataset.accomplishmentId);await bs(h)}}),(u=document.getElementById("showCompletedTodos"))==null||u.addEventListener("change",async()=>{await V()})}async function x(e,t={},s="all"){console.log("Rendering Kanban Board view");let o=await C({},!0);t.project&&(o=o.filter(r=>r.projectId&&r.projectId.toString()===t.project)),t.phase&&(o=o.filter(r=>r.phaseKey===t.phase));const a=document.createElement("div");a.className="board-split-view";const n=document.createElement("div");n.className="board-kanban-pane";const i=document.createElement("div");i.className="kanban-board";const l=[{id:"backlog",title:"Backlog",statuses:["Ready","Estimated"],className:"lane-backlog"},{id:"inprogress",title:"In Progress",statuses:["InProgress"],className:"lane-inprogress"},{id:"blocked",title:"Blocked / Backburner",statuses:["Blocked","Backburner","OnHold"],className:"lane-blocked"},{id:"done",title:"Done",statuses:["Completed","Abandoned","Archived"],className:"lane-done"}];for(const r of l){let m=o.filter(d=>r.statuses.includes(d.status));r.id==="done"&&s!=="all"&&(m=m.filter(d=>{const h=Es(d);if(!h)return!1;const f=new Date;if(f.setHours(0,0,0,0),s==="today"){const y=f.toISOString().split("T")[0];return h===y}else if(s==="thisWeek"){const y=new Date(f);y.setDate(f.getDate()-f.getDay());const k=new Date(y);k.setDate(y.getDate()+6);const b=y.toISOString().split("T")[0],w=k.toISOString().split("T")[0];return h>=b&&h<=w}else if(s==="nextWeek"){const y=new Date(f);y.setDate(f.getDate()-f.getDay()+7);const k=new Date(y);k.setDate(y.getDate()+6);const b=y.toISOString().split("T")[0],w=k.toISOString().split("T")[0];return h>=b&&h<=w}return!0}));const g=document.createElement("div");g.className=`kanban-lane ${r.className}`,g.dataset.laneId=r.id,g.innerHTML=`
      <div class="kanban-lane-header">
        <h5>${r.title}</h5>
        <span class="lane-counter">${m.length}</span>
      </div>
      <div class="kanban-lane-content" data-lane="${r.id}">
        <div class="drop-zone"></div>
      </div>
    `;const u=g.querySelector(".kanban-lane-content");for(const d of m){const h=await Ts(d);u.appendChild(h)}i.appendChild(g)}n.appendChild(i);const c=document.createElement("div");c.className="board-task-detail-pane",c.id="boardTaskDetailPane",c.innerHTML=`
    <div class="board-task-empty-state">
      <i class="fas fa-tasks fa-2x mb-3"></i>
      <h5>Select a task</h5>
      <p>Click on any task card to view detailed information</p>
    </div>
  `,a.appendChild(n),a.appendChild(c),e.innerHTML="",e.appendChild(a),setTimeout(()=>{Bs(),Ls(e,t,s),As()},100)}async function Ts(e){const s=(await D(e.id)).reduce((m,g)=>m+g.hours,0),o=e.estimate||0,a=o>0?Math.min(s/o*100,100):0,n=new Date().toISOString().split("T")[0],i=e.dueOn<n&&!["Completed","Abandoned","Archived"].includes(e.status),l=!i&&e.dueOn<=new Date(Date.now()+2*24*60*60*1e3).toISOString().split("T")[0],c=document.createElement("div");c.className=`kanban-card urgency-${e.urgency.toLowerCase()}`,c.dataset.taskId=e.id,c.dataset.taskStatus=e.status,c.draggable=!0,i&&c.classList.add("overdue");const r=await Is(e);return c.innerHTML=`
    <div class="card-header">
      <div class="card-title" data-field="title" data-task-id="${e.id}">${e.title}</div>
      <div class="card-header-actions">
        <button class="card-edit-btn btn btn-outline-info work-task-btn" data-task-id="${e.id}" title="Edit task">
          <i class="fas fa-edit"></i>
        </button>
      </div>
    </div>
    ${r}
    <div class="card-meta">
      <div class="card-due-date ${i?"overdue":l?"due-soon":""}">
        <i class="fas fa-calendar"></i>
        ${new Date(e.dueOn).toLocaleDateString()}
      </div>
      <div class="card-meta-right">
        <div class="card-status-indicator status-${e.status.toLowerCase()}" title="Status: ${e.status}">
          <i class="fas fa-${Ss(e.status)}"></i>
          <span>${e.status}</span>
        </div>
        ${e.notes&&e.notes.trim()?`
          <div class="card-notes-indicator" title="Has notes">
            <i class="fas fa-sticky-note"></i>
          </div>
        `:""}
      </div>
    </div>
    <div class="card-time-info">
      <div class="card-hours">
        <i class="fas fa-clock"></i>
        ${s.toFixed(1)}h logged
      </div>
      <div class="card-hours">
        <i class="fas fa-hourglass-half"></i>
        ${(e.remainingHours||0).toFixed(1)}h left
      </div>
    </div>
    ${o>0?`
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-bar-fill" style="width: ${a}%"></div>
        </div>
        <div class="progress-text">${s.toFixed(1)}h / ${o}h (${Math.round(a)}%)</div>
      </div>
    `:""}
    <div class="card-quick-actions">
      <div class="quick-time-buttons">
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.25">15m</button>
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.5">30m</button>
        <button class="quick-action-btn btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="1">1h</button>
        <button class="quick-action-btn btn btn-outline-primary custom-time-btn" data-task-id="${e.id}">+</button>
      </div>
    </div>
  `,c}async function Is(e){const t=[];if(e.projectId){const s=await De(e.projectId);s&&t.push(`
        <span class="badge badge-project" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}if(e.phaseKey){const s=await Me(e.phaseKey);s&&t.push(`
        <span class="badge badge-phase" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}return t.length>0?`<div class="card-badges">${t.join("")}</div>`:""}function Ss(e){return{Ready:"flag",Estimated:"calculator",InProgress:"spinner",Completed:"check-circle",Blocked:"ban",Backburner:"fire",OnHold:"pause-circle",Abandoned:"times-circle",Archived:"archive"}[e]||"circle"}function Es(e){var t;return["Completed","Abandoned","Archived"].includes(e.status)&&(e.completedOn||((t=e.lastModified)==null?void 0:t.split("T")[0]))||null}function Ls(e,t,s){if(e.dataset.eventListenersSetup==="true")return;e.dataset.eventListenersSetup="true";const o=async({taskId:g})=>{document.getElementById("taskList")&&(console.log("[Board] Time logged for task",g,"- refreshing board"),await x(e,t,s))};e._timeLoggedHandler=o,T.on("task:timeLogged",o);const a=async({taskId:g})=>{document.getElementById("taskList")&&(console.log("[Board] Task updated",g,"- refreshing board"),await x(e,t,s))};e._taskUpdatedHandler=a,T.on("task:updated",a);const n=async({taskId:g})=>{document.getElementById("taskList")&&(console.log("[Board] Task created",g,"- refreshing board"),await x(e,t,s))};e._taskCreatedHandler=n,T.on("task:created",n);const i=async({taskId:g})=>{document.getElementById("taskList")&&(console.log("[Board] Task deleted",g,"- refreshing board"),await x(e,t,s))};e._taskDeletedHandler=i,T.on("task:deleted",i);const l=async({filters:g})=>{document.getElementById("taskList")&&(console.log("[Board] Filters changed - refreshing board with new filters",g),await x(e,g,s))};e._filtersChangedHandler=l,T.on("filters:changed",l);const c=({taskId:g,taskTitle:u})=>{const d=document.querySelector(`[data-task-id="${g}"]`);d&&(console.log("[Board] Rocket deployed for task",g,"- adding charge meter at 0 (frozen)"),Te(d,u,Date.now(),!1))};e._rocketDeployedHandler=c,T.on("spaceport:rocketDeployed",c);const r=({taskId:g,taskTitle:u,totalTime:d})=>{const h=document.querySelector(`[data-task-id="${g}"]`);if(h){console.log("[Board] Rocket launched for task",g,"- starting LIVE charge meter from totalTime:",d);const f=(d||0)*1e3,y=Date.now()-f;Te(h,u,y,!0)}};e._rocketLaunchedHandler=r,T.on("spaceport:rocketLaunched",r);const m=({taskId:g})=>{const u=document.querySelector(`[data-task-id="${g}"]`);u&&(console.log("[Board] Rocket landed for task",g,"- removing charge meter"),mt(u))};e._rocketLandedHandler=m,T.on("spaceport:rocketLanded",m)}function Bs(){ut(),Ps(),Ms()}function ut(){const e=document.getElementById("taskList");e&&e.dataset.dragInitialized!=="true"&&(e.dataset.dragInitialized="true",e.addEventListener("dragstart",t=>{const s=t.target.closest(".kanban-card");s&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",s.dataset.taskId),s.classList.add("dragging"))}),e.addEventListener("dragend",t=>{const s=t.target.closest(".kanban-card");s&&s.classList.remove("dragging")}),e.addEventListener("dragover",t=>{const s=t.target.closest(".kanban-lane-content");s&&(t.preventDefault(),t.dataTransfer.dropEffect="move",s.classList.add("drag-over"))}),e.addEventListener("dragleave",t=>{const s=t.target.closest(".kanban-lane-content");s&&(s.contains(t.relatedTarget)||s.classList.remove("drag-over"))}),e.addEventListener("drop",async t=>{const s=t.target.closest(".kanban-lane-content");if(!s)return;t.preventDefault(),s.classList.remove("drag-over");const o=parseInt(t.dataTransfer.getData("text/plain")),a=s.dataset.lane;await $s(o,a)}))}async function $s(e,t){const o={backlog:"Ready",inprogress:"InProgress",blocked:"Blocked",done:"Completed"}[t];if(o)try{const n=(await C({},!0)).find(l=>l.id===e);if(!n){v("Task not found","error");return}if(n.status=o,await He(n,!0)){v(`Task moved to ${o}`,"success");const l=document.getElementById("taskList");if(l){const c=R();await x(l,c)}}}catch(a){console.error("Error updating task status:",a),v("Failed to update task status","error")}}function Ps(){const e=document.querySelectorAll(".kanban-card");e.forEach(t=>{t.addEventListener("click",s=>{if(s.target.closest("button")||t.classList.contains("dragging"))return;e.forEach(a=>a.classList.remove("selected")),t.classList.add("selected");const o=parseInt(t.dataset.taskId);Ds(o)})})}async function Ds(e){const t=document.getElementById("boardTaskDetailPane");if(t){t.innerHTML='<div class="text-center p-4"><i class="fas fa-spinner fa-spin fa-2x"></i></div>';try{const o=(await C({},!0)).find(u=>u.id===e);if(!o){t.innerHTML=`
        <div class="board-task-empty-state">
          <i class="fas fa-exclamation-circle fa-3x text-muted mb-3"></i>
          <p>Task not found (ID: ${e})</p>
        </div>
      `;return}const a=await D(e),n=a.reduce((u,d)=>u+d.hours,0),i=o.estimate?Math.min(n/o.estimate*100,100):0;let l="";if(o.projectId){const u=await De(o.projectId);u&&(l=`<span class="badge" style="background-color: ${u.color||"#6c757d"}">${u.name}</span>`)}let c="";if(o.phaseKey){const u=await Me(o.phaseKey);u&&(c=`<span class="badge" style="background-color: ${u.color||"#6c757d"}">${u.name}</span>`)}const r=o.statusHistory?o.statusHistory.slice(-3).reverse().map(u=>`
        <div class="status-history-item mb-2">
          <span class="badge bg-${Ne(u.status)}">${u.status}</span>
          <small class="text-muted ms-2">${new Date(u.timestamp).toLocaleDateString()}</small>
        </div>
      `).join(""):'<p class="text-muted">No status history</p>',m=a.sort((u,d)=>d.dateLogged.localeCompare(u.dateLogged)).slice(0,5),g=m.length>0?m.map(u=>`
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span>${new Date(u.dateLogged).toLocaleDateString()}</span>
        <span class="fw-bold">${u.hours.toFixed(1)}h</span>
      </div>
    `).join(""):'<p class="text-muted">No time logged yet</p>';t.innerHTML=`
      <div class="board-task-detail-header">
        <div class="board-task-title">${o.title}</div>
        <div class="board-task-status-badges mt-2">
          <span class="badge bg-${Ne(o.status)}">${o.status}</span>
          <span class="badge bg-warning">${o.urgency}</span>
          ${l}
          ${c}
        </div>
      </div>
      
      <div class="board-task-section">
        <div class="board-task-section-title">Key Metrics</div>
        <div class="board-task-metrics">
          <div class="board-task-metric">
            <div class="board-task-metric-label">Due Date</div>
            <div class="board-task-metric-value">${o.dueOn?new Date(o.dueOn).toLocaleDateString():"Not set"}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Hours Logged</div>
            <div class="board-task-metric-value">${n.toFixed(1)}h</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Estimate</div>
            <div class="board-task-metric-value">${o.estimate||"None"}${o.estimate?"h":""}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Remaining</div>
            <div class="board-task-metric-value">${o.remainingHours!==null&&o.remainingHours!==void 0?o.remainingHours.toFixed(1)+"h":"N/A"}</div>
          </div>
          <div class="board-task-metric">
            <div class="board-task-metric-label">Progress</div>
            <div class="board-task-metric-value">${i.toFixed(0)}%</div>
          </div>
        </div>
        ${o.estimate?`
          <div class="progress mt-2" style="height: 8px;">
            <div class="progress-bar bg-primary" style="width: ${i}%"></div>
          </div>
        `:""}
      </div>
      
      ${o.description?`
        <div class="board-task-section">
          <div class="board-task-section-title">Description</div>
          <div class="board-task-description">${o.description}</div>
        </div>
      `:""}
      
      ${o.notes?`
        <div class="board-task-section">
          <div class="board-task-section-title">Notes</div>
          <div class="board-task-description">${o.notes}</div>
        </div>
      `:""}
      
      <div class="board-task-section">
        <div class="board-task-section-title">Recent Status Changes</div>
        ${r}
      </div>
      
      <div class="board-task-section">
        <div class="board-task-section-title">Recent Time Logs</div>
        ${g}
      </div>
      
      <div class="board-task-section">
        <button class="btn btn-primary w-100 work-task-btn" data-task-id="${o.id}">
          <i class="fas fa-edit me-2"></i>Edit in Work View
        </button>
      </div>
    `}catch(s){console.error("Error loading task details:",s),t.innerHTML=`
      <div class="board-task-empty-state">
        <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
        <p>Error loading task details</p>
        <small class="text-muted">${s.message}</small>
      </div>
    `}}}function Ms(){document.body.dataset.quickTimeInitialized!=="true"&&(document.body.dataset.quickTimeInitialized="true",document.addEventListener("click",e=>{const t=document.getElementById("taskList");if(!t)return;const s=e.target;if(t.contains(s)){if(e.target.closest(".quick-time-btn")){const o=e.target.closest(".quick-time-btn"),a=parseInt(o.dataset.taskId),n=parseFloat(o.dataset.hours);window.logQuickTime&&window.logQuickTime(a,n)}if(e.target.closest(".custom-time-btn")){const o=e.target.closest(".custom-time-btn"),a=parseInt(o.dataset.taskId);window.showCustomTimeModal&&window.showCustomTimeModal(a)}}}))}const Y=new URLSearchParams(window.location.search).get("debug")==="true",Cs=Y?1e3:6e4;Y&&console.log("[Board] 🚀 DEBUG MODE ACTIVE - Charge bars will fill every second instead of every minute!");function Ve(e){return e<15?{bars:1,color:"dim-green"}:e<30?{bars:2,color:"medium-green"}:e<45?{bars:3,color:"bright-green"}:e<60?{bars:4,color:"brightest-green"}:e<75?{bars:4,color:"orange"}:{bars:4,color:"red"}}function Te(e,t,s,o=!0){mt(e),e.classList.remove("rocket-fueling","rocket-active"),e.classList.add("charge-active");const a=Math.floor((Date.now()-s)/Cs),n=Ve(a),i=document.createElement("div");i.className="charge-meter-indicator",i.setAttribute("data-start-time",s);const l=Array.from({length:4},(u,d)=>`<div class="charge-bar ${d<n.bars?"active":""}"></div>`).join("");i.innerHTML=`
    <div class="charge-meter ${n.color}">
      ${l}
    </div>
    <span class="charge-timer">00:00</span>
  `;const c=Math.floor(a),r=Math.floor(c/60),m=c%60;i.querySelector(".charge-timer").textContent=`${r}:${m.toString().padStart(2,"0")}`,i.title=`Power charging - ${n.bars} bar${n.bars>1?"s":""} ${Y?"(DEBUG: seconds)":""}`;const g=e.querySelector(".card-header-actions");if(g)if(g.insertBefore(i,g.firstChild),console.log("[Board] Charge meter added to DOM, isLive:",o),o){const u=setInterval(()=>{const d=i.querySelector(".charge-timer"),h=i.querySelector(".charge-meter");if(!d||!document.body.contains(i)){clearInterval(u);return}const f=parseInt(i.getAttribute("data-start-time")),y=Math.floor((Date.now()-f)/1e3),k=Math.floor(y/(Y?1:60)),b=Math.floor(k/60),w=k%60;d.textContent=`${b}:${w.toString().padStart(2,"0")}`;const S=Ve(k);i.querySelectorAll(".charge-bar").forEach((O,H)=>{H<S.bars?O.classList.add("active"):O.classList.remove("active")}),h.className=`charge-meter ${S.color}`,i.title=`Power charging - ${S.bars} bar${S.bars>1?"s":""} ${Y?"(DEBUG: seconds)":""}`},1e3);i.setAttribute("data-timer-id",u)}else i.style.opacity="0.6",i.title=`Deployed - ${n.bars} bar${n.bars>1?"s":""} accumulated ${Y?"(DEBUG: seconds)":""}`;else console.error("[Board] Could not find .card-header-actions in task card")}function mt(e){const t=e.querySelector(".charge-meter-indicator");if(t){const a=t.getAttribute("data-timer-id");a&&clearInterval(parseInt(a)),t.remove()}const s=e.querySelector(".fueling-indicator");s&&s.remove();const o=e.querySelector(".rocket-indicator");if(o){const a=o.getAttribute("data-timer-id");a&&clearInterval(parseInt(a)),o.remove()}e.classList.remove("charge-active","rocket-active","rocket-fueling")}function As(){const e=L();if(!e||!e.rockets){console.log("[Board] No SpacePort session or rockets found");return}console.log("[Board] Syncing charge meters with SpacePort session",{rocketCount:e.rockets.size,activeRocket:e.activeRocket}),e.rockets.forEach((t,s)=>{const o=document.querySelector(`[data-task-id="${t.taskId}"]`);if(!o){console.log(`[Board] Card not found for task ${t.taskId}`);return}const a=(t.totalTime||0)*1e3,n=Date.now()-a,i=t.isActive&&e.activeRocket===s;console.log(`[Board] Adding charge meter for task ${t.taskId}`,{isActive:i,totalTime:t.totalTime,startTime:new Date(n),bars:Math.floor(t.totalTime/60)}),Te(o,t.taskTitle,n,i)})}let ce=[];async function Hs(e,t={}){console.log("Rendering Calendar Month view"),console.log("Filters received:",JSON.stringify(t));try{const s=N(),o=new Date;o.setMonth(o.getMonth()+s);const a=o.getFullYear(),n=o.getMonth()+1;console.log(`Calendar: Year=${a}, Month=${n}, Offset=${s}`);const i=xs(a,n);let l=await C({},!0);console.log(`Calendar: Loaded ${l.length} tasks`),t.status&&(l=l.filter(d=>d.status===t.status)),t.urgency&&(l=l.filter(d=>d.urgency===t.urgency)),t.project&&(l=l.filter(d=>d.projectId&&d.projectId.toString()===t.project)),t.phase&&(l=l.filter(d=>d.phaseKey===t.phase)),console.log(`Calendar: ${l.length} tasks after filters`),ce=l;const r=`
    <div class="calendar-header">
      \x3C!-- Navigation & Period Label -->
      <div class="calendar-nav-section">
        <button class="btn btn-outline-primary btn-sm" id="calendarPrevMonth">
          <i class="fas fa-chevron-left"></i>
        </button>
        <h5 class="mb-0 mx-3" id="calendarPeriodLabel">${o.toLocaleDateString("en-US",{month:"long",year:"numeric"})}</h5>
        <button class="btn btn-outline-primary btn-sm" id="calendarNextMonth">
          <i class="fas fa-chevron-right"></i>
        </button>
        <button class="btn btn-outline-secondary btn-sm ms-2" id="calendarTodayButton">Today</button>
      </div>
      
      \x3C!-- Filters -->
      <div class="calendar-filters-compact">
        <select id="calendarStatusFilter" class="form-select form-select-sm" title="Filter by status">
          <option value="">All Status</option>
          <option value="Ready">Ready</option>
          <option value="Estimated">Estimated</option>
          <option value="InProgress">In Progress</option>
          <option value="Blocked">Blocked</option>
          <option value="Backburner">Backburner</option>
          <option value="OnHold">On Hold</option>
          <option value="Completed">Completed</option>
          <option value="Abandoned">Abandoned</option>
          <option value="Archived">Archived</option>
        </select>
        <select id="calendarUrgencyFilter" class="form-select form-select-sm" title="Filter by urgency">
          <option value="">All Urgency</option>
          <option value="High">High</option>
          <option value="Med">Med</option>
          <option value="Low">Low</option>
        </select>
        <button class="btn btn-outline-secondary btn-sm" id="clearCalendarFilters" title="Clear all filters">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      \x3C!-- Monthly Summary -->
      <div class="month-summary-compact">
        <div class="summary-item">
          <i class="fas fa-tasks text-primary"></i>
          <span class="summary-value" id="monthTotalTasks">0</span>
        </div>
        <div class="summary-item">
          <i class="fas fa-clock text-success"></i>
          <span class="summary-value" id="monthTotalHours">0h</span>
        </div>
        <div class="summary-item">
          <i class="fas fa-calendar-check text-info"></i>
          <span class="summary-value" id="monthWorkDays">0</span>
        </div>
      </div>
    </div>
  `,m=await Os(l,a,n),g=await Ws(i,m,a,n,l),u=`
    <div class="month-split-view">
      \x3C!-- Left Pane: Calendar -->
      <div class="month-calendar-pane">
        ${r}
        ${g}
      </div>
      
      \x3C!-- Right Pane: Details -->
      <div class="month-details-pane">
        <div class="month-details-header">
          <h6 id="selectedPeriodTitle" class="mb-0">Select a day or week</h6>
          <small id="selectedPeriodSubtitle" class="text-muted"></small>
        </div>
        <div id="selectedPeriodContent">
          <div class="text-muted text-center py-4">
            <i class="fas fa-calendar-alt fa-2x opacity-50 mb-3"></i>
            <p>Click on a day or week to view details</p>
          </div>
        </div>
      </div>
    </div>
  `;e.innerHTML=u,_s(m),Ie=!1,qs(m,a,n),Us(),Ys(),console.log("✅ Calendar view rendered successfully")}catch(s){console.error("❌ Error rendering calendar view:",s),e.innerHTML=`
      <div class="alert alert-danger m-3">
        <h5><i class="fas fa-exclamation-triangle"></i> Calendar View Error</h5>
        <p>Failed to load calendar view: ${s.message}</p>
        <button class="btn btn-primary btn-sm" onclick="location.reload()">Reload Page</button>
      </div>
    `}}function xs(e,t){const s=new Date(e,t-1,1),o=new Date(e,t,0),a=s.getDay(),n=o.getDate(),i=[];let l=new Array(7).fill(null);for(let r=a;r<7;r++)l[r]=r-a+1;i.push(l);let c=8-a;for(;c<=n;){l=[];for(let r=0;r<7;r++)c<=n?(l.push(c),c++):l.push(null);i.push(l)}return i}async function Os(e,t,s){const o={};for(const a of e){a.dueOn&&(o[a.dueOn]||(o[a.dueOn]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[a.dueOn].tasks.push(a));const n=gt(a);n&&n!==a.dueOn&&(o[n]||(o[n]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[n].tasks.some(l=>l.id===a.id)||o[n].tasks.push(a))}`${t}${s.toString().padStart(2,"0")}`,`${t}${s.toString().padStart(2,"0")}${new Date(t,s,0).getDate().toString().padStart(2,"0")}`;for(const a in o)for(const n of o[a].tasks){const i=await D(n.id,a,a);o[a].totalHours+=i.reduce((l,c)=>l+c.hours,0)}try{const a=await Oe(!0),n=await We();a.forEach(i=>{var c;const l=(c=i.createdAt)==null?void 0:c.split("T")[0];l&&(o[l]||(o[l]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[l].todos++)}),n.forEach(i=>{var c;const l=(c=i.createdAt)==null?void 0:c.split("T")[0];l&&(o[l]||(o[l]={tasks:[],totalHours:0,todos:0,accomplishments:0,workSession:null}),o[l].accomplishments++)})}catch(a){console.error("Error loading calendar data:",a)}return o}function gt(e){var t;return["Completed","Abandoned","Archived"].includes(e.status)&&(e.completedOn||((t=e.lastModified)==null?void 0:t.split("T")[0]))||null}async function Ws(e,t,s,o,a){let n='<div class="calendar-table-container"><table class="table calendar-table"><thead><tr>';n+='<th class="week-selector-header" title="Select Week"><i class="fas fa-calendar-week"></i></th>',["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(l=>n+=`<th>${l}</th>`),n+="</tr></thead><tbody>";let i=0;for(const l of e){n+=`<tr class="calendar-week-row" data-week="${i}">`,n+=`<td class="week-selector-cell clickable-week-header" data-week="${i}">
      <span class="week-number">W${i+1}</span>
    </td>`;const r=l.slice(0,7).map(async g=>{if(!g)return{day:null,content:""};const u=`${s}-${o.toString().padStart(2,"0")}-${g.toString().padStart(2,"0")}`,d=t[u]||{tasks:[],workSession:null},h=u===new Date().toISOString().split("T")[0],f=await Rs(d.tasks,u),y=await Fs(d.tasks,u,d.workSession,a),k=await js(d.tasks,u,a);return{day:g,dateStr:u,isToday:h,content:`
          <div class="calendar-day-inner">
            <div class="calendar-day-header">
              <div class="day-number-row">
                <span class="calendar-day-number">${g}</span>
                ${f}
              </div>
            </div>
            <div class="calendar-day-content">
              ${y}
              <div class="calendar-progress-bars">
                ${k}
              </div>
            </div>
          </div>
        `}}),m=await Promise.all(r);for(const g of m)g.day?(n+=`<td class="calendar-day ${g.isToday?"today":""}" data-date="${g.dateStr}">`,n+=g.content,n+="</td>"):n+='<td class="calendar-day empty-day"></td>';n+="</tr>",i++}return n+="</tbody></table></div>",n}async function Rs(e,t){const s=e.filter(a=>a.dueOn===t);return s.length===0?"":`<div class="due-badges-container">${s.map(a=>{const n=`status-${a.status.toLowerCase()}`,i=`urgency-${a.urgency.toLowerCase()}`,l=a.dueOn<new Date().toISOString().split("T")[0]&&!["Completed","Abandoned","Archived"].includes(a.status);return`<span class="due-task-badge ${n} ${i} ${l?"overdue-badge":""}" 
                  title="${a.title} - ${a.status}">
              <i class="fas fa-circle"></i>
            </span>`}).join("")}</div>`}async function Fs(e,t,s,o){const a=await D(null,t,t),n=new Set(o.map(c=>c.id)),l=a.filter(c=>n.has(c.taskId)).reduce((c,r)=>c+r.hours,0);return l===0?"":`<div class="day-time-summary"><span class="hours-worked"><i class="fas fa-clock"></i> ${l.toFixed(1)}h</span></div>`}async function js(e,t,s){const o=await D(null,t,t);if(o.length===0)return"";const a=new Set(s.map(c=>c.id)),n=o.filter(c=>a.has(c.taskId));if(n.length===0)return"";const i=[...new Set(n.map(c=>c.taskId))];let l="";for(const c of i){const r=s.find(f=>f.id===c);if(!r)continue;const g=n.filter(f=>f.taskId===c).reduce((f,y)=>f+y.hours,0),d=(await D(c)).reduce((f,y)=>f+y.hours,0),h=r.estimate||0;if(r.remainingHours,h>0){const f=Math.min(d/h*100,100),y=Math.max(0,100-f);l+=`
        <div class="mini-progress-bar" title="${r.title}: ${g.toFixed(1)}h logged on ${t} (${d.toFixed(1)}h / ${h}h total)">
          <div class="mini-progress-fill status-${r.status.toLowerCase()}" style="width: ${f}%"></div>
          <div class="mini-progress-remaining" style="width: ${y}%; left: ${f}%"></div>
        </div>
      `}else l+=`
        <div class="mini-progress-bar no-estimate" title="${r.title}: ${g.toFixed(1)}h logged on ${t} (${d.toFixed(1)}h total)">
          <div class="mini-progress-fill status-${r.status.toLowerCase()}" style="width: 100%"></div>
        </div>
      `}return l}function qs(e,t,s){const o=document.querySelectorAll(".clickable-week-header"),a=document.querySelectorAll(".calendar-day[data-date]");o.forEach(n=>{n.addEventListener("click",i=>{const l=parseInt(i.currentTarget.dataset.week),c=document.querySelector(`[data-week="${l}"]`);document.querySelectorAll(".calendar-week-row").forEach(m=>m.classList.remove("selected-week")),document.querySelectorAll(".clickable-week-header").forEach(m=>m.classList.remove("selected-week-header")),document.querySelectorAll(".calendar-day").forEach(m=>m.classList.remove("selected-day")),c.classList.add("selected-week"),i.currentTarget.classList.add("selected-week-header");const r=Array.from(c.querySelectorAll(".calendar-day[data-date]")).map(m=>m.dataset.date).filter(m=>m);if(r.length>0){const m=r[0],g=r[r.length-1];Ns(r,e,m,g)}})}),a.forEach(n=>{n.addEventListener("click",i=>{const l=i.currentTarget.dataset.date;l&&(document.querySelectorAll(".calendar-week-row").forEach(c=>c.classList.remove("selected-week")),document.querySelectorAll(".clickable-week-header").forEach(c=>c.classList.remove("selected-week-header")),document.querySelectorAll(".calendar-day").forEach(c=>c.classList.remove("selected-day")),i.currentTarget.classList.add("selected-day"),Fe(l,e))})})}async function Ns(e,t,s,o){const a=document.getElementById("selectedPeriodTitle"),n=document.getElementById("selectedPeriodSubtitle"),i=document.getElementById("selectedPeriodContent"),l=new Date(s),c=new Date(o),r=`${l.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${c.toLocaleDateString("en-US",{month:"short",day:"numeric"})}`;a.textContent=`Week: ${r}`,n.textContent="Weekly Tasks";const m=new Map;e.forEach(y=>{const k=t[y];k&&k.tasks&&k.tasks.forEach(b=>{if(!m.has(b.id))if(["Completed","Abandoned"].includes(b.status)){const w=gt(b);w&&e.includes(w)&&m.set(b.id,{task:b,reason:"due"})}else m.set(b.id,{task:b,reason:"due"})})});const g=await D(null,s,o),u=new Set(g.map(y=>y.taskId));if(u.size>0)for(const y of u)if(m.has(y))m.get(y).reason="both";else{const k=ce.find(b=>b.id===y);k&&m.set(y,{task:k,reason:"time"})}const d=Array.from(m.values()).map(y=>y.task),h=await ht(s,d);let f='<div class="week-details">';if(d.length>0){f+='<div class="tasks-section">';for(const y of Array.from(m.values())){const k=y.task,b=y.reason,w=h[k.id]||{totalHours:0},S=`status-${k.status.toLowerCase()}`,B=k.estimate?Math.min(w.totalHours/k.estimate*100,100):0,O=k.dueOn<o&&!["Completed","Abandoned","Archived"].includes(k.status),H=await ft(k);let U="";b==="due"?U='<span class="task-reason-badge due-badge-reason" title="Task due this week"><i class="fas fa-calendar-check"></i> Due</span>':b==="time"?U='<span class="task-reason-badge time-badge-reason" title="Time logged this week"><i class="fas fa-clock"></i> Logged</span>':b==="both"&&(U='<span class="task-reason-badge both-badge-reason" title="Due & time logged this week"><i class="fas fa-calendar-check"></i> <i class="fas fa-clock"></i></span>'),f+=`
        <div class="progress-task-card ${O?"overdue":""}">
          <div class="task-card-header ${S}">
            <div class="status-info">
              <span class="status-label">${k.status}</span>
              <span class="urgency-indicator urgency-${k.urgency.toLowerCase()}">${k.urgency}</span>
            </div>
            <div class="task-card-header-actions">
              ${U}
              <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${k.id}" title="Edit task in Work view">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          ${H}
          <div class="task-card-body">
            <div class="task-title">${k.title}</div>
            <div class="task-progress-section">
              ${k.estimate?`
                <div class="progress-bar-container">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${B}%"></div>
                  </div>
                  <div class="progress-text">${w.totalHours.toFixed(1)}h / ${k.estimate}h (${B.toFixed(0)}%)</div>
                </div>
              `:`
                <div class="progress-text">Total: ${w.totalHours.toFixed(1)}h logged</div>
              `}
            </div>
            <div class="task-meta">
              <span class="task-due ${O?"overdue-text":""}">
                <i class="fas fa-calendar"></i> Due: ${new Date(k.dueOn).toLocaleDateString()}
              </span>
            </div>
          </div>
        </div>
      `}f+="</div>"}else f+=`
      <div class="no-tasks-message">
        <i class="fas fa-calendar-week fa-2x text-muted mb-3"></i>
        <p class="text-muted">No tasks scheduled or worked on this week</p>
      </div>
    `;f+="</div>",i.innerHTML=f}async function Fe(e,t){const s=document.getElementById("selectedPeriodTitle"),o=document.getElementById("selectedPeriodSubtitle"),a=document.getElementById("selectedPeriodContent"),i=new Date(e).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"}),l=t[e]||{tasks:[]};s.textContent=i;const c=e===new Date().toISOString().split("T")[0];o.textContent=c?"Today":"";const r=new Map;l.tasks.forEach(f=>{r.set(f.id,{task:f,reason:"due"})});const m=await D(null,e,e),g=new Set(ce.map(f=>f.id)),u=m.filter(f=>g.has(f.taskId));for(const f of u){const y=ce.find(k=>k.id===f.taskId);y&&!r.has(y.id)?r.set(y.id,{task:y,reason:"time"}):y&&r.has(y.id)&&(r.get(y.id).reason="both")}const d=await ht(e,Array.from(r.values()).map(f=>f.task));let h='<div class="day-details">';if(r.size>0){h+='<div class="tasks-section">';for(const[f,{task:y,reason:k}]of r){const b=d[y.id]||{totalHours:0,todayHours:0},w=`status-${y.status.toLowerCase()}`,S=y.estimate?Math.min(b.totalHours/y.estimate*100,100):0,B=y.dueOn<e&&!["Completed","Abandoned","Archived"].includes(y.status),O=await ft(y);let H="";k==="due"?H='<span class="task-reason-badge due-badge-reason" title="Task due on this day"><i class="fas fa-calendar-check"></i> Due</span>':k==="time"?H='<span class="task-reason-badge time-badge-reason" title="Time logged on this day"><i class="fas fa-clock"></i> Logged</span>':k==="both"&&(H='<span class="task-reason-badge both-badge-reason" title="Due & time logged"><i class="fas fa-calendar-check"></i> <i class="fas fa-clock"></i></span>'),h+=`
        <div class="progress-task-card ${B?"overdue":""}">
          <div class="task-card-header ${w}">
            <div class="status-info">
              <span class="status-label">${y.status}</span>
              <span class="urgency-indicator urgency-${y.urgency.toLowerCase()}">${y.urgency}</span>
            </div>
            <div class="task-card-header-actions">
              ${H}
              <button class="btn btn-sm btn-outline-info work-task-btn" data-task-id="${y.id}" title="Edit task in Work view">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          ${O}
          <div class="task-card-body">
            <div class="task-title">${y.title}</div>
            <div class="task-progress-section">
              ${y.estimate?`
                <div class="progress-bar-container">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: ${S}%"></div>
                  </div>
                  <div class="progress-text">${b.totalHours.toFixed(1)}h / ${y.estimate}h (${S.toFixed(0)}%)</div>
                </div>
              `:`
                <div class="progress-text">Total: ${b.totalHours.toFixed(1)}h logged</div>
              `}
              ${b.todayHours>0?`
                <div class="today-hours">
                  <i class="fas fa-clock text-primary"></i> ${b.todayHours.toFixed(1)}h on this day
                </div>
              `:""}
            </div>
            <div class="task-meta">
              <span class="task-due ${B?"overdue-text":""}">
                <i class="fas fa-calendar"></i> Due: ${new Date(y.dueOn).toLocaleDateString()}
              </span>
            </div>
          </div>
        </div>
      `}h+="</div>"}else h+=`
      <div class="no-tasks-message">
        <i class="fas fa-calendar-check fa-2x text-muted mb-3"></i>
        <p class="text-muted">No tasks scheduled or worked on this day</p>
      </div>
    `;h+=await zs(e),h+="</div>",a.innerHTML=h,Vs(e)}async function zs(e){const t=await Re(e);let s="";if(t){const o=t.punchIn?new Date(t.punchIn).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A",a=t.punchOut?new Date(t.punchOut).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Not Punched Out",n=t.totalHours?`${t.totalHours.toFixed(2)}h`:"In Progress",i=!!t.punchOut;s=`
      <div class="work-session-info">
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-sign-in-alt text-success"></i> Punch In:
          </span>
          <span class="work-session-value">${o}</span>
        </div>
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-sign-out-alt ${i?"text-danger":"text-muted"}"></i> Punch Out:
          </span>
          <span class="work-session-value ${i?"":"text-muted"}">${a}</span>
        </div>
        <div class="work-session-row">
          <span class="work-session-label">
            <i class="fas fa-clock text-primary"></i> Duration:
          </span>
          <span class="work-session-value fw-bold text-primary">${n}</span>
        </div>
      </div>
    `}else s=`
      <div class="no-session-message text-muted text-center py-2">
        <i class="fas fa-briefcase me-1"></i>
        No work session recorded for this day
      </div>
    `;return`
    <div class="work-session-section mt-4">
      <h6 class="mb-3">
        <i class="fas fa-briefcase me-2"></i>
        Work Session
      </h6>
      ${s}
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-sm btn-outline-primary flex-fill" id="editWorkSessionBtn" data-date="${e}">
          <i class="fas fa-edit me-1"></i>
          ${t?"Edit Session":"Add Session"}
        </button>
        ${t?`
          <button class="btn btn-sm btn-outline-danger" id="deleteWorkSessionBtn" data-session-id="${t.id}" data-date="${e}">
            <i class="fas fa-trash"></i>
          </button>
        `:""}
      </div>
    </div>
  `}function Vs(e){const t=document.getElementById("editWorkSessionBtn"),s=document.getElementById("deleteWorkSessionBtn");t&&t.addEventListener("click",async()=>{await Gs(e)}),s&&s.addEventListener("click",async()=>{const o=parseInt(s.dataset.sessionId);confirm("Are you sure you want to delete this work session?")&&await Xt(o)&&(v("Work session deleted","success"),await Fe(e,{}),window.renderTasks&&window.renderTasks("month"))})}async function ht(e,t){const s={};for(const o of t){const n=(await D(o.id)).reduce((c,r)=>c+r.hours,0),l=(await D(o.id,e,e)).reduce((c,r)=>c+r.hours,0);s[o.id]={totalHours:n,todayHours:l}}return s}async function ft(e){const t=[];if(e.projectId){const s=await De(e.projectId);s&&t.push(`
        <span class="badge badge-project" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}if(e.phaseKey){const s=await Me(e.phaseKey);s&&t.push(`
        <span class="badge badge-phase" style="background-color: ${s.color||"#6c757d"}">
          ${s.name}
        </span>
      `)}return t.length>0?`<div class="card-badges">${t.join("")}</div>`:""}let Ie=!1;function Us(){if(Ie){console.log("⚠️ Calendar controls already initialized, skipping");return}console.log("🔧 Initializing calendar controls...");const e=document.getElementById("calendarPrevMonth"),t=document.getElementById("calendarNextMonth"),s=document.getElementById("calendarTodayButton"),o=document.getElementById("calendarStatusFilter"),a=document.getElementById("calendarUrgencyFilter"),n=document.getElementById("clearCalendarFilters");console.log("Calendar buttons found:",{prev:!!e,next:!!t,today:!!s}),e&&e.addEventListener("click",()=>{console.log("📅 Previous month clicked, current offset:",N()),ye(N()-1),console.log("📅 New offset:",N()),window.renderTasks&&window.renderTasks("month")}),t&&t.addEventListener("click",()=>{console.log("📅 Next month clicked, current offset:",N()),ye(N()+1),console.log("📅 New offset:",N()),console.log("window.renderTasks exists?",!!window.renderTasks),window.renderTasks?(console.log('Calling window.renderTasks("month")'),window.renderTasks("month")):console.error("❌ window.renderTasks is not defined!")}),s&&s.addEventListener("click",()=>{console.log("📅 Today clicked, resetting offset to 0"),ye(0),window.renderTasks&&window.renderTasks("month")}),o&&o.addEventListener("change",()=>{localStorage.setItem("calendarStatusFilter",o.value),_(o);const i=R();X({...i,status:o.value||null}),window.renderTasks&&window.renderTasks("month")}),a&&a.addEventListener("change",()=>{localStorage.setItem("calendarUrgencyFilter",a.value),_(a);const i=R();X({...i,urgency:a.value||null}),window.renderTasks&&window.renderTasks("month")}),n&&n.addEventListener("click",()=>{o&&(o.value="",localStorage.removeItem("calendarStatusFilter"),_(o)),a&&(a.value="",localStorage.removeItem("calendarUrgencyFilter"),_(a));const i=R();X({...i,status:null,urgency:null}),window.renderTasks&&window.renderTasks("month")}),Ie=!0,console.log("✅ Calendar controls initialized successfully")}function _(e){e.value!==""?(e.style.borderColor="#007bff",e.style.backgroundColor="rgba(0, 123, 255, 0.1)"):(e.style.borderColor="",e.style.backgroundColor="")}function Ys(){const e=document.getElementById("calendarStatusFilter"),t=document.getElementById("calendarUrgencyFilter");if(e){const s=localStorage.getItem("calendarStatusFilter");s&&(e.value=s,_(e))}if(t){const s=localStorage.getItem("calendarUrgencyFilter");s&&(t.value=s,_(t))}}function _s(e){const t=new Set;let s=0,o=0;for(const a in e){const n=e[a];n.tasks.forEach(i=>t.add(i.id)),s+=n.totalHours,(n.totalHours>0||n.workSession)&&o++}document.getElementById("monthTotalTasks").textContent=t.size,document.getElementById("monthTotalHours").textContent=`${s.toFixed(1)}h`,document.getElementById("monthWorkDays").textContent=o}async function Gs(e){const t=await Re(e);let s=document.getElementById("workSessionModal");if(s||(document.body.insertAdjacentHTML("beforeend",`
      <div class="modal fade" id="workSessionModal" tabindex="-1">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">
                <i class="fas fa-briefcase me-2"></i>
                <span id="workSessionModalTitle">Edit Work Session</span>
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form id="workSessionForm">
                <div class="mb-3">
                  <label for="workSessionDate" class="form-label">Date</label>
                  <input type="date" class="form-control" id="workSessionDate" required>
                </div>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="workSessionPunchIn" class="form-label">
                      <i class="fas fa-sign-in-alt text-success me-1"></i>
                      Punch In Time
                    </label>
                    <input type="time" class="form-control" id="workSessionPunchIn" required>
                  </div>
                  
                  <div class="col-md-6 mb-3">
                    <label for="workSessionPunchOut" class="form-label">
                      <i class="fas fa-sign-out-alt text-danger me-1"></i>
                      Punch Out Time
                    </label>
                    <input type="time" class="form-control" id="workSessionPunchOut">
                    <div class="form-text">Leave empty if still in progress</div>
                  </div>
                </div>
                
                <div class="alert alert-info" id="workSessionDuration">
                  <i class="fas fa-clock me-2"></i>
                  <span id="durationDisplay">Duration will be calculated</span>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="saveWorkSessionBtn">
                <i class="fas fa-save me-1"></i>Save
              </button>
            </div>
          </div>
        </div>
      </div>
    `),s=document.getElementById("workSessionModal")),document.getElementById("workSessionDate").value=e,t){if(document.getElementById("workSessionModalTitle").textContent="Edit Work Session",t.punchIn){const l=new Date(t.punchIn);document.getElementById("workSessionPunchIn").value=l.toTimeString().slice(0,5)}if(t.punchOut){const l=new Date(t.punchOut);document.getElementById("workSessionPunchOut").value=l.toTimeString().slice(0,5)}else document.getElementById("workSessionPunchOut").value=""}else document.getElementById("workSessionModalTitle").textContent="Add Work Session",document.getElementById("workSessionPunchIn").value="09:00",document.getElementById("workSessionPunchOut").value="";const o=()=>{const l=document.getElementById("workSessionPunchIn").value,c=document.getElementById("workSessionPunchOut").value;if(l&&c){const r=document.getElementById("workSessionDate").value,m=new Date(`${r}T${l}`),u=new Date(`${r}T${c}`)-m;if(u>0){const d=(u/36e5).toFixed(2);document.getElementById("durationDisplay").textContent=`Duration: ${d} hours`}else document.getElementById("durationDisplay").textContent="Invalid: Punch out must be after punch in"}else l?document.getElementById("durationDisplay").textContent="In Progress (no punch out time)":document.getElementById("durationDisplay").textContent="Duration will be calculated"};document.getElementById("workSessionPunchIn").addEventListener("change",o),document.getElementById("workSessionPunchOut").addEventListener("change",o),o();const a=document.getElementById("saveWorkSessionBtn"),n=async()=>{const l=document.getElementById("workSessionDate").value,c=document.getElementById("workSessionPunchIn").value,r=document.getElementById("workSessionPunchOut").value;if(!l||!c){v("Date and punch in time are required","error");return}const m=`${l}T${c}:00`,g=r?`${l}T${r}:00`:null,u={id:t==null?void 0:t.id,date:l,punchIn:m,punchOut:g,activities:(t==null?void 0:t.activities)||[],breaks:(t==null?void 0:t.breaks)||[]};await Qt(u)&&(v("Work session saved","success"),bootstrap.Modal.getInstance(s).hide(),await Fe(e,{}),window.renderTasks&&window.renderTasks("month"))};a.replaceWith(a.cloneNode(!0)),document.getElementById("saveWorkSessionBtn").addEventListener("click",n),new bootstrap.Modal(s).show()}async function pt(){try{const t=(await C({},!0)).filter(i=>{var l,c;return i.status==="Completed"&&((c=(l=i.estimationData)==null?void 0:l.scale)==null?void 0:c.expected)&&i.estimationData.scale.expected>0});if(t.length===0)return null;let s=0,o=0,a=0;for(const i of t){const c=(await D(i.id)).reduce((r,m)=>r+m.hours,0);c>0&&(s+=i.estimationData.scale.expected,o+=c,a++)}if(s===0||a===0)return null;const n=o/s;return{velocity:n,sampleSize:a,totalHours:o,totalPoints:s,averageHoursPerPoint:n}}catch(e){return console.error("Error calculating personal velocity:",e),null}}async function Qs(e){if(!(e!=null&&e.scale))return{canPredict:!1,message:"No estimation data provided"};const t=await pt();if(!t)return{canPredict:!1,message:"Complete more tasks with estimation data to enable predictions"};const{low:s,expected:o,high:a}=e.scale,n=t.velocity;return{canPredict:!0,low:s*n,expected:o*n,high:a*n,velocity:n,sampleSize:t.sampleSize,confidence:e.confidence||100}}function Xs(e){return e>=90?"Very confident - I've done this before":e>=70?"Confident - Similar work completed":e>=50?"Reasonable guess - Some unknowns":e>=30?"Uncertain - Many unknowns":"Total guess - Could be way off"}async function Se(e,t=null){console.log("Rendering Work view",t?`with task ${t}`:""),e.innerHTML=`
    <div class="work-container">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-edit me-2"></i>
            Task Workspace
          </h5>
        </div>
        <div class="card-body">
          <div id="workTaskContent">
            <div class="text-center text-muted py-5">
              <i class="fas fa-clipboard-list fa-3x mb-3"></i>
              <h4>Select a task to start working</h4>
              <p>Choose a task from the Board or Today view to edit and track time.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  `,t&&await pe(t)}async function pe(e){const s=(await C({},!0)).find(o=>o.id===e);if(!s){console.error("Task not found with ID:",e),v("Task not found","error");return}await Ks(s)}async function Ks(e){var a,n,i,l,c,r,m,g,u,d,h,f,y,k;console.log("Rendering work interface for task:",e.title);const t=document.getElementById("workTaskContent");if(!t){console.error("workTaskContent element not found!");return}const s=await D(e.id),o=s.reduce((b,w)=>b+w.hours,0);t.innerHTML=`
    <div class="work-task-header mb-4">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h4 class="mb-1">${e.title}</h4>
          <div class="text-muted">
            <span class="badge bg-secondary me-2">${e.status}</span>
            <span class="badge bg-${e.urgency==="High"?"danger":e.urgency==="Med"?"warning":"success"} me-2">${e.urgency}</span>
            <span class="badge bg-info">${e.importance}</span>
          </div>
        </div>
        <div class="text-end">
          <div class="h5 mb-1">${o.toFixed(1)}h logged</div>
          <div class="text-muted">${e.estimate?`of ${e.estimate}h estimated`:"No estimate"}</div>
        </div>
      </div>
    </div>
    
    <div class="row g-4">
      \x3C!-- Task Details Form -->
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-tasks me-2"></i>Task Details</h6>
          </div>
          <div class="card-body">
            <form id="workTaskForm">
              <input type="hidden" id="workTaskId" value="${e.id}">
              
              <div class="mb-3">
                <label for="workTaskTitle" class="form-label">Title</label>
                <input type="text" class="form-control" id="workTaskTitle" value="${e.title}" required>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="workTaskDueDate" class="form-label">Due Date</label>
                  <input type="date" class="form-control" id="workTaskDueDate" value="${e.dueOn}">
                </div>
                <div class="col-md-4">
                  <label for="workTaskEstimate" class="form-label">Estimate (hours)</label>
                  <input type="number" class="form-control" id="workTaskEstimate" step="0.25" min="0" value="${e.estimate||""}">
                </div>
                <div class="col-md-4">
                  <label for="workTaskRemaining" class="form-label">Remaining (hours)</label>
                  <input type="number" class="form-control" id="workTaskRemaining" step="0.1" min="0" value="${e.remainingHours||0}">
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-4">
                  <label for="workTaskStatus" class="form-label">Status</label>
                  <select class="form-select" id="workTaskStatus">
                    <option value="Ready" ${e.status==="Ready"?"selected":""}>Ready</option>
                    <option value="Estimated" ${e.status==="Estimated"?"selected":""}>Estimated</option>
                    <option value="InProgress" ${e.status==="InProgress"?"selected":""}>In Progress</option>
                    <option value="Blocked" ${e.status==="Blocked"?"selected":""}>Blocked</option>
                    <option value="Backburner" ${e.status==="Backburner"?"selected":""}>Backburner</option>
                    <option value="OnHold" ${e.status==="OnHold"?"selected":""}>On Hold</option>
                    <option value="Completed" ${e.status==="Completed"?"selected":""}>Completed</option>
                    <option value="Abandoned" ${e.status==="Abandoned"?"selected":""}>Abandoned</option>
                    <option value="Archived" ${e.status==="Archived"?"selected":""}>Archived</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="workTaskUrgency" class="form-label">Urgency</label>
                  <select class="form-select" id="workTaskUrgency">
                    <option value="Low" ${e.urgency==="Low"?"selected":""}>Low</option>
                    <option value="Med" ${e.urgency==="Med"?"selected":""}>Medium</option>
                    <option value="High" ${e.urgency==="High"?"selected":""}>High</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label for="workTaskImportance" class="form-label">Importance</label>
                  <select class="form-select" id="workTaskImportance">
                    <option value="Low" ${e.importance==="Low"?"selected":""}>Low</option>
                    <option value="Med" ${e.importance==="Med"?"selected":""}>Medium</option>
                    <option value="High" ${e.importance==="High"?"selected":""}>High</option>
                  </select>
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="workTaskProject" class="form-label">Project</label>
                  <select class="form-select" id="workTaskProject">
                    <option value="">No Project (AdHoc)</option>
                    \x3C!-- Projects will be populated here -->
                  </select>
                </div>
                <div class="col-md-6">
                  <label for="workTaskPhase" class="form-label">Phase</label>
                  <select class="form-select" id="workTaskPhase">
                    <option value="">No Phase</option>
                    \x3C!-- Phases will be populated here -->
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label for="workTaskDescription" class="form-label">Description</label>
                <textarea class="form-control" id="workTaskDescription" rows="4">${e.description||""}</textarea>
              </div>
              
              <div class="mb-3">
                <label for="workTaskNotes" class="form-label">Notes</label>
                <textarea class="form-control" id="workTaskNotes" rows="6" placeholder="Add detailed notes, progress updates, reminders...">${e.notes||""}</textarea>
                <div class="form-text">Use this space for detailed notes, progress updates, links, or any other information.</div>
              </div>
              
              \x3C!-- Personal Scale Estimation -->
              <div class="mb-3">
                <label class="form-label">
                  <i class="fas fa-chart-line me-2"></i>Personal Scale Estimation
                </label>
                <div class="estimation-panel p-3 border rounded bg-light">
                  \x3C!-- Scale Estimates -->
                  <div class="row g-3 mb-3">
                    <div class="col-md-4">
                      <label for="estimateLow" class="form-label small">Low Estimate</label>
                      <input type="range" class="form-range" id="estimateLow" min="1" max="10" step="1" value="${((n=(a=e.estimationData)==null?void 0:a.scale)==null?void 0:n.low)||3}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateLowValue">${((l=(i=e.estimationData)==null?void 0:i.scale)==null?void 0:l.low)||3}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label for="estimateExpected" class="form-label small">Expected Estimate</label>
                      <input type="range" class="form-range" id="estimateExpected" min="1" max="10" step="1" value="${((r=(c=e.estimationData)==null?void 0:c.scale)==null?void 0:r.expected)||5}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateExpectedValue">${((g=(m=e.estimationData)==null?void 0:m.scale)==null?void 0:g.expected)||5}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label for="estimateHigh" class="form-label small">High Estimate</label>
                      <input type="range" class="form-range" id="estimateHigh" min="1" max="10" step="1" value="${((d=(u=e.estimationData)==null?void 0:u.scale)==null?void 0:d.high)||7}">
                      <div class="d-flex justify-content-between">
                        <small class="text-muted">1</small>
                        <span class="fw-bold" id="estimateHighValue">${((f=(h=e.estimationData)==null?void 0:h.scale)==null?void 0:f.high)||7}</span>
                        <small class="text-muted">10</small>
                      </div>
                    </div>
                  </div>
                  
                  \x3C!-- Confidence Level -->
                  <div class="mb-3">
                    <label for="estimateConfidence" class="form-label small">Confidence Level</label>
                    <input type="range" class="form-range" id="estimateConfidence" min="0" max="100" step="1" value="${((y=e.estimationData)==null?void 0:y.confidence)||100}">
                    <div class="d-flex justify-content-between align-items-center">
                      <small class="text-muted">0%</small>
                      <div class="text-center">
                        <span class="fw-bold" id="estimateConfidenceValue">${((k=e.estimationData)==null?void 0:k.confidence)||100}%</span>
                        <div class="small text-muted" id="confidenceHint">Very confident</div>
                      </div>
                      <small class="text-muted">100%</small>
                    </div>
                  </div>
                  
                  \x3C!-- Velocity Prediction -->
                  <div class="mt-3 p-2 bg-white rounded border">
                    <h6 class="small mb-2"><i class="fas fa-clock me-1"></i>Hour Prediction</h6>
                    <div id="velocityPrediction">
                      <div class="text-muted">Complete more tasks to enable predictions</div>
                    </div>
                  </div>
                </div>
              </div>
              
              \x3C!-- Category Lists Management -->
              <div class="mb-3">
                <label class="form-label">
                  <i class="fas fa-tags me-2"></i>Category Lists for Time Tracking
                </label>
                <div class="category-lists-panel p-3 border rounded bg-light">
                  <div id="workTaskCategoryLists">
                    \x3C!-- Category lists will be populated here -->
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-info-circle me-1"></i>
                      Select which category lists to use when logging time for this task
                    </small>
                  </div>
                </div>
              </div>
              
              <div class="d-flex gap-2 justify-content-between">
                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save me-2"></i>Save Changes
                  </button>
                  <button type="button" class="btn btn-outline-secondary" id="cancelWorkEdit">
                    <i class="fas fa-times me-2"></i>Cancel
                  </button>
                </div>
                <button type="button" class="btn btn-outline-danger" id="deleteTaskBtn" data-task-id="${e.id}">
                  <i class="fas fa-trash me-2"></i>Delete
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      
      \x3C!-- Time Logging Panel -->
      <div class="col-lg-4">
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-clock me-2"></i>Time Tracking</h6>
          </div>
          <div class="card-body">
            \x3C!-- Quick Time Buttons -->
            <div class="mb-3">
              <div class="d-flex gap-2 flex-wrap">
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.25">
                  <i class="fas fa-plus me-1"></i>15m
                </button>
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="0.5">
                  <i class="fas fa-plus me-1"></i>30m
                </button>
                <button class="btn btn-outline-success quick-time-btn" data-task-id="${e.id}" data-hours="1">
                  <i class="fas fa-plus me-1"></i>1h
                </button>
              </div>
            </div>
            
            \x3C!-- Custom Time Entry -->
            <div class="mb-3">
              <h6>Custom Time Entry</h6>
              <div class="row g-2 mb-2">
                <div class="col">
                  <input type="number" class="form-control" id="customHours" step="0.25" min="0" max="24" placeholder="Hours">
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary" id="logCustomTimeBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
              
              \x3C!-- Category Selector for Time Logging -->
              <div class="mb-2">
                <label class="form-label small text-muted">Category (optional)</label>
                <div id="workCategoryContainer">
                  <select class="form-select" disabled>
                    <option>Loading categories...</option>
                  </select>
                </div>
              </div>
              
              \x3C!-- Date Selection Toggle -->
              <div class="mb-2">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="customDateToggle">
                  <label class="form-check-label text-muted small" for="customDateToggle">
                    Different date?
                  </label>
                </div>
              </div>
              
              \x3C!-- Custom Date Picker -->
              <div id="customDateContainer" style="display: none;" class="mb-2">
                <input type="date" class="form-control form-control-sm" id="customDate" value="${new Date().toISOString().split("T")[0]}">
                <div class="form-text">Select the date when this time was actually worked</div>
              </div>
            </div>
            
            \x3C!-- Time Logs -->
            <div class="mt-3">
              <h6>Recent Time Logs</h6>
              <div id="workTimeLogs" class="time-logs-list">
                \x3C!-- Time logs will be populated here -->
              </div>
            </div>
          </div>
        </div>
        
        \x3C!-- Status History Panel -->
        <div class="card mt-3">
          <div class="card-header">
            <h6 class="mb-0"><i class="fas fa-history me-2"></i>Status History</h6>
          </div>
          <div class="card-body">
            <div id="workStatusHistory" class="status-history-container" style="max-height: 400px; overflow-y: auto;">
              ${Js(e.statusHistory||[])}
            </div>
          </div>
        </div>
      </div>
    </div>
  `,await Zs(s),await eo(e),await to(e.projectId),await yt(e.phaseKey,e.projectId),so(e)}function Js(e){return!e||e.length===0?'<p class="text-muted">No status history available</p>':e.map(t=>{const s=new Date(t.timestamp);return`
      <div class="status-history-entry mb-2 p-2 border-bottom">
        <div class="d-flex justify-content-between">
          <span class="badge bg-secondary">${t.status}</span>
          <small class="text-muted">${s.toLocaleDateString()} ${s.toLocaleTimeString()}</small>
        </div>
        ${t.note?`<div class="small text-muted mt-1">${t.note}</div>`:""}
      </div>
    `}).reverse().join("")}async function Zs(e){const t=document.getElementById("workTimeLogs");if(!t)return;if(e.length===0){t.innerHTML='<p class="text-muted small">No time logs yet</p>';return}const s=e.slice(-5).reverse();t.innerHTML=s.map(o=>`
    <div class="time-log-entry mb-2 p-2 border rounded" data-log-id="${o.id}">
      <div class="d-flex justify-content-between align-items-center">
        <div class="flex-grow-1">
          <div class="d-flex justify-content-between">
            <strong>${o.hours.toFixed(2)}h</strong>
            <small class="text-muted">${new Date(o.dateLogged).toLocaleDateString()}</small>
          </div>
          ${o.categoryKey?`<div class="small text-muted">${o.categoryKey}</div>`:""}
          ${o.notes?`<div class="small">${o.notes}</div>`:""}
        </div>
        <button class="btn btn-sm btn-outline-danger ms-2 delete-log-btn" data-log-id="${o.id}" title="Delete time entry">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="delete-confirm mt-2" style="display: none;">
        <div class="alert alert-warning mb-2 py-2 small">
          <i class="fas fa-exclamation-triangle me-1"></i>
          Remove this time entry? This cannot be undone.
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-danger confirm-delete-btn" data-log-id="${o.id}">
            <i class="fas fa-check me-1"></i>Yes, Remove
          </button>
          <button class="btn btn-sm btn-secondary cancel-delete-btn">
            <i class="fas fa-times me-1"></i>Cancel
          </button>
        </div>
      </div>
    </div>
  `).join(""),t.querySelectorAll(".delete-log-btn").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation();const i=o.closest(".time-log-entry").querySelector(".delete-confirm");i.style.display="block",o.style.display="none"})}),t.querySelectorAll(".confirm-delete-btn").forEach(o=>{o.addEventListener("click",async a=>{a.stopPropagation();const n=parseInt(o.dataset.logId);await no(n)})}),t.querySelectorAll(".cancel-delete-btn").forEach(o=>{o.addEventListener("click",a=>{a.stopPropagation();const n=o.closest(".time-log-entry"),i=n.querySelector(".delete-confirm"),l=n.querySelector(".delete-log-btn");i.style.display="none",l.style.display="block"})})}async function eo(e){const t=document.getElementById("workTaskCategoryLists");if(!t)return;const s=await he();if(s.length===0){t.innerHTML=`
      <div class="text-muted">
        <i class="fas fa-plus-circle me-2"></i>
        No category lists available. Create one in Settings to enable time categorization.
      </div>
    `;return}const o=e.categoryLists||[];let a='<div class="row g-2">';s.forEach(n=>{const i=o.includes(n.slug);a+=`
      <div class="col-md-6">
        <div class="form-check">
          <input class="form-check-input category-list-checkbox" 
                 type="checkbox" 
                 id="categoryList_${n.slug}" 
                 value="${n.slug}"
                 ${i?"checked":""}>
          <label class="form-check-label" for="categoryList_${n.slug}">
            <strong>${n.title}</strong>
            <div class="small text-muted">${n.categories.length} categories</div>
          </label>
        </div>
      </div>
    `}),a+="</div>",t.innerHTML=a}async function to(e){const t=document.getElementById("workTaskProject");if(!t)return;const s=await se();let o='<option value="">No Project (AdHoc)</option>';s.forEach(a=>{o+=`<option value="${a.id}" ${a.id===e?"selected":""}>${a.name}</option>`}),t.innerHTML=o}async function yt(e,t){const s=document.getElementById("workTaskPhase");if(!s)return;const o=await oe();let a='<option value="">No Phase</option>';o.forEach(n=>{n.phases.forEach(i=>{const l=`${n.slug}.${i.slug}`;a+=`<option value="${l}" ${l===e?"selected":""}>${n.title}: ${i.title}</option>`})}),s.innerHTML=a}function so(e){const t=document.getElementById("workTaskForm");t&&t.addEventListener("submit",async g=>{g.preventDefault(),await oo(e)});const s=document.getElementById("cancelWorkEdit");s&&s.addEventListener("click",()=>{Se(document.getElementById("workTaskContent").parentElement.parentElement.parentElement)});const o=document.getElementById("deleteTaskBtn");o&&o.addEventListener("click",async()=>{confirm("Are you sure you want to delete this task?")&&(await Ut(e.id),v("Task deleted successfully","success"),Se(document.getElementById("workTaskContent").parentElement.parentElement.parentElement))});const a=document.getElementById("workTaskProject");a&&a.addEventListener("change",async function(){await yt(null,this.value)});const n=document.getElementById("customDateToggle"),i=document.getElementById("customDateContainer");n&&i&&n.addEventListener("change",()=>{i.style.display=n.checked?"block":"none"}),io(),ao(e);const l=document.querySelector(".col-lg-4 .card");if(l){if(l.dataset.quickTimeInitialized==="true")return;l.dataset.quickTimeInitialized="true";const g=async u=>{const d=u.target.closest(".quick-time-btn");if(d){const h=parseFloat(d.dataset.hours);await Ee(e.id,h)}};l.addEventListener("click",g)}const c=document.getElementById("logCustomTimeBtn");c&&c.addEventListener("click",async()=>{const g=parseFloat(document.getElementById("customHours").value);g>0&&(await Ee(e.id,g),document.getElementById("customHours").value="")});const r=document.getElementById("workTaskEstimate"),m=document.getElementById("workTaskRemaining");r&&m&&(r.addEventListener("input",()=>{const g=parseFloat(r.value)||0,u=parseFloat(m.value)||0;(u===0||m.value===""||u===parseFloat(r.getAttribute("data-previous-value")||0))&&(m.value=g),r.setAttribute("data-previous-value",g)}),r.setAttribute("data-previous-value",r.value||0))}async function oo(e){parseInt(document.getElementById("workTaskId").value);const t=Array.from(document.querySelectorAll(".category-list-checkbox:checked")).map(a=>a.value),s={...e,title:document.getElementById("workTaskTitle").value,dueOn:document.getElementById("workTaskDueDate").value,estimate:parseFloat(document.getElementById("workTaskEstimate").value)||null,remainingHours:parseFloat(document.getElementById("workTaskRemaining").value)||0,status:document.getElementById("workTaskStatus").value,urgency:document.getElementById("workTaskUrgency").value,importance:document.getElementById("workTaskImportance").value,projectId:document.getElementById("workTaskProject").value?parseInt(document.getElementById("workTaskProject").value):null,phaseKey:document.getElementById("workTaskPhase").value||null,description:document.getElementById("workTaskDescription").value,notes:document.getElementById("workTaskNotes").value,categoryLists:t,estimationData:{scale:{low:parseInt(document.getElementById("estimateLow").value),expected:parseInt(document.getElementById("estimateExpected").value),high:parseInt(document.getElementById("estimateHigh").value)},confidence:parseInt(document.getElementById("estimateConfidence").value),estimatedAt:new Date().toISOString()}};if(await He(s,!0)){v("Task updated successfully!","success");const a=document.getElementById("boardTab");a&&a.click()}}async function ao(e){const t=document.getElementById("workCategoryContainer");if(!t)return;const s=e.categoryLists||[];if(s.length===0){t.innerHTML=`
      <select class="form-select" disabled>
        <option>No categories available</option>
      </select>
      <small class="form-text text-muted">Add category lists to this task to enable categorization</small>
    `;return}const{getCategoryLists:o}=await os(async()=>{const{getCategoryLists:r}=await Promise.resolve().then(()=>Ot);return{getCategoryLists:r}},void 0,import.meta.url),n=(await o()).filter(r=>s.includes(r.slug)),i=[];for(const r of n)r.categories&&r.categories.length>0&&r.categories.forEach(m=>{i.push({key:m.slug,listTitle:r.title,categoryTitle:m.title})});if(i.length===0){t.innerHTML=`
      <select class="form-select" disabled>
        <option>No categories available</option>
      </select>
      <small class="form-text text-muted">Add categories to the assigned category lists</small>
    `;return}const l=i.reduce((r,m)=>(r[m.listTitle]||(r[m.listTitle]=[]),r[m.listTitle].push(m),r),{});let c='<option value="">Select category (optional)</option>';Object.keys(l).forEach(r=>{c+=`<optgroup label="${r}">`,l[r].forEach(m=>{c+=`<option value="${m.key}">${m.categoryTitle}</option>`}),c+="</optgroup>"}),t.innerHTML=`
    <select class="form-select category-selector" id="workCategorySelect">
      ${c}
    </select>
  `}let ve=!1;async function Ee(e,t,s){if(ve){console.log("Already logging time, ignoring duplicate click");return}ve=!0;try{const o=document.getElementById("customDateToggle"),a=document.getElementById("customDate"),n=document.getElementById("workCategorySelect"),i=o!=null&&o.checked&&a?a.value:new Date().toISOString().split("T")[0],l={taskId:e,hours:t,dateLogged:i,categoryKey:(n==null?void 0:n.value)||null,notes:`Quick log: ${t}h`};if(!await Ce(l))return;const m=(await C({},!0)).find(u=>u.id===e);let g=`${t}h logged`;if(m&&m.remainingHours!==null&&m.remainingHours!==void 0){const u=Pe(Math.max(0,m.remainingHours-t));console.log(`Decrementing remaining hours: ${m.remainingHours}h -> ${u}h (logged ${t}h)`),await xe(e,u,`Auto-decremented by ${t}h time log`)&&(g+=" and remaining hours updated!")}v(g,"success"),n&&(n.value=""),T.emit("task:timeLogged",{taskId:e,hours:t,dateLogged:i}),await pe(e),s&&typeof s=="function"&&await s()}finally{ve=!1}}async function no(e){console.log("Deleting time log:",e);const s=(await D()).find(c=>c.id===e);if(!s){v("Time log not found","error");return}const o=s.taskId,a=s.hours;if(!await Nt(e))return;const l=(await C({},!0)).find(c=>c.id===o);if(l&&l.remainingHours!==null&&l.remainingHours!==void 0){const c=Pe(l.remainingHours+a);await xe(o,c,`Restored ${a}h from deleted time log`)}v("Time entry removed","success"),await pe(o)}async function io(){const e=document.getElementById("estimateLow"),t=document.getElementById("estimateExpected"),s=document.getElementById("estimateHigh"),o=document.getElementById("estimateConfidence");if(!e||!t||!s||!o)return;function a(){const n=parseInt(e.value),i=parseInt(t.value),l=parseInt(s.value),c=parseInt(o.value);document.getElementById("estimateLowValue").textContent=n,document.getElementById("estimateExpectedValue").textContent=i,document.getElementById("estimateHighValue").textContent=l,document.getElementById("estimateConfidenceValue").textContent=`${c}%`;const r=document.getElementById("confidenceHint");r&&(r.textContent=Xs(c)),n>i&&(e.value=i,document.getElementById("estimateLowValue").textContent=i),i<n&&(t.value=n,document.getElementById("estimateExpectedValue").textContent=n),i>l&&(t.value=l,document.getElementById("estimateExpectedValue").textContent=l),l<i&&(s.value=i,document.getElementById("estimateHighValue").textContent=i),lo()}e.addEventListener("input",a),t.addEventListener("input",a),s.addEventListener("input",a),o.addEventListener("input",a),a()}async function lo(){const e=document.getElementById("velocityPrediction");if(!e)return;const t=document.getElementById("estimateLow"),s=document.getElementById("estimateExpected"),o=document.getElementById("estimateHigh"),a=document.getElementById("estimateConfidence");if(!t||!s||!o||!a)return;const n={scale:{low:parseInt(t.value),expected:parseInt(s.value),high:parseInt(o.value)},confidence:parseInt(a.value)},i=await Qs(n);if(!i.canPredict){e.innerHTML=`
      <div class="text-muted">
        <i class="fas fa-info-circle me-1"></i>
        ${i.message}
      </div>
    `;return}e.innerHTML=`
    <div class="row g-3 text-center">
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">Low</div>
        <div class="fw-bold text-success fs-6">${i.low.toFixed(1)}h</div>
      </div>
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">Expected</div>
        <div class="fw-bold text-primary fs-6">${i.expected.toFixed(1)}h</div>
      </div>
      <div class="col-4">
        <div class="text-muted mb-1" style="font-size: 0.85rem;">High</div>
        <div class="fw-bold text-warning fs-6">${i.high.toFixed(1)}h</div>
      </div>
    </div>
    <div class="text-center mt-3">
      <div class="text-muted" style="font-size: 0.8rem;">
        Based on ${i.sampleSize} completed task${i.sampleSize===1?"":"s"}<br>
        Personal velocity: ${i.velocity.toFixed(2)}h per scale point
      </div>
    </div>
  `}let $=null;async function ro(e){console.log("Rendering Reports view"),e.innerHTML=`
    <div class="reports-container">
      <div class="row g-4">
        \x3C!-- Report Controls -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-cog me-2"></i>
                Report Settings
              </h5>
            </div>
            <div class="card-body">
              \x3C!-- Time Period Selection -->
              <div class="mb-3">
                <label class="form-label">Time Period</label>
                <select class="form-select" id="reportPeriod">
                  <option value="thisWeek">This Week</option>
                  <option value="lastWeek">Last Week</option>
                  <option value="thisMonth">This Month</option>
                  <option value="lastMonth">Last Month</option>
                  <option value="custom">Custom Range</option>
                </select>
              </div>
              
              \x3C!-- Custom Date Range -->
              <div id="customDateRange" style="display: none;">
                <div class="row g-2 mb-3">
                  <div class="col">
                    <label class="form-label small">From</label>
                    <input type="date" class="form-control" id="reportStartDate">
                  </div>
                  <div class="col">
                    <label class="form-label small">To</label>
                    <input type="date" class="form-control" id="reportEndDate">
                  </div>
                </div>
              </div>
              
              \x3C!-- Report Type Selection -->
              <div class="mb-3">
                <label class="form-label">Report Sections</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeExecutiveSummary" checked>
                  <label class="form-check-label" for="includeExecutiveSummary">
                    Executive Summary
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeTimesheet" checked>
                  <label class="form-check-label" for="includeTimesheet">
                    Time Summary
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeTaskProgress" checked>
                  <label class="form-check-label" for="includeTaskProgress">
                    Task Progress
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeAccomplishments" checked>
                  <label class="form-check-label" for="includeAccomplishments">
                    Accomplishments
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="includeCategoryAnalytics" checked>
                  <label class="form-check-label" for="includeCategoryAnalytics">
                    Category Analytics
                  </label>
                </div>
              </div>
              
              \x3C!-- Generate Button -->
              <button class="btn btn-primary w-100 mb-2" id="generateReportBtn">
                <i class="fas fa-chart-line me-2"></i>
                Generate Report
              </button>
              
              \x3C!-- Export Button -->
              <button class="btn btn-outline-success w-100" id="exportReportBtn" disabled>
                <i class="fas fa-download me-2"></i>
                Export as Markdown
              </button>
            </div>
          </div>
        </div>
        
        \x3C!-- Report Preview -->
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="fas fa-file-alt me-2"></i>
                Report Preview
              </h5>
            </div>
            <div class="card-body">
              <div id="reportPreview" class="report-preview">
                <div class="text-center text-muted py-5">
                  <i class="fas fa-chart-bar fa-3x mb-3"></i>
                  <h4>Ready to Generate Report</h4>
                  <p>Select your preferences and click "Generate Report" to create your custom report.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `,co()}function co(){const e=document.getElementById("reportPeriod");e&&e.addEventListener("change",uo);const t=document.getElementById("generateReportBtn");t&&t.addEventListener("click",mo);const s=document.getElementById("exportReportBtn");s&&s.addEventListener("click",po)}function uo(){const e=document.getElementById("reportPeriod").value,t=document.getElementById("customDateRange"),s=document.getElementById("reportStartDate"),o=document.getElementById("reportEndDate");e==="custom"?(t.style.display="block",s.value||(s.value=new Date().toISOString().split("T")[0]),o.value||(o.value=new Date().toISOString().split("T")[0])):t.style.display="none"}async function mo(){const e=document.getElementById("reportPeriod").value,t=document.getElementById("includeExecutiveSummary").checked,s=document.getElementById("includeTimesheet").checked,o=document.getElementById("includeTaskProgress").checked,a=document.getElementById("includeAccomplishments").checked,n=document.getElementById("includeCategoryAnalytics").checked;let i,l,c;const r=new Date;switch(e){case"thisWeek":const m=new Date(r);m.setDate(r.getDate()-r.getDay());const g=new Date(m);g.setDate(m.getDate()+6),i=m.toISOString().split("T")[0],l=g.toISOString().split("T")[0],c="This Week";break;case"lastWeek":const u=new Date(r);u.setDate(r.getDate()-r.getDay()-7);const d=new Date(u);d.setDate(u.getDate()+6),i=u.toISOString().split("T")[0],l=d.toISOString().split("T")[0],c="Last Week";break;case"thisMonth":const h=new Date(r.getFullYear(),r.getMonth(),1),f=new Date(r.getFullYear(),r.getMonth()+1,0);i=h.toISOString().split("T")[0],l=f.toISOString().split("T")[0],c="This Month";break;case"lastMonth":const y=new Date(r.getFullYear(),r.getMonth()-1,1),k=new Date(r.getFullYear(),r.getMonth(),0);i=y.toISOString().split("T")[0],l=k.toISOString().split("T")[0],c="Last Month";break;case"custom":i=document.getElementById("reportStartDate").value,l=document.getElementById("reportEndDate").value,c=`${new Date(i).toLocaleDateString()} - ${new Date(l).toLocaleDateString()}`;break}try{const m=await go(i,l,c,{includeExecutiveSummary:t,includeTimesheet:s,includeTaskProgress:o,includeAccomplishments:a,includeCategoryAnalytics:n});$=m;const g=document.getElementById("reportPreview");g.innerHTML=await ho(m),document.getElementById("exportReportBtn").disabled=!1}catch(m){console.error("Error generating report:",m),alert("Error generating report: "+m.message)}}async function go(e,t,s,o){const a=await C({},!0),n=await Ae(),i=await Oe(!0),l=await We(),c=n.filter(b=>b.dateLogged>=e&&b.dateLogged<=t),r=i.filter(b=>{var S;const w=((S=b.createdAt)==null?void 0:S.split("T")[0])||b.date;return w>=e&&w<=t}),m=l.filter(b=>{var S;const w=((S=b.createdAt)==null?void 0:S.split("T")[0])||b.date;return w>=e&&w<=t}),g={};let u=0;for(const b of c){if(!g[b.taskId]){const w=a.find(S=>S.id===b.taskId);g[b.taskId]={task:w,hours:0,logs:[]}}g[b.taskId].hours+=b.hours,g[b.taskId].logs.push(b),u+=b.hours}const d=[],h=[];for(const b of a)if(b.statusHistory){const w=b.statusHistory.find(B=>B.status==="Completed");if(w){const B=w.timestamp.split("T")[0];B>=e&&B<=t&&d.push({...b,completedAt:w.timestamp})}const S=b.statusHistory.find(B=>B.status==="Abandoned");if(S){const B=S.timestamp.split("T")[0];B>=e&&B<=t&&h.push({...b,abandonedAt:S.timestamp})}}const f={created:0,estimated:0,started:0,blocked:0,completed:0,abandoned:0};for(const b of a)if(b.statusHistory)for(const w of b.statusHistory){const S=w.timestamp.split("T")[0];if(S>=e&&S<=t)switch(w.status){case"Ready":w.note&&w.note.includes("created")&&f.created++;break;case"Estimated":f.estimated++;break;case"InProgress":f.started++;break;case"Blocked":f.blocked++;break;case"Completed":f.completed++;break;case"Abandoned":f.abandoned++;break}}const y=at(c),k=a.filter(b=>["InProgress","Blocked","Backburner","OnHold"].includes(b.status)&&c.some(w=>w.taskId===b.id));return{period:s,startDate:e,endDate:t,options:o,summary:{totalHours:u,completedTasks:d.length,abandonedTasks:h.length,activeTasks:k.length,accomplishments:m.length,todos:r.length},statusTransitions:f,timeByTask:g,tasksCompletedInPeriod:d,tasksAbandonedInPeriod:h,activeTasks:k,accomplishments:m,todos:r,categoryAnalytics:y}}async function ho(e){var s,o;let t=`
    <div class="report-content">
      <h2>Report for ${e.period}</h2>
      <p class="text-muted">Generated on ${new Date().toLocaleDateString()}</p>
  `;if(e.options.includeExecutiveSummary&&(t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-star me-2"></i>Executive Summary</h3>
        <div class="row g-3 mb-3">
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-primary mb-1">${e.summary.totalHours.toFixed(1)}h</div>
              <div class="text-muted">Total Hours</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-success mb-1">${e.summary.completedTasks}</div>
              <div class="text-muted">Completed</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-danger mb-1">${e.summary.abandonedTasks}</div>
              <div class="text-muted">Abandoned</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-warning mb-1">${e.summary.activeTasks}</div>
              <div class="text-muted">Active Tasks</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${e.statusTransitions.started}</div>
              <div class="text-muted">Tasks Started</div>
            </div>
          </div>
          <div class="col-md-2">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${e.summary.accomplishments}</div>
              <div class="text-muted">Accomplishments</div>
            </div>
          </div>
        </div>
        
        \x3C!-- Status Transitions -->
        <div class="row g-3 mb-3">
          <div class="col-12">
            <h5><i class="fas fa-chart-line me-2"></i>Status Transitions in Period</h5>
            <div class="row g-2">
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-primary">${e.statusTransitions.created}</div>
                  <small class="text-muted">Created</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-info">${e.statusTransitions.estimated}</div>
                  <small class="text-muted">Estimated</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-primary">${e.statusTransitions.started}</div>
                  <small class="text-muted">Started</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-danger">${e.statusTransitions.blocked}</div>
                  <small class="text-muted">Blocked</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-success">${e.statusTransitions.completed}</div>
                  <small class="text-muted">Completed</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="text-center p-2 border rounded">
                  <div class="fw-bold text-dark">${e.statusTransitions.abandoned}</div>
                  <small class="text-muted">Abandoned</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `),e.options.includeTimesheet){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-clock me-2"></i>Time Summary</h3>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead class="table-dark">
              <tr>
                <th>Task</th>
                <th>Status</th>
                <th>Hours</th>
                <th>Sessions</th>
              </tr>
            </thead>
            <tbody>
    `;const a=Object.values(e.timeByTask).sort((n,i)=>i.hours-n.hours);for(const n of a)t+=`
              <tr>
                <td>${((s=n.task)==null?void 0:s.title)||"Unknown Task"}</td>
                <td><span class="badge bg-secondary">${((o=n.task)==null?void 0:o.status)||"N/A"}</span></td>
                <td><strong>${n.hours.toFixed(1)}h</strong></td>
                <td>${n.logs.length}</td>
              </tr>
      `;t+=`
            </tbody>
          </table>
        </div>
      </div>
    `}if(e.options.includeTaskProgress&&e.tasksCompletedInPeriod.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-check-circle me-2"></i>Completed Tasks</h3>
        <ul class="list-group mb-3">
    `;for(const a of e.tasksCompletedInPeriod){const n=new Date(a.completedAt);t+=`
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <span class="fw-bold">${a.title}</span>
              <small class="text-muted d-block">Completed: ${n.toLocaleDateString()}</small>
            </div>
            <span class="badge bg-success">Completed</span>
          </li>
      `}t+=`
        </ul>
      </div>
    `}if(e.options.includeAccomplishments&&e.accomplishments.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-trophy me-2"></i>Accomplishments</h3>
        <ul class="list-group">
    `;for(const a of e.accomplishments)t+=`
          <li class="list-group-item">
            <strong>${a.title}</strong>
            ${a.content?`<div class="small text-muted">${a.content}</div>`:""}
          </li>
      `;t+=`
        </ul>
      </div>
    `}if(e.options.includeCategoryAnalytics&&e.categoryAnalytics.length>0){t+=`
      <div class="report-section mb-4">
        <h3><i class="fas fa-tags me-2"></i>Category Analytics</h3>
        <div class="table-responsive">
          <table class="table table-sm table-striped">
            <thead class="table-dark">
              <tr>
                <th>Category</th>
                <th>Hours</th>
                <th>% of Total</th>
              </tr>
            </thead>
            <tbody>
    `;for(const a of e.categoryAnalytics)t+=`
              <tr>
                <td>${a.name}</td>
                <td><strong>${a.hours.toFixed(1)}h</strong></td>
                <td>${a.percentage.toFixed(1)}%</td>
              </tr>
      `;t+=`
            </tbody>
          </table>
        </div>
      </div>
    `}return t+=await fo(),t+="</div>",t}async function fo(){const e=await pt();if(!e)return`
      <div class="report-section mb-4">
        <h3><i class="fas fa-tachometer-alt me-2"></i>Personal Velocity Analysis</h3>
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          Complete tasks with estimation data to see velocity metrics. 
          Add scale estimates (Low/Expected/High) when editing tasks in the Work view.
        </div>
      </div>
    `;const s=(await C({},!0)).filter(n=>{var i,l;return n.status==="Completed"&&((l=(i=n.estimationData)==null?void 0:i.scale)==null?void 0:l.expected)});let o={totalTasks:0,withinRange:0,underestimated:0,overestimated:0,avgConfidence:0};if(s.length>0){let n=0;for(const i of s){const r=(await Ae()).filter(m=>m.taskId===i.id).reduce((m,g)=>m+g.hours,0);if(r>0){o.totalTasks++;const m=i.estimationData.scale.low*e.velocity,g=i.estimationData.scale.high*e.velocity;r>=m&&r<=g?o.withinRange++:r>g?o.underestimated++:o.overestimated++,n+=i.estimationData.confidence||100}}o.avgConfidence=n/o.totalTasks}const a=o.totalTasks>0?(o.withinRange/o.totalTasks*100).toFixed(1):0;return`
    <div class="report-section mb-4">
      <h3><i class="fas fa-tachometer-alt me-2"></i>Personal Velocity Analysis</h3>
      
      \x3C!-- Velocity Metrics -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-primary mb-1">${e.velocity.toFixed(2)}h</div>
            <div class="text-muted">Hours per Point</div>
            <small class="text-muted">Current Velocity</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-success mb-1">${e.sampleSize}</div>
            <div class="text-muted">Completed Tasks</div>
            <small class="text-muted">With Estimates</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-info mb-1">${e.totalHours.toFixed(1)}h</div>
            <div class="text-muted">Total Hours</div>
            <small class="text-muted">Actual Time Logged</small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="metric-card text-center p-3 border rounded">
            <div class="h3 text-warning mb-1">${e.totalPoints}</div>
            <div class="text-muted">Scale Points</div>
            <small class="text-muted">Expected Estimates</small>
          </div>
        </div>
      </div>
      
      \x3C!-- Estimation Accuracy -->
      ${o.totalTasks>0?`
      <div class="mb-4">
        <h5><i class="fas fa-bullseye me-2"></i>Estimation Accuracy</h5>
        <div class="row g-3">
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-success mb-1">${a}%</div>
              <div class="text-muted">Within Range</div>
              <small class="text-muted">${o.withinRange} of ${o.totalTasks} tasks</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-warning mb-1">${o.underestimated}</div>
              <div class="text-muted">Underestimated</div>
              <small class="text-muted">Took longer than High</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-info mb-1">${o.overestimated}</div>
              <div class="text-muted">Overestimated</div>
              <small class="text-muted">Took less than Low</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="metric-card text-center p-3 border rounded">
              <div class="h3 text-primary mb-1">${o.avgConfidence.toFixed(0)}%</div>
              <div class="text-muted">Avg Confidence</div>
              <small class="text-muted">Your certainty level</small>
            </div>
          </div>
        </div>
      </div>
      `:""}
      
      \x3C!-- Interpretation Guide -->
      <div class="alert alert-light border">
        <h6><i class="fas fa-lightbulb me-2"></i>Understanding Your Velocity</h6>
        <ul class="mb-0">
          <li><strong>Velocity ${e.velocity.toFixed(2)}h/point</strong> means each scale point represents about ${e.velocity.toFixed(1)} hours of work for you</li>
          ${o.totalTasks>0?`
          <li><strong>${a}% accuracy</strong> means your estimates are ${a>=80?"excellent":a>=60?"good":"improving"} - actual hours fall within your Low-High range</li>
          <li><strong>Underestimated tasks</strong> suggest adding buffer or adjusting your scale interpretation for complex work</li>
          <li><strong>Overestimated tasks</strong> indicate you might be too conservative - trust your skills more</li>
          `:"<li>Complete more tasks to see accuracy metrics</li>"}
        </ul>
      </div>
    </div>
  `}function po(){var a,n;if(!$){alert("Please generate a report first");return}let e=`# Report for ${$.period}

`;if(e+=`Generated on ${new Date().toLocaleDateString()}

`,$.options.includeExecutiveSummary&&(e+=`## Executive Summary

`,e+=`- **Total Hours**: ${$.summary.totalHours.toFixed(1)}h
`,e+=`- **Completed Tasks**: ${$.summary.completedTasks}
`,e+=`- **Abandoned Tasks**: ${$.summary.abandonedTasks}
`,e+=`- **Active Tasks**: ${$.summary.activeTasks}
`,e+=`- **Accomplishments**: ${$.summary.accomplishments}

`),$.options.includeTimesheet){e+=`## Time Summary

`,e+=`| Task | Status | Hours | Sessions |
`,e+=`|------|--------|-------|----------|
`;const i=Object.values($.timeByTask).sort((l,c)=>c.hours-l.hours);for(const l of i)e+=`| ${((a=l.task)==null?void 0:a.title)||"Unknown"} | ${((n=l.task)==null?void 0:n.status)||"N/A"} | ${l.hours.toFixed(1)}h | ${l.logs.length} |
`;e+=`
`}if($.options.includeTaskProgress&&$.tasksCompletedInPeriod.length>0){e+=`## Completed Tasks

`;for(const i of $.tasksCompletedInPeriod){const l=new Date(i.completedAt);e+=`- **${i.title}** - Completed: ${l.toLocaleDateString()}
`}e+=`
`}if($.options.includeAccomplishments&&$.accomplishments.length>0){e+=`## Accomplishments

`;for(const i of $.accomplishments)e+=`- **${i.title}**
`,i.content&&(e+=`  ${i.content}
`);e+=`
`}const t=new Blob([e],{type:"text/markdown"}),s=URL.createObjectURL(t),o=document.createElement("a");o.href=s,o.download=`report-${$.startDate}-to-${$.endDate}.md`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}let E,p,P,Ue=!1,Ye=0;const yo=5e3;async function vo(){if(console.log("🚀 Initializing Mission Control Spaceport..."),!document.getElementById("spaceportView")){console.error("SpacePort container not found");return}if(E=document.getElementById("spaceportCanvas"),!E){console.error("SpacePort canvas not found");return}if(Ue){console.log("🛸 Spaceport already initialized, restarting animation..."),Ge();return}p=E.getContext("2d"),_e(),window.addEventListener("resize",_e),wo(),ko(),Ge(),Ue=!0,console.log("🛸 Spaceport Mission Control Online!")}function _e(){const e=document.getElementById("spaceportView");E.width=e.clientWidth,E.height=e.clientHeight-40,P=E.height*.75,bo()}function bo(){const e=L();if(!(!e.rockets||e.rockets.size===0))for(const[t,s]of e.rockets){s.launchPad.y=P;const o=A(s.type||"scout");s.y=P-o/2-40}}function ko(){const e=L();if(e.isOperational&&e.rockets&&e.rockets.size>0){const t=Date.now();for(const[s,o]of e.rockets)if(o.isActive&&o.startTime){const a=t-o.startTime;o.totalTime+=a,o.startTime=t,console.log(`⏰ Restored rocket "${o.taskTitle}" - accrued ${(a/1e3/60).toFixed(2)} minutes while browser was closed. Total: ${(o.totalTime/1e3/60).toFixed(2)} minutes`)}q()}if(e.isOperational){const t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus");t&&(t.textContent="End Operations",t.className="punch-btn punch-out"),s&&(s.textContent="Mission Control Operational",s.className="punch-status-display operational");const o=document.querySelector(".mission-control");o&&(o.style.display="block"),vt();const a=document.getElementById("rocketsCount");if(a&&(a.textContent=e.rockets.size),e.activeRocket){const n=e.rockets.get(e.activeRocket);if(n){const i=document.getElementById("activeMissionName"),l=document.getElementById("activeRocketDisplay"),c=document.getElementById("energyStatus"),r=document.getElementById("launchControls");i&&(i.textContent=n.taskTitle),l&&(l.textContent=n.taskTitle.substring(0,20)),c&&(c.textContent="Charging"),r&&(r.className="launch-controls active"),console.log(`⚡ Restored active rocket: ${n.taskTitle}`)}}console.log(`🚀 Restored SpacePort session with ${e.rockets.size} rocket(s)`)}}function wo(){const e=document.getElementById("spaceportPunchBtn");e?e.addEventListener("click",To):console.warn("SpacePort punch button not found"),E&&E.addEventListener("click",Do);const t=document.getElementById("launchBtn");t?t.addEventListener("click",xo):console.warn("SpacePort launch button not found"),So()}async function To(){const e=L(),t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus"),o=document.querySelector(".mission-control");e.isOperational?await Io():(e.isOperational=!0,e.sessionStartTime=Date.now(),q(),t.textContent="End Operations",t.className="punch-btn punch-out",s.textContent="Mission Control Operational",s.className="punch-status-display operational",o&&(o.style.display="block"),await vt(),console.log("🚀 Spaceport Operations Initiated!"))}async function Io(){console.log("🛸 Ending Spaceport Operations...");const e=L();for(const[a,n]of e.rockets)n.totalTime>0&&await bt(n);e.isOperational=!1,e.activeRocket=null,e.rockets.clear(),e.launchPads=[],e.sessionStartTime=null,q();const t=document.getElementById("spaceportPunchBtn"),s=document.getElementById("spaceportStatus"),o=document.querySelector(".mission-control");t.textContent="Initiate Operations",t.className="punch-btn",s.textContent="Operations Complete",s.className="punch-status-display",o&&(o.style.display="none"),document.getElementById("launchControls").className="launch-controls",document.getElementById("missionList").innerHTML='<div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">Operations Ended</div>',console.log("✅ Mission Control Shutdown Complete!")}async function vt(){const e=await C({status:"InProgress"},!1);console.log(`🛸 Found ${e.length} available missions`);const t=document.getElementById("missionList");if(e.length===0){t.innerHTML='<div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">No In-Progress Tasks Available</div>';return}t.innerHTML=e.map(s=>`
    <div class="mission-item" data-task-id="${s.id}">
      🎯 ${s.title.substring(0,30)}${s.title.length>30?"...":""}
    </div>
  `).join(""),t.querySelectorAll(".mission-item").forEach(s=>{s.addEventListener("click",()=>{const o=s.dataset.taskId,a=e.find(n=>n.id.toString()===o);a&&Lo(a)})})}let K="random";function So(){const e=document.getElementById("spaceshipPickerToggle"),t=document.querySelector(".spaceship-picker"),s=document.getElementById("spaceshipOptions"),o=document.getElementById("spaceshipCurrent"),a=document.querySelectorAll(".spaceship-btn");e&&e.addEventListener("click",()=>{t.classList.contains("expanded")?(t.classList.remove("expanded"),s.style.display="none"):(t.classList.add("expanded"),s.style.display="flex")}),a.forEach(n=>{n.dataset.type===K&&n.classList.add("selected"),n.addEventListener("click",()=>{K=n.dataset.type,a.forEach(l=>l.classList.remove("selected")),n.classList.add("selected");const i=n.querySelector(".spaceship-name").textContent;o&&(o.textContent=i),t.classList.remove("expanded"),s.style.display="none",console.log(`🚀 Spaceship type selected: ${K}`),v(`Spaceship Type: ${i}`,"info")})}),console.log("🛸 Spaceship picker initialized")}function Eo(e){return K==="random"?Bo(e):K}function Lo(e){const t=L(),s=Array.from(t.rockets.values()).find(l=>l.taskId===e.id&&!l.category);if(s){console.log(`🚀 Rocket already deployed for task: ${e.title}`),de(s.id);return}const o=`rocket_${e.id}_${Date.now()}`,a=$o();t.launchPads.push(a),q();const n=Eo(e),i={id:o,taskId:e.id,taskTitle:e.title,category:null,totalTime:0,x:a.x,y:P-A(n)/2-40,launchPad:a,isActive:!1,isReadyForCategory:!0,deployTime:Date.now(),type:n};t.rockets.set(o,i),q(),T.emit("spaceport:rocketDeployed",{rocketId:o,taskId:e.id,taskTitle:e.title,rocketType:n}),t.activeRocket||de(o),document.getElementById("rocketsCount").textContent=t.rockets.size,console.log(`🚀 ${n.toUpperCase()} rocket deployed for mission: ${e.title} - Click to select category!`)}function Bo(e){const t=e.title.toLowerCase();return t.includes("dev")||t.includes("code")||t.includes("bug")||t.includes("fix")||t.includes("technical")||t.includes("api")?"v2":t.includes("project")||t.includes("launch")||t.includes("deploy")||t.includes("release")||t.includes("major")||t.includes("milestone")?"apollo":t.includes("fun")||t.includes("creative")||t.includes("experiment")||t.includes("prototype")||t.includes("test")||t.includes("play")||t.includes("brainstorm")||t.includes("sketch")||t.includes("demo")||t.includes("looney")||t.includes("tunes")||t.includes("cartoon")?"cartoon":"scout"}function $o(){const e=L(),t=E.width*.1,o=E.width*.65-70,a=t+150,n=o-40,i=n-a,l=e.launchPads.length,c=90,r=130;let m;return l===0?m=a+i*.4:m=Po(a,n,c,r),m=Math.max(a,Math.min(n,m)),{x:m,y:P,radius:35,isActive:!1}}function Po(e,t,s,o){const n=L().launchPads.map(r=>r.x),i=t-e,l=[],c=20;for(let r=0;r<c;r++){const m=e+i*r/(c-1);let g=0,u=!0;for(const d of n){const h=Math.abs(m-d);if(h<s){u=!1;break}h>=o?g+=100:g+=h/o*100}u&&l.push({x:m,score:g})}return l.length===0?e+Math.random()*i:(l.sort((r,m)=>m.score-r.score),l[0].x)}function Do(e){const t=L();if(!t.isOperational)return;const s=E.getBoundingClientRect(),o=e.clientX-s.left,a=e.clientY-s.top,n=E.width*.65,i=140,c=P-120;if(o>=n-i/2&&o<=n+i/2&&a>=c&&a<=P){Ao();return}for(const[r,m]of t.rockets){const g=m.launchPad,u=g.radius*.6,d=g.y-g.radius*.8*.3;if(Math.sqrt(Math.pow(o-g.x,2)+Math.pow(a-d,2))<=u){Mo(r),de(r);return}}Co(),Ho()}function de(e){const t=L(),s=t.rockets.get(e);if(s){if(t.activeRocket){const o=t.rockets.get(t.activeRocket);if(o&&(o.isActive=!1,o.launchPad.isActive=!1,o.startTime)){const a=Date.now()-o.startTime;o.totalTime+=a}}t.activeRocket=e,s.isActive=!0,s.launchPad.isActive=!0,s.startTime=Date.now(),q(),T.emit("spaceport:rocketLaunched",{rocketId:e,taskId:s.taskId,taskTitle:s.taskTitle,category:s.category}),document.getElementById("activeMissionName").textContent=s.taskTitle,document.getElementById("activeRocketDisplay").textContent=s.taskTitle.substring(0,20),document.getElementById("energyStatus").textContent="Charging",document.getElementById("launchControls").className="launch-controls active",console.log(`⚡ Activated rocket: ${s.taskTitle}`)}}function Mo(e){console.log(`🎛️ Showing control form for rocket: ${e}`)}function Co(){document.querySelectorAll(".rocket-control-form").forEach(t=>t.remove())}function Ao(){console.log("🏢 Mission Control Interface Activated")}function Ho(){const e=document.getElementById("missionControlOverlay");e&&e.remove()}async function xo(){const e=L();if(!e.activeRocket)return;const t=e.rockets.get(e.activeRocket);if(t){if(t.startTime){const s=Date.now()-t.startTime;t.totalTime+=s}if(await bt(t),console.log("🚀 Starting epic blastoff for:",t.taskTitle),t.isLaunching=!0,await Oo(t),console.log("🚀 Blastoff complete, removing rocket"),e.rockets.delete(e.activeRocket),e.launchPads=e.launchPads.filter(s=>s!==t.launchPad),e.activeRocket=null,q(),document.getElementById("launchControls").className="launch-controls",document.getElementById("rocketsCount").textContent=e.rockets.size,document.getElementById("activeRocketDisplay").textContent="None",document.getElementById("energyStatus").textContent=e.rockets.size>0?"Standby":"Offline",e.rockets.size>0){const s=e.rockets.keys().next().value;de(s)}}}async function Oo(e){console.log(`🚀 EPIC BLASTOFF START: ${e.taskTitle} - ${(e.totalTime/(1e3*60)).toFixed(1)} minutes`),console.log("🚀 Phase 1: Preparation"),e.launchPhase="preparation",e.launchStartTime=Date.now(),await ne(1e3),console.log("🚀 Phase 2: Ignition"),e.launchPhase="ignition";const t=L();t.screenShake={intensity:2,duration:2e3,startTime:Date.now()},await ne(500),console.log("🚀 Phase 3: Liftoff"),e.launchPhase="liftoff",e.liftoffStartTime=Date.now(),e.originalY=e.y,e.scale=1,t.screenShake={intensity:5,duration:3e3,startTime:Date.now()},e.launchPad.hasBlastCrater=!0,e.launchPad.craterStartTime=Date.now(),t.particles=t.particles||[],Wo(e),await ne(3e3),console.log("🚀 Phase 4: Launch completed"),e.launchPhase="completed",await ne(1e3);const s=L();s.screenShake=null}function Wo(e){const t=L();e.type==="apollo"?Ro(e,t):e.type==="cartoon"?jo(e,t):Fo(e,t)}function Ro(e,t){[{x:0,y:0},{x:-10,y:0},{x:10,y:0},{x:0,y:-10},{x:0,y:10}].forEach(o=>{const a=e.x+o.x,n=e.y+A(e.type)/2;for(let i=0;i<20;i++)t.particles.push({type:"apollo-exhaust",x:a+(Math.random()-.5)*8,y:n+Math.random()*10,vx:(Math.random()-.5)*6+o.x*.3,vy:Math.random()*12+8,life:1,decay:.015,size:Math.random()*10+8,color:`hsl(${Math.random()*40+10}, 100%, ${60+Math.random()*30}%)`,intensity:1})});for(let o=0;o<60;o++)t.particles.push({type:"apollo-smoke",x:e.x+(Math.random()-.5)*50,y:e.y+20+Math.random()*30,vx:(Math.random()-.5)*8,vy:-(Math.random()*5+2),life:1,decay:.006,size:Math.random()*15+12,color:`rgba(120, 120, 120, ${Math.random()*.7+.3})`,expansion:1.02});for(let o=0;o<40;o++)t.particles.push({type:"apollo-debris",x:e.x+(Math.random()-.5)*60,y:e.y+20,vx:(Math.random()-.5)*20,vy:-(Math.random()*15+5),life:1,decay:.012,size:Math.random()*5+2,color:`hsl(${Math.random()*40+20}, 60%, ${30+Math.random()*30}%)`,gravity:.3});for(let o=0;o<3;o++)setTimeout(()=>{t.particles.push({type:"apollo-shockwave",x:e.x,y:e.y+25,radius:10,maxRadius:150+o*50,life:1,decay:.008,color:`hsla(${30+o*10}, 80%, 60%, 0.6)`,wave:o})},o*200)}function Fo(e,t){for(let o=0;o<50;o++)t.particles.push({type:"flame",x:e.x+(Math.random()-.5)*10,y:e.y+20,vx:(Math.random()-.5)*4,vy:Math.random()*8+5,life:1,decay:.02,size:Math.random()*6+4,color:`hsl(${Math.random()*60+10}, 100%, ${50+Math.random()*30}%)`}),o<20&&t.particles.push({type:"debris",x:e.x+(Math.random()-.5)*30,y:e.y+10,vx:(Math.random()-.5)*12,vy:-(Math.random()*6+2),life:1,decay:.015,size:Math.random()*3+1,color:"#888"}),o<30&&t.particles.push({type:"smoke",x:e.x+(Math.random()-.5)*20,y:e.y+15,vx:(Math.random()-.5)*3,vy:-(Math.random()*3+1),life:1,decay:.008,size:Math.random()*8+6,color:`rgba(100, 100, 100, ${Math.random()*.5+.2})`});t.particles.push({type:"shockwave",x:e.x,y:e.y+10,radius:0,maxRadius:100,life:1,decay:.03,color:"rgba(255, 255, 100, 0.6)"})}function jo(e,t){for(let s=0;s<30;s++)t.particles.push({type:"cartoon-puff",x:e.x+(Math.random()-.5)*40,y:e.y+(Math.random()-.5)*20,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:1,decay:.015,size:Math.random()*10+5,color:`hsl(${Math.random()*360}, 90%, 70%)`});for(let s=0;s<20;s++)t.particles.push({type:"cartoon-star",x:e.x+(Math.random()-.5)*30,y:e.y+(Math.random()-.5)*15,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,life:1,decay:.012,size:Math.random()*6+3,color:`hsl(${Math.random()*360}, 100%, 60%)`});t.particles.push({type:"cartoon-boing",x:e.x,y:e.y+15,radius:5,maxRadius:80,life:1,decay:.04,color:"hsl(60, 100%, 50%)",bouncy:!0})}function ne(e){return new Promise(t=>setTimeout(t,e))}function Ge(){function e(){qo(),Vo(),requestAnimationFrame(e)}e()}function qo(){const e=L();if(!e.isOperational)return;const t=Date.now();if(t-Ye>yo&&(q(),Ye=t),e.sessionStartTime){const s=Date.now()-e.sessionStartTime,o=Math.floor(s/(1e3*60*60)),a=Math.floor(s%(1e3*60*60)/(1e3*60)),n=Math.floor(s%(1e3*60)/1e3);document.getElementById("missionTimeDisplay").textContent=`${o.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}for(const[s,o]of e.rockets)if(o.launchPhase==="liftoff"&&o.liftoffStartTime){const a=Date.now()-o.liftoffStartTime;o.type==="cartoon"?No(o,a,e):zo(o,a,e)}e.particles&&(e.particles=e.particles.filter(s=>(s.x+=s.vx,s.y+=s.vy,s.life-=s.decay,(s.type==="debris"||s.type==="flame")&&(s.vy+=.2),s.type==="shockwave"&&(s.radius+=(s.maxRadius-s.radius)*.1),s.life>0))),e.screenShake&&Date.now()-e.screenShake.startTime>e.screenShake.duration&&(e.screenShake=null)}function No(e,t,s){const o=Math.min(t/6e3,1);if(!e.balloonPhysics){e.balloonPhysics={vx:(Math.random()-.5)*100,vy:-Math.random()*200-100,thrust:1,escapeAngle:Math.random()*Math.PI*2,spin:(Math.random()-.5)*20,spiralPhase:0,loopPhase:0,lastMajorChange:0,airBursts:[],momentum:1};for(let d=0;d<3;d++)e.balloonPhysics.airBursts.push({angle:Math.random()*Math.PI*2,strength:Math.random()*.8+.2,frequency:Math.random()*5+2})}const a=e.balloonPhysics,n=t*.001;if(a.thrust=Math.max(.05,1.2-o*.8),a.momentum=Math.max(.1,1-o*.6),t-a.lastMajorChange>300+Math.random()*800){const d=a.thrust*(200+Math.random()*300),h=Math.random()*Math.PI*2;a.vx+=Math.cos(h)*d,a.vy+=Math.sin(h)*d,a.escapeAngle+=(Math.random()-.5)*Math.PI,a.spin+=(Math.random()-.5)*30,a.lastMajorChange=t}let i=0,l=0;a.airBursts.forEach((d,h)=>{const f=n*d.frequency,y=Math.sin(f)*d.strength*a.thrust*80;i+=Math.cos(d.angle)*y,l+=Math.sin(d.angle)*y,Math.random()<.01&&(d.angle+=(Math.random()-.5)*.5)}),a.vx+=i,a.vy+=l,a.spiralPhase+=n*3,a.loopPhase+=n*2;const c=Math.sin(a.spiralPhase)*a.thrust*50;a.vx+=Math.cos(n*4)*c,a.vy+=Math.sin(n*4)*c;const r=Math.cos(a.loopPhase)*a.thrust*40;a.vx+=Math.sin(n*6)*r,a.vy+=Math.cos(n*6)*r,a.vy+=30*(1-a.thrust),a.vx+=(Math.random()-.5)*a.thrust*60,a.vy+=(Math.random()-.5)*a.thrust*60,a.vx*=.98,a.vy*=.98,e.x+=a.vx*.016*a.momentum,e.y+=a.vy*.016*a.momentum;const m=E.width,g=E.height,u=30;(e.x<u||e.x>m-u)&&(a.vx*=-.9,a.vy*=.95,a.spin+=(Math.random()-.5)*20,a.vx+=(Math.random()-.5)*100,a.vy+=(Math.random()-.5)*100),(e.y<u||e.y>g-u)&&(a.vy*=-.9,a.vx*=.95,a.spin+=(Math.random()-.5)*20,a.vx+=(Math.random()-.5)*150,a.vy+=(Math.random()-.5)*150),a.spin+=a.thrust*8,e.tilt=a.spin+Math.sin(n*10)*20,e.scale=1+Math.sin(n*12)*.15+a.thrust*.1,Math.random()<a.thrust*1.5&&(s.particles=s.particles||[],a.airBursts.forEach((d,h)=>{Math.random()<.3&&s.particles.push({type:Math.random()<.4?"cartoon-star":"cartoon-puff",x:e.x+Math.cos(d.angle)*20,y:e.y+Math.sin(d.angle)*20,vx:-Math.cos(d.angle)*50+(Math.random()-.5)*30,vy:-Math.sin(d.angle)*50+(Math.random()-.5)*30,life:1,decay:.02,size:Math.random()*8+4,color:`hsl(${(h*120+n*100)%360}, 90%, 70%)`})}))}function zo(e,t,s){const o=Math.min(t/3e3,1);if(o<=.2){const a=o/.2,n=1-Math.pow(1-a,3);e.y=e.originalY-n*50,e.scale=1,e.thrust=1,e.tilt=Math.sin(t*.01)*2}else if(o<=.6){const a=(o-.2)/.4,n=Math.pow(a,2);e.y=e.originalY-50-n*300,e.scale=1-a*.2,e.thrust=.8,e.tilt=0,Math.random()<.6&&(s.particles=s.particles||[],s.particles.push({type:"velocity-trail",x:e.x+(Math.random()-.5)*8,y:e.y+A(e.type)/2,vx:(Math.random()-.5)*3,vy:Math.random()*8+5,life:1,decay:.03,size:Math.random()*6+4,color:`hsl(${Math.random()*60+15}, 100%, ${70+Math.random()*20}%)`}))}else{const a=(o-.6)/.4,n=1-Math.pow(1-a,4);e.y=e.originalY-350-n*(E.height*.8);const i=1-a*.85;e.scale=Math.max(.15,i),e.thrust=.6-a*.4,e.atmospheric=a,Math.random()<.2&&(s.particles=s.particles||[],s.particles.push({type:"high-altitude-trail",x:e.x+(Math.random()-.5)*4,y:e.y+A(e.type)/2,vx:(Math.random()-.5)*1,vy:Math.random()*3+2,life:1,decay:.02,size:Math.random()*3+2,color:`hsla(${Math.random()*40+10}, 80%, 60%, 0.7)`}))}if(Math.random()<.4){s.particles=s.particles||[];const a=e.thrust||.5;s.particles.push({type:"exhaust-trail",x:e.x+(Math.random()-.5)*6,y:e.y+A(e.type)/2+10,vx:(Math.random()-.5)*4,vy:Math.random()*6+3,life:1,decay:.025,size:Math.random()*5+3,color:`hsl(${Math.random()*50+10}, 90%, ${50+a*30}%)`,intensity:a})}}function Vo(){if(!E||!p)return;const e=L();if(p.save(),e.screenShake){const s=(Date.now()-e.screenShake.startTime)/e.screenShake.duration,o=e.screenShake.intensity*(1-s),a=(Math.random()-.5)*o,n=(Math.random()-.5)*o;p.translate(a,n)}p.fillStyle="transparent",p.clearRect(0,0,E.width,E.height),Uo(),Yo(),_o(),Ko(),Xo(),Jo(),ta(),p.restore()}function Uo(){if(!(!E||!p)){p.fillStyle="rgba(255, 255, 255, 0.8)";for(let e=0;e<50;e++){const t=Math.random()*E.width,s=Math.random()*(P-100),o=Math.random()*2;p.beginPath(),p.arc(t,s,o,0,Math.PI*2),p.fill()}}}function Yo(){p.strokeStyle="#4a6741",p.lineWidth=3,p.beginPath(),p.moveTo(0,P),p.lineTo(E.width,P),p.stroke();const e=p.createLinearGradient(0,P,0,E.height);e.addColorStop(0,"rgba(100, 150, 255, 0.1)"),e.addColorStop(1,"rgba(50, 100, 150, 0.3)"),p.fillStyle=e,p.fillRect(0,P,E.width,E.height-P)}function _o(){const e=L(),t=E.width*.1,s=P,a=s-240,n=Date.now()*.001,i=e.activeRocket?.7+Math.sin(n*3)*.3:.2+Math.sin(n*.5)*.1,l=n*.7%(Math.PI*2),c=e.activeRocket?180+Math.sin(l)*60:200+Math.sin(l*.3)*20,r=`hsl(${c}, 80%, ${60+i*20}%)`;p.strokeStyle=r,p.lineWidth=3;const m=25;p.beginPath(),p.moveTo(t-m,s),p.lineTo(t-8,a+60),p.lineTo(t-8,a+20),p.moveTo(t+m,s),p.lineTo(t+8,a+60),p.lineTo(t+8,a+20),p.stroke(),p.lineWidth=4,p.beginPath(),p.moveTo(t,s),p.lineTo(t,a+20),p.stroke();const g=35,u=a-10,d=`hsl(${c}, 90%, 70%)`;for(let f=0;f<4;f++){const y=g-f*6,k=i*(1-f*.2),b=Math.max(.1,k);p.strokeStyle=`hsla(${c}, 80%, 70%, ${b})`,p.lineWidth=3-f*.5,p.beginPath(),p.arc(t,u,y,0,Math.PI*2),p.stroke()}const h=12+Math.sin(n*4)*4;p.shadowColor=d,p.shadowBlur=20+i*20,p.fillStyle=d,p.beginPath(),p.arc(t,u,h,0,Math.PI*2),p.fill(),p.shadowBlur=0,e.activeRocket&&i>.6&&Go(t,u,g+10,c,i),e.activeRocket&&Math.random()<.0011&&Qo(t,u,c)}function Go(e,t,s,o,a){const n=3+Math.floor(Math.random()*3);for(let i=0;i<n;i++){const l=Math.PI*2*i/n+Math.random()*.5,c=s+Math.random()*15;p.strokeStyle=`hsla(${o+Math.random()*40-20}, 90%, 80%, ${a})`,p.lineWidth=1+Math.random()*2,p.shadowColor=p.strokeStyle,p.shadowBlur=8,p.beginPath(),p.moveTo(e,t);const r=4+Math.floor(Math.random()*3);for(let m=1;m<=r;m++){const g=e+Math.cos(l)*(c*m/r)+(Math.random()-.5)*10,u=t+Math.sin(l)*(c*m/r)+(Math.random()-.5)*10;p.lineTo(g,u)}p.stroke(),p.shadowBlur=0}}function Qo(e,t,s){const o=L();if(!o.activeRocket)return;const a=o.rockets.get(o.activeRocket);if(!a)return;const n={startX:e,startY:t,endX:a.x,endY:a.y,hue:s,intensity:1,duration:15,createdAt:Date.now()};o.zapEffects||(o.zapEffects=[]),o.zapEffects.push(n),console.log(`⚡ ZAP! Tesla tower energizes rocket: ${a.taskTitle}`)}function Xo(){const e=L();if(!e.zapEffects)return;const t=Date.now();e.zapEffects=e.zapEffects.filter(s=>{const o=t-s.createdAt,a=s.duration*(1e3/60);if(o>a)return!1;const i=1-o/a;p.shadowColor=`hsl(${s.hue}, 90%, 80%)`,p.shadowBlur=15*i,p.strokeStyle=`hsla(${s.hue}, 90%, 85%, ${i})`,p.lineWidth=3*i,p.beginPath(),p.moveTo(s.startX,s.startY);const l=8,c=(s.endX-s.startX)/l,r=(s.endY-s.startY)/l;for(let m=1;m<=l;m++){const g=s.startX+c*m,u=s.startY+r*m,d=(Math.random()-.5)*30*i,h=(Math.random()-.5)*30*i;p.lineTo(g+d,u+h)}return p.lineTo(s.endX,s.endY),p.stroke(),p.shadowBlur=0,!0})}function Ko(){const e=L(),t=E.width*.65,s=P,o=120,a=140,n=s-o;p.strokeStyle="#64d6ff",p.lineWidth=3,p.fillStyle="rgba(0, 20, 40, 0.8)",p.fillRect(t-a/2,n,a,o),p.strokeRect(t-a/2,n,a,o),p.fillStyle="rgba(100, 214, 255, 0.2)",p.fillRect(t-15,s-30,30,30),p.strokeRect(t-15,s-30,30,30);for(let r=0;r<4;r++){const m=n+20+r*25;for(let g=0;g<5;g++){const u=t-50+g*25;p.fillStyle=e.isOperational?"rgba(100, 214, 255, 0.6)":"rgba(100, 214, 255, 0.2)",p.fillRect(u,m,12,15),p.strokeStyle="#64d6ff",p.lineWidth=1,p.strokeRect(u,m,12,15)}}const i=25;p.fillStyle="rgba(0, 30, 60, 0.9)",p.fillRect(t-20,n-i,40,i),p.strokeRect(t-20,n-i,40,i),p.strokeStyle="#64d6ff",p.lineWidth=2,p.beginPath(),p.moveTo(t,n-i),p.lineTo(t,n-i-20),p.stroke();const l=8,c=e.isOperational?Date.now()*.001%(Math.PI*2):0;p.save(),p.translate(t,n-i-15),p.rotate(c),p.beginPath(),p.arc(0,0,l,0,Math.PI),p.stroke(),p.restore(),e.isOperational&&(p.fillStyle="#64d6ff",p.font="bold 12px Arial",p.textAlign="center",p.fillText("MISSION CONTROL",t,s+15))}function Jo(){const e=L();for(const[t,s]of e.rockets)Zo(s.launchPad),(!s.launchPhase||s.launchPhase!=="completed")&&ea(s)}function Zo(e){const t=p,s=e.x,o=e.y,a=e.radius,n=a*3,i=a*2,l=a*.8;t.fillStyle=e.isActive?"rgba(80, 180, 80, 0.9)":"rgba(100, 100, 100, 0.9)",t.strokeStyle=e.isActive?"#50b450":"#666",t.lineWidth=2,t.beginPath(),t.moveTo(s-n/2,o),t.lineTo(s-i/2,o-l),t.lineTo(s+i/2,o-l),t.lineTo(s+n/2,o),t.closePath(),t.fill(),t.stroke();const c=a*2.4,r=a*1.6,m=l*.6;t.fillStyle=e.isActive?"rgba(100, 200, 100, 0.9)":"rgba(120, 120, 120, 0.9)",t.strokeStyle=e.isActive?"#64c864":"#777",t.beginPath(),t.moveTo(s-c/2,o-l*.4),t.lineTo(s-r/2,o-l*.4-m),t.lineTo(s+r/2,o-l*.4-m),t.lineTo(s+c/2,o-l*.4),t.closePath(),t.fill(),t.stroke();const g=a*1.6,u=l*.3;if(t.fillStyle=e.isActive?"rgba(120, 255, 120, 0.9)":"rgba(140, 140, 140, 0.9)",t.strokeStyle=e.isActive?"#78ff78":"#888",t.lineWidth=3,t.beginPath(),t.moveTo(s-g/2,o-l),t.lineTo(s-g/3,o-l-u),t.lineTo(s+g/3,o-l-u),t.lineTo(s+g/2,o-l),t.closePath(),t.fill(),t.stroke(),e.isActive){const f=a+Math.sin(Date.now()*.005)*5;t.strokeStyle="rgba(100, 255, 100, 0.6)",t.lineWidth=2,t.beginPath(),t.arc(s,o,f,0,Math.PI*2),t.stroke()}const d=a*.6,h=o-l*.3;if(t.fillStyle=e.isActive?"rgba(0, 150, 0, 0.7)":"rgba(80, 80, 80, 0.7)",t.strokeStyle=e.isActive?"#00aa00":"#555",t.lineWidth=2,t.beginPath(),t.arc(s,h,d,0,Math.PI*2),t.fill(),t.stroke(),t.fillStyle=e.isActive?"rgba(100, 255, 100, 0.4)":"rgba(150, 150, 150, 0.4)",t.beginPath(),t.arc(s-d*.3,h-d*.3,d*.5,0,Math.PI*2),t.fill(),e.hasBlastCrater&&e.craterStartTime){const f=Date.now()-e.craterStartTime,y=Math.min(f/3e3,1),k=a*.8*y;t.fillStyle=`rgba(60, 30, 20, ${.8*y})`,t.beginPath(),t.arc(s,o-l*.2,k,0,Math.PI*2),t.fill(),f>3e4&&(e.hasBlastCrater=!1,e.craterStartTime=null)}}function ea(e){const t=p,s=e.x,o=e.y;t.save(),e.tilt!==void 0&&(t.translate(s,o),t.rotate(e.tilt*Math.PI/180),t.translate(-s,-o)),e.scale!==void 0&&(t.translate(s,o),t.scale(e.scale,e.scale),t.translate(-s,-o)),e.atmospheric!==void 0&&(t.globalAlpha=1-e.atmospheric*.6);let a="#888",n=null;if(e.launchPhase==="preparation"){a="#ffff64",n="#ffff64";const g=Math.sin(Date.now()*.05)*2;t.translate(g,0)}else if(e.launchPhase==="ignition")a="#ff6464",n="#ff6464",t.shadowBlur=25;else if(e.launchPhase==="liftoff"){const g=e.thrust||.5;a=`hsl(${60-g*60}, 100%, ${70+g*20}%)`,n=a,t.shadowBlur=20+g*20;const u=Math.sin(Date.now()*.02)*g*2;t.translate(u,0)}else e.category?e.isActive?(a="#64ff64",n="#64ff64"):a="#64d6ff":(a="#ffaa00",n="#ffaa00");switch(n&&(t.shadowColor=n,t.shadowBlur=t.shadowBlur||15),e.type){case"v2":oa(t,s,o,a);break;case"apollo":aa(t,s,o,a),na(t,e,s,o);break;case"cartoon":ia(t,s,o,a);break;case"xwing":la(t,s,o,a);break;case"tie":ra(t,s,o);break;case"scout":default:sa(t,s,o,a);break}if(e.isActive){const g=o+A(e.type)/2+15;t.fillStyle="rgba(255, 100, 100, 0.8)",t.beginPath(),t.ellipse(s,g,8,12,0,0,Math.PI*2),t.fill()}if(!e.category){const u=A(e.type)/2+Math.sin(Date.now()*.008)*12;t.beginPath(),t.arc(s,o,u,0,Math.PI*2),t.strokeStyle="#ffaa0040",t.lineWidth=3,t.stroke()}if(t.shadowBlur=0,e.category){if(e.category){t.fillStyle="#64d6ff",t.font="12px Arial",t.textAlign="center";const g=e.category.split(".").pop()||"Work",u=o-A(e.type)/2-5;t.fillText(g.substring(0,8),s,u)}}else{t.fillStyle="#ffaa00",t.font="bold 20px Arial",t.textAlign="center";const g=o-A(e.type)/2-10;t.fillText("?",s+20,g)}let i=e.totalTime;e.isActive&&e.startTime&&(i+=Date.now()-e.startTime);const l=Math.floor(i/(1e3*60)),c=`${Math.floor(l/60)}:${(l%60).toString().padStart(2,"0")}`,r=t.measureText(c).width+8,m=o+A(e.type)/2+35;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(s-r/2,m-5,r,16),t.fillStyle=e.isActive?"#64ff64":a,t.font="12px Courier New",t.textAlign="center",t.fillText(c,s,m+8),t.restore()}function ta(){const e=L();if(!e.particles)return;const t=p;e.particles.forEach(s=>{switch(t.save(),s.type){case"flame":t.globalAlpha=s.life,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"trail":t.globalAlpha=s.life*.8,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*2,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"velocity-trail":t.globalAlpha=s.life*.9,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*1.5,t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size*2);break;case"high-altitude-trail":t.globalAlpha=s.life*.5,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*.8,t.beginPath(),t.arc(s.x,s.y,s.size*.8,0,Math.PI*2),t.fill();break;case"exhaust-trail":const o=s.intensity||.5;t.globalAlpha=s.life*(.6+o*.4),t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*(1+o),t.beginPath(),t.arc(s.x,s.y,s.size*(.8+o*.4),0,Math.PI*2),t.fill();break;case"debris":t.globalAlpha=s.life,t.fillStyle=s.color,t.fillRect(s.x,s.y,s.size,s.size);break;case"smoke":t.globalAlpha=s.life*.3,t.fillStyle=s.color,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"shockwave":t.globalAlpha=s.life*.5,t.strokeStyle=s.color,t.lineWidth=3,t.setLineDash([5,5]),t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.PI*2),t.stroke(),t.setLineDash([]);break;case"apollo-exhaust":const a=s.intensity||1;t.globalAlpha=s.life*a,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size*2,t.beginPath(),t.arc(s.x,s.y,s.size*a,0,Math.PI*2),t.fill(),t.globalAlpha=s.life*a*.8,t.fillStyle="#ffffff",t.beginPath(),t.arc(s.x,s.y,s.size*.3,0,Math.PI*2),t.fill();break;case"apollo-smoke":s.expansion&&(s.size*=s.expansion),t.globalAlpha=s.life*.4,t.fillStyle=s.color,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill();break;case"apollo-debris":s.gravity&&(s.vy+=s.gravity),t.globalAlpha=s.life,t.fillStyle=s.color,t.fillRect(s.x-s.size/2,s.y-s.size/2,s.size,s.size);break;case"apollo-shockwave":s.radius=Math.min(s.radius+4,s.maxRadius),t.globalAlpha=s.life*.6,t.strokeStyle=s.color,t.lineWidth=4-(s.wave||0),t.setLineDash([8,4]),t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.PI*2),t.stroke(),t.setLineDash([]);break;case"cartoon-puff":t.globalAlpha=s.life*.8,t.fillStyle=s.color,t.shadowColor=s.color,t.shadowBlur=s.size,t.beginPath(),t.arc(s.x,s.y,s.size,0,Math.PI*2),t.fill(),t.globalAlpha=s.life*.6,t.strokeStyle="#000",t.lineWidth=2,t.stroke();break;case"cartoon-star":t.globalAlpha=s.life,t.fillStyle=s.color,t.save(),t.translate(s.x,s.y),t.rotate(Date.now()*.01),t.beginPath();for(let i=0;i<5;i++){const l=i*Math.PI*2/5,c=Math.cos(l)*s.size,r=Math.sin(l)*s.size;i===0?t.moveTo(c,r):t.lineTo(c,r);const m=l+Math.PI/5,g=Math.cos(m)*(s.size*.4),u=Math.sin(m)*(s.size*.4);t.lineTo(g,u)}t.closePath(),t.fill(),t.strokeStyle="#000",t.lineWidth=1,t.stroke(),t.restore();break;case"cartoon-boing":s.radius+=3,s.radius>s.maxRadius&&(s.radius=s.maxRadius),t.globalAlpha=s.life*.8,t.strokeStyle=s.color,t.lineWidth=5,t.setLineDash([]),t.beginPath();const n=16;for(let i=0;i<=n;i++){const l=i/n*Math.PI*2,c=Math.sin(i*2)*5,r=s.radius+c,m=s.x+Math.cos(l)*r,g=s.y+Math.sin(l)*r;i===0?t.moveTo(m,g):t.lineTo(m,g)}t.closePath(),t.stroke();break}t.restore()})}function A(e){switch(e){case"v2":return 120;case"apollo":return 150;case"cartoon":return 70;case"scout":return 80;case"xwing":return 100;case"tie":return 90;default:return 80}}function sa(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-18/2,s-40+15,18,50),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,s-40-5),e.lineTo(t-18/2,s-40+15),e.lineTo(t+18/2,s-40+15),e.closePath(),e.fill(),e.stroke();const l=s+40-15,c=12;e.beginPath(),e.moveTo(t-18/2,l),e.lineTo(t-18/2-c,l+c),e.lineTo(t-18/2,l+c),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+18/2,l),e.lineTo(t+18/2+c,l+c),e.lineTo(t+18/2,l+c),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t-4,l),e.lineTo(t,l+c),e.lineTo(t+4,l),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t-4,l+c),e.lineTo(t,l),e.lineTo(t+4,l+c),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.rect(t-6,s+40-15,12,15),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(t-18/2+2,s),e.lineTo(t+18/2-2,s),e.stroke()}function oa(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-24/2,s-60+20,24,80),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,s-60-5),e.lineTo(t-24/2,s-60+20),e.lineTo(t+24/2,s-60+20),e.closePath(),e.fill(),e.stroke();const l=s+60-20,c=25,r=15;e.beginPath(),e.moveTo(t-24/2,l),e.lineTo(t-24/2-r,l+c),e.lineTo(t-24/2,l+c),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+24/2,l),e.lineTo(t+24/2+r,l+c),e.lineTo(t+24/2,l+c),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t,l),e.lineTo(t-6,l+c),e.lineTo(t+6,l+c),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.rect(t-8,s+60-20,16,20),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=1,e.beginPath(),e.moveTo(t-24/2+2,s-10),e.lineTo(t+24/2-2,s-10),e.stroke(),e.beginPath(),e.moveTo(t-24/2+2,s+10),e.lineTo(t+24/2-2,s+10),e.stroke()}function aa(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=2;const i=32,l=45;e.beginPath(),e.rect(t-i/2,s+75-l,i,l),e.fill(),e.stroke(),e.strokeStyle="#555",e.lineWidth=1;for(let b=1;b<4;b++){const w=s+75-l*b/4;e.beginPath(),e.moveTo(t-i/2,w),e.lineTo(t+i/2,w),e.stroke()}const c=26,r=45;e.strokeStyle="#333",e.lineWidth=2,e.beginPath(),e.rect(t-c/2,s+75-l-r,c,r),e.fill(),e.stroke();const m=22,g=35;e.beginPath(),e.rect(t-m/2,s+75-l-r-g,m,g),e.fill(),e.stroke();const u=18,d=25;e.beginPath(),e.rect(t-u/2,s-75,u,d),e.fill(),e.stroke(),e.strokeStyle="#666",e.lineWidth=3,e.beginPath(),e.moveTo(t,s-75),e.lineTo(t,s-75-20),e.stroke(),e.fillStyle="#ff4444",e.beginPath(),e.moveTo(t,s-75-25),e.lineTo(t-4,s-75-15),e.lineTo(t+4,s-75-15),e.closePath(),e.fill(),e.stroke(),e.fillStyle=o,e.fillStyle="#222";const h=s+75,f=5;e.beginPath(),e.arc(t,h,f,0,Math.PI*2),e.fill(),e.strokeStyle="#444",e.stroke(),[{x:-10,y:0},{x:10,y:0},{x:0,y:-10},{x:0,y:10}].forEach(b=>{e.fillStyle="#222",e.beginPath(),e.arc(t+b.x,h+b.y,f-1,0,Math.PI*2),e.fill(),e.strokeStyle="#444",e.stroke()}),e.strokeStyle="#555",e.lineWidth=2,e.beginPath(),e.moveTo(t-i/2,s+75-l),e.lineTo(t+i/2,s+75-l),e.stroke(),e.beginPath(),e.moveTo(t-c/2,s+75-l-r),e.lineTo(t+c/2,s+75-l-r),e.stroke(),e.fillStyle="#000";const k=3;for(let b=0;b<3;b++){const w=s+75-l-r-b*8;e.fillRect(t-m/2,w,m,k)}}function na(e,t,s,o){if(t.launchPhase==="liftoff"||t.launchPhase==="completed")return;const a=s+60,n=180,i=o-90,l=o+90;let c=0;if(t.launchPhase==="ignition"){const u=(Date.now()-t.launchStartTime-1e3)/500;u>0&&(c=Math.min(u,1)*40)}const r=a+c;e.save(),e.strokeStyle="#666",e.fillStyle="#555",e.lineWidth=3,e.beginPath(),e.moveTo(r,l),e.lineTo(r,i),e.stroke(),[.2,.4,.6,.8].forEach(u=>{const d=l-n*u;e.beginPath(),e.moveTo(r-15,d),e.lineTo(r+8,d),e.stroke(),e.beginPath(),e.moveTo(r,d),e.lineTo(r-8,d+10),e.stroke()});const g=o-20;t.launchPhase!=="ignition"&&(e.strokeStyle="#777",e.lineWidth=4,e.beginPath(),e.moveTo(r,g),e.lineTo(s+16,g),e.stroke(),e.strokeStyle="#888",e.lineWidth=2,e.beginPath(),e.moveTo(s+16,g),e.lineTo(s+16,g+5),e.stroke()),e.fillStyle="#444",e.fillRect(r-8,l,16,8),e.strokeStyle="#777",e.lineWidth=1;for(let u=0;u<20;u++){const d=l-u*8;d>i&&(e.beginPath(),e.moveTo(r-3,d),e.lineTo(r+3,d),e.stroke())}e.restore()}function ia(e,t,s,o){e.fillStyle=o,e.strokeStyle="#333",e.lineWidth=3,e.beginPath(),e.ellipse(t,s,45/2,30,0,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.moveTo(t,s-35-8),e.lineTo(t-4,s-35+5),e.lineTo(t+4,s-35+5),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#ffff00",e.beginPath(),e.arc(t,s-35-12,3,0,Math.PI*2),e.fill(),e.fillStyle="#222",e.fillRect(t-45/2,s-3,45,6),e.fillStyle=o,e.strokeStyle="#333",e.beginPath(),e.moveTo(t-45/2,s+35-15),e.lineTo(t-45/2-8,s+35),e.lineTo(t-45/2+2,s+35),e.closePath(),e.fill(),e.stroke(),e.beginPath(),e.moveTo(t+45/2,s+35-15),e.lineTo(t+45/2+8,s+35),e.lineTo(t+45/2-2,s+35),e.closePath(),e.fill(),e.stroke(),e.fillStyle="#444",e.beginPath(),e.arc(t,s+35,8,0,Math.PI*2),e.fill(),e.strokeStyle="#666",e.stroke(),e.fillStyle="#555",[{x:-45/3,y:-10},{x:45/3,y:-10},{x:-45/3,y:0},{x:45/3,y:0},{x:-45/3,y:10},{x:45/3,y:10}].forEach(c=>{e.beginPath(),e.arc(t+c.x,s+c.y,2,0,Math.PI*2),e.fill()}),e.fillStyle="rgba(255, 255, 255, 0.3)",e.beginPath(),e.ellipse(t-45/4,s-35/2,45/6,35/3,0,0,Math.PI*2),e.fill()}function la(e,t,s,o){e.strokeStyle="#333",e.lineWidth=2,e.fillStyle=o,e.fillRect(t-10/2,s-70/2,10,70),e.strokeRect(t-10/2,s-70/2,10,70),e.fillStyle=o,e.beginPath(),e.moveTo(t,s-70/2-25),e.lineTo(t-10/2,s-70/2),e.lineTo(t+10/2,s-70/2),e.closePath(),e.fill(),e.stroke(),e.fillStyle="rgba(79, 195, 247, 0.7)",e.fillRect(t-10/2+1,s-70/2+10,8,12),e.strokeRect(t-10/2+1,s-70/2+10,8,12),e.fillStyle="#4fc3f7",e.beginPath(),e.arc(t,s-70/2+28,4,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle=o,e.lineWidth=1.5;const m=s+15;e.save(),e.translate(t,m),e.rotate(-Math.PI/6),e.fillRect(-6/2-15,-30,6,30),e.strokeRect(-6/2-15,-30,6,30),e.fillStyle="#555",e.fillRect(-6/2-15-1,-38,8,8),e.strokeRect(-6/2-15-1,-38,8,8),e.fillStyle="#ff6b6b",e.fillRect(-6/2-15,-37,6,4),e.fillStyle="#ff4444",e.fillRect(-6/2-15+6/2-1,-30,2,-4),e.restore(),e.save(),e.translate(t,m),e.rotate(Math.PI/6),e.fillStyle=o,e.fillRect(15-6/2,-30,6,30),e.strokeRect(15-6/2,-30,6,30),e.fillStyle="#555",e.fillRect(15-6/2-1,-38,8,8),e.strokeRect(15-6/2-1,-38,8,8),e.fillStyle="#ff6b6b",e.fillRect(15-6/2,-37,6,4),e.fillStyle="#ff4444",e.fillRect(15-6/2+6/2-1,-30,2,-4),e.restore(),e.save(),e.translate(t,m),e.rotate(-Math.PI/6),e.fillStyle=o,e.fillRect(-6/2-15,0,6,30),e.strokeRect(-6/2-15,0,6,30),e.fillStyle="#555",e.fillRect(-6/2-15-1,30,8,8),e.strokeRect(-6/2-15-1,30,8,8),e.fillStyle="#ff6b6b",e.fillRect(-6/2-15,31,6,4),e.fillStyle="#ff4444",e.fillRect(-6/2-15+6/2-1,30,2,4),e.restore(),e.save(),e.translate(t,m),e.rotate(Math.PI/6),e.fillStyle=o,e.fillRect(15-6/2,0,6,30),e.strokeRect(15-6/2,0,6,30),e.fillStyle="#555",e.fillRect(15-6/2-1,30,8,8),e.strokeRect(15-6/2-1,30,8,8),e.fillStyle="#ff6b6b",e.fillRect(15-6/2,31,6,4),e.fillStyle="#ff4444",e.fillRect(15-6/2+6/2-1,30,2,4),e.restore(),e.fillStyle="#ff8844",e.fillRect(t-3,s+70/2-2,2,4),e.fillRect(t+1,s+70/2-2,2,4),e.strokeStyle="#555",e.lineWidth=.5;for(let g=-20;g<30;g+=8)e.beginPath(),e.moveTo(t-10/2,s+g),e.lineTo(t+10/2,s+g),e.stroke()}function ra(e,t,s,o){e.fillStyle="#222",e.strokeStyle="#333",e.lineWidth=2;const n=12;e.beginPath(),e.arc(t,s,n,0,Math.PI*2),e.fill(),e.stroke(),e.fillStyle="#4fc3f7",e.beginPath(),e.arc(t,s,n-3,0,Math.PI*2),e.fill(),e.strokeStyle="#333",e.lineWidth=1,e.beginPath(),e.moveTo(t,s-n+3),e.lineTo(t,s+n-3),e.moveTo(t-n+3,s),e.lineTo(t+n-3,s),e.stroke(),e.strokeStyle="#444",e.lineWidth=3,e.beginPath(),e.moveTo(t-n,s),e.lineTo(t-35-10,s),e.stroke(),e.beginPath(),e.moveTo(t+n,s),e.lineTo(t+35+10,s),e.stroke();function i(l,c,r){e.fillStyle="#1a237e",e.strokeStyle="#333",e.lineWidth=2,e.beginPath();for(let m=0;m<6;m++){const g=Math.PI/3*m,u=l+r*Math.cos(g),d=c+r*Math.sin(g);m===0?e.moveTo(u,d):e.lineTo(u,d)}e.closePath(),e.fill(),e.stroke(),e.strokeStyle="#283593",e.lineWidth=1;for(let m=0;m<6;m++){const g=Math.PI/3*m,u=l+r*Math.cos(g),d=c+r*Math.sin(g);e.beginPath(),e.moveTo(l,c),e.lineTo(u,d),e.stroke()}e.beginPath();for(let m=0;m<6;m++){const g=Math.PI/3*m,u=l+r*.6*Math.cos(g),d=c+r*.6*Math.sin(g);m===0?e.moveTo(u,d):e.lineTo(u,d)}e.closePath(),e.stroke()}i(t-35-10,s,35),i(t+35+10,s,35),e.fillStyle="#4eff4e",e.beginPath(),e.arc(t,s+n-2,3,0,Math.PI*2),e.fill()}async function bt(e){if(e.totalTime<1e3)return;const t=e.totalTime/(1e3*60*60),s=e.category||"work";try{const o={taskId:parseInt(e.taskId),hours:t,dateLogged:new Date().toISOString().split("T")[0],description:`Spaceport Mission: ${e.taskTitle}`,category:s,loggedAt:new Date().toISOString()};await Ce(o)&&(console.log(`💾 Mission Complete: ${t.toFixed(2)} hours for ${e.taskTitle}`),v(`🚀 Mission Complete: ${t.toFixed(2)}h logged`,"success"),T.emit("spaceport:rocketLanded",{taskId:parseInt(e.taskId),taskTitle:e.taskTitle,hours:t,category:s}))}catch(o){console.error("Error saving rocket mission time:",o),v("Failed to save mission time","error")}}async function M(e="board"){console.log("Rendering tasks for view:",e),Ct(e),ua(e);const t=document.getElementById("taskList");if(!t){console.error("Container element #taskList not found");return}const s=document.getElementById("spaceportView");e==="spaceport"?(t.style.display="none",s&&(s.style.display="block")):(t.style.display="block",s&&(s.style.display="none"));const o=R();switch(e){case"board":await x(t,o);break;case"month":await Hs(t,o);break;case"today":await ls(t);break;case"work":await Se(t);break;case"reports":await ro(t);break;case"spaceport":await ca();break;case"all":await da();break;default:await x(t,o)}}async function ca(){await vo()}async function da(){console.log("All tasks view not yet implemented")}function ua(e){document.querySelectorAll(".nav-link").forEach(o=>{o.classList.remove("active")});const s={board:"boardTab",month:"monthTab",today:"todayTab",work:"workTab",reports:"reportsTab",spaceport:"spaceportTab",all:"allTab"}[e];if(s){const o=document.getElementById(s);o&&o.classList.add("active")}}function ma(){var e,t,s,o,a,n;(e=document.getElementById("boardTab"))==null||e.addEventListener("click",i=>{i.preventDefault(),M("board")}),(t=document.getElementById("monthTab"))==null||t.addEventListener("click",i=>{i.preventDefault(),M("month")}),(s=document.getElementById("todayTab"))==null||s.addEventListener("click",i=>{i.preventDefault(),M("today")}),(o=document.getElementById("workTab"))==null||o.addEventListener("click",i=>{i.preventDefault(),M("work")}),(a=document.getElementById("reportsTab"))==null||a.addEventListener("click",i=>{i.preventDefault(),M("reports")}),(n=document.getElementById("spaceportTab"))==null||n.addEventListener("click",i=>{i.preventDefault(),M("spaceport")})}function ga(){var e,t,s,o,a,n,i;(e=document.getElementById("exportBtn"))==null||e.addEventListener("click",async()=>{await ns()}),(t=document.getElementById("importBtn"))==null||t.addEventListener("click",()=>{document.getElementById("importFile").click()}),(s=document.getElementById("importFile"))==null||s.addEventListener("change",async l=>{const c=l.target.files[0];c&&(await is(c),M(ee()))}),(o=document.getElementById("globalFilterClear"))==null||o.addEventListener("click",()=>{document.getElementById("globalProjectFilter").value="",document.getElementById("globalPhaseFilter").value="",At(),localStorage.removeItem("globalProjectFilter"),localStorage.removeItem("globalPhaseFilter")}),(a=document.getElementById("globalProjectFilter"))==null||a.addEventListener("change",l=>{const c=l.target.value,r=R();X({...r,project:c||null}),localStorage.setItem("globalProjectFilter",c)}),(n=document.getElementById("globalPhaseFilter"))==null||n.addEventListener("change",l=>{const c=l.target.value,r=R();X({...r,phase:c||null}),localStorage.setItem("globalPhaseFilter",c)}),(i=document.getElementById("punchClockBtn"))==null||i.addEventListener("click",()=>{new bootstrap.Modal(document.getElementById("punchClockModal")).show()}),document.addEventListener("click",l=>{if(l.target.closest(".work-task-btn")){const c=parseInt(l.target.closest(".work-task-btn").dataset.taskId);c&&(console.log("Opening work tab for task:",c),ha(c))}})}async function ha(e){console.log("openWorkTab called with taskId:",e),document.querySelectorAll(".nav-link").forEach(s=>s.classList.remove("active"));const t=document.getElementById("workTab");t&&(t.classList.add("active"),t.style.display="block");try{await M("work"),setTimeout(async()=>{await pe(e)},100)}catch(s){console.error("Error opening work tab:",s),v("Failed to open task","error")}}window.renderTasks=M;window.toggleSidebar=function(){const e=document.getElementById("sidebar"),t=document.getElementById("toggleIcon");e.classList.contains("collapsed")?(e.classList.remove("collapsed"),t.className="fas fa-chevron-left",localStorage.setItem("sidebarCollapsed","false")):(e.classList.add("collapsed"),t.className="fas fa-chevron-right",localStorage.setItem("sidebarCollapsed","true"))};window.showQuickAdd=function(){document.getElementById("sidebar").classList.contains("collapsed")&&toggleSidebar(),setTimeout(()=>{var t;(t=document.getElementById("quickTaskTitle"))==null||t.focus()},300)};function fa(){const e=document.getElementById("sidebar"),t=document.getElementById("toggleIcon");localStorage.getItem("sidebarCollapsed")==="true"?(e.classList.add("collapsed"),t.className="fas fa-chevron-right"):(e.classList.remove("collapsed"),t.className="fas fa-chevron-left")}function pa(){var t,s,o;const e=document.getElementById("quickTaskDue");if(e){const a=new Date;a.setDate(a.getDate()+7),e.value=a.toISOString().split("T")[0]}(t=document.getElementById("quickAddBtn"))==null||t.addEventListener("click",async()=>{await ya()}),(s=document.getElementById("expandAddBtn"))==null||s.addEventListener("click",()=>{const a=document.getElementById("expandedAddForm"),n=document.getElementById("expandAddBtn");a.style.display==="none"||!a.style.display?(a.style.display="block",n.innerHTML='<i class="fas fa-chevron-up"></i> Less Options'):(a.style.display="none",n.innerHTML='<i class="fas fa-chevron-down"></i> More Options')}),(o=document.getElementById("quickTaskProject"))==null||o.addEventListener("change",a=>{Ia(a.target.value)})}async function ya(){var a,n,i,l,c,r,m,g;const e=document.getElementById("quickTaskTitle").value.trim(),t=document.getElementById("quickTaskDue").value,s=document.getElementById("quickTaskStatus").value;if(!e||!t){v("Please fill in task title and due date","error");return}const o={title:e,dueOn:t,status:s,text:((a=document.getElementById("quickTaskText"))==null?void 0:a.value)||"",notes:((n=document.getElementById("quickTaskNotes"))==null?void 0:n.value)||"",urgency:((i=document.getElementById("quickTaskUrgency"))==null?void 0:i.value)||"Med",importance:((l=document.getElementById("quickTaskImportance"))==null?void 0:l.value)||"Med",estimate:parseFloat(((c=document.getElementById("quickTaskEstimate"))==null?void 0:c.value)||0),remainingHours:parseFloat(((r=document.getElementById("quickTaskRemaining"))==null?void 0:r.value)||0),projectId:(m=document.getElementById("quickTaskProject"))!=null&&m.value?parseInt(document.getElementById("quickTaskProject").value):null,phaseKey:((g=document.getElementById("quickTaskPhase"))==null?void 0:g.value)||null,categoryLists:va(),createdAt:new Date().toISOString()};try{if(await He(o,!1)){v("Task added successfully!","success"),document.getElementById("quickTaskTitle").value="",document.getElementById("quickTaskText").value="",document.getElementById("quickTaskNotes").value="",document.getElementById("quickTaskEstimate").value="0",document.getElementById("quickTaskRemaining").value="0";const d=document.getElementById("quickTaskDue");if(d){const h=new Date;h.setDate(h.getDate()+7),d.value=h.toISOString().split("T")[0]}M(ee())}else v("Failed to add task","error")}catch(u){console.error("Error adding task:",u),v("Failed to add task","error")}}function va(){const e=document.querySelectorAll(".category-list-checkbox:checked");return Array.from(e).map(t=>t.value)}function ba(){const e=document.getElementById("saveQuickTimeBtn"),t=document.getElementById("quickTimeModal");e==null||e.addEventListener("click",async()=>{const s=parseInt(document.getElementById("quickTimeTaskId").value),o=parseFloat(document.getElementById("quickTimeHours").value),a=document.getElementById("quickTimeDate").value,n=document.getElementById("quickTimeNotes").value.trim();if(!o||o<=0){v("Please enter a valid number of hours","error");return}if(!a){v("Please select a date","error");return}const i={taskId:s,hours:o,dateLogged:a,notes:n||`Custom log: ${o}h`,categoryKey:null};if(!await Ce(i))return;const r=(await C({},!0)).find(u=>u.id===s);if(r&&r.remainingHours!==null&&r.remainingHours!==void 0){const u=Pe(Math.max(0,r.remainingHours-o));await xe(s,u,`Auto-decremented by ${o}h time log`)}v(`${o}h logged successfully!`,"success"),bootstrap.Modal.getInstance(t).hide();const g=ee();if(g==="board"){const u=document.getElementById("taskList"),d=R();await x(u,d)}else await M(g)})}window.manageCategoryLists=function(){const e=document.getElementById("expandedAddForm"),t=document.getElementById("expandAddBtn");(e.style.display==="none"||!e.style.display)&&t.click(),setTimeout(()=>{const s=document.getElementById("quickTaskCategoryLists");s&&s.scrollIntoView({behavior:"smooth",block:"nearest"})},100)};window.manageProjects=function(){new bootstrap.Modal(document.getElementById("projectsModal")).show()};window.managePhases=function(){new bootstrap.Modal(document.getElementById("phaseListsModal")).show()};window.logQuickTime=async function(e,t){await Ee(e,t,async()=>{if(ee()==="board"){const o=document.getElementById("taskList"),a=R();await x(o,a)}})};window.showCustomTimeModal=function(e){const t=new bootstrap.Modal(document.getElementById("quickTimeModal")),s=document.getElementById("quickTimeTaskId"),o=document.getElementById("quickTimeHours"),a=document.getElementById("quickTimeDate"),n=document.getElementById("quickTimeNotes");s.value=e,a.value=new Date().toISOString().split("T")[0],o.value="",n.value="",t._element.addEventListener("shown.bs.modal",()=>{o.focus()},{once:!0}),t.show()};async function ka(){const e=document.getElementById("globalProjectFilter");if(e){const s=await se();e.innerHTML='<option value="">All Projects</option>',s.forEach(a=>{e.innerHTML+=`<option value="${a.id}">${a.name}</option>`});const o=localStorage.getItem("globalProjectFilter");o&&(e.value=o)}const t=document.getElementById("globalPhaseFilter");if(t){const s=await oe();t.innerHTML='<option value="">All Phases</option>',s.forEach(a=>{a.phases&&a.phases.forEach(n=>{t.innerHTML+=`<option value="${n.slug}">${a.title}: ${n.title}</option>`})});const o=localStorage.getItem("globalPhaseFilter");o&&(t.value=o)}}async function wa(){const e=document.getElementById("quickTaskProject");if(e){const s=await se();e.innerHTML='<option value="">No Project (AdHoc)</option>',s.forEach(o=>{e.innerHTML+=`<option value="${o.id}">${o.name}</option>`})}const t=document.getElementById("quickTaskPhase");t&&(t.innerHTML='<option value="">No Phase</option>'),await Ta()}async function Ta(){const e=document.getElementById("quickTaskCategoryLists");if(!e)return;const t=await he();if(t.length===0){e.innerHTML='<div class="text-muted small">No category lists available</div>';return}e.innerHTML=t.map(s=>`
    <div class="form-check">
      <input class="form-check-input category-list-checkbox" type="checkbox" value="${s.slug}" id="catList_${s.slug}">
      <label class="form-check-label" for="catList_${s.slug}">
        ${s.title}
      </label>
    </div>
  `).join("")}async function Ia(e){const t=document.getElementById("quickTaskPhase");if(!t||(t.innerHTML='<option value="">No Phase</option>',!e))return;const o=(await se()).find(i=>i.id===parseInt(e));if(!o||!o.phaseListId)return;const n=(await oe()).find(i=>i.id===o.phaseListId);!n||!n.phases||n.phases.length===0||n.phases.forEach(i=>{t.innerHTML+=`<option value="${i.slug}">${i.title}</option>`})}function Sa(){const e=document.getElementById("modalTodoTitleInput"),t=document.getElementById("modalTodoAddBtn"),s=document.getElementById("modalShowCompletedTodos"),o=document.getElementById("modalCancelTodoDetails"),a=document.getElementById("modalSubmitTodoWithDetails");e&&e.addEventListener("keypress",i=>{i.key==="Enter"&&(i.shiftKey?Xe():Qe()?be():Ke())}),t&&t.addEventListener("click",i=>{i.preventDefault(),document.getElementById("modalTodoTitleInput").value.trim()?Qe()?be():Ke():Xe()}),s&&s.addEventListener("change",Q),o&&o.addEventListener("click",kt),a&&a.addEventListener("click",be);const n=document.getElementById("todoListModal");n&&n.addEventListener("show.bs.modal",function(){Q(),setTimeout(()=>e==null?void 0:e.focus(),100)})}function Qe(){const e=document.getElementById("modalTodoDetailsInput"),t=document.querySelector("#modalTodoDetailsInput textarea");return e&&e.style.display!=="none"&&t&&t.value.trim()}function Xe(){const e=document.getElementById("modalTodoDetailsInput");if(e){e.style.display="block";const t=document.querySelector("#modalTodoDetailsInput textarea");t&&t.focus()}}function kt(){const e=document.getElementById("modalTodoDetailsInput"),t=document.querySelector("#modalTodoDetailsInput textarea");e&&(e.style.display="none"),t&&(t.value="")}async function Ke(){const e=document.getElementById("modalTodoTitleInput"),t=e.value.trim();t&&(await fe(t,""),e.value="",Q(),e.focus())}async function be(){const e=document.getElementById("modalTodoTitleInput"),t=document.querySelector("#modalTodoDetailsInput textarea"),s=e.value.trim(),o=t.value.trim();s&&(await fe(s,o),e.value="",t.value="",kt(),Q(),e.focus())}async function Q(){try{const t=await(await I).getAll("todos"),s=document.getElementById("modalShowCompletedTodos"),o=(s==null?void 0:s.checked)||!1,a=o?t:t.filter(i=>!i.completed);a.sort((i,l)=>i.completed!==l.completed?i.completed?1:-1:new Date(l.createdAt)-new Date(i.createdAt));const n=document.getElementById("modalTodosList");if(!n)return;if(a.length===0){n.innerHTML=o?'<p class="text-muted text-center">No todos yet. Add one to get started!</p>':'<p class="text-muted text-center">No active todos. Add one to get started!</p>';return}n.innerHTML=a.map(i=>`
      <div class="todo-item ${i.completed?"completed":""}" data-todo-id="${i.id}">
        <input type="checkbox" class="form-check-input todo-checkbox" 
               ${i.completed?"checked":""} 
               data-todo-id="${i.id}">
        <div class="todo-content">
          <div class="todo-title">${i.title}</div>
          ${i.content?`<p class="todo-text">${i.content}</p>`:""}
          ${i.completed&&i.completedAt?`<small class="text-muted">Completed: ${new Date(i.completedAt).toLocaleDateString()}</small>`:`<small class="text-muted">Created: ${new Date(i.createdAt).toLocaleDateString()}</small>`}
        </div>
        <div class="todo-actions ms-auto">
          <button class="btn btn-sm btn-outline-danger delete-btn" data-todo-id="${i.id}" title="Delete todo">
            <i class="fas fa-trash"></i>
          </button>
          <div class="delete-confirmation d-none">
            <span class="me-2">Delete this todo?</span>
            <button class="btn btn-danger btn-sm me-1 confirm-delete-btn" data-todo-id="${i.id}">
              <i class="fas fa-check me-1"></i>Yes
            </button>
            <button class="btn btn-outline-secondary btn-sm cancel-delete-btn" data-todo-id="${i.id}">
              <i class="fas fa-times me-1"></i>Cancel
            </button>
          </div>
        </div>
      </div>
    `).join(""),n.querySelectorAll(".todo-checkbox").forEach(i=>{i.addEventListener("change",async l=>{const c=parseInt(l.target.dataset.todoId);await Ea(c)})}),n.querySelectorAll(".delete-btn").forEach(i=>{i.addEventListener("click",l=>{const c=parseInt(l.currentTarget.dataset.todoId);La(c)})}),n.querySelectorAll(".confirm-delete-btn").forEach(i=>{i.addEventListener("click",async l=>{const c=parseInt(l.currentTarget.dataset.todoId);await $a(c)})}),n.querySelectorAll(".cancel-delete-btn").forEach(i=>{i.addEventListener("click",l=>{const c=parseInt(l.currentTarget.dataset.todoId);Ba(c)})})}catch(e){console.error("Error loading modal todos:",e)}}async function Ea(e){try{const t=await I,s=await t.get("todos",e);if(!s)return;s.completed=!s.completed,s.completedAt=s.completed?new Date().toISOString():null,await t.put("todos",s),await Q()}catch(t){console.error("Error toggling todo:",t),v("Failed to update todo","error")}}function La(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-btn"),o=t.querySelector(".delete-confirmation");s.classList.add("d-none"),o.classList.remove("d-none"),t.classList.add("deleting")}function Ba(e){const t=document.querySelector(`[data-todo-id="${e}"]`);if(!t)return;const s=t.querySelector(".delete-btn"),o=t.querySelector(".delete-confirmation");s.classList.remove("d-none"),o.classList.add("d-none"),t.classList.remove("deleting")}async function $a(e){try{await(await I).delete("todos",e),await Q(),v("Todo deleted","success")}catch(t){console.error("Error deleting todo:",t),v("Failed to delete todo","error")}}let F=null;function Pa(){const e=document.getElementById("phaseListsModal");ie(),document.getElementById("newPhaseListBtn").addEventListener("click",()=>{wt()}),document.getElementById("phaseListForm").addEventListener("submit",async t=>{t.preventDefault(),await Ca()}),document.getElementById("cancelPhaseListBtn").addEventListener("click",()=>{Le()}),document.getElementById("deletePhaseListBtn").addEventListener("click",async()=>{if(F&&confirm(`Are you sure you want to delete "${F.title}"?

This will permanently delete the phase list and all its phases.`))try{await qt(F.id),Le(),ie(),v("Phase list deleted","success")}catch(t){console.error("Error deleting phase list:",t),v("Failed to delete phase list","error")}}),document.getElementById("addPhaseBtn").addEventListener("click",()=>{Da()}),document.getElementById("phaseListTitle").addEventListener("input",t=>{const s=ue(t.target.value);document.getElementById("phaseListSlugPreview").textContent=s||"(auto-generated)"}),e&&(e.addEventListener("show.bs.modal",function(){ie(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}function ue(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function ie(){const e=document.getElementById("phaseListsContainer"),t=await oe();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-layer-group fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No phase lists yet.<br>Create your first list!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>{var o;return`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-list-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.title}</div>
        <small class="text-muted">${((o=s.phases)==null?void 0:o.length)||0} phases</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `}).join(""),e.querySelectorAll("[data-list-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.listId),a=t.find(n=>n.id===o);a&&wt(a)})})}function wt(e=null){F=e,document.getElementById("phaseListPlaceholder").style.display="none",document.getElementById("phaseListEditor").style.display="block",e?(document.getElementById("phaseListTitle").value=e.title,document.getElementById("phaseListDescription").value=e.description||"",document.getElementById("phaseListSlugPreview").textContent=e.slug,document.getElementById("deletePhaseListBtn").style.display="inline-block",me(e.phases||[])):(document.getElementById("phaseListTitle").value="",document.getElementById("phaseListDescription").value="",document.getElementById("phaseListSlugPreview").textContent="(auto-generated)",document.getElementById("deletePhaseListBtn").style.display="none",me([]))}function Le(){F=null,document.getElementById("phaseListEditor").style.display="none",document.getElementById("phaseListPlaceholder").style.display="block",document.getElementById("phaseListForm").reset()}function me(e){const t=document.getElementById("phasesContainer");if(e.length===0){t.innerHTML=`
      <div class="text-muted text-center py-3">
        <i class="fas fa-layer-group fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No phases yet.<br>Click "Add Phase" to get started!</p>
      </div>
    `;return}t.innerHTML=e.map((s,o)=>`
    <div class="d-flex align-items-center mb-2 phase-item">
      <input type="text" class="form-control phase-title" value="${s.title}" placeholder="Phase name" data-phase-index="${o}">
      <small class="text-muted ms-2 me-2">Slug: <span class="phase-slug">${s.slug||"(auto-generated)"}</span></small>
      <button type="button" class="btn btn-outline-danger btn-sm ms-2" data-remove-phase="${o}">
        <i class="fas fa-trash"></i>
      </button>
    </div>
  `).join(""),t.querySelectorAll(".phase-title").forEach(s=>{s.addEventListener("input",o=>{const a=o.target.parentElement.querySelector(".phase-slug"),n=ue(o.target.value);a.textContent=n||"(auto-generated)"})}),t.querySelectorAll("[data-remove-phase]").forEach(s=>{s.addEventListener("click",o=>{const a=parseInt(o.currentTarget.dataset.removePhase);Ma(a)})})}function Da(){const e=je();e.push({title:"",slug:""}),me(e);const s=document.getElementById("phasesContainer").querySelectorAll(".phase-title");s.length>0&&s[s.length-1].focus()}function Ma(e){const t=je();t.splice(e,1),me(t)}function je(){const t=document.getElementById("phasesContainer").querySelectorAll(".phase-title"),s=document.getElementById("phaseListTitle").value.trim(),o=ue(s);return Array.from(t).map(a=>({title:a.value.trim(),slug:`${o}.${ue(a.value.trim())}`})).filter(a=>a.title)}async function Ca(){const e=document.getElementById("phaseListTitle").value.trim(),t=document.getElementById("phaseListDescription").value.trim(),s=je();if(!e){v("Phase list title is required","error");return}for(const a of s)if(!a.title){v("All phases must have a title","error");return}const o={title:e,description:t,phases:s};F&&(o.id=F.id,o.slug=F.slug);try{await jt(o),Le(),ie(),v("Phase list saved","success")}catch(a){console.error("Error saving phase list:",a),v("Failed to save phase list","error")}}let j=null;function Aa(){const e=document.getElementById("categoryListsModal");le(),document.getElementById("newCategoryListBtn").addEventListener("click",()=>{Tt()}),document.getElementById("categoryListForm").addEventListener("submit",async t=>{t.preventDefault(),await xa()}),document.getElementById("cancelCategoryListBtn").addEventListener("click",()=>{Be()}),document.getElementById("deleteCategoryListBtn").addEventListener("click",async()=>{if(j&&confirm(`Are you sure you want to delete "${j.title}"?

This will permanently delete the category list and all its categories.`))try{await st(j.id),Be(),le(),v("Category list deleted","success")}catch(t){console.error("Error deleting category list:",t),v("Failed to delete category list","error")}}),document.getElementById("addCategoryBtn").addEventListener("click",()=>{Ha()}),document.getElementById("categoryListTitle").addEventListener("input",t=>{const s=Z(t.target.value);document.getElementById("categoryListSlugPreview").textContent=s||"(auto-generated)"}),e&&(e.addEventListener("show.bs.modal",function(){le(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}function Z(e){return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")}async function le(){const e=document.getElementById("categoryListsContainer"),t=await he();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-tags fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No category lists yet.<br>Create your first list!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>{var o;return`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-list-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.title}</div>
        <small class="text-muted">${((o=s.categories)==null?void 0:o.length)||0} categories</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `}).join(""),e.querySelectorAll("[data-list-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.listId),a=t.find(n=>n.id===o);a&&Tt(a)})})}function Tt(e=null){j=e,document.getElementById("categoryListPlaceholder").style.display="none",document.getElementById("categoryListEditor").style.display="block",e?(document.getElementById("categoryListTitle").value=e.title,document.getElementById("categoryListDescription").value=e.description||"",document.getElementById("categoryListSlugPreview").textContent=e.slug,document.getElementById("deleteCategoryListBtn").style.display="inline-block",ge(e.categories||[])):(document.getElementById("categoryListForm").reset(),document.getElementById("categoryListSlugPreview").textContent="(auto-generated)",document.getElementById("deleteCategoryListBtn").style.display="none",ge([]))}function Be(){j=null,document.getElementById("categoryListEditor").style.display="none",document.getElementById("categoryListPlaceholder").style.display="block"}function ge(e){const t=document.getElementById("categoriesContainer");if(e.length===0){t.innerHTML=`
      <div class="text-muted text-center py-3">
        <i class="fas fa-tag opacity-50 mb-2"></i>
        <p class="small mb-0">No categories yet. Add some below!</p>
      </div>
    `;return}t.innerHTML=e.map((s,o)=>`
    <div class="category-item d-flex align-items-center gap-2 mb-2 p-2 border rounded" data-index="${o}">
      <div class="drag-handle text-muted" style="cursor: grab;">
        <i class="fas fa-grip-vertical"></i>
      </div>
      <div class="flex-grow-1">
        <input type="text" class="form-control form-control-sm category-title" 
               value="${s.title}" placeholder="Category name" required>
        <small class="text-muted">Slug: <span class="category-slug">${s.slug}</span></small>
      </div>
      <button type="button" class="btn btn-outline-danger btn-sm remove-category">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `).join(""),t.querySelectorAll(".category-title").forEach(s=>{s.addEventListener("input",o=>{const a=Z(o.target.value),n=o.target.parentElement.querySelector(".category-slug");n.textContent=a||"(auto-generated)"})}),t.querySelectorAll(".remove-category").forEach(s=>{s.addEventListener("click",o=>{o.target.closest(".category-item").remove(),t.children.length===0&&ge([])})})}function Ha(){const e=document.getElementById("categoriesContainer");e.querySelector(".text-muted.text-center")&&(e.innerHTML="");const s=e.children.length,o=document.createElement("div");o.className="category-item d-flex align-items-center gap-2 mb-2 p-2 border rounded",o.dataset.index=s,o.innerHTML=`
    <div class="drag-handle text-muted" style="cursor: grab;">
      <i class="fas fa-grip-vertical"></i>
    </div>
    <div class="flex-grow-1">
      <input type="text" class="form-control form-control-sm category-title" 
             placeholder="Category name" required>
      <small class="text-muted">Slug: <span class="category-slug">(auto-generated)</span></small>
    </div>
    <button type="button" class="btn btn-outline-danger btn-sm remove-category">
      <i class="fas fa-times"></i>
    </button>
  `,e.appendChild(o);const a=o.querySelector(".category-title"),n=o.querySelector(".category-slug"),i=o.querySelector(".remove-category");a.addEventListener("input",l=>{const c=Z(l.target.value);n.textContent=c||"(auto-generated)"}),i.addEventListener("click",()=>{o.remove(),e.children.length===0&&ge([])}),a.focus()}async function xa(){const e=document.getElementById("categoryListTitle").value.trim(),t=document.getElementById("categoryListDescription").value.trim();if(!e){v("Please enter a list title","error");return}const s=document.querySelectorAll(".category-item"),o=[];for(const n of s){const l=n.querySelector(".category-title").value.trim();l&&o.push({title:l,slug:`${Z(e)}.${Z(l)}`})}const a={title:e,description:t,categories:o};j&&(a.id=j.id,a.slug=j.slug);try{await tt(a),Be(),le(),v("Category list saved","success")}catch(n){console.error("Error saving category list:",n),v("Failed to save category list","error")}}let z=null;function Oa(){const e=document.getElementById("projectsModal");re(),document.getElementById("newProjectBtn").addEventListener("click",()=>{It()}),document.getElementById("projectForm").addEventListener("submit",async t=>{t.preventDefault(),await Ra()}),document.getElementById("cancelProjectBtn").addEventListener("click",()=>{$e()}),document.getElementById("deleteProjectBtn").addEventListener("click",async()=>{if(z&&confirm(`Are you sure you want to delete "${z.name}"?

This will permanently delete the project. Tasks linked to this project will become unassigned.`))try{await Rt(z.id),$e(),re(),v("Project deleted","success")}catch(t){console.error("Error deleting project:",t),v("Failed to delete project","error")}}),e&&(e.addEventListener("show.bs.modal",function(){re(),this.removeAttribute("aria-hidden")}),e.addEventListener("hide.bs.modal",function(){const t=this.querySelector(":focus");t&&t.blur()}))}async function re(){const e=document.getElementById("projectsContainer"),t=await se();if(t.length===0){e.innerHTML=`
      <div class="text-muted text-center py-4">
        <i class="fas fa-project-diagram fa-2x mb-2 opacity-50"></i>
        <p class="small mb-0">No projects yet.<br>Create your first project!</p>
      </div>
    `;return}e.innerHTML=t.map(s=>`
    <button class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
            data-project-id="${s.id}">
      <div>
        <div class="fw-semibold">${s.name}</div>
        <small class="text-muted">Status: ${s.status}</small>
      </div>
      <i class="fas fa-chevron-right"></i>
    </button>
  `).join(""),e.querySelectorAll("[data-project-id]").forEach(s=>{s.addEventListener("click",()=>{const o=parseInt(s.dataset.projectId),a=t.find(n=>n.id===o);a&&It(a)})})}async function It(e=null){z=e,document.getElementById("projectPlaceholder").style.display="none",document.getElementById("projectEditor").style.display="block",await Wa("projectPhaseList",e==null?void 0:e.phaseListId),e?(document.getElementById("projectName").value=e.name,document.getElementById("projectDescription").value=e.description||"",document.getElementById("projectStatus").value=e.status||"Ready",document.getElementById("deleteProjectBtn").style.display="inline-block"):(document.getElementById("projectName").value="",document.getElementById("projectDescription").value="",document.getElementById("projectStatus").value="Ready",document.getElementById("deleteProjectBtn").style.display="none")}function $e(){z=null,document.getElementById("projectEditor").style.display="none",document.getElementById("projectPlaceholder").style.display="block",document.getElementById("projectForm").reset()}async function Wa(e,t=null){const s=document.getElementById(e),o=await oe();s.innerHTML='<option value="">No Phase List</option>',o.forEach(a=>{const n=document.createElement("option");n.value=a.id,n.textContent=a.title,t&&a.id==t&&(n.selected=!0),s.appendChild(n)})}async function Ra(){const e=document.getElementById("projectName").value.trim(),t=document.getElementById("projectDescription").value.trim(),s=document.getElementById("projectStatus").value;if(!e){v("Project name is required","error");return}const o={name:e,description:t,status:s,phaseListId:document.getElementById("projectPhaseList").value||null};z&&(o.id=z.id);try{await Wt(o),$e(),re(),v("Project saved","success")}catch(a){console.error("Error saving project:",a),v("Failed to save project","error")}}async function Fa(){const e=document.getElementById("punchClockBtn"),t=document.getElementById("punchClockText"),s=document.getElementById("primaryPunchBtn"),o=document.getElementById("primaryPunchText");if(!e)return;async function a(){const d=await G(),h=await es();if(d){const f={work:"Working",lunch:"Lunch",meeting:"Meeting",personal:"Personal",custom:(h==null?void 0:h.description)||"Activity"},y=h?f[h.category]||h.description:"Punched In";t.textContent=y,e.classList.remove("btn-outline-primary"),e.classList.add("btn-outline-danger"),s&&o&&(o.textContent="End Work Day",s.classList.remove("btn-primary"),s.classList.add("btn-danger"));const k=document.getElementById("interruptionButtons"),b=document.getElementById("returnToWorkSection"),w=document.getElementById("interruptionButtonsRow");k&&(k.style.display="block"),h&&h.category!=="work"?(b&&(b.style.display="block"),w&&(w.style.display="none")):(b&&(b.style.display="none"),w&&(w.style.display="block"))}else{t.textContent="Punch In",e.classList.remove("btn-outline-danger"),e.classList.add("btn-outline-primary"),s&&o&&(o.textContent="Start Work Day",s.classList.remove("btn-danger"),s.classList.add("btn-primary"));const f=document.getElementById("interruptionButtons");f&&(f.style.display="none")}}async function n(){if(await G()){const f=await Jt();f?v(`Punched Out! Total: ${f.totalHours}h`,"success"):v("Failed to punch out","error")}else await Kt()?v("Punched In! Good luck! 🚀","success"):v("Failed to punch in","error");await a();const h=bootstrap.Modal.getInstance(document.getElementById("punchClockModal"));h&&h.hide(),ee()==="today"&&await M("today")}async function i(d,h){await Zt(d,h)?v({lunch:"Enjoy your lunch break! 🍽️",meeting:"Meeting time - make it productive! 🤝",personal:"Taking care of personal matters. ⏰",work:"Back to work! Let's be productive! 💼"}[d]||`${h} activity started.`,"info"):v("Failed to record activity","error"),await a()}e.addEventListener("click",async()=>{await a()}),s&&s.addEventListener("click",n);const l=document.getElementById("lunchBtn"),c=document.getElementById("meetingBtn"),r=document.getElementById("personalBtn"),m=document.getElementById("returnToWorkBtn"),g=document.getElementById("addCustomInterruptionBtn"),u=document.getElementById("customInterruptionInput");if(l&&l.addEventListener("click",()=>i("lunch","Lunch Break")),c&&c.addEventListener("click",()=>i("meeting","Meeting")),r&&r.addEventListener("click",()=>i("personal","Personal Time")),m&&m.addEventListener("click",()=>i("work","Work Time")),g&&u){const d=async()=>{const h=u.value.trim();if(!h){v("Please enter a description for the interruption.","warning"),u.focus();return}await i("custom",h),u.value=""};g.addEventListener("click",d),u.addEventListener("keypress",h=>{h.key==="Enter"&&d()})}await a()}async function ja(){console.log("🚀 Initializing Task Time Tracker..."),fa(),ma(),ga(),pa(),ba(),Sa(),Aa(),Oa(),Pa(),await Fa(),ut(),await ka(),await wa(),await M("board"),console.log("✅ App initialized successfully!")}document.addEventListener("DOMContentLoaded",function(){ja()});</script>
  <style rel="stylesheet" crossorigin>#spaceportView{display:none;height:calc(100vh - 200px);background:linear-gradient(to bottom,#0a0a1a,#1a1a2e 70%,#16213e);border-radius:15px;position:relative;overflow:hidden;box-shadow:inset 0 0 50px #6496ff1a}#spaceportCanvas{width:100%;height:100%;cursor:pointer;background:radial-gradient(ellipse at 50% 100%,rgba(100,150,255,.05) 0%,transparent 50%)}.mission-control{position:absolute;bottom:20px;right:20px;z-index:10;display:flex;flex-direction:column;gap:10px;max-width:250px;opacity:.7}.control-panel{background:#00142899;padding:10px;border-radius:8px;border:1px solid rgba(100,150,255,.2);-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:0 0 10px #6496ff1a;font-size:.85rem}.control-panel h6{color:#64d6ff;margin-bottom:10px;font-family:Courier New,monospace;font-size:.9rem;text-transform:uppercase;letter-spacing:1px}.mission-list{max-height:200px;overflow-y:auto}.mission-item{background:#6496ff0d;border:1px solid rgba(100,150,255,.15);border-radius:4px;padding:6px 8px;margin:3px 0;cursor:pointer;transition:all .2s ease;font-size:.75rem;color:#fffc}.mission-item:hover{background:#6496ff26;border-color:#64d6ff80;color:#fff}.mission-item.active{background:#64ff6433;border-color:#64ff64;box-shadow:0 0 15px #64ff6466}.rocket-control-form{font-family:Courier New,monospace}.rocket-control-form button:hover{transform:translateY(-1px);box-shadow:0 2px 8px #0000004d}.rocket-control-form button:active{transform:translateY(0)}.launch-controls{display:none;margin-top:15px;padding:10px;background:#ff64641a;border:1px solid rgba(255,100,100,.3);border-radius:5px}.launch-controls.active{display:block}.launch-btn{background:linear-gradient(45deg,#f44,#f66);border:none;color:#fff;padding:10px 20px;border-radius:20px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:1px;font-size:.9rem;box-shadow:0 4px 15px #ff44444d;transition:all .3s ease;width:100%}.launch-btn:hover{background:linear-gradient(45deg,#f66,#f88);box-shadow:0 6px 20px #ff444480;transform:translateY(-2px)}.spaceport-stats{position:absolute;top:20px;right:20px;background:#001428e6;padding:15px;border-radius:10px;border:2px solid rgba(100,150,255,.3);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);color:#fff;min-width:200px;font-family:Courier New,monospace}.spaceport-stats h6{color:#64d6ff;margin-bottom:10px;font-size:.9rem;text-transform:uppercase;letter-spacing:1px}.stat-row{display:flex;justify-content:space-between;margin-bottom:5px;font-size:.8rem}.stat-value{color:#64ff64;font-weight:700}.punch-controls{position:absolute;bottom:30px;left:50%;transform:translate(-50%);display:flex;gap:15px;align-items:center}.punch-status-display{background:#001428e6;padding:10px 20px;border-radius:25px;border:2px solid rgba(100,150,255,.3);color:#64d6ff;font-family:Courier New,monospace;font-size:.9rem;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px)}.punch-status-display.operational{border-color:#64ff64;color:#64ff64;box-shadow:0 0 20px #64ff644d}.punch-btn{background:linear-gradient(45deg,#44f,#66f);border:none;color:#fff;padding:12px 25px;border-radius:25px;cursor:pointer;font-weight:700;text-transform:uppercase;letter-spacing:1px;font-size:.9rem;box-shadow:0 4px 15px #4444ff4d;transition:all .3s ease}.punch-btn:hover{background:linear-gradient(45deg,#66f,#88f);box-shadow:0 6px 20px #4444ff80;transform:translateY(-2px)}.punch-btn.operational{background:linear-gradient(45deg,#f44,#f66);box-shadow:0 4px 15px #ff44444d}.punch-btn.operational:hover{background:linear-gradient(45deg,#f66,#f88);box-shadow:0 6px 20px #ff444480}.rocket-form-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#001428f2;border:2px solid rgba(100,150,255,.4);border-radius:15px;padding:20px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:0 10px 30px #00000080;color:#fff;font-family:Courier New,monospace;min-width:300px;z-index:1000}.rocket-form-title{color:#64d6ff;text-align:center;margin-bottom:15px;text-transform:uppercase;letter-spacing:1px;font-size:1.1rem}.rocket-form-buttons{display:flex;gap:10px;margin-top:15px}.rocket-form-buttons button{flex:1;padding:8px 15px;border:1px solid rgba(100,150,255,.3);border-radius:5px;background:#6496ff1a;color:#64d6ff;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;text-transform:uppercase;font-size:.8rem}.rocket-form-buttons button:hover{background:#6496ff33;border-color:#6496ff80}.rocket-form-buttons .btn-danger{background:#ff64641a;border-color:#ff64644d;color:#ff6464}.rocket-form-buttons .btn-danger:hover{background:#ff646433;border-color:#ff646480}.rocket-form-buttons .btn-success{background:#64ff641a;border-color:#64ff644d;color:#64ff64}.rocket-form-buttons .btn-success:hover{background:#64ff6433;border-color:#64ff6480}.category-selector-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#001428f2;border:2px solid rgba(100,150,255,.4);border-radius:15px;padding:25px;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px);box-shadow:0 10px 30px #00000080;color:#fff;font-family:Courier New,monospace;min-width:350px;max-width:400px;z-index:1001}.category-list{max-height:250px;overflow-y:auto;margin:15px 0}.category-option{background:#6496ff0d;border:1px solid rgba(100,150,255,.15);border-radius:5px;padding:10px;margin:5px 0;cursor:pointer;transition:all .2s ease;font-size:.85rem}.category-option:hover{background:#6496ff26;border-color:#64d6ff80}.category-option-title{color:#64d6ff;font-weight:700;margin-bottom:5px}.category-option-time{color:#64ff64;font-size:.75rem}.spaceship-picker{margin:10px 0}.spaceship-picker-header{display:flex;align-items:center;justify-content:space-between;gap:8px;background:#6496ff1a;border:1px solid rgba(100,150,255,.3);border-radius:6px;padding:8px 10px;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;font-size:.75rem;color:#64d6ff}.spaceship-picker-header:hover{background:#6496ff33;border-color:#64d6ff80}.spaceship-current{flex:1;text-align:center;color:#aaa;font-style:italic}.spaceship-toggle-icon{color:#64d6ff;font-size:.7rem;transition:transform .2s ease}.spaceship-picker.expanded .spaceship-toggle-icon{transform:rotate(180deg)}.spaceship-options{display:flex;flex-direction:column;gap:6px;margin-top:6px;max-height:0;overflow:hidden;transition:max-height .3s ease}.spaceship-picker.expanded .spaceship-options{max-height:250px;overflow-y:auto}.spaceship-options::-webkit-scrollbar{width:6px}.spaceship-options::-webkit-scrollbar-track{background:#6496ff0d;border-radius:3px}.spaceship-options::-webkit-scrollbar-thumb{background:#6496ff4d;border-radius:3px}.spaceship-options::-webkit-scrollbar-thumb:hover{background:#64d6ff80}.spaceship-btn{display:flex;align-items:center;gap:8px;background:#6496ff0d;border:1px solid rgba(100,150,255,.2);border-radius:6px;padding:6px 10px;color:#aaa;cursor:pointer;transition:all .2s ease;font-family:Courier New,monospace;font-size:.75rem}.spaceship-btn:hover{background:#6496ff26;border-color:#64d6ff66;color:#64d6ff}.spaceship-btn.selected{background:#64d6ff33;border-color:#64d6ff99;color:#64d6ff;box-shadow:0 0 10px #64d6ff4d}.spaceship-icon{font-size:1.2rem;min-width:20px;text-align:center}.spaceship-name{flex:1;text-align:left}.summary-card{background-color:#e9ecef;margin-bottom:.75rem!important}.summary-card p{margin-bottom:0;font-size:.9rem;color:#495057}.calendar-table td{height:100px;border:1px solid #dee2e6}.task-event{background-color:#007bff;color:#fff;padding:2px 5px;margin:2px;border-radius:3px;cursor:pointer}.editing{background-color:#fff3cd;border:1px solid #ffeaa7}.sidebar{width:320px;background-color:#f8f9fa;border-right:1px solid #dee2e6;padding:1rem;flex-shrink:0;transition:width .3s ease,padding .3s ease;overflow-x:hidden;position:relative}.sidebar-toggle{position:absolute;top:1rem;right:.5rem;background:#6c757d;color:#fff;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.8rem;z-index:10;transition:all .2s ease}.sidebar-toggle:hover{background:#495057;transform:scale(1.1)}.sidebar-nav-item{padding:.75rem;border-radius:.375rem;background:#fff;border:1px solid #dee2e6;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.75rem;text-decoration:none;color:#495057}.sidebar-nav-item:hover{background:#e9ecef;border-color:#adb5bd;text-decoration:none;color:#343a40}.sidebar-nav-item.active{background:#007bff;border-color:#007bff;color:#fff}.sidebar-nav-item i{width:16px;text-align:center;flex-shrink:0}#categoryListsBadgeContainer{display:flex;flex-wrap:wrap;gap:.375rem}.category-list-badge{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .5rem;background:#e7f3ff;border:1px solid #b8daff;border-radius:.375rem;font-size:.75rem;color:#0c5aa6;transition:all .2s ease}.category-list-badge:hover{background:#cce7ff;border-color:#9fcdff}.category-list-badge .remove-badge{cursor:pointer;padding:0;border:none;background:none;color:#6c757d;font-size:.7rem;line-height:1;transition:color .2s ease}.category-list-badge .remove-badge:hover{color:#dc3545}.main-content{flex:1;display:flex;flex-direction:column}.header-bar{background-color:#fff;border-bottom:1px solid #dee2e6;padding:.75rem 1.5rem;display:flex;justify-content:space-between;align-items:center}.month-split-view{display:flex;height:calc(100vh - 200px);gap:1.5rem}.board-split-view{display:flex;height:calc(100vh - 200px);gap:1rem;width:100%;max-width:100vw;overflow:hidden;box-sizing:border-box}.board-kanban-pane{flex:1;min-width:0;overflow-x:auto;overflow-y:hidden;width:0}.board-task-detail-pane{width:320px;flex-shrink:0;background:#f8f9fa;border:1px solid #dee2e6;border-radius:.5rem;padding:1rem;overflow-y:auto}.board-task-detail-header{border-bottom:1px solid #dee2e6;padding-bottom:1rem;margin-bottom:1.5rem}.board-task-title{font-size:1.25rem;font-weight:600;margin-bottom:.5rem;color:#212529}.board-task-status-badges{display:flex;gap:.5rem;flex-wrap:wrap}.board-task-section{margin-bottom:1.5rem}.board-task-section-title{font-size:.9rem;font-weight:600;color:#6c757d;text-transform:uppercase;letter-spacing:.5px;margin-bottom:.75rem}.board-task-metrics{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.board-task-metric{background:#fff;padding:.75rem;border-radius:.375rem;border:1px solid #e9ecef}.board-task-metric-label{font-size:.8rem;color:#6c757d;margin-bottom:.25rem}.board-task-metric-value{font-size:1.1rem;font-weight:600;color:#212529}.board-task-description{background:#fff;padding:1rem;border-radius:.375rem;border:1px solid #e9ecef;max-height:200px;overflow-y:auto;white-space:pre-wrap;line-height:1.5}.board-task-empty-state{text-align:center;color:#6c757d;padding:3rem 1rem}.burndown-chart-container{background:#f8f9fa;border:1px solid #dee2e6;border-radius:.375rem;padding:1rem;margin-bottom:1rem}.burndown-chart{width:100%;height:150px;position:relative;background:linear-gradient(to bottom,#fff,#f8f9fa);border:1px solid #e9ecef;border-radius:.25rem}.burndown-line{stroke:#0d6efd;stroke-width:2;fill:none}.burndown-point{fill:#0d6efd;stroke:#fff;stroke-width:2}.burndown-axis{stroke:#dee2e6;stroke-width:1}.burndown-label{font-size:.75rem;fill:#6c757d}.board-task-edit-btn{width:100%;margin-top:1.5rem}.kanban-card.selected-task{box-shadow:0 0 0 2px #007bff;transform:scale(1.02)}.status-history-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:#fff;border-radius:.25rem;margin-bottom:.5rem;border:1px solid #e9ecef}.status-badge{font-size:.75rem;padding:.25rem .5rem}.status-badge.status-completed{background-color:#28a745}.status-badge.status-abandoned{background-color:#dc3545}.status-badge.status-archived{background-color:#6c757d}.status-badge.status-inprogress{background-color:#007bff}.status-badge.status-blocked{background-color:#dc3545}.status-badge.status-backburner{background-color:#ffc107;color:#212529}.status-badge.status-onhold{background-color:#17a2b8}.status-badge.status-ready{background-color:#28a745}.status-badge.status-estimated{background-color:#17a2b8}@media (max-width: 1400px){.board-task-detail-pane{width:280px;padding:.75rem}}@media (max-width: 1200px){.board-task-detail-pane{width:260px;padding:.75rem}}@media (max-width: 992px){.board-split-view{flex-direction:column;height:auto;overflow:visible}.board-kanban-pane{flex:none;margin-bottom:1rem;overflow-x:auto;overflow-y:visible}.board-task-detail-pane{width:100%;flex:none;max-height:400px}.kanban-lane{min-width:220px}}.month-calendar-pane{flex:1;min-width:0}.month-details-pane{width:350px;flex-shrink:0;background:#f8f9fa;border:1px solid #dee2e6;border-radius:.5rem;padding:1.5rem;overflow-y:auto}.calendar-table-container{position:relative}.week-selector{position:absolute;left:-30px;width:25px;height:100%;cursor:pointer;border-radius:.25rem;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.week-selector:hover{background-color:#e9ecef}.week-selector.selected{background-color:#007bff}.week-selector.selected:before{content:"";position:absolute;right:-5px;width:3px;height:80%;background-color:#007bff;border-radius:2px}.calendar-day.selected-day{background-color:#007bff!important;color:#fff}.calendar-day.selected-day .calendar-day-number{color:#fff}.month-details-header{border-bottom:2px solid #dee2e6;padding-bottom:1rem;margin-bottom:1.5rem}@media (max-width: 768px){.month-split-view{flex-direction:column;height:auto}.month-details-pane{width:100%;max-height:400px}}.stat-card{text-align:center;padding:.75rem;border-radius:.375rem;min-height:60px;display:flex;flex-direction:column;justify-content:center}.stat-value{font-size:1.25rem;font-weight:700;line-height:1}.stat-label{font-size:.75rem;opacity:.9;margin-top:.25rem}.day-summary{padding:.75rem;border:1px solid #dee2e6;border-radius:.375rem;margin-bottom:.5rem;cursor:pointer;transition:all .2s ease}.day-summary:hover{background-color:#f8f9fa;border-color:#007bff}.day-summary.today{border-color:#007bff;background-color:#007bff0d}.day-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}.work-indicator{color:#28a745;font-size:1.2rem}.day-stats{display:flex;gap:.25rem;flex-wrap:wrap}.day-stats .badge{font-size:.7rem}.work-session-card{padding:1rem;border:1px solid #dee2e6;border-radius:.375rem;background-color:#f8f9fa}.work-details{font-size:.9rem}.work-details>div{margin-bottom:.25rem}.task-card{padding:.75rem;border:1px solid;border-radius:.375rem;margin-bottom:.5rem;background-color:#fff}.task-title{font-weight:500;margin-bottom:.5rem}.task-meta{display:flex;gap:.5rem}.day-badge{font-size:.65rem;padding:.2rem .4rem;border-radius:.25rem;margin:.1rem}.day-badge.tasks{background-color:#007bff;color:#fff}.day-badge.hours{background-color:#28a745;color:#fff}.day-badge.work{background-color:#ffc107;color:#212529;font-weight:700}.project-badge{font-size:.65rem;padding:2px 6px;border-radius:3px;margin:1px 2px 1px 0;display:inline-block;font-weight:600;background:#e3f2fd;color:#1976d2;border:1px solid #bbdefb}.phase-badge{font-size:.65rem;padding:2px 6px;border-radius:3px;margin:1px 2px 1px 0;display:inline-block;font-weight:500;background:#f3e5f5;color:#7b1fa2;border:1px solid #e1bee7}.badge-container{margin-bottom:4px;line-height:1.2}.global-filters{display:flex;align-items:center;gap:12px;opacity:.7;transition:opacity .2s ease}.global-filters:hover{opacity:1}.global-filters select{background:linear-gradient(135deg,#ffffffe6,#f8f9fae6);border:1px solid rgba(206,212,218,.6);border-radius:4px;padding:2px 8px;font-size:.8rem;color:#495057;min-width:100px;transition:all .2s ease}.global-filters select:focus{opacity:1;border-color:#007bff66;box-shadow:0 0 0 .1rem #007bff1a}.global-filters .filter-clear{background:transparent;border:1px solid rgba(206,212,218,.4);color:#6c757d;border-radius:3px;padding:2px 6px;font-size:.7rem;transition:all .2s ease}.global-filters .filter-clear:hover{background:#dc35451a;border-color:#dc35454d;color:#dc3545}.week-selector-cell{width:60px;padding:0;vertical-align:middle;background-color:#f8f9fa;border-right:2px solid #dee2e6}.clickable-week-header{cursor:pointer;transition:all .2s ease;text-align:center;font-size:.7rem;font-weight:600;color:#6c757d;height:120px;position:relative}.clickable-week-header:hover{background-color:#e9ecef;color:#495057;transform:scale(1.02)}.clickable-week-header.selected-week-header{background-color:#007bff;color:#fff}.week-number{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-90deg);white-space:nowrap}.week-selector{width:12px;height:12px;border:2px solid #007bff;border-radius:50%;cursor:pointer;transition:background-color .2s ease}.week-selector:hover{background-color:#007bff4d}.selected-week .week-selector{background-color:#007bff}.week-selector-header{width:30px;text-align:center;color:#6c757d;font-size:.8rem;background-color:#f8f9fa;border-right:2px solid #dee2e6}.week-selector-header i{opacity:.7}.month-header-line{border-bottom:2px solid #e9ecef;padding-bottom:.75rem}.month-summary{flex-shrink:0}.summary-item{min-width:60px}.summary-value{font-size:1.1rem;line-height:1.2}@media (max-width: 992px){.month-summary{display:none!important}}.calendar-filters select:not([value=""]){border-color:#007bff;background-color:#007bff1a}.calendar-filters select:focus{border-color:#007bff;box-shadow:0 0 0 .2rem #007bff40}.status-ready{background-color:#6c757d;color:#fff}.status-estimated{background-color:#17a2b8;color:#fff}.status-inprogress{background-color:#007bff;color:#fff}.status-blocked{background-color:#dc3545;color:#fff}.status-backburner{background-color:#fd7e14;color:#fff}.status-onhold{background-color:#6f42c1;color:#fff}.status-completed{background-color:#28a745;color:#fff}.status-abandoned{background-color:#6c757d;color:#fff}.status-archived{background-color:#343a40;color:#fff}.calendar-day{position:relative;vertical-align:top;height:120px;min-height:120px;padding:0;border:1px solid #dee2e6;overflow:hidden;cursor:pointer;transition:all .2s ease}.calendar-day-inner{display:flex;flex-direction:column;height:100%;width:100%}.calendar-day.empty-day{background-color:#f8f9fa;cursor:default;pointer-events:none;border-color:#e9ecef}.calendar-day:hover{border-color:#007bff;box-shadow:0 2px 8px #007bff26;transform:translateY(-1px);z-index:2}.calendar-day.empty-day:hover{border-color:#e9ecef;box-shadow:none;transform:none}.calendar-day.selected-day{border-color:#007bff;box-shadow:0 0 0 2px #007bff4d;z-index:3}.calendar-day.today{border-color:#28a745;background-color:#28a7450d}.calendar-day.today:hover{border-color:#28a745;box-shadow:0 2px 8px #28a74533}.calendar-week-row.selected-week{position:relative;z-index:1}.calendar-week-row.selected-week .calendar-day,.calendar-week-row.selected-week .week-selector-cell{box-shadow:inset 0 0 0 3px #007bff;border-radius:.25rem}.calendar-day-header{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-bottom:1px solid #dee2e6;padding:.2rem .4rem;font-size:.75rem;font-weight:600;flex-shrink:0;transition:all .2s ease;display:flex;flex-direction:column;gap:1px;justify-content:space-between}.day-number-row{display:flex;justify-content:space-between;align-items:center}.calendar-day:hover .calendar-day-header{background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-bottom-color:#007bff}.calendar-day.today .calendar-day-header{background:linear-gradient(135deg,#e8f5e8,#c8e6c9);border-bottom-color:#28a745}.calendar-day-content{padding:.5rem;flex:1;overflow:hidden;transition:all .2s ease;display:flex;flex-direction:column;gap:.5rem}.calendar-day:hover .calendar-day-content{background-color:#007bff05}.day-time-summary{display:flex;justify-content:center;align-items:center;padding:.3rem .5rem;background:linear-gradient(90deg,#28a7451f,#1987541f);border-radius:.35rem;border:1px solid rgba(40,167,69,.25);flex-shrink:0}.hours-worked{color:#198754;display:flex;align-items:center;gap:.3rem;font-weight:700;font-size:.75rem}.hours-worked i{font-size:.7rem}.calendar-day:hover .day-time-summary{background:linear-gradient(90deg,#28a7452e,#1987542e);border-color:#28a74559;box-shadow:0 1px 3px #0000001a}.calendar-day.today .day-time-summary{background:linear-gradient(90deg,#28a74533,#19875433);border-color:#28a74566;box-shadow:0 1px 2px #28a74533}.day-work-summary{display:flex;gap:.25rem;font-size:.65rem;color:#495057}.punch-indicator{background:#28a745;color:#fff;padding:.1rem .3rem;border-radius:.2rem;font-size:.6rem}.task-hours{background:#007bff;color:#fff;padding:.1rem .3rem;border-radius:.2rem;font-size:.6rem}.status-badges{display:flex;gap:.2rem;margin-bottom:.3rem;flex-wrap:wrap}.status-badge{padding:.1rem .3rem;border-radius:.25rem;font-size:.6rem;font-weight:500;line-height:1}.task-bars{display:flex;flex-direction:column;gap:.2rem}.task-bar{height:6px;border-radius:2px;position:relative;overflow:hidden;box-shadow:0 1px 2px #0000001a}.task-bar-progress{height:100%;background:#fff6;transition:width .3s ease;border-radius:1px}.task-overflow{color:#6c757d;font-size:.6rem;margin-top:.2rem;text-align:center}.category-time-summary{background:#f8f9fa;border-radius:.5rem;padding:1rem;border:1px solid #e9ecef}.category-summary-grid{display:flex;flex-direction:column;gap:.5rem}.category-summary-item{display:flex;align-items:center;gap:.75rem;padding:.5rem;background:#fff;border-radius:.375rem;border:1px solid #e9ecef}.category-indicator{width:12px;height:12px;border-radius:50%;flex-shrink:0}.category-info{flex:1}.category-name{font-weight:600;font-size:.9rem;color:#495057}.category-stats{font-size:.8rem;color:#6c757d}.progress-task-card{border-radius:.5rem;overflow:hidden;margin-bottom:1rem;box-shadow:0 2px 8px #0000001a;border:1px solid #e9ecef;transition:box-shadow .2s ease,transform .2s ease}.progress-task-card:hover{box-shadow:0 4px 12px #00000026;transform:translateY(-1px)}.task-card-header{padding:.75rem;display:flex;justify-content:space-between;align-items:center;font-size:.85rem;font-weight:600}.task-card-header-actions{display:flex;align-items:center;gap:.5rem}.task-card-header-actions .btn{padding:.25rem .5rem;font-size:.8rem;line-height:1}.task-reason-badge{font-size:.7rem;padding:.25rem .5rem;border-radius:.25rem;background:#ffffff4d;font-weight:500;display:inline-flex;align-items:center;gap:.25rem}.status-info{display:flex;align-items:center;gap:.5rem}.status-label{color:inherit;font-weight:600}.urgency-indicator{font-size:.7rem;padding:.2rem .4rem;border-radius:.25rem;background:#fff3;font-weight:500}.urgency-high{background-color:#dc35454d!important}.urgency-med{background-color:#ffc1074d!important}.urgency-low{background-color:#28a7454d!important}.edit-task-btn{background:#ffffffe6;border:1px solid rgba(255,255,255,.5);border-radius:.375rem;padding:.25rem .5rem;font-size:.75rem;color:#495057;cursor:pointer;transition:all .2s ease;display:flex;align-items:center;gap:.25rem}.edit-task-btn:hover{background:#fff;border-color:#007bff;color:#007bff;transform:scale(1.05)}.task-card-body{padding:.75rem;background:#fff}.task-title{font-weight:600;margin-bottom:.75rem;color:#212529;line-height:1.4}.task-progress-section{margin-bottom:.75rem}.progress-bar{height:8px;background-color:#e9ecef;border-radius:4px;overflow:hidden;margin-bottom:.25rem}.progress-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);transition:width .3s ease}.progress-text{font-size:.8rem;color:#6c757d;font-weight:500}.today-hours{margin-top:.5rem;font-size:.8rem;color:#007bff;font-weight:500;display:flex;align-items:center;gap:.25rem}.task-meta{display:flex;flex-wrap:wrap;gap:.75rem;font-size:.8rem;color:#6c757d}.task-due,.task-category{display:flex;align-items:center;gap:.25rem}.overdue-text{color:#dc3545!important;font-weight:600}.no-tasks-message{text-align:center;padding:3rem 1rem}.tasks-section{margin-bottom:1rem}.header-title{margin:0;font-size:1.5rem;flex-shrink:0}.header-filters{flex:1;justify-content:center}.header-actions{display:flex;gap:.5rem;flex-shrink:0}.content-area{flex:1;padding:1.5rem}.quick-add-form{background-color:#fff;border:1px solid #dee2e6;border-radius:.375rem;padding:1rem}@media (max-width: 768px){.sidebar,.sidebar.collapsed{width:100%}.app-container{flex-direction:column}.header-bar{flex-direction:column;gap:1rem;padding:1rem}.header-filters{flex-direction:column;gap:.5rem}.header-title{font-size:1.25rem}.kanban-board{flex-direction:column}.kanban-lane{min-width:100%;margin-bottom:1rem}.sidebar-toggle{display:none}}.today-container{padding:20px}.today-card{background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid #e9ecef;border-radius:12px;box-shadow:0 4px 6px #00000012;transition:all .3s ease;height:100%}.today-card:hover{box-shadow:0 8px 25px #0000001a;transform:translateY(-2px)}.today-card-header{display:flex;align-items:center;padding:20px 20px 15px;border-bottom:1px solid #e9ecef;margin-bottom:0}.today-card-header h5{color:#495057;font-weight:600;margin:0}.today-card-header i{color:#6c757d;font-size:1.1em}.today-card-body{padding:20px;min-height:300px}.todos-list{max-height:400px;overflow-y:auto}.todo-item{display:flex;align-items:flex-start;padding:12px 16px;margin-bottom:8px;background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;transition:all .2s ease}.todo-item:hover{background:#e9ecef;border-color:#dee2e6}.todo-item.completed{opacity:.6;background:#f1f3f4;border-color:#d1d5db}.todo-item.completed .todo-title{text-decoration:line-through;color:#6c757d}.todo-item.completed .todo-text{text-decoration:line-through}.todo-checkbox{margin-right:12px;margin-top:2px}.todo-content{flex:1}.todo-title{font-weight:500;color:#495057;margin-bottom:4px}.todo-text{font-size:.9em;color:#6c757d;margin:0}.accomplishments-list{max-height:400px;overflow-y:auto}.accomplishment-item{padding:16px;margin-bottom:12px;background:linear-gradient(135deg,#fff3cd,#ffeaa7);border:1px solid #ffeaa7;border-radius:8px;transition:all .2s ease}.accomplishment-item:hover{box-shadow:0 4px 8px #ffeaa74d;transform:translateY(-1px)}.accomplishment-title{font-weight:600;color:#856404;margin-bottom:8px}.accomplishment-content{color:#856404;margin:0}.accomplishment-time{font-size:.8em;color:#6c757d;margin-top:8px}.today-tasks{max-height:300px;overflow-y:auto}.today-task-item{display:flex;align-items:center;padding:12px 16px;margin-bottom:8px;background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;transition:all .2s ease}.today-task-item:hover{background:#e9ecef;border-color:#dee2e6}.today-task-item.overdue{border-left:4px solid #dc3545;background:linear-gradient(135deg,#fff5f5,#fed7d7)}.today-task-urgency{width:8px;height:8px;border-radius:50%;margin-right:12px}.today-task-urgency.high{background:#dc3545}.today-task-urgency.med{background:#ffc107}.today-task-urgency.low{background:#28a745}.task-overview-filters{display:flex;justify-content:center;margin-bottom:20px}.task-overview-filters .btn-group .btn{padding:8px 16px;font-size:.9em;font-weight:500;border:1px solid #0d6efd;color:#0d6efd;background:#fff;transition:all .2s ease;position:relative;overflow:hidden}.task-overview-filters .btn-group .btn:hover{background:linear-gradient(135deg,#e7f1ff,#cce7ff);transform:translateY(-1px);box-shadow:0 4px 8px #0d6efd33}.task-overview-filters .btn-group .btn.active{background:linear-gradient(135deg,#0d6efd,#0b5ed7);color:#fff;border-color:#0d6efd;box-shadow:0 4px 12px #0d6efd4d}.task-overview-filters .btn-group .btn.active:hover{background:linear-gradient(135deg,#0b5ed7,#0a58ca);transform:translateY(-1px)}.task-overview-filters .btn-group .btn i{margin-right:6px}.today-task-item.due-today{border-left:4px solid #ffc107;background:linear-gradient(135deg,#fff9e6,#fffaf0)}.today-task-item .badge{font-size:.7em;padding:2px 6px}.today-task-item .text-end small{font-size:.75em;line-height:1.2}.today-task-item .text-end small:first-child{font-weight:500;color:#495057}@keyframes buttonPress{0%{transform:translateY(0)}50%{transform:translateY(1px)}to{transform:translateY(0)}}.task-overview-filters .btn:active{animation:buttonPress .1s ease}.work-container{max-width:1400px;margin:0 auto}.work-task-header{padding:20px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:8px;border:1px solid #dee2e6}.work-task-header h4{color:#495057;font-weight:600}.time-logs-list{max-height:200px;overflow-y:auto}.time-logs-list::-webkit-scrollbar{width:6px}.time-logs-list::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.time-logs-list::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.time-logs-list::-webkit-scrollbar-thumb:hover{background:#a8a8a8}#workTab{transition:opacity .2s ease}#workTab.active{opacity:1}#customDateContainer{background:#f8f9fa;border:1px solid #dee2e6;border-radius:4px;padding:8px;transition:all .3s ease}#customDateToggle:checked+label{color:#007bff!important;font-weight:500}.form-check-label{cursor:pointer;-webkit-user-select:none;user-select:none}.todo-form,.accomplishment-form{padding:16px;background:linear-gradient(135deg,#f8f9fa,#fff);border:1px solid #e9ecef;border-radius:8px;margin-bottom:16px;box-shadow:0 2px 4px #0000000d}.todo-form .input-group,.accomplishment-form .input-group{margin-bottom:8px}.todo-form input,.accomplishment-form input{border:1px solid #dee2e6;border-radius:6px 0 0 6px;padding:10px 12px;font-size:.95em;transition:all .2s ease}.todo-form input:focus,.accomplishment-form input:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}.todo-form .btn,.accomplishment-form .btn{border-radius:0 6px 6px 0;padding:10px 16px;transition:all .2s ease}.todo-details,.accomplishment-details{animation:slideDown .3s ease;overflow:hidden}.todo-details textarea,.accomplishment-details textarea{border:1px solid #dee2e6;border-radius:6px;padding:10px 12px;font-size:.9em;resize:vertical;min-height:60px;transition:border-color .2s ease}.todo-details textarea:focus,.accomplishment-details textarea:focus{border-color:#0d6efd;box-shadow:0 0 0 .2rem #0d6efd40;outline:none}.todo-form small,.accomplishment-form small{color:#6c757d;font-size:.8em;font-style:italic}@keyframes slideDown{0%{opacity:0;max-height:0;transform:translateY(-10px)}to{opacity:1;max-height:200px;transform:translateY(0)}}.todo-form .btn-primary:hover{background:linear-gradient(135deg,#0b5ed7,#0a58ca);transform:translateY(-1px);box-shadow:0 4px 8px #0d6efd4d}.accomplishment-form .btn-success:hover{background:linear-gradient(135deg,#198754,#157347);transform:translateY(-1px);box-shadow:0 4px 8px #1987544d}.todo-form input::placeholder,.accomplishment-form input::placeholder{color:#adb5bd;font-style:italic}.todo-details textarea::placeholder,.accomplishment-details textarea::placeholder{color:#adb5bd;font-style:italic}.delete-confirmation{padding:12px 16px;background:linear-gradient(135deg,#fff3cd,#ffeaa7);border:1px solid #ffc107;border-radius:6px;animation:slideIn .3s ease}.todo-item.deleting,.accomplishment-item.deleting{transform:scale(.98);transition:transform .2s ease}.delete-confirmation .btn{padding:4px 12px;font-size:.85em;border-radius:4px}.delete-confirmation .btn-danger{background:linear-gradient(135deg,#dc3545,#c82333);border:none;color:#fff}.delete-confirmation .btn-danger:hover{background:linear-gradient(135deg,#c82333,#a71e2a);transform:translateY(-1px);box-shadow:0 4px 8px #dc35454d}.delete-confirmation .btn-outline-secondary{border-color:#6c757d;color:#6c757d}.delete-confirmation .btn-outline-secondary:hover{background:#6c757d;color:#fff;transform:translateY(-1px)}@keyframes slideIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.error-toast{position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#f8d7da,#f5c6cb);border:1px solid #f5c6cb;border-radius:8px;padding:12px 16px;box-shadow:0 4px 12px #00000026;z-index:9999;opacity:0;transform:translate(100%);transition:all .3s ease;max-width:300px}.error-toast.show{opacity:1;transform:translate(0)}.error-toast .fas{color:#721c24}.error-toast span{color:#721c24;font-weight:500}.calendar-table{table-layout:fixed;border-collapse:separate;border-spacing:2px;width:100%;min-width:800px}.calendar-due-badge{background:#007bff;color:#fff;border-radius:12px;padding:2px 8px;font-size:.7rem;font-weight:600;display:inline-flex;align-items:center;gap:2px}.calendar-time-indicators{display:flex;gap:2px;flex-wrap:nowrap;align-items:center;justify-content:flex-start;overflow:hidden}.calendar-task-time{background:#28a745;color:#fff;border-radius:8px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:1px;white-space:nowrap}.calendar-punch-time{background:#ffc107;color:#212529;border-radius:8px;padding:1px 4px;font-size:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:1px;white-space:nowrap}.calendar-progress-bars{display:flex;flex-direction:column;gap:1px;height:100%;min-height:73px;overflow:hidden;padding:2px}.mini-progress-bar{height:14px;background:#0000001a;border-radius:3px;position:relative;margin-bottom:3px;overflow:hidden}.mini-progress-bar.no-estimate{height:12px}.mini-progress-fill{height:100%;position:absolute;left:0;top:0;transition:width .3s ease;border-radius:2px 0 0 2px}.mini-progress-remaining{height:100%;position:absolute;top:0;background:#ffc1074d;border-radius:0 2px 2px 0}.mini-progress-fill.status-inprogress{background:#0d6efd}.mini-progress-fill.status-completed{background:#28a745}.mini-progress-fill.status-estimated{background:#17a2b8}.mini-progress-fill.status-ready{background:#6c757d}.mini-progress-fill.status-blocked{background:#dc3545}.mini-progress-fill.status-onhold,.mini-progress-fill.status-backburner{background:#ffc107}.due-badges-container{display:flex;gap:2px;flex-wrap:wrap;margin-left:4px}.due-task-badge{display:inline-flex;align-items:center;font-size:8px;width:10px;height:10px;border-radius:50%;transition:all .2s ease}.due-task-badge i{font-size:8px}.due-task-badge.status-inprogress{color:#0d6efd}.due-task-badge.status-completed{color:#28a745}.due-task-badge.status-estimated{color:#17a2b8}.due-task-badge.status-ready{color:#6c757d}.due-task-badge.status-blocked{color:#dc3545}.due-task-badge.status-onhold,.due-task-badge.status-backburner{color:#ffc107}.due-task-badge.urgency-high{font-size:10px;width:12px;height:12px}.due-task-badge.overdue-badge{color:#e91e63!important;animation:pulse-badge 1.5s infinite}@keyframes pulse-badge{0%,to{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.2)}}.calendar-task-bar{border-radius:3px;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,.1);display:flex;transition:all .2s ease;flex-shrink:0}.calendar-task-bar.today-tomorrow{border-width:2px;animation:pulse-urgent 2s infinite}.calendar-task-bar.overdue{border-color:#dc3545!important;border-width:2px}.calendar-task-bar.in-progress-no-time{border-style:dashed;border-width:2px}.task-bar-progress{height:100%;background:#ffffff4d;transition:width .3s ease}.task-bar-remaining{height:100%;flex:1;background:#0000001a}.urgency-high-next-week{background:#fcc}.urgency-high-this-week{background:#ff6b6b}.urgency-high-today-tomorrow{background:#e74c3c}.urgency-med-next-week{background:#fff3cd}.urgency-med-this-week{background:#ffd93d}.urgency-med-today-tomorrow{background:#f39c12}.urgency-low-next-week{background:#d4edda}.urgency-low-this-week{background:#6bcf7f}.urgency-low-today-tomorrow{background:#27ae60}@keyframes pulse-urgent{0%,to{opacity:1;transform:scale(1)}50%{opacity:.8;transform:scale(1.02)}}.calendar-table .week-selector-header{width:60px;min-width:60px;max-width:60px}.calendar-table th:not(.week-selector-header){width:calc((100% - 60px) / 7)}.calendar-table .week-selector-cell{width:60px;min-width:60px;max-width:60px}.calendar-table .calendar-day{width:calc((100% - 60px) / 7);max-width:calc((100% - 60px) / 7)}.calendar-day{position:relative;height:125px;vertical-align:top;padding:8px;border:1px solid #e9ecef;border-radius:8px;background:linear-gradient(135deg,#fff,#f8f9fa);transition:all .2s ease;cursor:pointer}.calendar-day:hover{background:linear-gradient(135deg,#f8f9fa,#e9ecef);box-shadow:0 4px 8px #0000001a}.calendar-day.today{background:linear-gradient(135deg,#e3f2fd,#bbdefb);border-color:#2196f3;box-shadow:0 0 0 2px #2196f34d}.calendar-day-number{font-weight:600;color:#495057;margin-bottom:8px;font-size:1.1em}.calendar-indicators{display:flex;flex-wrap:wrap;gap:4px}.day-indicator{display:inline-block;padding:2px 6px;border-radius:12px;font-size:.75em;font-weight:500;line-height:1;white-space:nowrap}.day-indicator.urgent{background:#dc3545;color:#fff;animation:pulse 2s infinite}.day-indicator.overdue{background:#fd7e14;color:#fff;font-weight:700}.day-indicator.tasks{background:#6c757d;color:#fff}.day-indicator.hours{background:#198754;color:#fff}.day-indicator.todos{background:#0d6efd;color:#fff}.day-indicator.accomplishments{background:#ffc107;color:#212529}@keyframes pulse{0%,to{opacity:1}50%{opacity:.7}}.calendar-tooltip{position:absolute;background:#000000e6;color:#fff;padding:12px 16px;border-radius:8px;font-size:.9em;max-width:300px;z-index:1000;pointer-events:none;opacity:0;transition:opacity .3s ease}.calendar-tooltip.show{opacity:1}.tooltip-content h6{margin:0 0 8px;color:#ffc107;border-bottom:1px solid #444;padding-bottom:4px}.tooltip-content .tooltip-section{margin-bottom:8px}.tooltip-content .tooltip-section:last-child{margin-bottom:0}.tooltip-content .tooltip-label{font-weight:600;color:#adb5bd;margin-bottom:4px}.tooltip-content .task-item{margin-left:8px;margin-bottom:2px}.tooltip-content .urgency-high{color:#ff6b6b}.tooltip-content .urgency-med{color:#ffd93d}.tooltip-content .urgency-low{color:#6bcf7f}.calendar-header{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6;border-radius:6px;padding:.75rem 1rem;box-shadow:0 1px 3px #00000014;display:flex;align-items:center;justify-content:space-between;gap:1.5rem;margin-bottom:1rem}.calendar-nav-section{display:flex;align-items:center;gap:.5rem}.calendar-nav-section h5{color:#495057;font-weight:600;font-size:1.1rem;min-width:160px;text-align:center;margin:0}.calendar-filters-compact{display:flex;align-items:center;gap:.5rem}.calendar-filters-compact .form-select{min-width:110px;font-size:.875rem}.month-summary-compact{display:flex;align-items:center;gap:1.25rem}.month-summary-compact .summary-item{display:flex;align-items:center;gap:.4rem;font-size:.9rem;font-weight:600}.month-summary-compact .summary-item i{font-size:1rem}.month-summary-compact .summary-value{color:#495057}.kanban-board{display:flex;gap:.75rem;height:100%;overflow-x:auto;padding:.5rem 0;width:100%;max-width:100%;box-sizing:border-box}.kanban-lane{flex:1;min-width:200px;width:0;background:linear-gradient(145deg,#f8f9fa,#e9ecef);border-radius:12px;box-shadow:0 4px 6px #00000012;display:flex;flex-direction:column;overflow:hidden}.kanban-lane-header{background:linear-gradient(135deg,#6c757d,#495057);color:#fff;padding:1rem;text-align:center;font-weight:600;position:relative}.kanban-lane-header h5{margin:0;font-size:1.1rem;color:#495057;font-weight:600}.lane-counter{background:#fff;border:1px solid #dee2e6;color:#6c757d;border-radius:12px;padding:.25rem .5rem;font-size:.8rem;position:absolute;top:.5rem;right:.5rem}.kanban-lane-content{flex:1;padding:.5rem 1rem 1rem;overflow-y:auto;min-height:200px}.kanban-card{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:1rem;padding:1rem;cursor:grab;transition:all .3s ease;border-left:4px solid #6c757d;position:relative;overflow:hidden}.kanban-card:hover{transform:translateY(-2px);box-shadow:0 4px 12px #00000026}.kanban-card.dragging{opacity:.5;transform:rotate(5deg);cursor:grabbing}.kanban-card.urgency-high{border-left-color:#dc3545;background:linear-gradient(135deg,#fff,#fff5f5)}.kanban-card.urgency-med{border-left-color:#ffc107;background:linear-gradient(135deg,#fff,#fffdf0)}.kanban-card.urgency-low{border-left-color:#28a745;background:linear-gradient(135deg,#fff,#f0fff4)}.kanban-card.overdue{background:linear-gradient(135deg,#fff,#ffebee);border-left-color:#e91e63;animation:pulse-overdue 2s infinite}@keyframes pulse-overdue{0%,to{opacity:1}50%{opacity:.8}}.card-notes-indicator{color:#ffc107;font-size:.9em;cursor:help;transition:color .2s ease}.card-notes-indicator:hover{color:#ffb300}.card-status-indicator{display:inline-flex;align-items:center;gap:.25rem;font-size:.7rem;font-weight:600;padding:.15rem .4rem;border-radius:.25rem;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.3px;white-space:nowrap;flex-shrink:0}.card-status-indicator span{display:inline}@media (max-width: 1400px){.card-status-indicator span{display:none}.card-status-indicator{padding:.25rem .35rem;gap:0}}.card-status-indicator.status-completed{background-color:#28a7451a;color:#28a745;border:1px solid rgba(40,167,69,.3)}.card-status-indicator.status-abandoned{background-color:#dc35451a;color:#dc3545;border:1px solid rgba(220,53,69,.3)}.card-status-indicator.status-archived{background-color:#6c757d1a;color:#6c757d;border:1px solid rgba(108,117,125,.3)}.card-status-indicator.status-blocked{background-color:#dc35451a;color:#dc3545;border:1px solid rgba(220,53,69,.3)}.card-status-indicator.status-backburner{background-color:#ffc1071a;color:#ffc107;border:1px solid rgba(255,193,7,.3)}.card-status-indicator.status-onhold{background-color:#17a2b81a;color:#17a2b8;border:1px solid rgba(23,162,184,.3)}.card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.25rem}.card-title{font-weight:600;font-size:1rem;margin-bottom:0;color:#2c3e50;line-height:1.3;cursor:pointer;flex:1;margin-right:.5rem}.card-edit-btn{padding:.2rem .4rem;font-size:.7rem;border:1px solid #17a2b8;background:transparent;color:#17a2b8;border-radius:3px;cursor:pointer;transition:all .2s ease;flex-shrink:0}.card-edit-btn:hover{background-color:#17a2b8;color:#fff}.card-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.85rem;color:#6c757d;gap:.5rem;flex-wrap:wrap}.card-meta-right{display:flex;align-items:center;gap:.5rem;flex-shrink:0}.card-time-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem;font-size:.85rem;color:#6c757d}.card-due-date{display:flex;align-items:center;gap:.25rem}.card-due-date.overdue{color:#e91e63;font-weight:600}.card-due-date.due-soon{color:#ff9800;font-weight:600}.card-hours{display:flex;align-items:center;gap:.25rem;font-weight:500}.progress-bar-container{margin-bottom:.75rem}.progress-bar{height:6px;background:#e9ecef;border-radius:3px;overflow:hidden}.progress-bar-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);transition:width .3s ease;border-radius:3px}.progress-text{font-size:.75rem;color:#6c757d;margin-top:.25rem}.card-quick-actions{display:flex;opacity:0;transition:opacity .2s ease;margin-top:.5rem}.kanban-card:hover .card-quick-actions{opacity:1}.quick-time-buttons{display:flex;gap:.25rem;width:100%}.quick-action-btn{padding:.25rem .5rem;font-size:.75rem;border:none;border-radius:4px;cursor:pointer;transition:all .2s ease;flex:1;min-width:0;white-space:nowrap}.quick-time-btn{max-width:4rem}.quick-action-btn:hover{transform:scale(1.05)}.kanban-lane-header{background:#f8f9fa;border:1px solid #dee2e6;border-bottom:3px solid #6c757d;padding:12px 16px;border-radius:6px 6px 0 0;margin-bottom:8px;transition:all .2s ease}.lane-backlog .kanban-lane-header{border-bottom-color:#6c757d}.lane-inprogress .kanban-lane-header{border-bottom-color:#007bff}.lane-blocked .kanban-lane-header{border-bottom-color:#ffc107}.lane-done .kanban-lane-header{border-bottom-color:#28a745}.kanban-lane-header:hover{background:#e9ecef;box-shadow:0 2px 4px #0000001a}.kanban-lane.drag-over{background:linear-gradient(145deg,#e3f2fd,#bbdefb);transform:scale(1.02)}.drop-zone{min-height:20px;border:2px dashed transparent;border-radius:8px;transition:all .3s ease}.drop-zone.drag-over{min-height:60px;border-color:#007bff;background:#007bff1a}.status-history-entry{min-height:44px;border-left:2px solid transparent;margin-left:-2px;padding:8px 0 8px 2px}.status-history-entry.recent-status{border-left-color:#007bff;background:#007bff05;border-radius:4px;padding-left:8px;margin-left:-8px}.status-timeline-dot{position:relative}.status-timeline-dot:after{content:"";position:absolute;left:50%;top:20px;transform:translate(-50%);width:2px;height:30px;background:#dee2e6;z-index:-1}.status-history-entry:last-child .status-timeline-dot:after{display:none}@media (max-width: 576px){.status-history-entry .d-flex.flex-column.flex-md-row{align-items:stretch!important}.status-history-entry .badge{align-self:flex-start;margin-bottom:4px}.status-history-entry small{font-size:.7rem!important;line-height:1.2}}.estimation-panel .form-range{margin:8px 0}.estimation-panel .form-range::-webkit-slider-thumb{background:#007bff}.estimation-panel .form-range::-moz-range-thumb{background:#007bff;border:none}.estimation-panel .small{font-size:.8rem}#velocityPrediction{background:#fffc;min-height:80px;padding:.5rem}@media (max-width: 768px){.estimation-panel .col-md-4{margin-bottom:1rem}}.punch-card-container{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:15px;padding:20px;box-shadow:0 4px 15px #0000001a}.punch-card{background:#fff;border:2px dashed #6c757d;border-radius:10px;padding:15px;max-width:400px;margin:0 auto;font-family:Courier New,monospace}.punch-card-header{border-bottom:1px solid #dee2e6;padding-bottom:10px;margin-bottom:15px}.card-date{font-size:.9rem;color:#6c757d}.time-slots{min-height:60px}.time-slots::-webkit-scrollbar{width:6px}.time-slots::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.time-slots::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.time-slots::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.time-slot{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px dotted #dee2e6;font-size:.9rem}.time-slot:last-child{border-bottom:none}.time-slot .time{font-weight:700;color:#495057}.time-slot .activity{color:#6c757d;font-style:italic}.current-status{background:#0d6efd1a;border-radius:15px;padding:20px}.status-display{display:flex;flex-direction:column;align-items:center;gap:10px}.status-icon{font-size:2.5rem;height:80px;width:80px;display:flex;align-items:center;justify-content:center;background:#ffffffe6;border-radius:50%;box-shadow:0 2px 10px #0000001a}.status-text{font-size:1.2rem;font-weight:600;color:#495057}.status-time{font-size:1rem;color:#6c757d}.punch-btn{min-width:200px;min-height:60px;font-size:1.1rem;font-weight:600;border-radius:15px;transition:all .3s ease}.punch-btn.btn-success{background:linear-gradient(135deg,#28a745,#20c997);border:none;box-shadow:0 4px 15px #28a7454d}.punch-btn.btn-danger{background:linear-gradient(135deg,#dc3545,#fd7e14);border:none;box-shadow:0 4px 15px #dc35454d}.punch-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px #0003}.interruption-buttons .btn{border-radius:10px;padding:8px 10px;transition:all .2s ease;font-size:.9rem}.interruption-buttons .btn:hover{transform:translateY(-1px)}.summary-item{padding:10px}.summary-value{font-size:1.2rem;font-weight:700;color:#495057}.summary-label{font-size:.85rem;color:#6c757d;text-transform:uppercase;letter-spacing:.5px}.punched-in{background:linear-gradient(135deg,#28a745,#20c997);color:#fff}.punched-out{background:linear-gradient(135deg,#6c757d,#adb5bd);color:#fff}.on-break{background:linear-gradient(135deg,#ffc107,#fd7e14);color:#fff}.toast{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:#fffffff2;border:1px solid rgba(0,0,0,.1);box-shadow:0 8px 32px #0000001a}.toast-success{border-left:4px solid #28a745}.toast-warning{border-left:4px solid #ffc107}.toast-error{border-left:4px solid #dc3545}.toast-info{border-left:4px solid #17a2b8}.toast-header{background:#f8f9facc;border-bottom:1px solid rgba(0,0,0,.1)}.toast-body{font-size:.95rem}.validation-message{display:none;margin-top:.5rem;padding:.5rem;border-radius:.375rem;font-size:.875rem;animation:fadeIn .3s ease-in-out}.validation-message.show{display:block}.validation-message.warning{background-color:#fff3cd;border:1px solid #ffeaa7;color:#856404}.validation-message.error{background-color:#f8d7da;border:1px solid #f5c6cb;color:#721c24}@keyframes fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.day-indicator.punch-clock{background-color:#17a2b8;color:#fff;font-size:.8rem}.day-indicator.punch-clock:hover{background-color:#138496}.metric-small{padding:10px}.metric-small .metric-value{font-size:1rem;font-weight:600;color:#495057}.metric-small .metric-label{font-size:.75rem;color:#6c757d;text-transform:uppercase;letter-spacing:.5px}.category-item{transition:all .2s ease}.category-item:hover{background-color:#f8f9fa}.category-item .drag-handle{opacity:.5;transition:opacity .2s ease}.category-item:hover .drag-handle{opacity:1}.category-item .form-control{border:1px solid #dee2e6}.category-item .form-control:focus{border-color:#86b7fe;box-shadow:0 0 0 .25rem #0d6efd40}#categoriesContainer{background-color:#fafbfc}#categoriesContainer::-webkit-scrollbar{width:8px}#categoriesContainer::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px}#categoriesContainer::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px}#categoriesContainer::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.list-group-item.active,.list-group-item:hover{background-color:#f8f9fa;border-color:#dee2e6}.category-lists-selector{max-height:200px;overflow-y:auto;border:1px solid #dee2e6;border-radius:.375rem;padding:.75rem;background-color:#fafbfc}.category-lists-selector .form-check{margin-bottom:.75rem}.category-lists-selector .form-check:last-child{margin-bottom:0}.category-lists-selector .form-check-label{line-height:1.4;cursor:pointer}.category-lists-selector .badge{font-size:.7em}.category-selector{margin-top:.5rem}#timeLogTaskDisplay{background-color:#f8f9fa!important;border:1px solid #dee2e6}.quick-time{transition:all .2s ease}.quick-time:hover{transform:translateY(-1px)}.quick-time.active{background-color:#198754;border-color:#198754;color:#fff}#timeLogModal .d-flex .quick-time{min-width:50px;padding:6px 12px;font-size:.875rem}.time-logs-list .badge{font-size:.7em}.time-logs-list .fw-bold{color:#495057}.time-logs-list .border-bottom:last-child{border-bottom:none!important}.time-logs-list .delete-log-btn{opacity:.6;transition:opacity .2s ease}.time-logs-list .border-bottom:hover .delete-log-btn{opacity:1}.report-section .progress{background-color:#e9ecef}.report-section .card{border:1px solid #dee2e6}.report-section .card-header{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.report-section .table th{background-color:#f8f9fa;border-top:none}.estimation-panel{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6!important}.estimation-panel .form-range{cursor:pointer}.estimation-panel .form-range::-webkit-slider-thumb{background-color:#0d6efd;cursor:pointer}.estimation-panel .form-range::-moz-range-thumb{background-color:#0d6efd;cursor:pointer}.estimation-panel .form-range:focus::-webkit-slider-thumb{box-shadow:0 0 0 .25rem #0d6efd40}.estimation-panel .form-range:focus::-moz-range-thumb{box-shadow:0 0 0 .25rem #0d6efd40}#velocityPrediction{min-height:80px;display:flex;align-items:center;justify-content:center}#velocityPrediction .row{width:100%}#velocityPrediction .text-muted{font-size:.875rem}#velocityPrediction .fs-6{font-size:1.1rem!important;font-weight:600}#confidenceHint{font-size:.75rem;color:#6c757d;margin-top:.25rem}.estimation-panel label.small{font-weight:600;color:#495057}.work-session-section{padding-top:1rem;border-top:1px solid #e9ecef}.work-session-info{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6;border-radius:.375rem;padding:1rem}.work-session-row:not(:last-child){border-bottom:1px solid #dee2e6}.work-session-label{font-weight:500;color:#495057}.work-session-value{font-family:Courier New,monospace;color:#212529}.no-session-message{padding:1.5rem;background:#f8f9fa;border:1px dashed #dee2e6;border-radius:.375rem}.activity-timeline{display:flex;flex-direction:column;gap:.75rem}.activity-item{display:flex;align-items:flex-start;gap:.75rem;padding:.5rem;border-radius:.375rem;transition:background-color .2s}.activity-item:hover{background-color:#00000005}.activity-item.active{background-color:#28a7450d;border-left:3px solid #28a745;padding-left:calc(.5rem - 3px)}.activity-icon{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:.875rem;flex-shrink:0}.activity-details{flex:1}.activity-header{display:flex;align-items:center;margin-bottom:.25rem}.activity-time{font-size:.813rem}.app-container{display:flex;min-height:100vh}.sidebar{width:320px;padding:1rem;flex-shrink:0;transition:width .3s ease,padding .3s ease;overflow-x:hidden;position:relative}.sidebar.collapsed{width:60px;padding:1rem .5rem}.sidebar.collapsed .sidebar-content{opacity:0;pointer-events:none}.sidebar.collapsed .sidebar-nav{opacity:1;pointer-events:all}.sidebar-toggle{position:absolute;top:1rem;right:.5rem;border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.8rem;z-index:10;transition:all .2s ease}.sidebar-toggle:hover{transform:scale(1.1)}.sidebar-nav{display:flex;flex-direction:column;gap:.5rem;margin-top:3rem;transition:opacity .3s ease}.sidebar.collapsed .sidebar-nav{margin-top:4rem}.sidebar-nav-item{padding:.75rem;border-radius:.375rem;cursor:pointer;transition:all .2s ease;text-align:center;font-weight:500;display:flex;align-items:center;gap:.5rem;white-space:nowrap}.sidebar.collapsed .sidebar-nav-item{justify-content:center;padding:.75rem .5rem}.sidebar.collapsed .sidebar-nav-item .nav-text{display:none}.sidebar-nav-item:hover{transform:translate(4px)}.sidebar.collapsed .sidebar-nav-item:hover{transform:translate(0) scale(1.05)}.sidebar-content{transition:opacity .3s ease}.main-content{flex:1;padding:2rem;overflow-y:auto}.task-card{margin-bottom:1rem}.action-btn{margin-right:.5rem}.due-badge{font-size:.9rem}.summary-card{margin-bottom:.75rem!important}.summary-card .card-body{padding:.5rem 1rem}.summary-card h5{font-size:1rem;margin-bottom:.25rem;font-weight:600}.summary-card p{margin-bottom:0;font-size:.9rem}.sortable:hover{cursor:pointer;text-decoration:underline}.editable{cursor:pointer;padding:2px 4px;border-radius:3px;transition:background-color .2s}.editing{border:1px solid #ffeaa7}.task-actions{opacity:0;transition:opacity .2s}.task-card:hover .task-actions{opacity:1}.quick-time-btn{margin:0 2px}.calendar-table{width:100%;table-layout:fixed}.calendar-table th,.calendar-table td{text-align:center;vertical-align:top}.calendar-table td{height:100px;border:1px solid}.task-event{padding:2px 5px;margin:2px;border-radius:3px;cursor:pointer}.calendar-split-view{display:flex;gap:1rem;height:calc(100vh - 150px)}.calendar-grid-section{flex:1;overflow-y:auto}.calendar-detail-section{width:400px;overflow-y:auto;padding:1rem;border-radius:.5rem}.calendar-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;padding:1rem;border-radius:.5rem;gap:1rem}.calendar-controls h3{margin:0;font-size:1.5rem;font-weight:600}.calendar-nav-buttons{display:flex;gap:.5rem;align-items:center}.calendar-filters{display:flex;gap:.5rem;flex-wrap:wrap}.calendar-day-cell{padding:.5rem;min-height:120px;position:relative;cursor:pointer;transition:all .2s ease}.calendar-day-cell:hover{transform:translateY(-2px)}.calendar-day-number{font-weight:600;font-size:.9rem;margin-bottom:.25rem}.calendar-day-tasks{font-size:.75rem;display:flex;flex-direction:column;gap:2px}.calendar-task-indicator{padding:2px 4px;border-radius:3px;font-size:.7rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.calendar-hours-badge{position:absolute;bottom:.25rem;right:.25rem;font-size:.65rem;padding:.15rem .4rem;border-radius:.25rem;font-weight:600}.progress-task-card{margin-bottom:1rem;border-radius:.5rem;overflow:hidden;transition:all .2s ease}.progress-task-card:hover{transform:translateY(-2px)}.task-card-header{padding:.75rem;display:flex;justify-content:space-between;align-items:center;gap:.5rem}.task-card-header-actions,.status-info{display:flex;gap:.5rem;align-items:center}.status-label{font-weight:600;font-size:.85rem}.urgency-indicator{font-size:.75rem;padding:.15rem .5rem;border-radius:.25rem;font-weight:600;text-transform:uppercase}.task-reason-badge{font-size:.7rem;padding:.25rem .5rem;border-radius:.25rem;font-weight:500;display:inline-flex;align-items:center;gap:.25rem}.card-badges{display:flex;gap:.5rem;padding:0 .75rem;flex-wrap:wrap}.badge-project,.badge-phase{font-size:.75rem;padding:.25rem .6rem;border-radius:.25rem;font-weight:500}.task-card-body{padding:.75rem}.task-title{font-weight:600;margin-bottom:.5rem;font-size:.95rem;line-height:1.4}.task-progress-section{margin-top:.5rem}.progress-bar-container{margin-bottom:.5rem}.progress-label{font-size:.75rem;margin-bottom:.25rem;display:flex;justify-content:space-between}.progress{height:8px;border-radius:4px}.task-dates{font-size:.75rem;display:flex;gap:1rem;margin-top:.5rem}.kanban-board{display:flex;gap:1rem;overflow-x:auto;padding:1rem;min-height:500px}.kanban-column{flex:0 0 300px;display:flex;flex-direction:column;border-radius:.5rem;padding:1rem;max-height:calc(100vh - 200px)}.kanban-column-header{font-weight:600;font-size:1.1rem;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:2px solid;display:flex;justify-content:space-between;align-items:center}.task-count-badge{font-size:.85rem;padding:.25rem .6rem;border-radius:.25rem;font-weight:500}.kanban-column-tasks{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:.75rem}.kanban-task-card{border-radius:.375rem;padding:.75rem;cursor:pointer;transition:all .2s ease}.kanban-task-card:hover{transform:translateY(-2px)}.kanban-task-title{font-weight:600;margin-bottom:.5rem;font-size:.9rem}.kanban-task-meta{font-size:.75rem;display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}.board-detail-pane{width:400px;padding:1.5rem;border-radius:.5rem;overflow-y:auto;max-height:calc(100vh - 200px)}.board-detail-empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem;text-align:center}.board-detail-empty i{font-size:3rem;margin-bottom:1rem;opacity:.3}.detail-task-title{font-size:1.25rem;font-weight:600;margin-bottom:1rem}.detail-task-badges{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}.detail-metrics-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin-bottom:1.5rem}.detail-metric{padding:.75rem;border-radius:.375rem;text-align:center}.detail-metric-label{font-size:.75rem;font-weight:500;text-transform:uppercase;margin-bottom:.25rem;opacity:.7}.detail-metric-value{font-size:1.25rem;font-weight:700}.detail-section{margin-bottom:1.5rem}.detail-section-title{font-weight:600;font-size:.9rem;margin-bottom:.5rem;text-transform:uppercase;letter-spacing:.5px}.detail-description,.detail-notes{font-size:.9rem;line-height:1.6;padding:.75rem;border-radius:.375rem}.detail-status-history,.detail-time-logs{display:flex;flex-direction:column;gap:.5rem}.detail-history-item,.detail-log-item{padding:.5rem .75rem;border-radius:.375rem;font-size:.85rem;display:flex;justify-content:space-between;align-items:center}.detail-history-date,.detail-log-date{font-size:.75rem;opacity:.7}.estimation-panel{padding:1.5rem;border-radius:.5rem;margin-bottom:1.5rem}.estimation-title{font-size:1.1rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}.slider-group{margin-bottom:1.25rem}.slider-label{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-weight:500}.slider-value{font-weight:700;font-size:1.1rem}.form-range{width:100%;height:8px;cursor:pointer}.form-range:focus{outline:none}.form-range::-webkit-slider-thumb{width:20px;height:20px;border-radius:50%;cursor:pointer;transition:all .2s ease}.form-range::-webkit-slider-thumb:hover{transform:scale(1.2)}.form-range::-moz-range-thumb{width:20px;height:20px;border-radius:50%;cursor:pointer;transition:all .2s ease;border:none}.form-range::-moz-range-thumb:hover{transform:scale(1.2)}.scale-hint{font-size:.8rem;margin-top:.25rem;font-style:italic}#velocityPrediction{margin-top:1.5rem;padding:1rem;border-radius:.5rem;font-size:.95rem;text-align:center;display:flex;flex-direction:column;align-items:center;gap:.5rem}#velocityPrediction strong{font-size:1.2rem}.work-session-section{padding-top:1rem;border-top:1px solid}.work-session-info{border-radius:.375rem;padding:1rem;border:1px solid}.work-session-row{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0}.work-session-row:not(:last-child){border-bottom:1px solid}.work-session-label{font-weight:500}.work-session-value{font-family:Courier New,monospace}.no-session-message{padding:1.5rem;border:1px dashed;border-radius:.375rem}.velocity-section{margin-top:2rem;padding:1.5rem;border-radius:.5rem}.velocity-metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}.velocity-metric{padding:1rem;border-radius:.375rem;text-align:center}.velocity-metric-label{font-size:.85rem;font-weight:500;text-transform:uppercase;margin-bottom:.5rem;opacity:.8}.velocity-metric-value{font-size:1.75rem;font-weight:700}.velocity-accuracy{margin-top:1.5rem;padding:1rem;border-radius:.375rem}.accuracy-bars{display:flex;flex-direction:column;gap:.75rem;margin-bottom:1rem}.accuracy-bar-row{display:flex;align-items:center;gap:1rem}.accuracy-label{width:120px;font-size:.85rem;font-weight:500}.accuracy-bar-container{flex:1;height:24px;border-radius:4px;overflow:hidden;position:relative}.accuracy-bar{height:100%;display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:600;transition:width .3s ease}.accuracy-percentage{width:50px;text-align:right;font-weight:600;font-size:.9rem}.velocity-interpretation{margin-top:1.5rem;padding:1rem;border-radius:.375rem;font-size:.9rem;line-height:1.6}.velocity-interpretation h5{margin-bottom:.75rem;font-size:1rem;font-weight:600}.velocity-interpretation ul{margin-left:1.5rem;margin-bottom:0}.velocity-interpretation li{margin-bottom:.5rem}@media (max-width: 768px){.sidebar{width:250px}.main-content{padding:1rem}.calendar-split-view{flex-direction:column;height:auto}.calendar-detail-section{width:100%}.kanban-board{flex-direction:column}.kanban-column{flex:1 1 auto}.board-detail-pane{width:100%}.detail-metrics-grid{grid-template-columns:1fr}}.card-header-actions{display:flex;align-items:center;gap:.5rem;margin-left:auto}.task-card.charge-active{position:relative;border:2px solid rgba(102,126,234,.4);box-shadow:0 0 8px #667eea4d}.charge-meter-indicator{display:flex;align-items:center;gap:.35rem;padding:.25rem .4rem;background:transparent;border-radius:4px;font-size:.7rem;cursor:help;transition:all .2s ease}.charge-meter-indicator:hover{transform:scale(1.05)}.charge-meter{display:flex;gap:2px;align-items:center;padding:2px;border-radius:3px;background:transparent}.charge-bar{width:5px;height:16px;background:#fff3;border-radius:2px;transition:all .3s ease;box-shadow:inset 0 0 2px #0000004d}.charge-bar.active{box-shadow:0 0 4px currentColor,inset 0 0 2px #ffffff4d}.charge-meter.dim-green .charge-bar.active,.charge-meter.medium-green .charge-bar.active,.charge-meter.bright-green .charge-bar.active{background:linear-gradient(to top,#4d8b2a,#5db535);color:#5db535;animation:bar-pulse-bright 1.5s ease-in-out infinite}.charge-meter.brightest-green .charge-bar.active{background:linear-gradient(to top,#5db535,#6fd642);color:#6fd642;animation:bar-pulse-full 1s ease-in-out infinite}.charge-meter.orange .charge-bar.active{background:linear-gradient(to top,#ff8c00,orange);color:orange;animation:bar-pulse-overcharge .8s ease-in-out infinite}.charge-meter.red .charge-bar.active{background:linear-gradient(to top,#dc143c,#f44);color:#f44;animation:bar-pulse-danger .5s ease-in-out infinite}.charge-timer{display:none;font-family:Courier New,monospace;font-size:.7rem;font-weight:700;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.8);letter-spacing:.5px;min-width:40px;order:-1}.charge-meter-indicator:hover .charge-timer{display:block}@keyframes bar-pulse-medium{0%,to{opacity:1}50%{opacity:.8}}@keyframes bar-pulse-bright{0%,to{opacity:1;transform:scaleY(1)}50%{opacity:.9;transform:scaleY(1.05)}}@keyframes bar-pulse-full{0%,to{opacity:1;transform:scaleY(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.1);filter:brightness(1.2)}}@keyframes bar-pulse-overcharge{0%,to{opacity:1;transform:scaleY(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.15);filter:brightness(1.3)}}@keyframes bar-pulse-danger{0%,to{opacity:1;transform:scaleY(1) scaleX(1);filter:brightness(1)}50%{opacity:1;transform:scaleY(1.2) scaleX(1.1);filter:brightness(1.5)}}.task-card.rocket-fueling{position:relative;border:2px solid #667eea;box-shadow:0 0 0 1px #667eea33;background:linear-gradient(135deg,#667eea08,#764ba208)}.task-card.rocket-fueling:before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent 0%,#667eea 50%,transparent 100%);animation:fueling-progress 2s ease-in-out infinite}.fueling-indicator{display:inline-flex;align-items:center;gap:.35rem;padding:.2rem .5rem;border-radius:12px;font-size:.7rem;font-weight:600;margin-left:auto;background:linear-gradient(135deg,#667eea,#764ba2);border:1px solid rgba(255,255,255,.3);color:#fff;box-shadow:0 2px 8px #667eea66}.fueling-badge{position:relative;display:flex;align-items:center;justify-content:center;width:16px;height:16px}.fueling-badge i{font-size:.75rem;color:gold;transform:rotate(-45deg);animation:fueling-bob 2s ease-in-out infinite;filter:drop-shadow(0 0 2px rgba(0,0,0,.5))}.fueling-drops{position:absolute;width:100%;height:100%;top:0;left:0}.fueling-drops:before,.fueling-drops:after{content:"";position:absolute;width:3px;height:3px;background:#ffd700cc;border-radius:50%;bottom:-6px;animation:fuel-drop 2s ease-in-out infinite}.fueling-drops:before{left:30%;animation-delay:0s}.fueling-drops:after{right:30%;animation-delay:.5s}.fueling-status{font-size:.7rem;white-space:nowrap;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3)}.task-card.rocket-active{position:relative;animation:card-glow-pulse 3s ease-in-out infinite}.task-card.rocket-active:before{content:"";position:absolute;top:-2px;right:-2px;bottom:-2px;left:-2px;border-radius:.5rem;background:linear-gradient(45deg,#667eea,#764ba2,#f093fb,#4facfe,#667eea);background-size:300% 300%;z-index:-1;animation:gradient-shift 4s ease infinite,glow-pulse 2s ease-in-out infinite;filter:blur(4px);opacity:.8}.task-card.rocket-active:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;border-radius:.5rem;background:inherit;z-index:-1}.rocket-indicator{display:inline-flex;align-items:center;gap:.4rem;padding:.25rem .6rem;border-radius:14px;font-size:.7rem;font-weight:600;margin-left:auto;background:linear-gradient(135deg,#667eea,#764ba2);border:1px solid rgba(255,255,255,.4);box-shadow:0 4px 16px #667eea80,0 0 20px #667eea4d;position:relative;overflow:hidden;animation:indicator-pulse 2s ease-in-out infinite}.rocket-indicator:before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.4),transparent);animation:shimmer 3s infinite}.rocket-badge{position:relative;display:flex;align-items:center;justify-content:center;width:18px;height:18px}.rocket-badge i{font-size:.85rem;color:gold;animation:rocket-fly 2s ease-in-out infinite;filter:drop-shadow(0 0 4px rgba(255,215,0,.9)) drop-shadow(0 0 2px rgba(0,0,0,.5));z-index:2}.rocket-trail{position:absolute;width:6px;height:6px;background:radial-gradient(circle,rgba(255,215,0,.9),transparent);border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);animation:trail-pulse 1s ease-in-out infinite;filter:blur(1px)}.rocket-timer{display:none;font-family:Courier New,monospace;font-size:.75rem;font-weight:700;color:#fff;text-shadow:0 1px 3px rgba(0,0,0,.5),0 0 10px rgba(255,255,255,.3);letter-spacing:.5px}.rocket-indicator:hover .rocket-timer{display:block}@keyframes card-glow-pulse{0%,to{transform:translateY(0)}50%{transform:translateY(-2px)}}@keyframes gradient-shift{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}@keyframes glow-pulse{0%,to{opacity:.6}50%{opacity:1}}@keyframes rocket-fly{0%,to{transform:translateY(0) translate(0) rotate(-45deg)}25%{transform:translateY(-3px) translate(2px) rotate(-43deg)}50%{transform:translateY(-5px) translate(3px) rotate(-45deg)}75%{transform:translateY(-3px) translate(2px) rotate(-47deg)}}@keyframes trail-pulse{0%,to{transform:translate(-50%,-50%) scale(1);opacity:.8}50%{transform:translate(-50%,-50%) scale(1.5);opacity:.4}}@keyframes shimmer{0%{transform:translate(-100%) translateY(-100%) rotate(45deg)}to{transform:translate(100%) translateY(100%) rotate(45deg)}}@keyframes fueling-progress{0%{transform:translate(-100%)}to{transform:translate(100%)}}@keyframes fueling-bob{0%,to{transform:rotate(-45deg) translateY(0)}50%{transform:rotate(-45deg) translateY(-2px)}}@keyframes fuel-drop{0%{transform:translateY(0);opacity:1}to{transform:translateY(8px);opacity:0}}@keyframes indicator-pulse{0%,to{box-shadow:0 4px 16px #667eea80,0 0 20px #667eea4d}50%{box-shadow:0 4px 20px #667eeab3,0 0 30px #667eea80}}body{background-color:#f8f9fa}.urgency-high{color:#dc3545}.urgency-med{color:#ffc107}.urgency-low{color:#28a745}.importance-high{background-color:#dc3545;color:#fff}.importance-med{background-color:#ffc107;color:#000}.importance-low{background-color:#28a745;color:#fff}.sidebar{background-color:#f8f9fa;border-right:1px solid #dee2e6}.sidebar-toggle{background:#6c757d;color:#fff}.sidebar-toggle:hover{background:#495057}.sidebar-nav-item{background:#fff;border:1px solid #dee2e6;color:#495057}.sidebar-nav-item:hover{background:#e9ecef;border-color:#6c757d}.sidebar-nav-item.active{background:#007bff;color:#fff;border-color:#007bff}.summary-card{background-color:#e9ecef}.summary-card p{color:#495057}.editable:hover{background-color:#f8f9fa}.editing{background-color:#fff3cd}.calendar-table td{border-color:#dee2e6}.task-event{background-color:#007bff;color:#fff}.calendar-controls{background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid #e9ecef;box-shadow:0 2px 4px #0000000d}.calendar-detail-section{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 8px #0000000d}.calendar-day-cell{background:#fff;border:1px solid #e9ecef}.calendar-day-cell:hover{background:#f8f9fa;box-shadow:0 4px 8px #0000001a}.calendar-day-cell.selected{background:#e7f3ff;border-color:#007bff}.calendar-day-cell.other-month{background:#fafafa;color:#adb5bd}.calendar-day-cell.today{background:#fff3cd;border-color:#ffc107}.calendar-task-indicator{background:#e7f3ff;color:#0056b3;border-left:3px solid #007bff}.calendar-hours-badge{background:#007bff1a;color:#0056b3}.progress-task-card{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 4px #0000000d}.progress-task-card:hover{box-shadow:0 4px 12px #0000001a}.progress-task-card.overdue{border-left:4px solid #dc3545}.task-card-header.status-not-started{background:linear-gradient(135deg,#e9ecef,#dee2e6);color:#495057}.task-card-header.status-in-progress{background:linear-gradient(135deg,#cfe2ff,#b6d4fe);color:#084298}.task-card-header.status-blocked{background:linear-gradient(135deg,#f8d7da,#f5c2c7);color:#842029}.task-card-header.status-completed{background:linear-gradient(135deg,#d1e7dd,#badbcc);color:#0a3622}.task-card-header.status-deferred{background:linear-gradient(135deg,#fff3cd,#ffecb5);color:#664d03}.urgency-indicator.urgency-high{background-color:#dc354533;color:#dc3545}.urgency-indicator.urgency-med{background-color:#ffc10733;color:#cc7a00}.urgency-indicator.urgency-low{background-color:#28a74533;color:#28a745}.task-reason-badge{background:#ffffff4d}.due-badge-reason,.time-badge-reason,.both-badge-reason{background-color:#6c757d26;color:#6c757d}.task-dates{color:#6c757d}.progress{background-color:#e9ecef}.progress-bar{background:linear-gradient(90deg,#007bff,#0056b3)}.progress-label{color:#6c757d}.kanban-column{background:#f8f9fa;border:1px solid #dee2e6}.kanban-column-header{color:#212529;border-bottom-color:#dee2e6}.kanban-column.status-not-started .kanban-column-header{border-bottom-color:#6c757d}.kanban-column.status-in-progress .kanban-column-header{border-bottom-color:#0d6efd}.kanban-column.status-blocked .kanban-column-header{border-bottom-color:#dc3545}.kanban-column.status-completed .kanban-column-header{border-bottom-color:#198754}.kanban-column.status-deferred .kanban-column-header{border-bottom-color:#ffc107}.task-count-badge{background:#0000001a;color:#495057}.kanban-task-card{background:#fff;border:1px solid #e9ecef;box-shadow:0 1px 3px #0000001a}.kanban-task-card:hover{box-shadow:0 4px 12px #00000026;border-color:#007bff}.kanban-task-meta{color:#6c757d}.board-detail-pane{background:#fff;border:1px solid #e9ecef;box-shadow:0 2px 8px #0000000d}.board-detail-empty{color:#6c757d}.detail-metric{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6}.detail-metric-label{color:#6c757d}.detail-metric-value{color:#212529}.detail-description,.detail-notes{background:#f8f9fa;color:#495057;border:1px solid #e9ecef}.detail-history-item,.detail-log-item{background:#f8f9fa;border:1px solid #e9ecef}.detail-history-date,.detail-log-date{color:#6c757d}.estimation-panel{background:linear-gradient(135deg,#e7f3ff,#cfe2ff);border:1px solid #b6d4fe}.estimation-title{color:#084298}.slider-label{color:#212529}.form-range{background:linear-gradient(to right,#e9ecef,#dee2e6)}.form-range::-webkit-slider-thumb{background:#007bff;border:2px solid white;box-shadow:0 2px 4px #0003}.form-range::-webkit-slider-thumb:hover{background:#0056b3;box-shadow:0 3px 8px #0000004d}.form-range::-moz-range-thumb{background:#007bff;border:2px solid white;box-shadow:0 2px 4px #0003}.form-range::-moz-range-thumb:hover{background:#0056b3;box-shadow:0 3px 8px #0000004d}.scale-hint{color:#6c757d}#velocityPrediction{background:linear-gradient(135deg,#d1e7dd,#badbcc);border:1px solid #a3cfbb;color:#0a3622}#velocityPrediction i{color:#198754}.work-session-section{border-top-color:#e9ecef}.work-session-info{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-color:#dee2e6}.work-session-row:not(:last-child){border-bottom-color:#dee2e6}.work-session-label{color:#495057}.work-session-value{color:#212529}.no-session-message{background:#f8f9fa;border-color:#dee2e6;color:#6c757d}.velocity-section{background:linear-gradient(135deg,#f8f9fa,#e9ecef);border:1px solid #dee2e6}.velocity-metric{background:#fff;border:1px solid #dee2e6}.velocity-metric-label{color:#6c757d}.velocity-metric-value{color:#007bff}.velocity-accuracy{background:#fff;border:1px solid #dee2e6}.accuracy-bar-container{background:#e9ecef}.accuracy-bar.within-range{background:linear-gradient(90deg,#28a745,#20c997);color:#fff}.accuracy-bar.underestimated{background:linear-gradient(90deg,#ffc107,#ffb300);color:#000}.accuracy-bar.overestimated{background:linear-gradient(90deg,#dc3545,#c82333);color:#fff}.velocity-interpretation{background:#fff3cd;border:1px solid #ffecb5;color:#664d03}.velocity-interpretation h5{color:#523502}.badge.bg-info{background-color:#0dcaf0!important;color:#000}.btn-outline-info{color:#0dcaf0;border-color:#0dcaf0}.btn-outline-info:hover{background-color:#0dcaf0;border-color:#0dcaf0;color:#000}.report-section{background:#fff;border:1px solid #e9ecef;border-radius:.5rem;padding:1.5rem;margin-bottom:1rem;box-shadow:0 2px 4px #0000000d}.report-section h4{color:#212529;border-bottom:2px solid #007bff;padding-bottom:.5rem;margin-bottom:1rem}.report-section .badge.bg-info{background-color:#0dcaf0!important}.rocket-indicator{color:#fff}.rocket-badge i{color:gold}.rocket-timer{color:#e0e7ff}</style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar for Quick Add -->
    <div class="sidebar" id="sidebar">
      <!-- Sidebar Toggle Button -->
      <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
        <i class="fas fa-chevron-left" id="toggleIcon"></i>
      </button>
      
      <!-- Sidebar Content (Hidden when collapsed) -->
      <div class="sidebar-content">
        <!--
        <h5 class="mb-3"><i class="fas fa-plus-circle"></i> Quick Add Task</h5>
      -->
        
        <!-- Selected Category Lists Badge Display -->
        <div id="selectedCategoryListsBadges" class="mb-3" style="display: none;">
          <div class="d-flex justify-content-between align-items-center mb-1">
            <div class="small text-muted">Active Category Lists:</div>
            <button class="btn btn-outline-secondary btn-sm" onclick="manageCategoryLists()" title="Manage category list selection">
              <i class="fas fa-cog fa-sm"></i>
            </button>
          </div>
          <div id="categoryListsBadgeContainer"></div>
        </div>
        
      <div class="quick-add-form">
        <div class="mb-3">
          <label class="form-label">Task Title</label>
          <input type="text" class="form-control" id="quickTaskTitle" placeholder="Enter task title..." required>
        </div>
        <div class="mb-3">
          <label class="form-label">Due Date</label>
          <input type="date" class="form-control" id="quickTaskDue" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Status</label>
          <select class="form-select" id="quickTaskStatus">
            <option value="Ready">Ready</option>
            <option value="Estimated">Estimated</option>
            <option value="InProgress">InProgress</option>
            <option value="Blocked">Blocked</option>
            <option value="Backburner">Backburner</option>
            <option value="OnHold">OnHold</option>
            <option value="Completed">Completed</option>
            <option value="Abandoned">Abandoned</option>
            <option value="Archived">Archived</option>
          </select>
        </div>
        <button class="btn btn-primary w-100 mb-3" id="quickAddBtn">
          <i class="fas fa-plus"></i> Add Task
        </button>
        
        <!-- Advanced Options Toggle -->
        <button class="btn btn-outline-secondary w-100 mb-2" id="expandAddBtn">
          <i class="fas fa-chevron-down"></i> More Options
        </button>
        
        <!-- Expanded form (hidden by default) -->
        <div id="expandedAddForm" style="display: none;">
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="quickTaskText" rows="3"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Notes</label>
            <textarea class="form-control" id="quickTaskNotes" rows="4" placeholder="Additional notes, links, reminders..."></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Urgency</label>
            <select class="form-select" id="quickTaskUrgency">
              <option value="Low">Low</option>
              <option value="Med">Med</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Importance</label>
            <select class="form-select" id="quickTaskImportance">
              <option value="Low">Low</option>
              <option value="Med">Med</option>
              <option value="High">High</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Estimate (hrs)</label>
            <input type="number" class="form-control" id="quickTaskEstimate" min="0" step="0.1" value="0">
          </div>
          <div class="mb-3">
            <label class="form-label">Remaining (hrs)</label>
            <input type="number" class="form-control" id="quickTaskRemaining" min="0" step="0.1" value="0">
            <small class="form-text text-muted">Auto-syncs with estimate until you manually edit it</small>
          </div>
          <div class="mb-3">
            <label class="form-label">Project</label>
            <select class="form-select" id="quickTaskProject">
              <option value="">No Project (AdHoc)</option>
              <!-- Projects will be populated here -->
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Phase</label>
            <select class="form-select" id="quickTaskPhase">
              <option value="">No Phase</option>
              <!-- Phases will be populated here -->
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Category Lists</label>
            <div id="quickTaskCategoryLists" class="category-lists-selector">
              <!-- Category lists will be populated here -->
            </div>
            <small class="form-text text-muted">Select which category lists to use for time logging on this task</small>
          </div>
        </div>
      </div>
      </div> <!-- End sidebar-content -->
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Header Bar -->
      <div class="header-bar">
        <h1 class="header-title"><i class="fas fa-tasks"></i> Task Time Tracker</h1>
        
        <!-- Global Filters -->
        <div class="global-filters">
          <select id="globalProjectFilter">
            <option value="">All Projects</option>
          </select>
          <select id="globalPhaseFilter">
            <option value="">All Phases</option>
          </select>
          <button class="filter-clear" id="globalFilterClear" title="Clear all filters">×</button>
        </div>
        
        <!-- Import/Export on the far right -->
        <div class="header-actions">
          <!-- Punch Clock Button -->
          <button class="btn btn-outline-primary btn-sm" id="punchClockBtn">
            <i class="fas fa-clock"></i> <span id="punchClockText">Punch In</span>
          </button>
          <!-- Category Lists Button -->
          <button class="btn btn-outline-info btn-sm" id="categoryListsBtn" data-bs-toggle="modal" data-bs-target="#categoryListsModal">
            <i class="fas fa-tags"></i> Categories
          </button>
          <!-- Projects Button -->
          <button class="btn btn-outline-warning btn-sm" id="projectsBtn" data-bs-toggle="modal" data-bs-target="#projectsModal">
            <i class="fas fa-project-diagram"></i> Projects
          </button>
          <!-- Phases Button -->
          <button class="btn btn-outline-secondary btn-sm" id="phasesBtn" data-bs-toggle="modal" data-bs-target="#phaseListsModal">
            <i class="fas fa-layer-group"></i> Phases
          </button>
          <!-- Todo List Button -->
          <button class="btn btn-outline-success btn-sm" id="todoListBtn" data-bs-toggle="modal" data-bs-target="#todoListModal">
            <i class="fas fa-list-check"></i>
          </button>
          <button class="btn btn-outline-secondary btn-sm" id="exportBtn">
            <i class="fas fa-download"></i> Export
          </button>
          <input type="file" id="importFile" accept=".json" style="display: none;">
          <button class="btn btn-outline-secondary btn-sm" id="importBtn">
            <i class="fas fa-upload"></i> Import
          </button>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <ul class="nav nav-tabs mb-3">
          <li class="nav-item">
            <a class="nav-link active" id="boardTab" href="#board">Board</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="monthTab" href="#month">Month</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="todayTab" href="#today">Today</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="reportsTab" href="#reports">
              <i class="fas fa-chart-bar me-1"></i>Reports
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="workTab" href="#work" style="display: none;">
              <i class="fas fa-edit me-1"></i>Work
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="spaceportTab" href="#spaceport">
              <i class="fas fa-rocket me-1"></i>SpacePort
            </a>
          </li>
        </ul>
    
    <div id="summary"></div>
    <div id="taskList"></div>
    
    <!-- SpacePort View -->
    <div id="spaceportView">
      <!-- Mission Control Panel - Hidden (building serves as interface) -->
      <div class="mission-control" style="display: none;">
        <div class="control-panel">
          <h6>◊ Mission Control ◊</h6>
          <div class="mission-list" id="missionList">
            <div class="text-center" style="color: #888; font-size: 0.8rem; padding: 20px;">
              Punch In to Load Missions
            </div>
          </div>
          
          <div class="launch-controls" id="launchControls">
            <div style="color: #fff; font-size: 0.8rem; margin-bottom: 8px;">
              Active Mission: <span id="activeMissionName">None</span>
            </div>
            <button class="launch-btn" id="launchBtn">
              🚀 Launch Mission
            </button>
          </div>
        </div>
      </div>
      
      <!-- Spaceport Stats -->
      <div class="spaceport-stats">
        <h6>◊ Spaceport Status ◊</h6>
        <div class="stat-row">
          <span>Active Rocket:</span>
          <span class="stat-value" id="activeRocketDisplay">None</span>
        </div>
        <div class="stat-row">
          <span>Mission Time:</span>
          <span class="stat-value" id="missionTimeDisplay">00:00:00</span>
        </div>
        <div class="stat-row">
          <span>Rockets Deployed:</span>
          <span class="stat-value" id="rocketsCount">0</span>
        </div>
        <div class="stat-row">
          <span>Energy Status:</span>
          <span class="stat-value" id="energyStatus">Standby</span>
        </div>
        
        <hr style="border-color: rgba(100, 150, 255, 0.3); margin: 10px 0;">
        
        <!-- Spaceship Picker -->
        <div class="spaceship-picker">
          <div class="spaceship-picker-header" id="spaceshipPickerToggle">
            <strong>◊ Spaceship Type ◊</strong>
            <span class="spaceship-current" id="spaceshipCurrent">Random</span>
            <span class="spaceship-toggle-icon">▼</span>
          </div>
          <div class="spaceship-options" id="spaceshipOptions" style="display: none;">
            <button class="spaceship-btn" data-type="random" title="Random - Auto-select based on task">
              <span class="spaceship-icon">🎲</span>
              <span class="spaceship-name">Random</span>
            </button>
            <button class="spaceship-btn" data-type="scout" title="Scout - Small and agile">
              <span class="spaceship-icon">🚀</span>
              <span class="spaceship-name">Scout</span>
            </button>
            <button class="spaceship-btn" data-type="v2" title="V2 - Technical missions">
              <span class="spaceship-icon">🛸</span>
              <span class="spaceship-name">V2</span>
            </button>
            <button class="spaceship-btn" data-type="apollo" title="Apollo - Large projects">
              <span class="spaceship-icon">🚁</span>
              <span class="spaceship-name">Apollo</span>
            </button>
            <button class="spaceship-btn" data-type="cartoon" title="Cartoon - Fun and creative">
              <span class="spaceship-icon">🎈</span>
              <span class="spaceship-name">Cartoon</span>
            </button>
            <button class="spaceship-btn" data-type="xwing" title="X-Wing - Rebel Alliance fighter">
              <span class="spaceship-icon">⚔️</span>
              <span class="spaceship-name">X-Wing</span>
            </button>
            <button class="spaceship-btn" data-type="tie" title="TIE Fighter - Imperial starfighter">
              <span class="spaceship-icon">⬢</span>
              <span class="spaceship-name">TIE Fighter</span>
            </button>
          </div>
        </div>
        
        <hr style="border-color: rgba(100, 150, 255, 0.3); margin: 10px 0;">
        <div style="font-size: 0.7rem; color: #888; line-height: 1.3;">
          <div><strong>Operations:</strong></div>
          <div>• Select mission to deploy rocket</div>
          <div>• Click rocket to switch context</div>
          <div>• Launch to commit time</div>
        </div>
      </div>
      
      <!-- Spaceport Canvas -->
      <canvas id="spaceportCanvas" width="1200" height="800"></canvas>
      
      <!-- Punch Controls -->
      <div class="punch-controls">
        <div class="punch-status-display" id="spaceportStatus">
          Mission Control Standby
        </div>
        <button class="punch-btn" id="spaceportPunchBtn">
          Initiate Operations
        </button>
      </div>
    </div>
      </div>
    </div>
  </div>

  <!-- Category Lists Manager Modal -->
  <div class="modal fade" id="categoryListsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-tags me-2"></i>Category Lists Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Lists Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Category Lists</h6>
                <button id="newCategoryListBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New List
                </button>
              </div>
              <div id="categoryListsContainer" class="list-group">
                <!-- Lists will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="categoryListEditor" style="display: none;">
                <form id="categoryListForm">
                  <div class="mb-3">
                    <label for="categoryListTitle" class="form-label">List Title</label>
                    <input type="text" class="form-control" id="categoryListTitle" required>
                    <div class="form-text">Slug: <span id="categoryListSlugPreview"></span></div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="categoryListDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="categoryListDescription" rows="2"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label mb-0">Categories</label>
                      <button type="button" id="addCategoryBtn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus me-1"></i>Add Category
                      </button>
                    </div>
                    <div id="categoriesContainer" class="border rounded p-2" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                      <!-- Categories will be populated here -->
                    </div>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save List
                    </button>
                    <button type="button" id="deleteCategoryListBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete List
                    </button>
                    <button type="button" id="cancelCategoryListBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="categoryListPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-tags fa-3x mb-3 opacity-50"></i>
                <p>Select a category list to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Projects Manager Modal -->
  <div class="modal fade" id="projectsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-project-diagram me-2"></i>Projects Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Projects Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Projects</h6>
                <button id="newProjectBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New Project
                </button>
              </div>
              <div id="projectsContainer" class="list-group">
                <!-- Projects will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="projectEditor" style="display: none;">
                <form id="projectForm">
                  <div class="mb-3">
                    <label for="projectName" class="form-label">Project Name</label>
                    <input type="text" class="form-control" id="projectName" required>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="projectDescription" rows="3"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectStatus" class="form-label">Status</label>
                    <select class="form-select" id="projectStatus" required>
                      <option value="Ready">Ready</option>
                      <option value="Estimated">Estimated</option>
                      <option value="InProgress">In Progress</option>
                      <option value="Blocked">Blocked</option>
                      <option value="Backburner">Backburner</option>
                      <option value="OnHold">On Hold</option>
                      <option value="Completed">Completed</option>
                      <option value="Abandoned">Abandoned</option>
                      <option value="Archived">Archived</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label for="projectPhaseList" class="form-label">Phase List</label>
                    <select class="form-select" id="projectPhaseList">
                      <option value="">No Phase List</option>
                      <!-- Phase lists will be populated here -->
                    </select>
                    <small class="form-text text-muted">Select a phase list to associate with this project</small>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save Project
                    </button>
                    <button type="button" id="deleteProjectBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete Project
                    </button>
                    <button type="button" id="cancelProjectBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="projectPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-project-diagram fa-3x mb-3 opacity-50"></i>
                <p>Select a project to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Phase Lists Manager Modal -->
  <div class="modal fade" id="phaseListsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-layer-group me-2"></i>Phase Lists Manager
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <!-- Lists Panel -->
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Phase Lists</h6>
                <button id="newPhaseListBtn" class="btn btn-primary btn-sm">
                  <i class="fas fa-plus me-1"></i>New List
                </button>
              </div>
              <div id="phaseListsContainer" class="list-group">
                <!-- Lists will be populated here -->
              </div>
            </div>
            
            <!-- Editor Panel -->
            <div class="col-md-8">
              <div id="phaseListEditor" style="display: none;">
                <form id="phaseListForm">
                  <div class="mb-3">
                    <label for="phaseListTitle" class="form-label">List Title</label>
                    <input type="text" class="form-control" id="phaseListTitle" required>
                    <div class="form-text">Slug: <span id="phaseListSlugPreview"></span></div>
                  </div>
                  
                  <div class="mb-3">
                    <label for="phaseListDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="phaseListDescription" rows="2"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <label class="form-label mb-0">Phases</label>
                      <button type="button" id="addPhaseBtn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-plus me-1"></i>Add Phase
                      </button>
                    </div>
                    <div id="phasesContainer" class="border rounded p-2" style="min-height: 200px; max-height: 300px; overflow-y: auto;">
                      <!-- Phases will be populated here -->
                    </div>
                  </div>
                  
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-success">
                      <i class="fas fa-save me-1"></i>Save List
                    </button>
                    <button type="button" id="deletePhaseListBtn" class="btn btn-danger" style="display: none;">
                      <i class="fas fa-trash me-1"></i>Delete List
                    </button>
                    <button type="button" id="cancelPhaseListBtn" class="btn btn-secondary">
                      Cancel
                    </button>
                  </div>
                </form>
              </div>
              
              <div id="phaseListPlaceholder" class="text-center text-muted py-5">
                <i class="fas fa-layer-group fa-3x mb-3 opacity-50"></i>
                <p>Select a phase list to edit, or create a new one.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Todo List Modal -->
  <div class="modal fade" id="todoListModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-list-check me-2"></i>Todo List
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <!-- Todo Form -->
          <div class="todo-form mb-4">
            <div class="input-group mb-2">
              <input type="text" id="modalTodoTitleInput" class="form-control" placeholder="Add a new todo..." maxlength="100">
              <button class="btn btn-primary" type="button" id="modalTodoAddBtn">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div id="modalTodoDetailsInput" class="todo-details" style="display: none;">
              <textarea class="form-control" placeholder="Optional details..." rows="2" maxlength="300"></textarea>
              <div class="mt-2 d-flex justify-content-end gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="modalCancelTodoDetails">Cancel</button>
                <button class="btn btn-sm btn-success" id="modalSubmitTodoWithDetails">Add Todo</button>
              </div>
            </div>
            <small class="text-muted">Press Enter to add quickly, or click + for details</small>
          </div>
          
          <!-- Todo List Controls -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h6 class="mb-0">Your Todos</h6>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="modalShowCompletedTodos">
              <label class="form-check-label" for="modalShowCompletedTodos">
                Show completed
              </label>
            </div>
          </div>
          
          <!-- Todo List Container -->
          <div id="modalTodosList" style="max-height: 400px; overflow-y: auto;">
            <!-- Todos will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Details Modal -->
  <div class="modal fade" id="taskDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-tasks me-2"></i>Task Details
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="taskDetailsForm">
            <input type="hidden" id="taskDetailsId">
            
            <div class="row">
              <div class="col-md-8">
                <div class="mb-3">
                  <label for="taskDetailsTitle" class="form-label">Title</label>
                  <input type="text" class="form-control" id="taskDetailsTitle" required>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsDescription" class="form-label">Description</label>
                  <textarea class="form-control" id="taskDetailsDescription" rows="3"></textarea>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsNotes" class="form-label">Notes</label>
                  <textarea class="form-control" id="taskDetailsNotes" rows="4"></textarea>
                </div>
              </div>
              
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="taskDetailsDueOn" class="form-label">Due Date</label>
                  <input type="date" class="form-control" id="taskDetailsDueOn" required>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsStatus" class="form-label">Status</label>
                  <select class="form-select" id="taskDetailsStatus">
                    <option value="Ready">Ready</option>
                    <option value="Estimated">Estimated</option>
                    <option value="InProgress">InProgress</option>
                    <option value="Blocked">Blocked</option>
                    <option value="Backburner">Backburner</option>
                    <option value="OnHold">OnHold</option>
                    <option value="Completed">Completed</option>
                    <option value="Abandoned">Abandoned</option>
                    <option value="Archived">Archived</option>
                  </select>
                </div>
                
                <div class="row">
                  <div class="col-6">
                    <div class="mb-3">
                      <label for="taskDetailsUrgency" class="form-label">Urgency</label>
                      <select class="form-select" id="taskDetailsUrgency">
                        <option value="Low">Low</option>
                        <option value="Med">Med</option>
                        <option value="High">High</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="mb-3">
                      <label for="taskDetailsImportance" class="form-label">Importance</label>
                      <select class="form-select" id="taskDetailsImportance">
                        <option value="Low">Low</option>
                        <option value="Med">Med</option>
                        <option value="High">High</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="taskDetailsEstimate" class="form-label">Estimate (hrs)</label>
                  <input type="number" class="form-control" id="taskDetailsEstimate" min="0" step="0.1" value="0">
                </div>
              </div>
            </div>
            
            <hr>
            
            <div class="row">
              <div class="col-6">
                <div class="mb-3">
                  <label for="taskDetailsProject" class="form-label">Project</label>
                  <select class="form-select" id="taskDetailsProject">
                    <option value="">No Project (AdHoc)</option>
                    <!-- Projects will be populated here -->
                  </select>
                </div>
              </div>
              <div class="col-6">
                <div class="mb-3">
                  <label for="taskDetailsPhase" class="form-label">Phase</label>
                  <select class="form-select" id="taskDetailsPhase">
                    <option value="">No Phase</option>
                    <!-- Phases will be populated here -->
                  </select>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Category Lists</label>
              <div id="taskDetailsCategoryLists" class="category-lists-selector">
                <!-- Category lists will be populated here -->
              </div>
              <small class="form-text text-muted">Select which category lists to use for time logging on this task</small>
            </div>
            
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-1"></i>Save Changes
              </button>
              <button type="button" id="deleteTaskDetailsBtn" class="btn btn-outline-danger">
                <i class="fas fa-trash me-1"></i>Delete Task
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Time Log Modal -->
  <div class="modal fade" id="timeLogModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-clock me-2"></i>Log Time
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="timeLogForm">
            <input type="hidden" id="timeLogTaskId">
            
            <div class="mb-3">
              <label class="form-label fw-semibold">Task</label>
              <div id="timeLogTaskDisplay" class="p-2 bg-light rounded">
                <!-- Task title will be displayed here -->
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="timeLogHours" class="form-label">Hours</label>
                  <input type="number" class="form-control" id="timeLogHours" 
                         min="0" step="0.25" placeholder="0.0" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="timeLogDate" class="form-label">Date</label>
                  <input type="date" class="form-control" id="timeLogDate" required>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label class="form-label">Category</label>
              <div id="timeLogCategoryContainer">
                <!-- Category selector will be populated here -->
              </div>
            </div>
            
            <div class="mb-3">
              <label for="timeLogDescription" class="form-label">Description (optional)</label>
              <textarea class="form-control" id="timeLogDescription" rows="3" 
                        placeholder="What did you work on?"></textarea>
            </div>
            
            <div class="d-flex justify-content-between">
              <div class="d-flex gap-2">
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="0.25">15m</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="0.5">30m</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="1">1h</button>
                <button type="button" class="btn btn-outline-secondary quick-time" data-hours="2">2h</button>
              </div>
              <button type="submit" class="btn btn-success">
                <i class="fas fa-save me-1"></i>Log Time
              </button>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-danger delete-task-btn" data-task-id="" title="Delete Task">
            <i class="fas fa-trash me-1"></i>Delete Task
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="deleteConfirmModalLabel">
            <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center mb-3">
            <div class="bg-danger bg-opacity-10 rounded-circle p-3 me-3">
              <i class="fas fa-trash text-danger fa-2x"></i>
            </div>
            <div>
              <h6 class="mb-1">Are you sure you want to delete this item?</h6>
              <p class="text-muted mb-0" id="deleteConfirmMessage">This action cannot be undone.</p>
            </div>
          </div>
          <div class="alert alert-warning mb-0">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Warning:</strong> <span id="deleteWarningText">This will permanently delete the item and all associated data.</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-2"></i>Cancel
          </button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
            <i class="fas fa-trash me-2"></i>Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container for Notifications -->
  <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <!-- Toasts will be dynamically added here -->
  </div>

  <!-- Punch Clock Modal -->
  <div class="modal fade" id="punchClockModal" tabindex="-1" aria-labelledby="punchClockModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="punchClockModalLabel">
            <i class="fas fa-clock me-2"></i>Time Clock Station
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Punch Card Visual -->
          <div class="punch-card-container text-center mb-4">
            <div class="punch-card">
              <div class="punch-card-header">
                <h6 class="mb-1">Daily Time Card</h6>
                <div class="card-date" id="punchCardDate"></div>
              </div>
              <div class="punch-card-content">
                <div class="time-slots" id="timeSlots" style="max-height: 150px; overflow-y: auto;">
                  <!-- Dynamic time slots will be added here -->
                </div>
              </div>
            </div>
          </div>

          <!-- Current Status -->
          <div class="current-status text-center mb-4">
            <div class="status-display" id="currentStatus">
              <div class="status-icon" id="statusIcon">🕘</div>
              <div class="status-text" id="statusText">Ready to Start Work</div>
              <div class="status-time" id="statusTime"></div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons text-center">
            <!-- Validation Messages -->
            <div class="validation-message warning" id="punchOutWarning">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <span id="punchOutWarningText"></span>
              <div class="mt-2">
                <button class="btn btn-sm btn-warning me-2" id="confirmEarlyPunchOut">Yes, End Early</button>
                <button class="btn btn-sm btn-secondary" id="cancelEarlyPunchOut">Continue Working</button>
              </div>
            </div>

            <!-- Primary Action (Punch In/Out) -->
            <div class="primary-action mb-3">
              <button class="btn btn-lg punch-btn" id="primaryPunchBtn">
                <i class="fas fa-play"></i>
                <span id="primaryPunchText">Start Work Day</span>
              </button>
            </div>

            <!-- Interruption Buttons (shown when punched in) -->
            <div class="interruption-buttons" id="interruptionButtons" style="display: none;">
              <!-- Return to Work button (shown when on break) -->
              <div class="return-to-work mb-3" id="returnToWorkSection" style="display: none;">
                <button class="btn btn-success w-100" id="returnToWorkBtn">
                  <i class="fas fa-briefcase"></i> Return to Work
                </button>
              </div>
              
              <div class="row g-2 mb-3" id="interruptionButtonsRow">
                <div class="col-4">
                  <button class="btn btn-outline-warning w-100" id="lunchBtn">
                    <i class="fas fa-utensils me-1"></i>Lunch
                  </button>
                </div>
                <div class="col-4">
                  <button class="btn btn-outline-info w-100" id="meetingBtn">
                    <i class="fas fa-users me-1"></i>Meeting
                  </button>
                </div>
                <div class="col-4">
                  <button class="btn btn-outline-secondary w-100" id="personalBtn">
                    <i class="fas fa-user me-1"></i>Personal
                  </button>
                </div>
              </div>
              <div class="custom-interruption">
                <div class="input-group">
                  <input type="text" class="form-control" id="customInterruptionInput" placeholder="Custom interruption...">
                  <button class="btn btn-outline-primary" id="addCustomInterruptionBtn">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Daily Summary -->
          <div class="daily-summary" id="dailySummary">
            <hr>
            <h6><i class="fas fa-chart-bar me-2"></i>Today's Summary</h6>
            <div class="row text-center">
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="totalHours">0h 0m</div>
                  <div class="summary-label">Total</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="workHours">0h 0m</div>
                  <div class="summary-label">Work</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="breakHours">0h 0m</div>
                  <div class="summary-label">Breaks</div>
                </div>
              </div>
              <div class="col-3">
                <div class="summary-item">
                  <div class="summary-value" id="currentSession">0h 0m</div>
                  <div class="summary-label">Session</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Time Entry Modal -->
  <div class="modal fade" id="quickTimeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-clock me-2"></i>Log Time</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="quickTimeTaskId">
          <div class="mb-3">
            <label for="quickTimeHours" class="form-label">Hours</label>
            <input type="number" class="form-control" id="quickTimeHours" step="0.25" min="0" placeholder="e.g., 1.5">
          </div>
          <div class="mb-3">
            <label for="quickTimeDate" class="form-label">Date</label>
            <input type="date" class="form-control" id="quickTimeDate">
          </div>
          <div class="mb-3">
            <label for="quickTimeNotes" class="form-label">Notes (optional)</label>
            <textarea class="form-control" id="quickTimeNotes" rows="2" placeholder="What did you work on?"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveQuickTimeBtn">Log Time</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>